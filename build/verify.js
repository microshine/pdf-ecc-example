/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var e;
/*!
 Copyright (c) Peculiar Ventures, LLC
*/
function t(e,t,r){var s;return e instanceof Object==!1?r:null!==(s=e[t])&&void 0!==s?s:r}function r(e,t=0,r=e.byteLength-t,s=!1){let n="";for(const i of new Uint8Array(e,t,r)){const e=i.toString(16).toUpperCase();1===e.length&&(n+="0"),n+=e,s&&(n+=" ")}return n.trim()}function s(e,t,r,s){return t instanceof ArrayBuffer?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):s<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-s<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1)}function n(e,t){let r=0;if(1===e.length)return e[0];for(let s=e.length-1;s>=0;s--)r+=e[e.length-1-s]*Math.pow(2,t*s);return r}function i(e,t,r=-1){const s=r;let n=e,i=0,a=Math.pow(2,t);for(let r=1;r<8;r++){if(e<a){let e;if(s<0)e=new ArrayBuffer(r),i=r;else{if(s<r)return new ArrayBuffer(0);e=new ArrayBuffer(s),i=s}const a=new Uint8Array(e);for(let e=r-1;e>=0;e--){const r=Math.pow(2,e*t);a[i-e-1]=Math.floor(n/r),n-=a[i-e-1]*r}return e}a*=Math.pow(2,t)}return new ArrayBuffer(0)}function a(...e){let t=0,r=0;for(const r of e)t+=r.byteLength;const s=new ArrayBuffer(t),n=new Uint8Array(s);for(const t of e)n.set(new Uint8Array(t),r),r+=t.byteLength;return s}function o(...e){let t=0,r=0;for(const r of e)t+=r.length;const s=new ArrayBuffer(t),n=new Uint8Array(s);for(const t of e)n.set(t,r),r+=t.length;return n}function c(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(t);for(let e=0;e<this.valueHex.byteLength;e++)r[e]=0;r[0]=128&e[0];const s=n(r,8),i=new ArrayBuffer(this.valueHex.byteLength),a=new Uint8Array(i);for(let t=0;t<this.valueHex.byteLength;t++)a[t]=e[t];a[0]&=127;return n(a,8)-s}function l(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==s[e])return!1;return!0}function h(e,t){const r=e.toString(10);if(t<r.length)return"";const s=t-r.length,n=new Array(s);for(let e=0;e<s;e++)n[e]="0";return n.join("").concat(r)}!function(e){!function(t){var r="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),s=n(e);function n(e,t){return function(r,s){"function"!=typeof e[r]&&Object.defineProperty(e,r,{configurable:!0,writable:!0,value:s}),t&&t(r,s)}}void 0===r.Reflect?r.Reflect=e:s=n(r.Reflect,s),function(e){var t=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,s=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",i="function"==typeof Object.create,a={__proto__:[]}instanceof Array,o=!i&&!a,c={create:i?function(){return se(Object.create(null))}:a?function(){return se({__proto__:null})}:function(){return se({})},has:o?function(e,r){return t.call(e,r)}:function(e,t){return t in e},get:o?function(e,r){return t.call(e,r)?e[r]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),h="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,u=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ee():Map,p=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?te():Set,d=new(h||"function"!=typeof WeakMap?re():WeakMap);function f(e,t,r,s){if(R(r)){if(!q(e))throw new TypeError;if(!G(t))throw new TypeError;return C(e,t)}if(!q(e))throw new TypeError;if(!F(t))throw new TypeError;if(!F(s)&&!R(s)&&!_(s))throw new TypeError;return _(s)&&(s=void 0),I(e,t,r=K(r),s)}function m(e,t){function r(r,s){if(!F(r))throw new TypeError;if(!R(s)&&!z(s))throw new TypeError;D(e,t,r,s)}return r}function g(e,t,r,s){if(!F(r))throw new TypeError;return R(s)||(s=K(s)),D(e,t,r,s)}function y(e,t,r){if(!F(t))throw new TypeError;return R(r)||(r=K(r)),E(e,t,r)}function v(e,t,r){if(!F(t))throw new TypeError;return R(r)||(r=K(r)),B(e,t,r)}function w(e,t,r){if(!F(t))throw new TypeError;return R(r)||(r=K(r)),N(e,t,r)}function b(e,t,r){if(!F(t))throw new TypeError;return R(r)||(r=K(r)),P(e,t,r)}function S(e,t){if(!F(e))throw new TypeError;return R(t)||(t=K(t)),U(e,t)}function A(e,t){if(!F(e))throw new TypeError;return R(t)||(t=K(t)),O(e,t)}function k(e,t,r){if(!F(t))throw new TypeError;R(r)||(r=K(r));var s=x(t,r,!1);if(R(s))return!1;if(!s.delete(e))return!1;if(s.size>0)return!0;var n=d.get(t);return n.delete(r),n.size>0||d.delete(t),!0}function C(e,t){for(var r=e.length-1;r>=0;--r){var s=(0,e[r])(t);if(!R(s)&&!_(s)){if(!G(s))throw new TypeError;t=s}}return t}function I(e,t,r,s){for(var n=e.length-1;n>=0;--n){var i=(0,e[n])(t,r,s);if(!R(i)&&!_(i)){if(!F(i))throw new TypeError;s=i}}return s}function x(e,t,r){var s=d.get(e);if(R(s)){if(!r)return;s=new u,d.set(e,s)}var n=s.get(t);if(R(n)){if(!r)return;n=new u,s.set(t,n)}return n}function E(e,t,r){if(B(e,t,r))return!0;var s=Z(t);return!_(s)&&E(e,s,r)}function B(e,t,r){var s=x(t,r,!1);return!R(s)&&H(s.has(e))}function N(e,t,r){if(B(e,t,r))return P(e,t,r);var s=Z(t);return _(s)?void 0:N(e,s,r)}function P(e,t,r){var s=x(t,r,!1);if(!R(s))return s.get(e)}function D(e,t,r,s){x(r,s,!0).set(e,t)}function U(e,t){var r=O(e,t),s=Z(e);if(null===s)return r;var n=U(s,t);if(n.length<=0)return r;if(r.length<=0)return n;for(var i=new p,a=[],o=0,c=r;o<c.length;o++){var l=c[o];i.has(l)||(i.add(l),a.push(l))}for(var h=0,u=n;h<u.length;h++){l=u[h];i.has(l)||(i.add(l),a.push(l))}return a}function O(e,t){var r=[],s=x(e,t,!1);if(R(s))return r;for(var n=$(s.keys()),i=0;;){var a=X(n);if(!a)return r.length=i,r;var o=Y(a);try{r[i]=o}catch(e){try{Q(n)}finally{throw e}}i++}}function T(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function R(e){return void 0===e}function _(e){return null===e}function V(e){return"symbol"==typeof e}function F(e){return"object"==typeof e?null!==e:"function"==typeof e}function L(e,t){switch(T(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",n=J(e,s);if(void 0!==n){var i=n.call(e,r);if(F(i))throw new TypeError;return i}return j(e,"default"===r?"number":r)}function j(e,t){if("string"===t){var r=e.toString;if(W(r))if(!F(n=r.call(e)))return n;if(W(s=e.valueOf))if(!F(n=s.call(e)))return n}else{var s;if(W(s=e.valueOf))if(!F(n=s.call(e)))return n;var n,i=e.toString;if(W(i))if(!F(n=i.call(e)))return n}throw new TypeError}function H(e){return!!e}function M(e){return""+e}function K(e){var t=L(e,3);return V(t)?t:M(t)}function q(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function W(e){return"function"==typeof e}function G(e){return"function"==typeof e}function z(e){switch(T(e)){case 3:case 4:return!0;default:return!1}}function J(e,t){var r=e[t];if(null!=r){if(!W(r))throw new TypeError;return r}}function $(e){var t=J(e,n);if(!W(t))throw new TypeError;var r=t.call(e);if(!F(r))throw new TypeError;return r}function Y(e){return e.value}function X(e){var t=e.next();return!t.done&&t}function Q(e){var t=e.return;t&&t.call(e)}function Z(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var r=e.prototype,s=r&&Object.getPrototypeOf(r);if(null==s||s===Object.prototype)return t;var n=s.constructor;return"function"!=typeof n||n===e?t:n}function ee(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[n]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var s=this._keys.length,n=r+1;n<s;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,s)},t.prototype.values=function(){return new r(this._keys,this._values,i)},t.prototype.entries=function(){return new r(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[n]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function s(e,t){return e}function i(e,t){return t}function a(e,t){return[e,t]}}function te(){return function(){function e(){this._map=new u}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[n]=function(){return this.keys()},e}()}function re(){var e=16,r=c.create(),s=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var e;do{e="@@WeakMap@@"+l()}while(c.has(r,e));return r[e]=!0,e}function i(e,r){if(!t.call(e,s)){if(!r)return;Object.defineProperty(e,s,{value:c.create()})}return e[s]}function a(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function o(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e)}function l(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",s=0;s<e;++s){var n=t[s];4!==s&&6!==s&&8!==s||(r+="-"),n<16&&(r+="0"),r+=n.toString(16).toLowerCase()}return r}}function se(e){return e.__=void 0,delete e.__,e}e("decorate",f),e("metadata",m),e("defineMetadata",g),e("hasMetadata",y),e("hasOwnMetadata",v),e("getMetadata",w),e("getOwnMetadata",b),e("getMetadataKeys",S),e("getOwnMetadataKeys",A),e("deleteMetadata",k)}(s)}()}(e||(e={}));const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function d(e,t=!1,r=!1,s=!1){let n=0,i=0,a=0,o="";const c=t?p:u;if(s){let t=0;for(let r=0;r<e.length;r++)if(0!==e.charCodeAt(r)){t=r;break}e=e.slice(t)}for(;n<e.length;){const t=e.charCodeAt(n++);n>=e.length&&(i=1);const s=e.charCodeAt(n++);n>=e.length&&(a=1);const l=e.charCodeAt(n++),h=t>>2,u=(3&t)<<4|s>>4;let p=(15&s)<<2|l>>6,d=63&l;1===i?p=d=64:1===a&&(d=64),o+=r?64===p?`${c.charAt(h)}${c.charAt(u)}`:64===d?`${c.charAt(h)}${c.charAt(u)}${c.charAt(p)}`:`${c.charAt(h)}${c.charAt(u)}${c.charAt(p)}${c.charAt(d)}`:`${c.charAt(h)}${c.charAt(u)}${c.charAt(p)}${c.charAt(d)}`}return o}function f(e,t=!1,r=!1){const s=t?p:u;function n(e){for(let t=0;t<64;t++)if(s.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}let a=0,o="";for(;a<e.length;){const t=n(e.charAt(a++)),r=a>=e.length?0:n(e.charAt(a++)),s=a>=e.length?0:n(e.charAt(a++)),c=a>=e.length?0:n(e.charAt(a++)),l=i(t)<<2|i(r)>>4,h=(15&i(r))<<4|i(s)>>2,u=(3&i(s))<<6|i(c);o+=String.fromCharCode(l),64!==s&&(o+=String.fromCharCode(h)),64!==c&&(o+=String.fromCharCode(u))}if(r){let e=-1;for(let t=o.length-1;t>=0;t--)if(0!==o.charCodeAt(t)){e=t;break}o=-1!==e?o.slice(0,e+1):""}return o}function m(e){let t="";const r=new Uint8Array(e);for(const e of r)t+=String.fromCharCode(e);return t}function g(e){const t=e.length,r=new ArrayBuffer(t),s=new Uint8Array(r);for(let r=0;r<t;r++)s[r]=e.charCodeAt(r);return r}const y=Math.log(2);function v(e){const t=Math.log(e)/y,r=Math.floor(t),s=Math.round(t);return r===s?r:s}function w(e,t){for(const r of t)delete e[r]}function b(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}const S=[new Uint8Array([1])];class A{constructor(e={}){this.blockLength=t(e,"blockLength",0),this.error=t(e,"error",""),this.warnings=t(e,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in e?e.valueBeforeDecode.slice(0):new ArrayBuffer(0)}static blockName(){return"baseBlock"}toJSON(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:r(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}const k=e=>class extends e{constructor(e={}){super(e),this.isHexOnly=t(e,"isHexOnly",!1),this.valueHex="valueHex"in e?e.valueHex.slice(0):new ArrayBuffer(0)}static blockName(){return"hexBlock"}fromBER(e,t,r){if(!1===s(this,e,t,r))return-1;return 0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}toBER(e=!1){return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}};class C extends(k(A)){constructor(e={}){super(),"idBlock"in e?(this.isHexOnly=t(e.idBlock,"isHexOnly",!1),this.valueHex=t(e.idBlock,"valueHex",new ArrayBuffer(0)),this.tagClass=t(e.idBlock,"tagClass",-1),this.tagNumber=t(e.idBlock,"tagNumber",-1),this.isConstructed=t(e.idBlock,"isConstructed",!1)):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}static blockName(){return"identificationBlock"}toBER(e=!1){let t,r,s=0;switch(this.tagClass){case 1:s|=0;break;case 2:s|=64;break;case 3:s|=128;break;case 4:s|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(s|=32),this.tagNumber<31&&!this.isHexOnly){if(t=new ArrayBuffer(1),r=new Uint8Array(t),!e){let e=this.tagNumber;e&=31,s|=e,r[0]=s}return t}if(!1===this.isHexOnly){const n=i(this.tagNumber,7),a=new Uint8Array(n),o=n.byteLength;if(t=new ArrayBuffer(o+1),r=new Uint8Array(t),r[0]=31|s,!e){for(let e=0;e<o-1;e++)r[e+1]=128|a[e];r[o]=a[o-1]}return t}if(t=new ArrayBuffer(this.valueHex.byteLength+1),r=new Uint8Array(t),r[0]=31|s,!1===e){const e=new Uint8Array(this.valueHex);for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHex.byteLength]=e[e.length-1]}return t}fromBER(e,t,r){if(!1===s(this,e,t,r))return-1;const i=new Uint8Array(e,t,r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&i[0]),this.isHexOnly=!1;const a=31&i[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{let e=1;this.valueHex=new ArrayBuffer(255);let t=255,r=new Uint8Array(this.valueHex);for(;128&i[e];){if(r[e-1]=127&i[e],e++,e>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(e===t){t+=255;const e=new ArrayBuffer(t),s=new Uint8Array(e);for(let e=0;e<r.length;e++)s[e]=r[e];this.valueHex=new ArrayBuffer(t),r=new Uint8Array(this.valueHex)}}this.blockLength=e+1,r[e-1]=127&i[e];const s=new ArrayBuffer(e),a=new Uint8Array(s);for(let t=0;t<e;t++)a[t]=r[t];this.valueHex=new ArrayBuffer(e),r=new Uint8Array(this.valueHex),r.set(a),this.blockLength<=9?this.tagNumber=n(r,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}class I extends A{constructor(e={}){super(),"lenBlock"in e?(this.isIndefiniteForm=t(e.lenBlock,"isIndefiniteForm",!1),this.longFormUsed=t(e.lenBlock,"longFormUsed",!1),this.length=t(e.lenBlock,"length",0)):(this.isIndefiniteForm=!1,this.longFormUsed=!1,this.length=0)}static blockName(){return"lengthBlock"}fromBER(e,t,r){if(!1===s(this,e,t,r))return-1;const i=new Uint8Array(e,t,r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;const a=127&i[0];if(a>8)return this.error="Too big integer",-1;if(a+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const o=new Uint8Array(a);for(let e=0;e<a;e++)o[e]=i[e+1];return 0===o[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=n(o,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=128),t;if(!0===this.longFormUsed){const s=i(this.length,8);if(s.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(t=new ArrayBuffer(s.byteLength+1),!0===e)return t;const n=new Uint8Array(s);r=new Uint8Array(t),r[0]=128|s.byteLength;for(let e=0;e<s.byteLength;e++)r[e+1]=n[e];return t}return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}class x extends A{constructor(e={}){super(e)}static blockName(){return"valueBlock"}fromBER(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}toBER(e=!1){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}class E extends A{constructor(e={},t=x){super(e),"name"in e&&(this.name=e.name),"optional"in e&&(this.optional=e.optional),"primitiveSchema"in e&&(this.primitiveSchema=e.primitiveSchema),this.idBlock=new C(e),this.lenBlock=new I(e),this.valueBlock=new t(e)}static blockName(){return"BaseBlock"}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}toBER(e=!1){let t;const r=this.idBlock.toBER(e),s=this.valueBlock.toBER(!0);this.lenBlock.length=s.byteLength;let n;if(t=a(r,this.lenBlock.toBER(e)),n=!1===e?this.valueBlock.toBER(e):new ArrayBuffer(this.lenBlock.length),t=a(t,n),!0===this.lenBlock.isIndefiniteForm){const r=new ArrayBuffer(2);if(!1===e){const e=new Uint8Array(r);e[0]=0,e[1]=0}t=a(t,r)}return t}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),"name"in this&&(e.name=this.name),"optional"in this&&(e.optional=this.optional),"primitiveSchema"in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(){return`${this.constructor.blockName()} : ${r(this.valueBlock.valueHex)}`}}class B extends x{constructor(e={}){super(e),this.valueHex="valueHex"in e?e.valueHex.slice(0):new ArrayBuffer(0),this.isHexOnly=t(e,"isHexOnly",!0)}fromBER(e,t,r){if(!1===s(this,e,t,r))return-1;const n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);const i=new Uint8Array(this.valueHex);for(let e=0;e<n.length;e++)i[e]=n[e];return this.blockLength=r,t+r}toBER(e=!1){return this.valueHex.slice(0)}static blockName(){return"PrimitiveValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}class N extends E{constructor(e={}){super(e,B),this.idBlock.isConstructed=!1}static blockName(){return"PRIMITIVE"}}class P extends x{constructor(e={}){super(e),this.value=t(e,"value",[]),this.isIndefiniteForm=t(e,"isIndefiniteForm",!1)}fromBER(e,t,r){const n=t,i=r;if(!1===s(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;let a=t;for(;o=this.isIndefiniteForm,c=r,(!0===o?1:c)>0;){const t=xe(e,a,r);if(-1===t.offset)return this.error=t.result.error,this.warnings.concat(t.result.warnings),-1;if(a=t.offset,this.blockLength+=t.result.blockLength,r-=t.result.blockLength,this.value.push(t.result),!0===this.isIndefiniteForm&&t.result.constructor.blockName()===O.blockName())break}var o,c;return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===O.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+i),a}toBER(e=!1){let t=new ArrayBuffer(0);for(let r=0;r<this.value.length;r++){t=a(t,this.value[r].toBER(e))}return t}static blockName(){return"ConstructedValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(let t=0;t<this.value.length;t++)e.value.push(this.value[t].toJSON());return e}}class D extends E{constructor(e={}){super(e,P),this.idBlock.isConstructed=!0}static blockName(){return"CONSTRUCTED"}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}toString(){const e=[];for(const t of this.valueBlock.value)e.push(t.toString().split("\n").map((e=>`  ${e}`)).join("\n"));const t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.blockName();return e.length?`${t} :\n${e.join("\n")}`:`${t} :`}}class U extends x{constructor(e={}){super(e)}fromBER(e,t,r){return t}toBER(e=!1){return new ArrayBuffer(0)}static blockName(){return"EndOfContentValueBlock"}}class O extends E{constructor(e={}){super(e,U),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}static blockName(){return"EndOfContent"}}class T extends x{constructor(e={}){if(super(e),this.value=t(e,"value",!1),this.isHexOnly=t(e,"isHexOnly",!1),"valueHex"in e)this.valueHex=e.valueHex.slice(0);else if(this.valueHex=new ArrayBuffer(1),!0===this.value){new Uint8Array(this.valueHex)[0]=255}}fromBER(e,t,r){if(!1===s(this,e,t,r))return-1;const n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);const i=new Uint8Array(this.valueHex);for(let e=0;e<n.length;e++)i[e]=n[e];return 0!==c.call(this)?this.value=!0:this.value=!1,this.blockLength=r,t+r}toBER(e=!1){return this.valueHex}static blockName(){return"BooleanValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}}class R extends E{constructor(e={}){super(e,T),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}static blockName(){return"BOOLEAN"}toString(){return`${this.constructor.blockName()} : ${this.valueBlock.value}`}}class _ extends D{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}static blockName(){return"SEQUENCE"}}class V extends D{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}static blockName(){return"SET"}}class F extends E{constructor(e={}){super(e,A),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}static blockName(){return"NULL"}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e=!1){const t=new ArrayBuffer(2);if(!0===e)return t;const r=new Uint8Array(t);return r[0]=5,r[1]=0,t}toString(){return`${this.constructor.blockName()}`}}class L extends(k(P)){constructor(e={}){super(e),this.isConstructed=t(e,"isConstructed",!1)}fromBER(e,t,r){let s=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,s=P.prototype.fromBER.call(this,e,t,r),-1===s)return s;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.blockName();if(t===O.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==j.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(e,t,r),this.blockLength=r;return s}toBER(e=!1){if(!0===this.isConstructed)return P.prototype.toBER.call(this,e);let t=new ArrayBuffer(this.valueHex.byteLength);return!0===e||0===this.valueHex.byteLength||(t=this.valueHex.slice(0)),t}static blockName(){return"OctetStringValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}}class j extends E{constructor(e={}){super(e,L),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=e.slice(t,t+r);try{const e=Ee(s);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}catch(e){}}return super.fromBER(e,t,r)}static blockName(){return"OCTET STRING"}isEqual(e){return e instanceof j!=!1&&JSON.stringify(this)===JSON.stringify(e)}toString(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?D.prototype.toString.call(this):`${this.constructor.blockName()} : ${r(this.valueBlock.valueHex)}`}}class H extends(k(P)){constructor(e={}){super(e),this.unusedBits=t(e,"unusedBits",0),this.isConstructed=t(e,"isConstructed",!1),this.blockLength=this.valueHex.byteLength}fromBER(e,t,r){if(0===r)return t;let n=-1;if(!0===this.isConstructed){if(n=P.prototype.fromBER.call(this,e,t,r),-1===n)return n;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.blockName();if(t===O.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==M.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[e].valueBlock.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[e].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===s(this,e,t,r))return-1;const i=new Uint8Array(e,t,r);if(this.unusedBits=i[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const s=e.slice(t+1,t+r);try{const e=Ee(s);-1!==e.offset&&e.offset===r-1&&(this.value=[e.result])}catch(e){}}this.valueHex=new ArrayBuffer(i.length-1);const a=new Uint8Array(this.valueHex);for(let e=0;e<r-1;e++)a[e]=i[e+1];return this.blockLength=i.length,t+r}toBER(e=!1){if(!0===this.isConstructed)return P.prototype.toBER.call(this,e);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);const t=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),s=new Uint8Array(r);s[0]=this.unusedBits;for(let e=0;e<this.valueHex.byteLength;e++)s[e+1]=t[e];return r}static blockName(){return"BitStringValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}}class M extends E{constructor(e={}){super(e,H),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}static blockName(){return"BIT STRING"}fromBER(e,t,r){return 0===r?t:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r))}isEqual(e){return e instanceof M!=!1&&JSON.stringify(this)===JSON.stringify(e)}toString(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return D.prototype.toString.call(this);{const e=[],t=new Uint8Array(this.valueBlock.valueHex);for(const r of t)e.push(r.toString(2).padStart(8,"0"));return`${this.constructor.blockName()} : ${e.join("")}`}}}class K extends(k(x)){constructor(e={}){super(e),"value"in e&&(this.valueDec=e.value)}set valueHex(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=c.call(this)))}get valueHex(){return this._valueHex}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=function(e){const t=e<0?-1*e:e;let r=128;for(let s=1;s<8;s++){if(t<=r){if(e<0){const e=i(r-t,8,s);return new Uint8Array(e)[0]|=128,e}let n=i(t,8,s),a=new Uint8Array(n);if(128&a[0]){const e=n.slice(0),t=new Uint8Array(e);n=new ArrayBuffer(n.byteLength+1),a=new Uint8Array(n);for(let r=0;r<e.byteLength;r++)a[r+1]=t[r];a[0]=0}return n}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e)}get valueDec(){return this._valueDec}fromDER(e,t,r,s=0){const n=this.fromBER(e,t,r);if(-1===n)return n;const i=new Uint8Array(this._valueHex);if(0===i[0]&&0!=(128&i[1])){const e=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(e).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=e.slice(0)}else if(0!==s&&this._valueHex.byteLength<s){s-this._valueHex.byteLength>1&&(s=this._valueHex.byteLength+1);const e=new ArrayBuffer(s);new Uint8Array(e).set(i,s-this._valueHex.byteLength),this._valueHex=e.slice(0)}return n}toDER(e=!1){const t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):{const e=new ArrayBuffer(this._valueHex.byteLength+1),r=new Uint8Array(e);r[0]=0,r.set(t,1),this._valueHex=e.slice(0)}break;case 0===t[0]&&0==(128&t[1]):{const e=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(e).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=e.slice(0)}}return this.toBER(e)}fromBER(e,t,r){const s=super.fromBER(e,t,r);return-1===s?s:(this.blockLength=r,t+r)}toBER(e=!1){return this.valueHex.slice(0)}static blockName(){return"IntegerValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.valueDec=this.valueDec,e}toString(){function e(e,t){const r=new Uint8Array([0]);let s=new Uint8Array(e),n=new Uint8Array(t),i=s.slice(0);const a=i.length-1;let c=n.slice(0);const l=c.length-1;let h=0;let u=0;for(let e=l<a?a:l;e>=0;e--,u++){if(!0==u<c.length)h=i[a-u]+c[l-u]+r[0];else h=i[a-u]+r[0];if(r[0]=h/10,!0==u>=i.length)i=o(new Uint8Array([h%10]),i);else i[a-u]=h%10}return r[0]>0&&(i=o(r,i)),i.slice(0)}function t(e){if(e>=S.length)for(let t=S.length;t<=e;t++){const e=new Uint8Array([0]);let r=S[t-1].slice(0);for(let t=r.length-1;t>=0;t--){const s=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=s[0]/10,r[t]=s[0]%10}e[0]>0&&(r=o(e,r)),S.push(r)}return S[e]}function r(e,t){let r=0,s=new Uint8Array(e),n=new Uint8Array(t),i=s.slice(0);const a=i.length-1;let o=n.slice(0);const c=o.length-1;let l,h=0;for(let e=c;e>=0;e--,h++)if(l=i[a-h]-o[c-h]-r,!0==l<0)r=1,i[a-h]=l+10;else r=0,i[a-h]=l;if(r>0)for(let e=a-c+1;e>=0;e--,h++){if(l=i[a-h]-r,!(l<0)){r=0,i[a-h]=l;break}r=1,i[a-h]=l+10}return i.slice()}const s=8*this._valueHex.byteLength-1;let n,i=new Uint8Array(8*this._valueHex.byteLength/3),a=0;const c=new Uint8Array(this._valueHex);let l="",h=!1;for(let o=this._valueHex.byteLength-1;o>=0;o--){n=c[o];for(let o=0;o<8;o++){if(1==(1&n))if(a===s)i=r(t(a),i),l="-";else i=e(i,t(a));a++,n>>=1}}for(let e=0;e<i.length;e++)i[e]&&(h=!0),h&&(l+="0123456789".charAt(i[e]));return!1===h&&(l+="0123456789".charAt(0)),l}}class q extends E{constructor(e={}){super(e,K),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}static blockName(){return"INTEGER"}isEqual(e){return e instanceof q?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?l(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&l(this.valueBlock.valueHex,e)}convertToDER(){const e=new q({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}convertFromDER(){const e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,t=new q({valueHex:this.valueBlock.valueHex});return t.valueBlock.fromDER(t.valueBlock.valueHex,0,t.valueBlock.valueHex.byteLength,e),t}toString(){b();const e=r(this.valueBlock.valueHex),t=BigInt(`0x${e}`);return`${this.constructor.blockName()} : ${t.toString()}`}}class W extends q{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}static blockName(){return"ENUMERATED"}}class G extends(k(A)){constructor(e={}){super(e),this.valueDec=t(e,"valueDec",-1),this.isFirstSid=t(e,"isFirstSid",!1)}static blockName(){return"sidBlock"}fromBER(e,t,r){if(0===r)return t;if(!1===s(this,e,t,r))return-1;const i=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);let a=new Uint8Array(this.valueHex);for(let e=0;e<r&&(a[e]=127&i[e],this.blockLength++,0!=(128&i[e]));e++);const o=new ArrayBuffer(this.blockLength),c=new Uint8Array(o);for(let e=0;e<this.blockLength;e++)c[e]=a[e];return this.valueHex=o.slice(0),a=new Uint8Array(this.valueHex),0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=n(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){b();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+(e+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e=!1){let t,r;if(this.isHexOnly){if(!0===e)return new ArrayBuffer(this.valueHex.byteLength);const s=new Uint8Array(this.valueHex);t=new ArrayBuffer(this.blockLength),r=new Uint8Array(t);for(let e=0;e<this.blockLength-1;e++)r[e]=128|s[e];return r[this.blockLength-1]=s[this.blockLength-1],t}const s=i(this.valueDec,7);if(0===s.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(t=new ArrayBuffer(s.byteLength),!1===e){const e=new Uint8Array(s);r=new Uint8Array(t);for(let t=0;t<s.byteLength-1;t++)r[t]=128|e[t];r[s.byteLength-1]=e[s.byteLength-1]}return t}toString(){let e="";if(!0===this.isHexOnly)e=r(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}class z extends x{constructor(e={}){super(e),this.fromString(t(e,"value",""))}fromBER(e,t,r){let s=t;for(;r>0;){const t=new G;if(s=t.fromBER(e,s,r),-1===s)return this.blockLength=0,this.error=t.error,s;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return s}toBER(e=!1){let t=new ArrayBuffer(0);for(let r=0;r<this.value.length;r++){const s=this.value[r].toBER(e);if(0===s.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=a(t,s)}return t}fromString(e){this.value=[];let t=0,r=0,s="",n=!1;do{if(r=e.indexOf(".",t),s=-1===r?e.substr(t):e.substr(t,r-t),t=r+1,n){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return this.value=[],!1}const r=parseInt(s,10);if(isNaN(r))return!0;e.valueDec=r+t,n=!1}else{const e=new G;if(s>Number.MAX_SAFE_INTEGER){b();const t=BigInt(s);e.valueBigInt=t}else if(e.valueDec=parseInt(s,10),isNaN(e.valueDec))return!0;0===this.value.length&&(e.isFirstSid=!0,n=!0),this.value.push(e)}}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();0!==r&&(e=`${e}.`),t?(s=`{${s}}`,this.value[r].isFirstSid?e=`2.{${s} - 80}`:e+=s):e+=s}return e}static blockName(){return"ObjectIdentifierValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}e.value=this.toString(),e.sidArray=[];for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}class J extends E{constructor(e={}){super(e,z),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}static blockName(){return"OBJECT IDENTIFIER"}toString(){return`${this.constructor.blockName()} : ${this.valueBlock.toString()}`}}class $ extends(k(A)){constructor(e={}){super(e),this.isHexOnly=!0,this.value=""}static blockName(){return"Utf8StringValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.value=this.value,e}}class Y extends E{constructor(e={}){super(e,$),"value"in e&&this.fromString(e.value),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}static blockName(){return"UTF8String"}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push(`Error during "decodeURIComponent": ${e}, using raw string`)}}fromString(e){const t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);const s=new Uint8Array(this.valueBlock.valueHex);for(let e=0;e<r;e++)s[e]=t.charCodeAt(e);this.valueBlock.value=e}toString(){return`${this.constructor.blockName()} : ${this.valueBlock.value}`}}class X extends(k(A)){constructor(e={}){super(e),this.valueDec=t(e,"valueDec",-1)}static blockName(){return"relativeSidBlock"}fromBER(e,t,r){if(0===r)return t;if(!1===s(this,e,t,r))return-1;const i=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);let a=new Uint8Array(this.valueHex);for(let e=0;e<r&&(a[e]=127&i[e],this.blockLength++,0!=(128&i[e]));e++);const o=new ArrayBuffer(this.blockLength),c=new Uint8Array(o);for(let e=0;e<this.blockLength;e++)c[e]=a[e];return this.valueHex=o.slice(0),a=new Uint8Array(this.valueHex),0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=n(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e=!1){let t,r;if(this.isHexOnly){if(!0===e)return new ArrayBuffer(this.valueHex.byteLength);const s=new Uint8Array(this.valueHex);t=new ArrayBuffer(this.blockLength),r=new Uint8Array(t);for(let e=0;e<this.blockLength-1;e++)r[e]=128|s[e];return r[this.blockLength-1]=s[this.blockLength-1],t}const s=i(this.valueDec,7);if(0===s.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(t=new ArrayBuffer(s.byteLength),!1===e){const e=new Uint8Array(s);r=new Uint8Array(t);for(let t=0;t<s.byteLength-1;t++)r[t]=128|e[t];r[s.byteLength-1]=e[s.byteLength-1]}return t}toString(){let e="";return e=!0===this.isHexOnly?r(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString(),e}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.valueDec=this.valueDec,e}}class Q extends x{constructor(e={}){super(e),this.fromString(t(e,"value",""))}fromBER(e,t,r){let s=t;for(;r>0;){const t=new X;if(s=t.fromBER(e,s,r),-1===s)return this.blockLength=0,this.error=t.error,s;this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return s}toBER(e=!1){let t=new ArrayBuffer(0);for(let r=0;r<this.value.length;r++){const s=this.value[r].toBER(e);if(0===s.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=a(t,s)}return t}fromString(e){this.value=[];let t=0,r=0,s="";do{r=e.indexOf(".",t),s=-1===r?e.substr(t):e.substr(t,r-t),t=r+1;const n=new X;if(n.valueDec=parseInt(s,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();0!==r&&(e=`${e}.`),t?(s=`{${s}}`,e+=s):e+=s}return e}static blockName(){return"RelativeObjectIdentifierValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}e.value=this.toString(),e.sidArray=[];for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}class Z extends E{constructor(e={}){super(e,Q),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}static blockName(){return"RelativeObjectIdentifier"}}class ee extends(k(A)){constructor(e={}){super(e),this.isHexOnly=!0,this.value=""}static blockName(){return"BmpStringValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.value=this.value,e}}class te extends E{constructor(e={}){super(e,ee),"value"in e&&this.fromString(e.value),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}static blockName(){return"BMPString"}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}fromBuffer(e){const t=e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=2){const t=r[e];r[e]=r[e+1],r[e+1]=t}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}fromString(e){const t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);const r=new Uint8Array(this.valueBlock.valueHex);for(let s=0;s<t;s++){const t=i(e.charCodeAt(s),8),n=new Uint8Array(t);if(n.length>2)continue;const a=2-n.length;for(let e=n.length-1;e>=0;e--)r[2*s+e+a]=n[e]}this.valueBlock.value=e}toString(){return`${this.constructor.blockName()} : ${this.valueBlock.value}`}}class re extends(k(A)){constructor(e={}){super(e),this.isHexOnly=!0,this.value=""}static blockName(){return"UniversalStringValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.value=this.value,e}}class se extends E{constructor(e={}){super(e,re),"value"in e&&this.fromString(e.value),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}static blockName(){return"UniversalString"}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}fromBuffer(e){const t=e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);const r=new Uint8Array(this.valueBlock.valueHex);for(let s=0;s<t;s++){const t=i(e.charCodeAt(s),8),n=new Uint8Array(t);if(n.length>4)continue;const a=4-n.length;for(let e=n.length-1;e>=0;e--)r[4*s+e+a]=n[e]}this.valueBlock.value=e}toString(){return`${this.constructor.blockName()} : ${this.valueBlock.value}`}}class ne extends(k(A)){constructor(e={}){super(e),this.value="",this.isHexOnly=!0}static blockName(){return"SimpleStringValueBlock"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.value=this.value,e}}class ie extends E{constructor(e={}){super(e,ne),"value"in e&&this.fromString(e.value)}static blockName(){return"SIMPLESTRING"}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}fromString(e){const t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);const r=new Uint8Array(this.valueBlock.valueHex);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);this.valueBlock.value=e}toString(){return`${this.constructor.blockName()} : ${this.valueBlock.value}`}}class ae extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}static blockName(){return"NumericString"}}class oe extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}static blockName(){return"PrintableString"}}class ce extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}static blockName(){return"TeletexString"}}class le extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}static blockName(){return"VideotexString"}}class he extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}static blockName(){return"IA5String"}}class ue extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}static blockName(){return"GraphicString"}}class pe extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}static blockName(){return"VisibleString"}}class de extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}static blockName(){return"GeneralString"}}class fe extends ie{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}static blockName(){return"CharacterString"}}class me extends pe{constructor(e={}){if(super(e),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,"value"in e){this.fromString(e.value),this.valueBlock.valueHex=new ArrayBuffer(e.value.length);const t=new Uint8Array(this.valueBlock.valueHex);for(let r=0;r<e.value.length;r++)t[r]=e.value.charCodeAt(r)}"valueDate"in e&&(this.fromDate(e.valueDate),this.valueBlock.valueHex=this.toBuffer()),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for convertion");const r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(){const e=new Array(7);return e[0]=h(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=h(this.month,2),e[2]=h(this.day,2),e[3]=h(this.hour,2),e[4]=h(this.minute,2),e[5]=h(this.second,2),e[6]="Z",e.join("")}static blockName(){return"UTCTime"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}class ge extends pe{constructor(e={}){if(super(e),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,this.millisecond=0,"value"in e){this.fromString(e.value),this.valueBlock.valueHex=new ArrayBuffer(e.value.length);const t=new Uint8Array(this.valueBlock.valueHex);for(let r=0;r<e.value.length;r++)t[r]=e.value.charCodeAt(r)}"valueDate"in e&&(this.fromDate(e.valueDate),this.valueBlock.valueHex=this.toBuffer()),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),s)}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,s="",n="",i=0,a=0,o=0;if("Z"===e[e.length-1])s=e.substr(0,e.length-1),r=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for convertion");s=e}if(r){if(-1!==s.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==s.indexOf("-"))throw new Error("Wrong input string for convertion")}else{let e=1,t=s.indexOf("+"),r="";if(-1===t&&(t=s.indexOf("-"),e=-1),-1!==t){if(r=s.substr(t+1),s=s.substr(0,t),2!==r.length&&4!==r.length)throw new Error("Wrong input string for convertion");let n=new Number(r.substr(0,2));if(isNaN(n.valueOf()))throw new Error("Wrong input string for convertion");if(a=e*n,4===r.length){if(n=new Number(r.substr(2,2)),isNaN(n.valueOf()))throw new Error("Wrong input string for convertion");o=e*n}}}let c=s.indexOf(".");if(-1===c&&(c=s.indexOf(",")),-1!==c){const e=new Number(`0${s.substr(c)}`);if(isNaN(e.valueOf()))throw new Error("Wrong input string for convertion");i=e.valueOf(),n=s.substr(0,c)}else n=s;switch(!0){case 8===n.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==c)throw new Error("Wrong input string for convertion");break;case 10===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){const e=1e3*i;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for convertion")}const l=t.exec(n);if(null===l)throw new Error("Wrong input string for convertion");for(let e=1;e<l.length;e++)switch(e){case 1:this.year=parseInt(l[e],10);break;case 2:this.month=parseInt(l[e],10);break;case 3:this.day=parseInt(l[e],10);break;case 4:this.hour=parseInt(l[e],10)+a;break;case 5:this.minute=parseInt(l[e],10)+o;break;case 6:this.second=parseInt(l[e],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===r){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(){const e=[];return e.push(h(this.year,4)),e.push(h(this.month,2)),e.push(h(this.day,2)),e.push(h(this.hour,2)),e.push(h(this.minute,2)),e.push(h(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(h(this.millisecond,3))),e.push("Z"),e.join("")}static blockName(){return"GeneralizedTime"}toJSON(){let e={};try{e=super.toJSON()}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}class ye extends Y{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}static blockName(){return"DATE"}}class ve extends Y{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}static blockName(){return"TimeOfDay"}}class we extends Y{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}static blockName(){return"DateTime"}}class be extends Y{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}static blockName(){return"Duration"}}class Se extends Y{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}static blockName(){return"TIME"}}class Ae{constructor(e={}){this.value=t(e,"value",[]),this.optional=t(e,"optional",!1)}}class ke{constructor(e={}){this.name=t(e,"name",""),this.optional=t(e,"optional",!1)}}class Ce{constructor(e={}){this.name=t(e,"name",""),this.optional=t(e,"optional",!1),this.value=t(e,"value",new ke),this.local=t(e,"local",!1)}}class Ie{constructor(e={}){this.data=t(e,"data",new ArrayBuffer(0))}fromBER(e,t,r){return this.data=e.slice(t,r),t+r}toBER(e=!1){return this.data}}function xe(e,t,r){const n=t;let i=new E({},Object);const a=new A;if(!1===s(a,e,t,r))return i.error=a.error,{offset:-1,result:i};if(0===new Uint8Array(e,t,r).length)return i.error="Zero buffer length",{offset:-1,result:i};let o=i.idBlock.fromBER(e,t,r);if(i.warnings.concat(i.idBlock.warnings),-1===o)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=o,r-=i.idBlock.blockLength,o=i.lenBlock.fromBER(e,t,r),i.warnings.concat(i.lenBlock.warnings),-1===o)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=o,r-=i.lenBlock.blockLength,!1===i.idBlock.isConstructed&&!0===i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let c=E;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(!0===i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=O;break;case 1:c=R;break;case 2:c=q;break;case 3:c=M;break;case 4:c=j;break;case 5:c=F;break;case 6:c=J;break;case 10:c=W;break;case 12:c=Y;break;case 13:c=Z;break;case 14:c=Se;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=_;break;case 17:c=V;break;case 18:c=ae;break;case 19:c=oe;break;case 20:c=ce;break;case 21:c=le;break;case 22:c=he;break;case 23:c=me;break;case 24:c=ge;break;case 25:c=ue;break;case 26:c=pe;break;case 27:c=de;break;case 28:c=se;break;case 29:c=fe;break;case 30:c=te;break;case 31:c=ye;break;case 32:c=ve;break;case 33:c=we;break;case 34:c=be;break;default:{let e;e=!0===i.idBlock.isConstructed?new D:new N,e.idBlock=i.idBlock,e.lenBlock=i.lenBlock,e.warnings=i.warnings,i=e}}}else c=!0===i.idBlock.isConstructed?D:N;return i=function(e,t){if(e instanceof t)return e;const r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(i,c),o=i.fromBER(e,t,!0===i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecode=e.slice(n,n+i.blockLength),{offset:o,result:i}}function Ee(e){if(0===e.byteLength){const e=new E({},Object);return e.error="Input buffer has zero length",{offset:-1,result:e}}return xe(e,0,e.byteLength)}function Be(e,t,r){if(r instanceof Ae){for(let s=0;s<r.value.length;s++){if(!0===Be(e,t,r.value[s]).verified)return{verified:!0,result:e}}{const e={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(e.name=r.name),e}}if(r instanceof ke)return r.hasOwnProperty("name")&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=r.idBlock.toBER(!1);if(0===s.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(s,0,s.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if("isHexOnly"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=new Uint8Array(r.idBlock.valueHex),n=new Uint8Array(t.idBlock.valueHex);if(s.length!==n.length)return{verified:!1,result:e};for(let t=0;t<s.length;t++)if(s[t]!==n[1])return{verified:!1,result:e}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){let s=0,n={verified:!1},i=r.valueBlock.value.length;if(i>0&&r.valueBlock.value[0]instanceof Ce&&(i=t.valueBlock.value.length),0===i)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){let t=!0;for(let e=0;e<r.valueBlock.value.length;e++)t=t&&(r.valueBlock.value[e].optional||!1);return!0===t?{verified:!0,result:e}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let a=0;a<i;a++)if(a-s>=t.valueBlock.value.length){if(!1===r.valueBlock.value[a].optional){const t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],t.name=r.name)),t}}else if(r.valueBlock.value[0]instanceof Ce){if(n=Be(e,t.valueBlock.value[a],r.valueBlock.value[0].value),!1===n.verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),n;s++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let s={};s="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e,void 0===s[r.valueBlock.value[0].name]&&(s[r.valueBlock.value[0].name]=[]),s[r.valueBlock.value[0].name].push(t.valueBlock.value[a])}}else if(n=Be(e,t.valueBlock.value[a-s],r.valueBlock.value[a]),!1===n.verified){if(!0!==r.valueBlock.value[a].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),n;s++}if(!1===n.verified){const t={verified:!1,result:e};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],t.name=r.name)),t}return{verified:!0,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){const s=Ee(t.valueBlock.valueHex);if(-1===s.offset){const t={verified:!1,result:s.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],t.name=r.name)),t}return Be(e,s.result,r.primitiveSchema)}return{verified:!0,result:e}}var Ne,Pe,De=Object.freeze({__proto__:null,HexBlock:k,ValueBlock:x,BaseBlock:E,Primitive:N,Constructed:D,EndOfContent:O,Boolean:R,Sequence:_,Set:V,Null:F,OctetString:j,BitString:M,Integer:q,Enumerated:W,ObjectIdentifier:J,Utf8String:Y,RelativeObjectIdentifier:Z,BmpString:te,UniversalString:se,NumericString:ae,PrintableString:oe,TeletexString:ce,VideotexString:le,IA5String:he,GraphicString:ue,VisibleString:pe,GeneralString:de,CharacterString:fe,UTCTime:me,GeneralizedTime:ge,DATE:ye,TimeOfDay:ve,DateTime:we,Duration:be,TIME:Se,Choice:Ae,Any:ke,Repeated:Ce,RawData:Ie,fromBER:Ee,compareSchema:Be,verifySchema:function(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const r=Ee(e);return-1===r.offset?{verified:!1,result:r.result}:Be(r.result,r.result,t)},fromJSON:function(e){}});!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(Ne||(Ne={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(Pe||(Pe={}));const Ue={fromASN:e=>e instanceof F?null:e.valueBeforeDecode,toASN:e=>{if(null===e)return new F;const t=Ee(e);if(t.result.error)throw new Error(t.result.error);return t.result}},Oe={fromASN:e=>e.valueBlock.valueHex.byteLength>4?e.valueBlock.toString():e.valueBlock.valueDec,toASN:e=>new q({value:e})},Te={fromASN:e=>e.valueBlock.valueDec,toASN:e=>new W({value:e})},Re={fromASN:e=>e.valueBlock.valueHex,toASN:e=>new q({valueHex:e})},_e={fromASN:e=>e.valueBlock.valueHex,toASN:e=>new M({valueHex:e})},Ve={fromASN:e=>e.valueBlock.toString(),toASN:e=>new J({value:e})},Fe={fromASN:e=>e.valueBlock.value,toASN:e=>new R({value:e})},Le={fromASN:e=>e.valueBlock.valueHex,toASN:e=>new j({valueHex:e})};function je(e){return{fromASN:e=>e.valueBlock.value,toASN:t=>new e({value:t})}}const He=je(Y),Me=je(te),Ke=je(se),qe=je(ae),We=je(oe),Ge=je(ce),ze=je(le),Je=je(he),$e=je(ue),Ye=je(pe),Xe=je(de),Qe=je(fe),Ze={fromASN:e=>e.toDate(),toASN:e=>new me({valueDate:e})},et={fromASN:e=>e.toDate(),toASN:e=>new ge({valueDate:e})},tt={fromASN:e=>null,toASN:e=>new F};function rt(e){switch(e){case Pe.Any:return Ue;case Pe.BitString:return _e;case Pe.BmpString:return Me;case Pe.Boolean:return Fe;case Pe.CharacterString:return Qe;case Pe.Enumerated:return Te;case Pe.GeneralString:return Xe;case Pe.GeneralizedTime:return et;case Pe.GraphicString:return $e;case Pe.IA5String:return Je;case Pe.Integer:return Oe;case Pe.Null:return tt;case Pe.NumericString:return qe;case Pe.ObjectIdentifier:return Ve;case Pe.OctetString:return Le;case Pe.PrintableString:return We;case Pe.TeletexString:return Ge;case Pe.UTCTime:return Ze;case Pe.UniversalString:return Ke;case Pe.Utf8String:return He;case Pe.VideotexString:return ze;case Pe.VisibleString:return Ye;default:return null}}class st{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){const t=this.toUint8Array(e);return t.byteOffset||t.length?t.buffer.slice(t.byteOffset,t.byteOffset+t.length):t.buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if("undefined"!=typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e))return new t(e.buffer,e.byteOffset,e.byteLength);if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=st.toUint8Array(e),s=st.toUint8Array(t);if(r.length!==s.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==s[e])return!1;return!0}}class nt{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){const t=st.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return decodeURIComponent(escape(r))}}class it{static toString(e,t=!1){const r=st.toArrayBuffer(e),s=new DataView(r);let n="";for(let e=0;e<r.byteLength;e+=2){const r=s.getUint16(e,t);n+=String.fromCharCode(r)}return n}static fromString(e,t=!1){const r=new ArrayBuffer(2*e.length),s=new DataView(r);for(let r=0;r<e.length;r++)s.setUint16(2*r,e.charCodeAt(r),t);return r}}class at{static isHex(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}static isBase64(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}static isBase64Url(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}static ToString(e,t="utf8"){const r=st.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return it.toString(r,!0);case"utf16":case"utf16be":return it.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return it.fromString(e,!0);case"utf16":case"utf16be":return it.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=st.toUint8Array(e);if("undefined"!=typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!at.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!at.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=at.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return nt.fromString(e);case"utf16":case"utf16be":return it.fromString(e);case"utf16le":case"usc2":return it.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=at.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return nt.toString(e);case"utf16":case"utf16be":return it.toString(e);case"utf16le":case"usc2":return it.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return r.buffer}static ToBinary(e){const t=st.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r}static ToHex(e){const t=st.toUint8Array(e),r=[],s=t.length;for(let e=0;e<s;e++){const s=t[e].toString(16).padStart(2,"0");r.push(s)}return r.join("")}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!at.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const s=t.slice(e,e+2);r[e/2]=parseInt(s,16)}return r.buffer}static ToUtf16String(e,t=!1){return it.toString(e,t)}static FromUtf16String(e,t=!1){return it.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}at.DEFAULT_UTF8_ENCODING="utf8";class ot{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if("number"==typeof e)this.fromNumber(e);else{if(!st.isBufferSource(e))throw TypeError("Unsupported type of 'params' argument for BitString");this.unusedBits=t,this.value=st.toArrayBuffer(e)}}fromASN(e){if(!(e instanceof M))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new M({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new M({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const r of t)e+=r.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const r=t.length+7>>3;this.unusedBits=(r<<3)-t.length;const s=new Uint8Array(r);t=t.padStart(r<<3,"0").split("").reverse().join("");let n=0;for(;n<r;)s[n]=parseInt(t.slice(n<<3,8+(n<<3)),2),n++;this.value=s.buffer}}class ct{constructor(e){"number"==typeof e?this.buffer=new ArrayBuffer(e):st.isBufferSource(e)?this.buffer=st.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}fromASN(e){if(!(e instanceof j))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new j({valueHex:this.buffer})}toSchema(e){return new j({name:e})}}function lt(e){return e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||lt(e.prototype):!!(e&&e.toASN&&e.fromASN)}function ht(e){var t;if(e){const r=Object.getPrototypeOf(e);return(null===(t=null==r?void 0:r.prototype)||void 0===t?void 0:t.constructor)===Array||ht(r)}return!1}function ut(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==s[t])return!1;return!0}const pt=new class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e){var t,r,s;const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${null!==(s=null===(r=null===(t=null==e?void 0:e.prototype)||void 0===t?void 0:t.constructor)||void 0===r?void 0:r.name)&&void 0!==s?s:e}' target`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:Ne.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}create(e,t){const r=this.items.get(e)||this.createDefault(e),s=[];for(const e in r.items){const n=r.items[e],i=t?e:"";let a;if("number"==typeof n.type){const e=Pe[n.type],t=De[e];if(!t)throw new Error(`Cannot get ASN1 class by name '${e}'`);a=new t({name:i})}else if(lt(n.type)){a=(new n.type).toSchema(i)}else if(n.optional){this.get(n.type).type===Ne.Choice?a=new ke({name:i}):(a=this.create(n.type,!1),a.name=i)}else a=new ke({name:i});const o=!!n.optional||void 0!==n.defaultValue;if(n.repeated){a.name="";a=new("set"===n.repeated?V:_)({name:"",value:[new Ce({name:i,value:a})]})}if(null!==n.context&&void 0!==n.context)if(n.implicit)if("number"==typeof n.type||lt(n.type)){const e=n.repeated?D:N;s.push(new e({name:i,optional:o,idBlock:{tagClass:3,tagNumber:n.context}}))}else{this.cache(n.type);const e=!!n.repeated;let t=e?a:this.get(n.type).schema;t=t.valueBlock?t.valueBlock.value:t.value,s.push(new D({name:e?"":i,optional:o,idBlock:{tagClass:3,tagNumber:n.context},value:t}))}else s.push(new D({optional:o,idBlock:{tagClass:3,tagNumber:n.context},value:[a]}));else a.optional=o,s.push(a)}switch(r.type){case Ne.Sequence:return new _({value:s,name:""});case Ne.Set:return new V({value:s,name:""});case Ne.Choice:return new Ae({value:s,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=e.__proto__;if(t){return this.items.get(t)||this.findParentSchema(t)}return null}},dt=e=>t=>{let r;pt.has(t)?r=pt.get(t):(r=pt.createDefault(t),pt.set(t,r)),Object.assign(r,e)},ft=e=>(t,r)=>{let s;pt.has(t.constructor)?s=pt.get(t.constructor):(s=pt.createDefault(t.constructor),pt.set(t.constructor,s));const n=Object.assign({},e);if("number"==typeof n.type&&!n.converter){const s=rt(e.type);if(!s)throw new Error(`Cannot get default converter for property '${r}' of ${t.constructor.name}`);n.converter=s}s.items[r]=n};class mt extends Error{constructor(){super(...arguments),this.schemas=[]}}class gt{static serialize(e){return e instanceof E?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&lt(e.constructor))return e.toASN();const t=e.constructor,r=pt.get(t);pt.cache(t);let s,n=[];if(r.itemType)if("number"==typeof r.itemType){const s=rt(r.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);n=e.map((e=>s.toASN(e)))}else n=e.map((e=>this.toAsnItem({type:r.itemType},"[]",t,e)));else for(const s in r.items){const i=r.items[s],a=e[s];if(void 0===a||i.defaultValue===a||"object"==typeof i.defaultValue&&"object"==typeof a&&ut(this.serialize(i.defaultValue),this.serialize(a)))continue;let o=gt.toAsnItem(i,s,t,a);if("number"==typeof i.context)if(i.implicit)if(i.repeated||"number"!=typeof i.type&&!lt(i.type))n.push(new D({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context},value:o.valueBlock.value}));else{const e={};e.valueHex=o instanceof F?o.valueBeforeDecode:o.valueBlock.toBER(),n.push(new N(Object.assign({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context}},e)))}else n.push(new D({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context},value:[o]}));else i.repeated?n=n.concat(o):n.push(o)}switch(r.type){case Ne.Sequence:s=new _({value:n});break;case Ne.Set:s=new V({value:n});break;case Ne.Choice:if(!n[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=n[0]}return s}static toAsnItem(e,t,r,s){let n;if("number"==typeof e.type){const i=e.converter;if(!i)throw new Error(`Property '${t}' doesn't have converter for type ${Pe[e.type]} in schema '${r.name}'`);if(e.repeated){const t=Array.from(s,(e=>i.toASN(e)));n=new("sequence"===e.repeated?_:V)({value:t})}else n=i.toASN(s)}else if(e.repeated){const t=Array.from(s,(e=>this.toASN(e)));n=new("sequence"===e.repeated?_:V)({value:t})}else n=this.toASN(s);return n}}class yt extends Array{constructor(e=[]){if("number"==typeof e)super(e);else{super();for(const t of e)this.push(t)}}}class vt{static serialize(e){return gt.serialize(e)}static parse(e,t){return class{static parse(e,t){let r;if(e instanceof ArrayBuffer)r=e;else if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))r=new Uint8Array(e).buffer;else{if(!(ArrayBuffer.isView(e)||e.buffer instanceof ArrayBuffer))throw new TypeError("Wrong type of 'data' argument");r=e.buffer}const s=Ee(r);if(s.result.error)throw new Error(s.result.error);return this.fromASN(s.result,t)}static fromASN(e,t){var r;try{if(lt(t))return(new t).fromASN(e);const s=pt.get(t);pt.cache(t);let n=s.schema;if(e.constructor===D&&s.type!==Ne.Choice){n=new D({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:s.schema.valueBlock.value});for(const t in s.items)delete e[t]}const i=Be(e,e,n);if(!i.verified)throw new mt(`Data does not match to ${t.name} ASN1 schema. ${i.result.error}`);const a=new t;if(ht(t)){if("number"==typeof s.itemType){const r=rt(s.itemType);if(!r)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,(e=>r.fromASN(e)))}return t.from(e.valueBlock.value,(e=>this.fromASN(e,s.itemType)))}for(const t in s.items){if(!e[t])continue;const n=s.items[t];if("number"==typeof n.type||lt(n.type)){const s=null!==(r=n.converter)&&void 0!==r?r:lt(n.type)?new n.type:null;if(!s)throw new Error("Converter is empty");if(n.repeated)if(n.implicit){const r=new("sequence"===n.repeated?_:V);r.valueBlock=e[t].valueBlock;const i=Ee(r.toBER(!1)).result.valueBlock.value;a[t]=Array.from(i,(e=>s.fromASN(e)))}else a[t]=Array.from(e[t],(e=>s.fromASN(e)));else{let r=e[t];if(n.implicit){let e;if(lt(n.type))e=(new n.type).toSchema("");else{const t=Pe[n.type],r=De[t];if(!r)throw new Error(`Cannot get '${t}' class from asn1js module`);e=new r}e.valueBlock=r.valueBlock,r=Ee(e.toBER(!1)).result}a[t]=s.fromASN(r)}}else n.repeated?a[t]=Array.from(e[t],(e=>this.fromASN(e,n.type))):a[t]=this.fromASN(e[t],n.type)}return a}catch(e){throw e instanceof mt&&e.schemas.push(t.name),e}}}.parse(e,t)}static toString(e){const t=Ee(st.isBufferSource(e)?st.toArrayBuffer(e):vt.serialize(e));if(-1===t.offset)throw new Error(`Cannot decode ASN.1 data. ${t.result.error}`);return t.result.toString()}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function wt(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function bt(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}function St(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r}!function(e){const t="(0?\\d+|0x[a-f0-9]+)",r={fourOctet:new RegExp(`^${t}\\.${t}\\.${t}\\.${t}$`,"i"),threeOctet:new RegExp(`^${t}\\.${t}\\.${t}$`,"i"),twoOctet:new RegExp(`^${t}\\.${t}$`,"i"),longValue:new RegExp(`^${t}$`,"i")},s=new RegExp("^0[0-7]+$","i"),n=new RegExp("^0x[a-f0-9]+$","i"),i="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",o={zoneIndex:new RegExp(i,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${i})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${t}\\.${t}\\.${t}\\.${t}(${i})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${t}\\.${t}\\.${t}\\.${t}(${i})?$`,"i")};function c(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let r,s,n=0,i=-1,a=(e.match(o.zoneIndex)||[])[0];for(a&&(a=a.substring(1),e=e.replace(/%.+$/,""));(i=e.indexOf(":",i+1))>=0;)n++;if("::"===e.substr(0,2)&&n--,"::"===e.substr(-2,2)&&n--,n>t)return null;for(s=t-n,r=":";s--;)r+="0:";return":"===(e=e.replace("::",r))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),r=[];for(let e=0;e<t.length;e++)r.push(parseInt(t[e],16));return r}(),zoneId:a}}function l(e,t,r,s){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let n,i=0;for(;s>0;){if(n=r-s,n<0&&(n=0),e[i]>>n!=t[i]>>n)return!1;s-=r,i+=1}return!0}function h(e){if(n.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(s.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function u(e,t){for(;e.length<t;)e=`0${e}`;return e}const p={};p.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,r;for(t=0;t<e.length;t++)if(r=e[t],!(0<=r&&r<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return l(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let s,n,i;for(s=3;s>=0;s-=1){if(n=this.octets[s],!(n in r))return null;if(i=r[n],t&&0!==i)return null;8!==i&&(t=!0),e+=i}return 32-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return p.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),p.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[];let i=0;for(;i<4;)n.push(parseInt(r[i],10)|255^parseInt(s[i],10)),i++;return new this(n)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.isIPv4=function(e){return null!==this.parser(e)},p.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},p.IPv4.isValidFourPartDecimal=function(e){return!(!p.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},p.IPv4.networkAddressFromCIDR=function(e){let t,r,s,n,i;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[],r=0;r<4;)n.push(parseInt(s[r],10)&parseInt(i[r],10)),r++;return new this(n)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},p.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const r=[this.parse(t[1]),e];return Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},p.IPv4.parser=function(e){let t,s,n;if(t=e.match(r.fourOctet))return function(){const e=t.slice(1,6),r=[];for(let t=0;t<e.length;t++)s=e[t],r.push(h(s));return r}();if(t=e.match(r.longValue)){if(n=h(t[1]),n>4294967295||n<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(n>>t&255);return e}().reverse()}return(t=e.match(r.twoOctet))?function(){const e=t.slice(1,4),r=[];if(n=h(e[1]),n>16777215||n<0)throw new Error("ipaddr: address outside defined range");return r.push(h(e[0])),r.push(n>>16&255),r.push(n>>8&255),r.push(255&n),r}():(t=e.match(r.threeOctet))?function(){const e=t.slice(1,5),r=[];if(n=h(e[2]),n>65535||n<0)throw new Error("ipaddr: address outside defined range");return r.push(h(e[0])),r.push(h(e[1])),r.push(n>>8&255),r.push(255&n),r}():null},p.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let r=0;const s=Math.floor(e/8);for(;r<s;)t[r]=255,r++;return s<4&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.IPv6=function(){function e(e,t){let r,s;if(16===e.length)for(this.parts=[],r=0;r<=14;r+=2)this.parts.push(e[r]<<8|e[r+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(r=0;r<this.parts.length;r++)if(s=this.parts[r],!(0<=s&&s<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return l(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let s,n;for(let i=7;i>=0;i-=1){if(s=this.parts[i],!(s in r))return null;if(n=r[s],t&&0!==n)return null;16!==n&&(t=!0),e+=n}return 128-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],r=this.parts;for(let s=0;s<r.length;s++)e=r[s],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(u(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],r=e[1];return new p.IPv4([t>>8,255&t,r>>8,255&r])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let r,s=0,n=-1;for(;r=e.exec(t);)r[0].length>n&&(s=r.index,n=r[0].length);return n<0?t:`${t.substring(0,s)}::${t.substring(s+n)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),p.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[];let i=0;for(;i<16;)n.push(parseInt(r[i],10)|255^parseInt(s[i],10)),i++;return new this(n)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.isIPv6=function(e){return null!==this.parser(e)},p.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},p.IPv6.networkAddressFromCIDR=function(e){let t,r,s,n,i;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[],r=0;r<16;)n.push(parseInt(s[r],10)&parseInt(i[r],10)),r++;return new this(n)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},p.IPv6.parseCIDR=function(e){let t,r,s;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&t<=128))return s=[this.parse(r[1]),t],Object.defineProperty(s,"toString",{value:function(){return this.join("/")}}),s;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},p.IPv6.parser=function(e){let t,r,s,n,i,a;if(s=e.match(o.deprecatedTransitional))return this.parser(`::ffff:${s[1]}`);if(o.native.test(e))return c(e,8);if((s=e.match(o.transitional))&&(a=s[6]||"",t=c(s[1].slice(0,-1)+a,6),t.parts)){for(i=[parseInt(s[2]),parseInt(s[3]),parseInt(s[4]),parseInt(s[5])],r=0;r<i.length;r++)if(n=i[r],!(0<=n&&n<=255))return null;return t.parts.push(i[0]<<8|i[1]),t.parts.push(i[2]<<8|i[3]),{parts:t.parts,zoneId:t.zoneId}}return null},p.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const s=Math.floor(e/8);for(;r<s;)t[r]=255,r++;return s<16&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.fromByteArray=function(e){const t=e.length;if(4===t)return new p.IPv4(e);if(16===t)return new p.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},p.isValid=function(e){return p.IPv6.isValid(e)||p.IPv4.isValid(e)},p.parse=function(e){if(p.IPv6.isValid(e))return p.IPv6.parse(e);if(p.IPv4.isValid(e))return p.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},p.parseCIDR=function(e){try{return p.IPv6.parseCIDR(e)}catch(t){try{return p.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},p.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},p.subnetMatch=function(e,t,r){let s,n,i,a;for(n in null==r&&(r="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,n))for(i=t[n],!i[0]||i[0]instanceof Array||(i=[i]),s=0;s<i.length;s++)if(a=i[s],e.kind()===a[0].kind()&&e.match.apply(e,a))return n;return r},"undefined"!=typeof module&&module.exports?module.exports=p:e.ipaddr=p}(globalThis);class At{static decodeIP(e){if(64===e.length&&0===parseInt(e,16))return"::/0";if(16!==e.length)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce(((e,t)=>e+ +t),0);let r=e.slice(0,8).replace(/(.{2})/g,(e=>`${parseInt(e,16)}.`));return r=r.slice(0,-1),`${r}/${t}`}static toString(e){if(4===e.byteLength||16===e.byteLength){const t=new Uint8Array(e);return(void 0)(Array.from(t)).toString()}return this.decodeIP(at.ToHex(e))}static fromString(e){const t=(void 0)(e);return new Uint8Array(t.toByteArray()).buffer}}var kt,Ct,It;let xt=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};wt([ft({type:Pe.TeletexString})],xt.prototype,"teletexString",void 0),wt([ft({type:Pe.PrintableString})],xt.prototype,"printableString",void 0),wt([ft({type:Pe.UniversalString})],xt.prototype,"universalString",void 0),wt([ft({type:Pe.Utf8String})],xt.prototype,"utf8String",void 0),wt([ft({type:Pe.BmpString})],xt.prototype,"bmpString",void 0),xt=wt([dt({type:Ne.Choice})],xt);let Et=class extends xt{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?at.ToHex(this.anyValue):super.toString())}};wt([ft({type:Pe.IA5String})],Et.prototype,"ia5String",void 0),wt([ft({type:Pe.Any})],Et.prototype,"anyValue",void 0),Et=wt([dt({type:Ne.Choice})],Et);class Bt{constructor(e={}){this.type="",this.value=new Et,Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Bt.prototype,"type",void 0),wt([ft({type:Et})],Bt.prototype,"value",void 0);let Nt=kt=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,kt.prototype)}};Nt=kt=wt([dt({type:Ne.Set,itemType:Bt})],Nt);let Pt=Ct=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Ct.prototype)}};Pt=Ct=wt([dt({type:Ne.Sequence,itemType:Nt})],Pt);let Dt=It=class extends Pt{constructor(e){super(e),Object.setPrototypeOf(this,It.prototype)}};Dt=It=wt([dt({type:Ne.Sequence})],Dt);const Ut={fromASN:e=>At.toString(Le.fromASN(e)),toASN:e=>Le.toASN(At.fromString(e))};class Ot{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Ot.prototype,"typeId",void 0),wt([ft({type:Pe.Any,context:0})],Ot.prototype,"value",void 0);class Tt{constructor(e={}){this.partyName=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:xt,optional:!0,context:0,implicit:!0})],Tt.prototype,"nameAssigner",void 0),wt([ft({type:xt,context:1,implicit:!0})],Tt.prototype,"partyName",void 0);let Rt=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Ot,context:0,implicit:!0})],Rt.prototype,"otherName",void 0),wt([ft({type:Pe.IA5String,context:1,implicit:!0})],Rt.prototype,"rfc822Name",void 0),wt([ft({type:Pe.IA5String,context:2,implicit:!0})],Rt.prototype,"dNSName",void 0),wt([ft({type:Pe.Any,context:3,implicit:!0})],Rt.prototype,"x400Address",void 0),wt([ft({type:Dt,context:4,implicit:!1})],Rt.prototype,"directoryName",void 0),wt([ft({type:Tt,context:5})],Rt.prototype,"ediPartyName",void 0),wt([ft({type:Pe.IA5String,context:6,implicit:!0})],Rt.prototype,"uniformResourceIdentifier",void 0),wt([ft({type:Pe.OctetString,context:7,implicit:!0,converter:Ut})],Rt.prototype,"iPAddress",void 0),wt([ft({type:Pe.ObjectIdentifier,context:8,implicit:!0})],Rt.prototype,"registeredID",void 0),Rt=wt([dt({type:Ne.Choice})],Rt);var _t;class Vt{constructor(e={}){this.accessMethod="",this.accessLocation=new Rt,Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Vt.prototype,"accessMethod",void 0),wt([ft({type:Rt})],Vt.prototype,"accessLocation",void 0);let Ft=_t=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,_t.prototype)}};Ft=_t=wt([dt({type:Ne.Sequence,itemType:Vt})],Ft);class Lt extends ct{}class jt{constructor(e={}){e&&Object.assign(this,e)}}wt([ft({type:Lt,context:0,optional:!0,implicit:!0})],jt.prototype,"keyIdentifier",void 0),wt([ft({type:Rt,context:1,optional:!0,implicit:!0,repeated:"sequence"})],jt.prototype,"authorityCertIssuer",void 0),wt([ft({type:Pe.Integer,context:2,optional:!0,implicit:!0,converter:Re})],jt.prototype,"authorityCertSerialNumber",void 0);class Ht{constructor(e={}){this.cA=!1,Object.assign(this,e)}}var Mt;wt([ft({type:Pe.Boolean,defaultValue:!1})],Ht.prototype,"cA",void 0),wt([ft({type:Pe.Integer,optional:!0})],Ht.prototype,"pathLenConstraint",void 0);let Kt=Mt=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Mt.prototype)}};var qt;Kt=Mt=wt([dt({type:Ne.Sequence,itemType:Rt})],Kt);let Wt=qt=class extends Kt{constructor(e){super(e),Object.setPrototypeOf(this,qt.prototype)}};var Gt;Wt=qt=wt([dt({type:Ne.Sequence})],Wt);let zt=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String}};wt([ft({type:Pe.IA5String})],zt.prototype,"ia5String",void 0),wt([ft({type:Pe.VisibleString})],zt.prototype,"visibleString",void 0),wt([ft({type:Pe.BmpString})],zt.prototype,"bmpString",void 0),wt([ft({type:Pe.Utf8String})],zt.prototype,"utf8String",void 0),zt=wt([dt({type:Ne.Choice})],zt);class Jt{constructor(e={}){this.organization=new zt,this.noticeNumbers=[],Object.assign(this,e)}}wt([ft({type:zt})],Jt.prototype,"organization",void 0),wt([ft({type:Pe.Integer,repeated:"sequence"})],Jt.prototype,"noticeNumbers",void 0);class $t{constructor(e={}){Object.assign(this,e)}}wt([ft({type:Jt,optional:!0})],$t.prototype,"noticeRef",void 0),wt([ft({type:zt,optional:!0})],$t.prototype,"explicitText",void 0);let Yt=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Pe.IA5String})],Yt.prototype,"cPSuri",void 0),wt([ft({type:$t})],Yt.prototype,"userNotice",void 0),Yt=wt([dt({type:Ne.Choice})],Yt);class Xt{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Xt.prototype,"policyQualifierId",void 0),wt([ft({type:Pe.Any})],Xt.prototype,"qualifier",void 0);class Qt{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Qt.prototype,"policyIdentifier",void 0),wt([ft({type:Xt,repeated:"sequence",optional:!0})],Qt.prototype,"policyQualifiers",void 0);let Zt=Gt=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Gt.prototype)}};Zt=Gt=wt([dt({type:Ne.Sequence,itemType:Qt})],Zt);let er=class{constructor(e=0){this.value=e}};wt([ft({type:Pe.Integer})],er.prototype,"value",void 0),er=wt([dt({type:Ne.Choice})],er);let tr=class extends er{};var rr;tr=wt([dt({type:Ne.Choice})],tr);var sr;!function(e){e[e.unused=1]="unused",e[e.keyCompromise=2]="keyCompromise",e[e.cACompromise=4]="cACompromise",e[e.affiliationChanged=8]="affiliationChanged",e[e.superseded=16]="superseded",e[e.cessationOfOperation=32]="cessationOfOperation",e[e.certificateHold=64]="certificateHold",e[e.privilegeWithdrawn=128]="privilegeWithdrawn",e[e.aACompromise=256]="aACompromise"}(sr||(sr={}));class nr extends ot{toJSON(){const e=[],t=this.toNumber();return t&sr.aACompromise&&e.push("aACompromise"),t&sr.affiliationChanged&&e.push("affiliationChanged"),t&sr.cACompromise&&e.push("cACompromise"),t&sr.certificateHold&&e.push("certificateHold"),t&sr.cessationOfOperation&&e.push("cessationOfOperation"),t&sr.keyCompromise&&e.push("keyCompromise"),t&sr.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&sr.superseded&&e.push("superseded"),t&sr.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let ir=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Rt,context:0,repeated:"sequence",implicit:!0})],ir.prototype,"fullName",void 0),wt([ft({type:Nt,context:1,implicit:!0})],ir.prototype,"nameRelativeToCRLIssuer",void 0),ir=wt([dt({type:Ne.Choice})],ir);class ar{constructor(e={}){Object.assign(this,e)}}wt([ft({type:ir,context:0,optional:!0})],ar.prototype,"distributionPoint",void 0),wt([ft({type:nr,context:1,optional:!0,implicit:!0})],ar.prototype,"reasons",void 0),wt([ft({type:Rt,context:2,optional:!0,repeated:"sequence",implicit:!0})],ar.prototype,"cRLIssuer",void 0);let or=rr=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,rr.prototype)}};var cr;or=rr=wt([dt({type:Ne.Sequence,itemType:ar})],or);let lr=cr=class extends or{constructor(e){super(e),Object.setPrototypeOf(this,cr.prototype)}};lr=cr=wt([dt({type:Ne.Sequence,itemType:ar})],lr);class hr{constructor(e={}){this.onlyContainsUserCerts=hr.ONLY,this.onlyContainsCACerts=hr.ONLY,this.indirectCRL=hr.ONLY,this.onlyContainsAttributeCerts=hr.ONLY,Object.assign(this,e)}}var ur;hr.ONLY=!1,wt([ft({type:ir,context:0,optional:!0})],hr.prototype,"distributionPoint",void 0),wt([ft({type:Pe.Boolean,context:1,defaultValue:hr.ONLY})],hr.prototype,"onlyContainsUserCerts",void 0),wt([ft({type:Pe.Boolean,context:2,defaultValue:hr.ONLY})],hr.prototype,"onlyContainsCACerts",void 0),wt([ft({type:nr,context:3,optional:!0})],hr.prototype,"onlySomeReasons",void 0),wt([ft({type:Pe.Boolean,context:4,defaultValue:hr.ONLY})],hr.prototype,"indirectCRL",void 0),wt([ft({type:Pe.Boolean,context:5,defaultValue:hr.ONLY})],hr.prototype,"onlyContainsAttributeCerts",void 0),function(e){e[e.unspecified=0]="unspecified",e[e.keyCompromise=1]="keyCompromise",e[e.cACompromise=2]="cACompromise",e[e.affiliationChanged=3]="affiliationChanged",e[e.superseded=4]="superseded",e[e.cessationOfOperation=5]="cessationOfOperation",e[e.certificateHold=6]="certificateHold",e[e.removeFromCRL=8]="removeFromCRL",e[e.privilegeWithdrawn=9]="privilegeWithdrawn",e[e.aACompromise=10]="aACompromise"}(ur||(ur={}));let pr=class{constructor(e=ur.unspecified){this.reason=ur.unspecified,this.reason=e}toJSON(){return ur[this.reason]}toString(){return this.toJSON()}};var dr;wt([ft({type:Pe.Enumerated})],pr.prototype,"reason",void 0),pr=wt([dt({type:Ne.Choice})],pr);let fr=dr=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,dr.prototype)}};fr=dr=wt([dt({type:Ne.Sequence,itemType:Pe.ObjectIdentifier})],fr);let mr=class{constructor(e=new ArrayBuffer(0)){this.value=e}};wt([ft({type:Pe.Integer,converter:Re})],mr.prototype,"value",void 0),mr=wt([dt({type:Ne.Choice})],mr);let gr=class{constructor(e){this.value=new Date,e&&(this.value=e)}};var yr;wt([ft({type:Pe.GeneralizedTime})],gr.prototype,"value",void 0),gr=wt([dt({type:Ne.Choice})],gr);let vr=yr=class extends Kt{constructor(e){super(e),Object.setPrototypeOf(this,yr.prototype)}};vr=yr=wt([dt({type:Ne.Sequence})],vr);var wr,br;!function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(wr||(wr={}));class Sr extends ot{toJSON(){const e=this.toNumber(),t=[];return e&wr.cRLSign&&t.push("crlSign"),e&wr.dataEncipherment&&t.push("dataEncipherment"),e&wr.decipherOnly&&t.push("decipherOnly"),e&wr.digitalSignature&&t.push("digitalSignature"),e&wr.encipherOnly&&t.push("encipherOnly"),e&wr.keyAgreement&&t.push("keyAgreement"),e&wr.keyCertSign&&t.push("keyCertSign"),e&wr.keyEncipherment&&t.push("keyEncipherment"),e&wr.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}class Ar{constructor(e={}){this.base=new Rt,this.minimum=0,Object.assign(this,e)}}wt([ft({type:Rt})],Ar.prototype,"base",void 0),wt([ft({type:Pe.Integer,context:0,defaultValue:0,implicit:!0})],Ar.prototype,"minimum",void 0),wt([ft({type:Pe.Integer,context:1,optional:!0,implicit:!0})],Ar.prototype,"maximum",void 0);let kr=br=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,br.prototype)}};kr=br=wt([dt({type:Ne.Sequence,itemType:Ar})],kr);class Cr{constructor(e={}){Object.assign(this,e)}}wt([ft({type:kr,context:0,optional:!0,implicit:!0})],Cr.prototype,"permittedSubtrees",void 0),wt([ft({type:kr,context:1,optional:!0,implicit:!0})],Cr.prototype,"excludedSubtrees",void 0);class Ir{constructor(e={}){Object.assign(this,e)}}wt([ft({type:Pe.Integer,context:0,implicit:!0,optional:!0,converter:Re})],Ir.prototype,"requireExplicitPolicy",void 0),wt([ft({type:Pe.Integer,context:1,implicit:!0,optional:!0,converter:Re})],Ir.prototype,"inhibitPolicyMapping",void 0);class xr{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}var Er;wt([ft({type:Pe.ObjectIdentifier})],xr.prototype,"issuerDomainPolicy",void 0),wt([ft({type:Pe.ObjectIdentifier})],xr.prototype,"subjectDomainPolicy",void 0);let Br=Er=class extends Kt{constructor(e){super(e),Object.setPrototypeOf(this,Er.prototype)}};Br=Er=wt([dt({type:Ne.Sequence})],Br);class Nr{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}}var Pr;wt([ft({type:Pe.ObjectIdentifier})],Nr.prototype,"type",void 0),wt([ft({type:Pe.Any,repeated:"set"})],Nr.prototype,"values",void 0);let Dr=Pr=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Pr.prototype)}};Dr=Pr=wt([dt({type:Ne.Sequence,itemType:Nr})],Dr);class Ur extends Lt{}class Or{constructor(e={}){Object.assign(this,e)}}var Tr;wt([ft({type:Pe.GeneralizedTime,context:0,implicit:!0,optional:!0})],Or.prototype,"notBefore",void 0),wt([ft({type:Pe.GeneralizedTime,context:1,implicit:!0,optional:!0})],Or.prototype,"notAfter",void 0),function(e){e[e.keyUpdateAllowed=1]="keyUpdateAllowed",e[e.newExtensions=2]="newExtensions",e[e.pKIXCertificate=4]="pKIXCertificate"}(Tr||(Tr={}));class Rr extends ot{toJSON(){const e=[],t=this.toNumber();return t&Tr.pKIXCertificate&&e.push("pKIXCertificate"),t&Tr.newExtensions&&e.push("newExtensions"),t&Tr.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class _r{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new Rr,Object.assign(this,e)}}wt([ft({type:Pe.GeneralString})],_r.prototype,"entrustVers",void 0),wt([ft({type:Rr})],_r.prototype,"entrustInfoFlags",void 0);class Vr{constructor(e={}){this.algorithm="",Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Vr.prototype,"algorithm",void 0),wt([ft({type:Pe.Any,optional:!0})],Vr.prototype,"parameters",void 0);class Fr{constructor(e={}){this.algorithm=new Vr,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Vr})],Fr.prototype,"algorithm",void 0),wt([ft({type:Pe.BitString})],Fr.prototype,"subjectPublicKey",void 0);let Lr=class{constructor(e){e&&("string"==typeof e||"number"==typeof e?this.utcTime=new Date(e):e instanceof Date?this.utcTime=e:Object.assign(this,e))}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};wt([ft({type:Pe.UTCTime})],Lr.prototype,"utcTime",void 0),wt([ft({type:Pe.GeneralizedTime})],Lr.prototype,"generalTime",void 0),Lr=wt([dt({type:Ne.Choice})],Lr);class jr{constructor(e){this.notBefore=new Lr(new Date),this.notAfter=new Lr(new Date),e&&(this.notBefore=new Lr(e.notBefore),this.notAfter=new Lr(e.notAfter))}}var Hr;wt([ft({type:Lr})],jr.prototype,"notBefore",void 0),wt([ft({type:Lr})],jr.prototype,"notAfter",void 0);class Mr{constructor(e={}){this.extnID="",this.critical=Mr.CRITICAL,this.extnValue=new ct,Object.assign(this,e)}}Mr.CRITICAL=!1,wt([ft({type:Pe.ObjectIdentifier})],Mr.prototype,"extnID",void 0),wt([ft({type:Pe.Boolean,defaultValue:Mr.CRITICAL})],Mr.prototype,"critical",void 0),wt([ft({type:ct})],Mr.prototype,"extnValue",void 0);let Kr=Hr=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Hr.prototype)}};var qr;Kr=Hr=wt([dt({type:Ne.Sequence,itemType:Mr})],Kr),function(e){e[e.v1=0]="v1",e[e.v2=1]="v2",e[e.v3=2]="v3"}(qr||(qr={}));class Wr{constructor(e={}){this.version=qr.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new Vr,this.issuer=new Dt,this.validity=new jr,this.subject=new Dt,this.subjectPublicKeyInfo=new Fr,Object.assign(this,e)}}wt([ft({type:Pe.Integer,context:0,defaultValue:qr.v1})],Wr.prototype,"version",void 0),wt([ft({type:Pe.Integer,converter:Re})],Wr.prototype,"serialNumber",void 0),wt([ft({type:Vr})],Wr.prototype,"signature",void 0),wt([ft({type:Dt})],Wr.prototype,"issuer",void 0),wt([ft({type:jr})],Wr.prototype,"validity",void 0),wt([ft({type:Dt})],Wr.prototype,"subject",void 0),wt([ft({type:Fr})],Wr.prototype,"subjectPublicKeyInfo",void 0),wt([ft({type:Pe.BitString,context:1,implicit:!0,optional:!0})],Wr.prototype,"issuerUniqueID",void 0),wt([ft({type:Pe.BitString,context:2,implicit:!0,optional:!0})],Wr.prototype,"subjectUniqueID",void 0),wt([ft({type:Kr,context:3,optional:!0})],Wr.prototype,"extensions",void 0);class Gr{constructor(e={}){this.tbsCertificate=new Wr,this.signatureAlgorithm=new Vr,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Wr})],Gr.prototype,"tbsCertificate",void 0),wt([ft({type:Vr})],Gr.prototype,"signatureAlgorithm",void 0),wt([ft({type:Pe.BitString})],Gr.prototype,"signatureValue",void 0);class zr{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Lr,Object.assign(this,e)}}wt([ft({type:Pe.Integer,converter:Re})],zr.prototype,"userCertificate",void 0),wt([ft({type:Lr})],zr.prototype,"revocationDate",void 0),wt([ft({type:Mr,optional:!0,repeated:"sequence"})],zr.prototype,"crlEntryExtensions",void 0);class Jr{constructor(e={}){this.signature=new Vr,this.issuer=new Dt,this.thisUpdate=new Lr,Object.assign(this,e)}}wt([ft({type:Pe.Integer,optional:!0})],Jr.prototype,"version",void 0),wt([ft({type:Vr})],Jr.prototype,"signature",void 0),wt([ft({type:Dt})],Jr.prototype,"issuer",void 0),wt([ft({type:Lr})],Jr.prototype,"thisUpdate",void 0),wt([ft({type:Lr,optional:!0})],Jr.prototype,"nextUpdate",void 0),wt([ft({type:zr,repeated:"sequence",optional:!0})],Jr.prototype,"revokedCertificates",void 0),wt([ft({type:Mr,optional:!0,context:0,repeated:"sequence"})],Jr.prototype,"crlExtensions",void 0);class $r{constructor(e={}){this.tbsCertList=new Jr,this.signatureAlgorithm=new Vr,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Jr})],$r.prototype,"tbsCertList",void 0),wt([ft({type:Vr})],$r.prototype,"signatureAlgorithm",void 0),wt([ft({type:Pe.BitString})],$r.prototype,"signature",void 0);const Yr="1.2.840.113549.1.1",Xr=`${Yr}.1`,Qr=`${Yr}.7`,Zr=`${Yr}.9`,es=`${Yr}.10`,ts=`${Yr}.2`,rs=`${Yr}.4`,ss=`${Yr}.5`,ns=`${Yr}.11`,is=`${Yr}.12`,as=`${Yr}.13`,os=`${Yr}.15`,cs=`${Yr}.16`,ls=`${Yr}.8`;function hs(e){return new Vr({algorithm:e,parameters:null})}hs("1.2.840.113549.2.2"),hs("1.2.840.113549.2.5");const us=hs("1.3.14.3.2.26");hs("2.16.840.1.101.3.4.2.4"),hs("2.16.840.1.101.3.4.2.1"),hs("2.16.840.1.101.3.4.2.2"),hs("2.16.840.1.101.3.4.2.3"),hs("2.16.840.1.101.3.4.2.5"),hs("2.16.840.1.101.3.4.2.6");const ps=new Vr({algorithm:ls,parameters:vt.serialize(us)}),ds=new Vr({algorithm:Zr,parameters:vt.serialize(Le.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});hs(Xr),hs(ts),hs(rs),hs(ss),hs(os),hs(cs),hs(is),hs(as),hs(os),hs(cs);class fs{constructor(e={}){this.hashAlgorithm=new Vr(us),this.maskGenAlgorithm=new Vr({algorithm:ls,parameters:vt.serialize(us)}),this.pSourceAlgorithm=new Vr(ds),Object.assign(this,e)}}wt([ft({type:Vr,context:0,defaultValue:us})],fs.prototype,"hashAlgorithm",void 0),wt([ft({type:Vr,context:1,defaultValue:ps})],fs.prototype,"maskGenAlgorithm",void 0),wt([ft({type:Vr,context:2,defaultValue:ds})],fs.prototype,"pSourceAlgorithm",void 0),new Vr({algorithm:Qr,parameters:vt.serialize(new fs)});class ms{constructor(e={}){this.hashAlgorithm=new Vr(us),this.maskGenAlgorithm=new Vr({algorithm:ls,parameters:vt.serialize(us)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}wt([ft({type:Vr,context:0,defaultValue:us})],ms.prototype,"hashAlgorithm",void 0),wt([ft({type:Vr,context:1,defaultValue:ps})],ms.prototype,"maskGenAlgorithm",void 0),wt([ft({type:Pe.Integer,context:2,defaultValue:20})],ms.prototype,"saltLength",void 0),wt([ft({type:Pe.Integer,context:3,defaultValue:1})],ms.prototype,"trailerField",void 0),new Vr({algorithm:es,parameters:vt.serialize(new ms)});class gs{constructor(e={}){this.digestAlgorithm=new Vr,this.digest=new ct,Object.assign(this,e)}}var ys;wt([ft({type:Vr})],gs.prototype,"digestAlgorithm",void 0),wt([ft({type:ct})],gs.prototype,"digest",void 0);class vs{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.Integer,converter:Re})],vs.prototype,"prime",void 0),wt([ft({type:Pe.Integer,converter:Re})],vs.prototype,"exponent",void 0),wt([ft({type:Pe.Integer,converter:Re})],vs.prototype,"coefficient",void 0);let ws=ys=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,ys.prototype)}};ws=ys=wt([dt({type:Ne.Sequence,itemType:vs})],ws);class bs{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.Integer})],bs.prototype,"version",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"modulus",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"publicExponent",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"privateExponent",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"prime1",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"prime2",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"exponent1",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"exponent2",void 0),wt([ft({type:Pe.Integer,converter:Re})],bs.prototype,"coefficient",void 0),wt([ft({type:ws,optional:!0})],bs.prototype,"otherPrimeInfos",void 0);class Ss{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}var As;wt([ft({type:Pe.Integer,converter:Re})],Ss.prototype,"modulus",void 0),wt([ft({type:Pe.Integer,converter:Re})],Ss.prototype,"publicExponent",void 0),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(As||(As={}));var ks=As,Cs=function(e,t){return Cs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},Cs(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Is(e,t){function r(){this.constructor=e}Cs(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function xs(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Es(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a}function Bs(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Es(arguments[t]));return e}function Ns(e){return!!e.useClass}function Ps(e){return!!e.useFactory}var Ds=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,r=this,s=!1;return new Proxy({},this.createHandler((function(){return s||(t=e(r.wrap()),s=!0),t})))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach((function(r){t[r]=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];t[0]=e();var n=Reflect[r];return n.apply(void 0,Bs(t))}})),t},e}();function Us(e){return"string"==typeof e||"symbol"==typeof e}function Os(e){return"object"==typeof e&&"token"in e&&"transform"in e}function Ts(e){return!!e.useToken}function Rs(e){return null!=e.useValue}var _s=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),Vs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Is(t,e),t}(_s),Fs=function(){this.scopedResolutions=new Map};function Ls(e,t,r){var s,n,i=Es(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1],a=function(e,t){return null===e?"at position #"+t:'"'+e.split(",")[t].trim()+'" at position #'+t}(void 0===i?null:i,t);return s="Cannot inject the dependency "+a+' of "'+e.name+'" constructor. Reason:',void 0===n&&(n="    "),Bs([s],r.message.split("\n").map((function(e){return n+e}))).join("\n")}var js,Hs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Is(t,e),t}(_s),Ms=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Is(t,e),t}(_s),Ks=function(){this.preResolution=new Hs,this.postResolution=new Ms},qs=new Map,Ws=function(){function e(e){this.parent=e,this._registry=new Vs,this.interceptors=new Ks}return e.prototype.register=function(e,t,r){var s;if(void 0===r&&(r={lifecycle:ks.Transient}),s=function(e){return Ns(e)||Rs(e)||Ts(e)||Ps(e)}(t)?t:{useClass:t},Ts(s))for(var n=[e],i=s;null!=i;){var a=i.useToken;if(n.includes(a))throw new Error("Token registration cycle detected! "+Bs(n,[a]).join(" -> "));n.push(a);var o=this._registry.get(a);i=o&&Ts(o.provider)?o.provider:null}if((r.lifecycle===ks.Singleton||r.lifecycle==ks.ContainerScoped||r.lifecycle==ks.ResolutionScoped)&&(Rs(s)||Ps(s)))throw new Error('Cannot use lifecycle "'+ks[r.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:s,options:r}),this},e.prototype.registerType=function(e,t){return Us(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(Us(e)){if(Us(t))return this.register(e,{useToken:t},{lifecycle:ks.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:ks.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var r=e;return t&&!Us(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:ks.Singleton})},e.prototype.resolve=function(e,t){void 0===t&&(t=new Fs);var r=this.getRegistration(e);if(!r&&Us(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"Single"),r){var s=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(function(e){return"function"==typeof e||e instanceof Ds}(e)){s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var r,s;if(this.interceptors.preResolution.has(e)){var n=[];try{for(var i=xs(this.interceptors.preResolution.getAll(e)),a=i.next();!a.done;a=i.next()){var o=a.value;"Once"!=o.options.frequency&&n.push(o),o.callback(e,t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(r)throw r.error}}this.interceptors.preResolution.setAll(e,n)}},e.prototype.executePostResolutionInterceptor=function(e,t,r){var s,n;if(this.interceptors.postResolution.has(e)){var i=[];try{for(var a=xs(this.interceptors.postResolution.getAll(e)),o=a.next();!o.done;o=a.next()){var c=o.value;"Once"!=c.options.frequency&&i.push(c),c.callback(e,t,r)}}catch(e){s={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(s)throw s.error}}this.interceptors.postResolution.setAll(e,i)}},e.prototype.resolveRegistration=function(e,t){if(e.options.lifecycle===ks.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var r,s=e.options.lifecycle===ks.Singleton,n=e.options.lifecycle===ks.ContainerScoped,i=s||n;return r=Rs(e.provider)?e.provider.useValue:Ts(e.provider)?i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Ns(e.provider)?i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Ps(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===ks.ResolutionScoped&&t.scopedResolutions.set(e,r),r},e.prototype.resolveAll=function(e,t){var r=this;void 0===t&&(t=new Fs);var s=this.getAllRegistrations(e);if(!s&&Us(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"All"),s){var n=s.map((function(e){return r.resolveRegistration(e,t)}));return this.executePostResolutionInterceptor(e,n,"All"),n}var i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;try{for(var r=xs(this._registry.entries()),s=r.next();!s.done;s=r.next()){var n=Es(s.value,2),i=n[0],a=n[1];this._registry.setAll(i,a.filter((function(e){return!Rs(e.provider)})).map((function(e){return e.instance=void 0,e})))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,r,s=new e(this);try{for(var n=xs(this._registry.entries()),i=n.next();!i.done;i=n.next()){var a=Es(i.value,2),o=a[0],c=a[1];c.some((function(e){return e.options.lifecycle===ks.ContainerScoped}))&&s._registry.setAll(o,c.map((function(e){return e.options.lifecycle===ks.ContainerScoped?{provider:e.provider,options:e.options}:e})))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return s},e.prototype.beforeResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:r})},e.prototype.afterResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:r})},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var r=this;if(e instanceof Ds)return e.createProxy((function(e){return r.resolve(e,t)}));var s=qs.get(e);if(!s||0===s.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var n=s.map(this.resolveParams(t,e));return new(e.bind.apply(e,Bs([void 0],n)))},e.prototype.resolveParams=function(e,t){var r=this;return function(s,n){var i,a,o,c;try{return"object"==typeof(c=s)&&"token"in c&&"multiple"in c?Os(s)?s.multiple?(i=r.resolve(s.transform)).transform.apply(i,Bs([r.resolveAll(s.token)],s.transformArgs)):(a=r.resolve(s.transform)).transform.apply(a,Bs([r.resolve(s.token,e)],s.transformArgs)):s.multiple?r.resolveAll(s.token):r.resolve(s.token,e):Os(s)?(o=r.resolve(s.transform,e)).transform.apply(o,Bs([r.resolve(s.token,e)],s.transformArgs)):r.resolve(s,e)}catch(e){throw new Error(Ls(t,n,e))}}},e}(),Gs=new Ws;function zs(){return function(e){qs.set(e,function(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],r=Reflect.getOwnMetadata("injectionTokens",e)||{};return Object.keys(r).forEach((function(e){t[+e]=r[e]})),t}(e))}}if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");class Js{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Js.prototype,"attrType",void 0),wt([ft({type:Pe.Any,repeated:"set"})],Js.prototype,"attrValues",void 0);class $s{constructor(e={}){this.acIssuer=new Rt,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}wt([ft({type:Rt})],$s.prototype,"acIssuer",void 0),wt([ft({type:Pe.Integer})],$s.prototype,"acSerial",void 0),wt([ft({type:Nr,repeated:"sequence"})],$s.prototype,"attrs",void 0);let Ys=js=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,js.prototype)}};Ys=js=wt([dt({type:Ne.Sequence,itemType:Pe.ObjectIdentifier})],Ys);class Xs{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}wt([ft({type:Pe.Integer,optional:!0})],Xs.prototype,"pathLenConstraint",void 0),wt([ft({type:Ys,implicit:!0,context:0,optional:!0})],Xs.prototype,"permittedAttrs",void 0),wt([ft({type:Ys,implicit:!0,context:1,optional:!0})],Xs.prototype,"excludedAttrs",void 0),wt([ft({type:Pe.Boolean,defaultValue:!0})],Xs.prototype,"permitUnSpecified",void 0);class Qs{constructor(e={}){this.issuer=new Kt,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}var Zs;wt([ft({type:Kt})],Qs.prototype,"issuer",void 0),wt([ft({type:Pe.Integer,converter:Re})],Qs.prototype,"serial",void 0),wt([ft({type:Pe.BitString,optional:!0})],Qs.prototype,"issuerUID",void 0),function(e){e[e.publicKey=0]="publicKey",e[e.publicKeyCert=1]="publicKeyCert",e[e.otherObjectTypes=2]="otherObjectTypes"}(Zs||(Zs={}));class en{constructor(e={}){this.digestedObjectType=Zs.publicKey,this.digestAlgorithm=new Vr,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.Enumerated})],en.prototype,"digestedObjectType",void 0),wt([ft({type:Pe.ObjectIdentifier,optional:!0})],en.prototype,"otherObjectTypeID",void 0),wt([ft({type:Vr})],en.prototype,"digestAlgorithm",void 0),wt([ft({type:Pe.BitString})],en.prototype,"objectDigest",void 0);class tn{constructor(e={}){Object.assign(this,e)}}wt([ft({type:Kt,optional:!0})],tn.prototype,"issuerName",void 0),wt([ft({type:Qs,context:0,implicit:!0,optional:!0})],tn.prototype,"baseCertificateID",void 0),wt([ft({type:en,context:1,implicit:!0,optional:!0})],tn.prototype,"objectDigestInfo",void 0);let rn=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Rt,repeated:"sequence"})],rn.prototype,"v1Form",void 0),wt([ft({type:tn,context:0,implicit:!0})],rn.prototype,"v2Form",void 0),rn=wt([dt({type:Ne.Choice})],rn);class sn{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}wt([ft({type:Pe.GeneralizedTime})],sn.prototype,"notBeforeTime",void 0),wt([ft({type:Pe.GeneralizedTime})],sn.prototype,"notAfterTime",void 0);class nn{constructor(e={}){Object.assign(this,e)}}var an,on,cn;wt([ft({type:Qs,implicit:!0,context:0,optional:!0})],nn.prototype,"baseCertificateID",void 0),wt([ft({type:Kt,implicit:!0,context:1,optional:!0})],nn.prototype,"entityName",void 0),wt([ft({type:en,implicit:!0,context:2,optional:!0})],nn.prototype,"objectDigestInfo",void 0),function(e){e[e.v2=1]="v2"}(an||(an={}));class ln{constructor(e={}){this.version=an.v2,this.holder=new nn,this.issuer=new rn,this.signature=new Vr,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new sn,this.attributes=[],Object.assign(this,e)}}wt([ft({type:Pe.Integer})],ln.prototype,"version",void 0),wt([ft({type:nn})],ln.prototype,"holder",void 0),wt([ft({type:rn})],ln.prototype,"issuer",void 0),wt([ft({type:Vr})],ln.prototype,"signature",void 0),wt([ft({type:Pe.Integer,converter:Re})],ln.prototype,"serialNumber",void 0),wt([ft({type:sn})],ln.prototype,"attrCertValidityPeriod",void 0),wt([ft({type:Nr,repeated:"sequence"})],ln.prototype,"attributes",void 0),wt([ft({type:Pe.BitString,optional:!0})],ln.prototype,"issuerUniqueID",void 0),wt([ft({type:Kr,optional:!0})],ln.prototype,"extensions",void 0);class hn{constructor(e={}){this.acinfo=new ln,this.signatureAlgorithm=new Vr,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:ln})],hn.prototype,"acinfo",void 0),wt([ft({type:Vr})],hn.prototype,"signatureAlgorithm",void 0),wt([ft({type:Pe.BitString})],hn.prototype,"signatureValue",void 0),function(e){e[e.unmarked=1]="unmarked",e[e.unclassified=2]="unclassified",e[e.restricted=4]="restricted",e[e.confidential=8]="confidential",e[e.secret=16]="secret",e[e.topSecret=32]="topSecret"}(on||(on={}));class un extends ot{}class pn{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier,implicit:!0,context:0})],pn.prototype,"type",void 0),wt([ft({type:Pe.Any,implicit:!0,context:1})],pn.prototype,"value",void 0);class dn{constructor(e={}){this.policyId="",this.classList=new un(on.unclassified),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],dn.prototype,"policyId",void 0),wt([ft({type:un,defaultValue:new un(on.unclassified)})],dn.prototype,"classList",void 0),wt([ft({type:pn,repeated:"set"})],dn.prototype,"securityCategories",void 0);class fn{constructor(e={}){Object.assign(this,e)}}wt([ft({type:ct})],fn.prototype,"cotets",void 0),wt([ft({type:Pe.ObjectIdentifier})],fn.prototype,"oid",void 0),wt([ft({type:Pe.Utf8String})],fn.prototype,"string",void 0);class mn{constructor(e={}){this.values=[],Object.assign(this,e)}}wt([ft({type:Kt,implicit:!0,context:0,optional:!0})],mn.prototype,"policyAuthority",void 0),wt([ft({type:fn,repeated:"sequence"})],mn.prototype,"values",void 0);class gn{constructor(e={}){this.targetCertificate=new Qs,Object.assign(this,e)}}wt([ft({type:Qs})],gn.prototype,"targetCertificate",void 0),wt([ft({type:Rt,optional:!0})],gn.prototype,"targetName",void 0),wt([ft({type:en,optional:!0})],gn.prototype,"certDigestInfo",void 0);let yn=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Rt,context:0,implicit:!0})],yn.prototype,"targetName",void 0),wt([ft({type:Rt,context:1,implicit:!0})],yn.prototype,"targetGroup",void 0),wt([ft({type:gn,context:2,implicit:!0})],yn.prototype,"targetCert",void 0),yn=wt([dt({type:Ne.Choice})],yn);let vn=cn=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,cn.prototype)}};var wn;vn=cn=wt([dt({type:Ne.Sequence,itemType:yn})],vn);let bn=wn=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,wn.prototype)}};bn=wn=wt([dt({type:Ne.Sequence,itemType:vn})],bn);class Sn{constructor(e={}){Object.assign(this,e)}}wt([ft({type:Kt,implicit:!0,context:0,optional:!0})],Sn.prototype,"roleAuthority",void 0),wt([ft({type:Rt,implicit:!0,context:1})],Sn.prototype,"roleName",void 0);class An{constructor(e={}){this.service=new Rt,this.ident=new Rt,Object.assign(this,e)}}var kn;wt([ft({type:Rt})],An.prototype,"service",void 0),wt([ft({type:Rt})],An.prototype,"ident",void 0),wt([ft({type:ct,optional:!0})],An.prototype,"authInfo",void 0);class Cn{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Cn.prototype,"otherCertFormat",void 0),wt([ft({type:Pe.Any})],Cn.prototype,"otherCert",void 0);let In=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Gr})],In.prototype,"certificate",void 0),wt([ft({type:hn,context:2,implicit:!0})],In.prototype,"v2AttrCert",void 0),wt([ft({type:Cn,context:3,implicit:!0})],In.prototype,"other",void 0),In=wt([dt({type:Ne.Choice})],In);let xn=kn=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,kn.prototype)}};xn=kn=wt([dt({type:Ne.Set,itemType:In})],xn);class En{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],En.prototype,"contentType",void 0),wt([ft({type:Pe.Any,context:0})],En.prototype,"content",void 0);let Bn=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:ct})],Bn.prototype,"single",void 0),wt([ft({type:Pe.Any})],Bn.prototype,"any",void 0),Bn=wt([dt({type:Ne.Choice})],Bn);class Nn{constructor(e={}){this.eContentType="",Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Nn.prototype,"eContentType",void 0),wt([ft({type:Bn,context:0,optional:!0})],Nn.prototype,"eContent",void 0);class Pn{constructor(e={}){this.issuer=new Dt,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Dt})],Pn.prototype,"issuer",void 0),wt([ft({type:Pe.Integer,converter:Re})],Pn.prototype,"serialNumber",void 0);var Dn;class Un{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Un.prototype,"otherRevInfoFormat",void 0),wt([ft({type:Pe.Any})],Un.prototype,"otherRevInfo",void 0);let On=class{constructor(e={}){this.other=new Un,Object.assign(this,e)}};wt([ft({type:Un,context:1,implicit:!0})],On.prototype,"other",void 0),On=wt([dt({type:Ne.Choice})],On);let Tn=Dn=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Dn.prototype)}};var Rn;Tn=Dn=wt([dt({type:Ne.Set,itemType:On})],Tn),function(e){e[e.v0=0]="v0",e[e.v1=1]="v1",e[e.v2=2]="v2",e[e.v3=3]="v3",e[e.v4=4]="v4",e[e.v5=5]="v5"}(Rn||(Rn={}));let _n=class extends Vr{};_n=wt([dt({type:Ne.Sequence})],_n);let Vn=class extends Vr{};Vn=wt([dt({type:Ne.Sequence})],Vn);let Fn=class{constructor(e={}){Object.assign(this,e)}};var Ln;wt([ft({type:Ur,context:0,implicit:!0})],Fn.prototype,"subjectKeyIdentifier",void 0),wt([ft({type:Pn})],Fn.prototype,"issuerAndSerialNumber",void 0),Fn=wt([dt({type:Ne.Choice})],Fn);class jn{constructor(e={}){this.version=Rn.v0,this.sid=new Fn,this.digestAlgorithm=new _n,this.signatureAlgorithm=new Vn,this.signature=new ct,Object.assign(this,e)}}wt([ft({type:Pe.Integer})],jn.prototype,"version",void 0),wt([ft({type:Fn})],jn.prototype,"sid",void 0),wt([ft({type:_n})],jn.prototype,"digestAlgorithm",void 0),wt([ft({type:Js,repeated:"set",context:0,implicit:!0,optional:!0})],jn.prototype,"signedAttrs",void 0),wt([ft({type:Vn})],jn.prototype,"signatureAlgorithm",void 0),wt([ft({type:ct})],jn.prototype,"signature",void 0),wt([ft({type:Js,repeated:"set",context:1,implicit:!0,optional:!0})],jn.prototype,"unsignedAttrs",void 0);let Hn=Ln=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Ln.prototype)}};var Mn;Hn=Ln=wt([dt({type:Ne.Set,itemType:jn})],Hn);let Kn=Mn=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Mn.prototype)}};Kn=Mn=wt([dt({type:Ne.Set,itemType:_n})],Kn);class qn{constructor(e={}){this.version=Rn.v0,this.digestAlgorithms=new Kn,this.encapContentInfo=new Nn,this.signerInfos=new Hn,Object.assign(this,e)}}var Wn;wt([ft({type:Pe.Integer})],qn.prototype,"version",void 0),wt([ft({type:Kn})],qn.prototype,"digestAlgorithms",void 0),wt([ft({type:Nn})],qn.prototype,"encapContentInfo",void 0),wt([ft({type:xn,context:0,implicit:!0,optional:!0})],qn.prototype,"certificates",void 0),wt([ft({type:On,context:1,implicit:!0,optional:!0})],qn.prototype,"crls",void 0),wt([ft({type:Hn})],qn.prototype,"signerInfos",void 0);class Gn{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}wt([ft({type:Pe.ObjectIdentifier})],Gn.prototype,"attrId",void 0),wt([ft({type:Pe.Any,repeated:"set"})],Gn.prototype,"attrValues",void 0);let zn=Wn=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Wn.prototype)}};var Jn;zn=Wn=wt([dt({type:Ne.Sequence,itemType:Gn})],zn);let $n=Jn=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Jn.prototype)}};$n=Jn=wt([dt({type:Ne.Sequence,itemType:En})],$n);class Yn{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Yn.prototype,"certId",void 0),wt([ft({type:Pe.Any,context:0})],Yn.prototype,"certValue",void 0);class Xn{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Xn.prototype,"crlId",void 0),wt([ft({type:Pe.Any,context:0})],Xn.prototype,"crltValue",void 0);class Qn extends ct{}class Zn{constructor(e={}){this.encryptionAlgorithm=new Vr,this.encryptedData=new Qn,Object.assign(this,e)}}var ei,ti;wt([ft({type:Vr})],Zn.prototype,"encryptionAlgorithm",void 0),wt([ft({type:Qn})],Zn.prototype,"encryptedData",void 0),function(e){e[e.v1=0]="v1"}(ti||(ti={}));class ri extends ct{}let si=ei=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,ei.prototype)}};si=ei=wt([dt({type:Ne.Sequence,itemType:Nr})],si);class ni{constructor(e={}){this.version=ti.v1,this.privateKeyAlgorithm=new Vr,this.privateKey=new ri,Object.assign(this,e)}}wt([ft({type:Pe.Integer})],ni.prototype,"version",void 0),wt([ft({type:Vr})],ni.prototype,"privateKeyAlgorithm",void 0),wt([ft({type:ri})],ni.prototype,"privateKey",void 0),wt([ft({type:si,implicit:!0,context:0,optional:!0})],ni.prototype,"attributes",void 0);let ii=class extends ni{};ii=wt([dt({type:Ne.Sequence})],ii);let ai=class extends Zn{};ai=wt([dt({type:Ne.Sequence})],ai);class oi{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],oi.prototype,"secretTypeId",void 0),wt([ft({type:Pe.Any,context:0})],oi.prototype,"secretValue",void 0);class ci{constructor(e={}){this.mac=new gs,this.macSalt=new ct,this.iterations=1,Object.assign(this,e)}}wt([ft({type:gs})],ci.prototype,"mac",void 0),wt([ft({type:ct})],ci.prototype,"macSalt",void 0),wt([ft({type:Pe.Integer,defaultValue:1})],ci.prototype,"iterations",void 0);class li{constructor(e={}){this.version=3,this.authSafe=new En,this.macData=new ci,Object.assign(this,e)}}var hi;wt([ft({type:Pe.Integer})],li.prototype,"version",void 0),wt([ft({type:En})],li.prototype,"authSafe",void 0),wt([ft({type:ci,optional:!0})],li.prototype,"macData",void 0);class ui{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],ui.prototype,"bagId",void 0),wt([ft({type:Pe.Any,context:0})],ui.prototype,"bagValue",void 0),wt([ft({type:Gn,repeated:"set",optional:!0})],ui.prototype,"bagAttributes",void 0);let pi=hi=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,hi.prototype)}};var di,fi,mi;pi=hi=wt([dt({type:Ne.Sequence,itemType:ui})],pi);let gi=class extends xt{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};wt([ft({type:Pe.IA5String})],gi.prototype,"ia5String",void 0),gi=wt([dt({type:Ne.Choice})],gi);let yi=class extends En{};yi=wt([dt({type:Ne.Sequence})],yi);let vi=class extends li{};vi=wt([dt({type:Ne.Sequence})],vi);let wi=class extends Zn{};wi=wt([dt({type:Ne.Sequence})],wi);let bi=class{constructor(e=""){this.value=e}toString(){return this.value}};wt([ft({type:Pe.IA5String})],bi.prototype,"value",void 0),bi=wt([dt({type:Ne.Choice})],bi);let Si=class extends gi{};Si=wt([dt({type:Ne.Choice})],Si);let Ai=class extends xt{};Ai=wt([dt({type:Ne.Choice})],Ai);let ki=class{constructor(e=new Date){this.value=e}};wt([ft({type:Pe.GeneralizedTime})],ki.prototype,"value",void 0),ki=wt([dt({type:Ne.Choice})],ki);let Ci=class extends xt{};Ci=wt([dt({type:Ne.Choice})],Ci);let Ii=class{constructor(e="M"){this.value=e}toString(){return this.value}};wt([ft({type:Pe.PrintableString})],Ii.prototype,"value",void 0),Ii=wt([dt({type:Ne.Choice})],Ii);let xi=class{constructor(e=""){this.value=e}toString(){return this.value}};wt([ft({type:Pe.PrintableString})],xi.prototype,"value",void 0),xi=wt([dt({type:Ne.Choice})],xi);let Ei=class extends xi{};Ei=wt([dt({type:Ne.Choice})],Ei);let Bi=class extends xt{};Bi=wt([dt({type:Ne.Choice})],Bi);let Ni=class{constructor(e=""){this.value=e}toString(){return this.value}};wt([ft({type:Pe.ObjectIdentifier})],Ni.prototype,"value",void 0),Ni=wt([dt({type:Ne.Choice})],Ni);let Pi=class extends Lr{};Pi=wt([dt({type:Ne.Choice})],Pi);let Di=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};wt([ft({type:Pe.Integer})],Di.prototype,"value",void 0),Di=wt([dt({type:Ne.Choice})],Di);let Ui=class extends jn{};Ui=wt([dt({type:Ne.Sequence})],Ui);let Oi=class extends xt{};Oi=wt([dt({type:Ne.Choice})],Oi);let Ti=di=class extends Kr{constructor(e){super(e),Object.setPrototypeOf(this,di.prototype)}};Ti=di=wt([dt({type:Ne.Sequence})],Ti);let Ri=fi=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,fi.prototype)}};Ri=fi=wt([dt({type:Ne.Set,itemType:Js})],Ri);let _i=class{constructor(e=""){this.value=e}toString(){return this.value}};wt([ft({type:Pe.BmpString})],_i.prototype,"value",void 0),_i=wt([dt({type:Ne.Choice})],_i);let Vi=class extends Vr{};Vi=wt([dt({type:Ne.Sequence})],Vi);let Fi=mi=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,mi.prototype)}};Fi=mi=wt([dt({type:Ne.Sequence,itemType:Vi})],Fi);function Li(e){return new Vr({algorithm:e})}const ji=Li("1.2.840.10045.4.1");Li("1.2.840.10045.4.3.1");const Hi=Li("1.2.840.10045.4.3.2"),Mi=Li("1.2.840.10045.4.3.3"),Ki=Li("1.2.840.10045.4.3.4");let qi=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Pe.ObjectIdentifier})],qi.prototype,"namedCurve",void 0),qi=wt([dt({type:Ne.Choice})],qi);class Wi{constructor(e={}){this.version=1,this.privateKey=new ct,Object.assign(this,e)}}wt([ft({type:Pe.Integer})],Wi.prototype,"version",void 0),wt([ft({type:ct})],Wi.prototype,"privateKey",void 0),wt([ft({type:qi,context:0,optional:!0})],Wi.prototype,"parameters",void 0),wt([ft({type:Pe.BitString,context:1,optional:!0})],Wi.prototype,"publicKey",void 0);class Gi{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}var zi;wt([ft({type:Pe.Integer,converter:Re})],Gi.prototype,"r",void 0),wt([ft({type:Pe.Integer,converter:Re})],Gi.prototype,"s",void 0);let Ji=zi=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,zi.prototype)}};Ji=zi=wt([dt({type:Ne.Sequence,itemType:Nr})],Ji);class $i{constructor(e={}){this.version=0,this.subject=new Dt,this.subjectPKInfo=new Fr,this.attributes=new Ji,Object.assign(this,e)}}wt([ft({type:Pe.Integer})],$i.prototype,"version",void 0),wt([ft({type:Dt})],$i.prototype,"subject",void 0),wt([ft({type:Fr})],$i.prototype,"subjectPKInfo",void 0),wt([ft({type:Ji,implicit:!0,context:0})],$i.prototype,"attributes",void 0);class Yi{constructor(e={}){this.certificationRequestInfo=new $i,this.signatureAlgorithm=new Vr,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:$i})],Yi.prototype,"certificationRequestInfo",void 0),wt([ft({type:Vr})],Yi.prototype,"signatureAlgorithm",void 0),wt([ft({type:Pe.BitString})],Yi.prototype,"signature",void 0);
/*!
 * MIT License
 * 
 * Copyright (c) Peculiar Ventures. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
class Xi{constructor(...e){if(1===e.length){const t=e[0];this.rawData=vt.serialize(t),this.onInit(t)}else{const t=vt.parse(e[0],e[1]);this.rawData=st.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof Xi&&function(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==s[t])return!1;return!0}(e.rawData,this.rawData)}}class Qi extends Xi{constructor(...e){let t;t=st.isBufferSource(e[0])?st.toArrayBuffer(e[0]):vt.serialize(new Mr({extnID:e[0],critical:e[1],extnValue:new ct(st.toArrayBuffer(e[2]))})),super(t,Mr)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}}class Zi extends Map{constructor(){super(),"undefined"!=typeof self&&"undefined"!=typeof crypto&&this.set(Zi.DEFAULT,crypto)}static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&void 0!==e.extractable}get(e=Zi.DEFAULT){const t=super.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if("string"==typeof e){if(!t)throw new TypeError("Argument 'value' is required");super.set(e.toLowerCase(),t)}else super.set(Zi.DEFAULT,e);return this}}Zi.DEFAULT="default";const ea=new Zi;Gs.registerSingleton("crypto.algorithmProvider",class{getAlgorithms(){return Gs.resolveAll("crypto.algorithm")}toAsnAlgorithm(e){for(const t of this.getAlgorithms()){const r=t.toAsnAlgorithm(e);if(r)return r}if(/[0-9.]+/.test(e.name)){const t=new Vr({algorithm:e.name});if("parameters"in e){const r=e;t.parameters=r.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const t of this.getAlgorithms()){const r=t.toWebAlgorithm(e);if(r)return r}return{name:e.algorithm,parameters:e.parameters}}});class ta{constructor(){this.CertificateTag="CERTIFICATE",this.CertificateRequestTag="CERTIFICATE REQUEST",this.PublicKeyTag="PUBLIC KEY",this.PrivateKeyTag="PRIVATE KEY"}static isPem(e){return"string"==typeof e&&/-{5}BEGIN [A-Z0-9 ]+-{5}([a-zA-Z0-9=+/\n\r]+)-{5}END [A-Z0-9 ]+-{5}/g.test(e)}static decode(e){const t=/-{5}BEGIN [A-Z0-9 ]+-{5}([a-zA-Z0-9=+/\n\r]+)-{5}END [A-Z0-9 ]+-{5}/g,r=[];let s=null;for(;s=t.exec(e);){const e=s[1].replace(/\r/g,"").replace(/\n/g,"");r.push(at.FromBase64(e))}return r}static encode(e,t){if(Array.isArray(e)){const r=new Array;return e.forEach((e=>{r.push(this.encodeBuffer(e,t))})),r.join("\n")}return this.encodeBuffer(e,t)}static encodeBuffer(e,t){const r=at.ToBase64(e);let s,n=0;const i=Array();for(;n<r.length&&(r.length-n<64?s=r.substring(n):(s=r.substring(n,n+64),n+=64),0!==s.length)&&(i.push(s),!(s.length<64)););const a=t.toLocaleUpperCase();return`-----BEGIN ${a}-----\n${i.join("\n")}\n-----END ${a}-----`}}class ra extends Xi{static isAsnEncoded(e){return st.isBufferSource(e)||"string"==typeof e}static toArrayBuffer(e){if("string"==typeof e){if(ta.isPem(e))return ta.decode(e)[0];if(at.isHex(e))return at.FromHex(e);if(at.isBase64(e))return at.FromBase64(e);if(at.isBase64Url(e))return at.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}{const t=at.ToBinary(e);return ta.isPem(t)?ta.decode(t)[0]:at.isHex(t)?at.FromHex(t):at.isBase64(t)?at.FromBase64(t):at.isBase64Url(t)?at.FromBase64Url(t):st.toArrayBuffer(e)}}constructor(...e){ra.isAsnEncoded(e[0])?super(ra.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return ta.encode(this.rawData,this.tag);case"hex":return at.ToHex(this.rawData);case"base64":return at.ToBase64(this.rawData);case"base64url":return at.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}}class sa extends ra{constructor(e){ra.isAsnEncoded(e)?super(e,Fr):super(e),this.tag="PUBLIC KEY"}async export(...e){let t,r=["verify"],s={hash:"SHA-256",...this.algorithm};return e.length>1?(s=e[0]||s,r=e[1]||r,t=e[2]||ea.get()):t=e[0]||ea.get(),t.subtle.importKey("spki",this.rawData,s,!0,r)}onInit(e){const t=Gs.resolve("crypto.algorithmProvider"),r=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case Xr:{const t=vt.parse(e.subjectPublicKey,Ss),s=st.toUint8Array(t.modulus);r.publicExponent=st.toUint8Array(t.publicExponent),r.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let r,s="SHA-1";return e.length>=1&&!(null===(t=e[0])||void 0===t?void 0:t.subtle)?(s=e[0]||s,r=e[1]||ea.get()):r=e[0]||ea.get(),await r.subtle.digest(s,this.rawData)}async getKeyIdentifier(e){e||(e=ea.get());const t=vt.parse(this.rawData,Fr);return await e.subtle.digest("SHA-1",t.subjectPublicKey)}}class na{constructor(){this.items={}}get(e){return this.items[e]||null}register(e,t){this.items[e]=t,this.items[t]=e}}const ia=new na;function aa(e,t){return`\\${at.ToHex(at.FromUtf8String(t)).toUpperCase()}`}ia.register("CN","2.5.4.3"),ia.register("L","2.5.4.7"),ia.register("ST","2.5.4.8"),ia.register("O","2.5.4.10"),ia.register("OU","2.5.4.11"),ia.register("C","2.5.4.6"),ia.register("DC","0.9.2342.19200300.100.1.25"),ia.register("E","1.2.840.113549.1.9.1"),ia.register("G","2.5.4.42"),ia.register("I","2.5.4.43"),ia.register("SN","2.5.4.4"),ia.register("T","2.5.4.12");class oa{constructor(e,t={}){this.extraNames=new na,this.asn=new Dt;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const r=t[e];this.extraNames.register(e,r)}"string"==typeof e?this.asn=this.fromString(e):e instanceof Dt?this.asn=e:st.isBufferSource(e)?this.asn=vt.parse(e,Dt):this.asn=this.fromJSON(e)}static isASCII(e){for(let t=0;t<e.length;t++){if(e.charCodeAt(t)>255)return!1}return!0}getName(e){return this.extraNames.get(e)||ia.get(e)}toString(){return this.asn.map((e=>e.map((e=>`${this.getName(e.type)||e.type}=${e.value.anyValue?`#${at.ToHex(e.value.anyValue)}`:e.value.toString().replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,aa)}`)).join("+"))).join(", ")}toJSON(){var e;const t=[];for(const r of this.asn){const s={};for(const t of r){const r=this.getName(t.type)||t.type;null!==(e=s[r])&&void 0!==e||(s[r]=[]),s[r].push(t.value.anyValue?`#${at.ToHex(t.value.anyValue)}`:t.value.toString())}t.push(s)}return t}fromString(e){const t=new Dt,r=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let s=null,n=",";for(;s=r.exec(`${e},`);){let[,e,r]=s;const i=r[r.length-1];","!==i&&"+"!==i||(r=r.slice(0,r.length-1),s[3]=i);const a=s[3];if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);const o=new Bt({type:e});if("#"===r.charAt(0))o.value.anyValue=at.FromHex(r.slice(1));else{const t=/"(.*?[^\\])?"/.exec(r);t&&(r=t[1]),r=r.replace(/\\0a/gi,"\n").replace(/\\0d/gi,"\r").replace(/\\0g/gi,"\t").replace(/\\(.)/g,"$1"),e===this.getName("E")||e===this.getName("DC")?o.value.ia5String=r:oa.isASCII(r)?o.value.printableString=r:o.value.utf8String=r}"+"===n?t[t.length-1].push(o):t.push(new Nt([o])),n=a}return t}fromJSON(e){const t=new Dt;for(const r of e){const e=new Nt;for(const t in r){let s=t;if(/[\d.]+/.test(t)||(s=this.getName(t)||""),!s)throw new Error(`Cannot get OID for name type '${t}'`);const n=r[t];for(const t of n){const r=new Bt({type:s});"#"===t[0]?r.value.anyValue=at.FromHex(t.slice(1)):s===this.getName("E")||s===this.getName("DC")?r.value.ia5String=t:r.value.printableString=t,e.push(r)}}t.push(e)}return t}toArrayBuffer(){return vt.serialize(this.asn)}async getThumbprint(...e){var t;let r,s="SHA-1";return e.length>=1&&!(null===(t=e[0])||void 0===t?void 0:t.subtle)?(s=e[0]||s,r=e[1]||ea.get()):r=e[0]||ea.get(),await r.subtle.digest(s,this.toArrayBuffer())}}class ca{static register(e,t){this.items.set(e,t)}static create(e){const t=new Qi(e),r=this.items.get(t.type);return r?new r(e):t}}ca.items=new Map;class la extends ra{constructor(e){ra.isAsnEncoded(e)?super(e,Gr):super(e),this.tag="CERTIFICATE"}onInit(e){const t=e.tbsCertificate;this.tbs=vt.serialize(t),this.serialNumber=at.ToHex(t.serialNumber),this.subjectName=new oa(t.subject),this.subject=new oa(t.subject).toString(),this.issuerName=new oa(t.issuer),this.issuer=this.issuerName.toString();const r=Gs.resolve("crypto.algorithmProvider");this.signatureAlgorithm=r.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const s=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!s)throw new Error("Cannot get 'notBefore' value");this.notBefore=s;const n=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!n)throw new Error("Cannot get 'notAfter' value");this.notAfter=n,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map((e=>ca.create(vt.serialize(e))))),this.publicKey=new sa(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if("string"==typeof e){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter((t=>"string"==typeof e?t.type===e:t instanceof e))}async verify(e={},t=ea.get()){let r,s;const n=e.publicKey;try{n?n instanceof la?(r={...n.publicKey.algorithm,...this.signatureAlgorithm},s=await n.publicKey.export(r,["verify"])):n instanceof sa?(r={...n.algorithm,...this.signatureAlgorithm},s=await n.export(r,["verify"])):(r={...n.algorithm,...this.signatureAlgorithm},s=n):(r={...this.publicKey.algorithm,...this.signatureAlgorithm},s=await this.publicKey.export(r,["verify"],t))}catch(e){return!1}const i=Gs.resolveAll("crypto.signatureFormatter").reverse();let a=null;for(const e of i)if(a=e.toWebSignature(r,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const o=await t.subtle.verify(this.signatureAlgorithm,s,a,this.tbs);if(e.signatureOnly)return o;{const t=(e.date||new Date).getTime();return o&&this.notBefore.getTime()<t&&t<this.notAfter.getTime()}}async getThumbprint(...e){let t,r="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(r=e[0]||r,t=e[1])),null!=t||(t=ea.get()),await t.subtle.digest(r,this.rawData)}async isSelfSigned(){return this.subject===this.issuer&&await this.verify({signatureOnly:!0})}}class ha extends Qi{constructor(...e){if(st.isBufferSource(e[0]))super(e[0]);else if("string"==typeof e[0]){const t=new jt({keyIdentifier:new ct(at.FromHex(e[0]))});super("2.5.29.35",e[1],vt.serialize(t))}else{const t=e[0],r=new jt({authorityCertIssuer:t.name,authorityCertSerialNumber:at.FromHex(t.serialNumber)});super("2.5.29.35",e[1],vt.serialize(r))}}static async create(e,t=!1,r=ea.get()){if(e instanceof la||Zi.isCryptoKey(e)){const s=e instanceof la?await e.publicKey.export(r):e,n=await r.subtle.exportKey("spki",s),i=new sa(n),a=await i.getKeyIdentifier(r);return new ha(at.ToHex(a),t)}return new ha(e,t)}onInit(e){super.onInit(e);const t=vt.parse(e.extnValue,jt);t.keyIdentifier&&(this.keyId=at.ToHex(t.keyIdentifier)),t.authorityCertIssuer&&t.authorityCertSerialNumber&&(this.certId={name:t.authorityCertIssuer,serialNumber:at.ToHex(t.authorityCertSerialNumber)})}}var ua;!function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(ua||(ua={}));class pa extends Qi{constructor(...e){if(st.isBufferSource(e[0])){super(e[0]);const t=vt.parse(this.value,Ur);this.keyId=at.ToHex(t)}else{const t="string"==typeof e[0]?at.FromHex(e[0]):e[0],r=new Ur(t);super("2.5.29.14",e[1],vt.serialize(r)),this.keyId=at.ToHex(t)}}static async create(e,t=!1,r=ea.get()){const s=await r.subtle.exportKey("spki",e),n=new sa(s),i=await n.getKeyIdentifier(r);return new pa(at.ToHex(i),t)}}class da extends Xi{constructor(...e){let t;if(st.isBufferSource(e[0]))t=st.toArrayBuffer(e[0]);else{const r=e[0],s=st.toArrayBuffer(e[1]);t=vt.serialize(new Ot({typeId:r,value:s}))}super(t,Ot)}onInit(e){this.type=e.typeId,this.value=e.value}toJSON(){return{type:this.type,value:at.ToHex(this.value)}}}class fa extends Qi{constructor(...e){if(st.isBufferSource(e[0]))super(e[0]);else{const t=e[0]||{},r=new Br;for(const e of t.dns||[])r.push(new Rt({dNSName:e}));for(const e of t.email||[])r.push(new Rt({rfc822Name:e}));for(const e of t.guid||[]){const t=/([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})/i.exec(e);if(!t)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const s=t.slice(1).map(((e,t)=>t<3?at.ToHex(new Uint8Array(at.FromHex(e)).reverse()):e)).join("");r.push(new Rt({otherName:new Ot({typeId:fa.GUID,value:vt.serialize(new ct(at.FromHex(s)))})}))}for(const e of t.ip||[])r.push(new Rt({iPAddress:e}));for(const e of t.url||[])r.push(new Rt({uniformResourceIdentifier:e}));for(const e of t.upn||[])r.push(new Rt({otherName:new Ot({typeId:fa.UPN,value:vt.serialize(He.toASN(e))})}));for(const e of t.registeredId||[])r.push(new Rt({registeredID:e}));for(const e of t.otherName||[])r.push(new Rt({otherName:new Ot({typeId:e.type,value:at.FromHex(e.value)})}));super("2.5.29.17",e[1],vt.serialize(r))}}onInit(e){super.onInit(e);const t=vt.parse(e.extnValue,Br);this.dns=t.filter((e=>e.dNSName)).map((e=>e.dNSName||"")),this.email=t.filter((e=>e.rfc822Name)).map((e=>e.rfc822Name||"")),this.ip=t.filter((e=>e.iPAddress)).map((e=>e.iPAddress||"")),this.url=t.filter((e=>e.uniformResourceIdentifier)).map((e=>e.uniformResourceIdentifier||"")),this.upn=t.filter((e=>{var t;return(null===(t=e.otherName)||void 0===t?void 0:t.typeId)===fa.UPN})).map((e=>e.otherName?vt.parse(e.otherName.value,xt).toString():"")),this.guid=t.filter((e=>{var t;return(null===(t=e.otherName)||void 0===t?void 0:t.typeId)===fa.GUID})).map((e=>e.otherName?vt.parse(e.otherName.value,ct):new ct)).map((e=>{const t=/([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})/i.exec(at.ToHex(e));if(!t)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const r=t.slice(1).map(((e,t)=>t<3?at.ToHex(new Uint8Array(at.FromHex(e)).reverse()):e)).join("-");return`{${r}}`})),this.registeredId=t.filter((e=>e.registeredID)).map((e=>e.registeredID||"")),this.otherNames=t.filter((e=>e.otherName&&![fa.GUID,fa.UPN].includes(e.otherName.typeId))).map((e=>new da(e.otherName.typeId,e.otherName.value)))}toJSON(){const e={};return this.dns.length&&(e.dns=[...this.dns]),this.email.length&&(e.email=[...this.email]),this.ip.length&&(e.ip=[...this.ip]),this.guid.length&&(e.guid=[...this.guid]),this.upn.length&&(e.upn=[...this.upn]),this.url.length&&(e.url=[...this.url]),this.registeredId.length&&(e.registeredId=[...this.registeredId]),this.otherNames.length&&(e.otherName=this.otherNames.map((e=>e.toJSON()))),e}}fa.GUID="1.3.6.1.4.1.311.25.1",fa.UPN="1.3.6.1.4.1.311.20.2.3";ca.register("2.5.29.32",class extends Qi{constructor(...e){var t;if(st.isBufferSource(e[0])){super(e[0]);const t=vt.parse(this.value,Zt);this.policies=t.map((e=>e.policyIdentifier))}else{const r=e[0],s=null!==(t=e[1])&&void 0!==t&&t,n=new Zt(r.map((e=>new Qt({policyIdentifier:e}))));super("2.5.29.32",s,vt.serialize(n)),this.policies=r}}});class ma extends Xi{constructor(...e){let t;if(st.isBufferSource(e[0]))t=st.toArrayBuffer(e[0]);else{const r=e[0],s=Array.isArray(e[1])?e[1].map((e=>st.toArrayBuffer(e))):[];t=vt.serialize(new Nr({type:r,values:s}))}super(t,Nr)}onInit(e){this.type=e.type,this.values=e.values}}class ga{static register(e,t){this.items.set(e,t)}static create(e){const t=new ma(e),r=this.items.get(t.type);return r?new r(e):t}}ga.items=new Map;let ya=class{toAsnAlgorithm(e){if("rsassa-pkcs1-v1_5"===e.name.toLowerCase()){if(!e.hash)return new Vr({algorithm:Xr,parameters:null});switch(e.hash.name.toLowerCase()){case"sha-1":return new Vr({algorithm:ss,parameters:null});case"sha-256":return new Vr({algorithm:ns,parameters:null});case"sha-384":return new Vr({algorithm:is,parameters:null});case"sha-512":return new Vr({algorithm:as,parameters:null})}}return null}toWebAlgorithm(e){switch(e.algorithm){case Xr:return{name:"RSASSA-PKCS1-v1_5"};case ss:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case ns:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case is:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case as:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}}return null}};var va;ya=wt([zs()],ya),Gs.registerSingleton("crypto.algorithm",ya);const wa="1.3.36.3.3.2.8.1.1",ba=`${wa}.1`,Sa=`${wa}.2`,Aa=`${wa}.3`,ka=`${wa}.4`,Ca=`${wa}.5`,Ia=`${wa}.6`,xa=`${wa}.7`,Ea=`${wa}.8`,Ba=`${wa}.9`,Na=`${wa}.10`,Pa=`${wa}.11`,Da=`${wa}.12`,Ua=`${wa}.13`,Oa=`${wa}.14`,Ta="ECDSA";let Ra=va=class{toAsnAlgorithm(e){if(e.name.toLowerCase()===Ta.toLowerCase())if("hash"in e){switch(("string"==typeof e.hash?e.hash:e.hash.name).toLowerCase()){case"sha-1":return ji;case"sha-256":return Hi;case"sha-384":return Mi;case"sha-512":return Ki}}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t="1.2.840.10045.3.1.7";break;case"K-256":t=va.SECP256K1;break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35";break;case"brainpoolP160r1":t=ba;break;case"brainpoolP160t1":t=Sa;break;case"brainpoolP192r1":t=Aa;break;case"brainpoolP192t1":t=ka;break;case"brainpoolP224r1":t=Ca;break;case"brainpoolP224t1":t=Ia;break;case"brainpoolP256r1":t=xa;break;case"brainpoolP256t1":t=Ea;break;case"brainpoolP320r1":t=Ba;break;case"brainpoolP320t1":t=Na;break;case"brainpoolP384r1":t=Pa;break;case"brainpoolP384t1":t=Da;break;case"brainpoolP512r1":t=Ua;break;case"brainpoolP512t1":t=Oa}if(t)return new Vr({algorithm:"1.2.840.10045.2.1",parameters:vt.serialize(new qi({namedCurve:t}))})}return null}toWebAlgorithm(e){switch(e.algorithm){case"1.2.840.10045.4.1":return{name:Ta,hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:Ta,hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:Ta,hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:Ta,hash:{name:"SHA-512"}};case"1.2.840.10045.2.1":if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(vt.parse(e.parameters,qi).namedCurve){case"1.2.840.10045.3.1.7":return{name:Ta,namedCurve:"P-256"};case va.SECP256K1:return{name:Ta,namedCurve:"K-256"};case"1.3.132.0.34":return{name:Ta,namedCurve:"P-384"};case"1.3.132.0.35":return{name:Ta,namedCurve:"P-521"};case ba:return{name:Ta,namedCurve:"brainpoolP160r1"};case Sa:return{name:Ta,namedCurve:"brainpoolP160t1"};case Aa:return{name:Ta,namedCurve:"brainpoolP192r1"};case ka:return{name:Ta,namedCurve:"brainpoolP192t1"};case Ca:return{name:Ta,namedCurve:"brainpoolP224r1"};case Ia:return{name:Ta,namedCurve:"brainpoolP224t1"};case xa:return{name:Ta,namedCurve:"brainpoolP256r1"};case Ea:return{name:Ta,namedCurve:"brainpoolP256t1"};case Ba:return{name:Ta,namedCurve:"brainpoolP320r1"};case Na:return{name:Ta,namedCurve:"brainpoolP320t1"};case Pa:return{name:Ta,namedCurve:"brainpoolP384r1"};case Da:return{name:Ta,namedCurve:"brainpoolP384t1"};case Ua:return{name:Ta,namedCurve:"brainpoolP512r1"};case Oa:return{name:Ta,namedCurve:"brainpoolP512t1"}}}return null}};Ra.SECP256K1="1.3.132.0.10",Ra=va=wt([zs()],Ra),Gs.registerSingleton("crypto.algorithm",Ra);class _a{addPadding(e,t){const r=st.toUint8Array(t),s=new Uint8Array(e);return s.set(r,e-r.length),s}removePadding(e,t=!1){let r=st.toUint8Array(e);for(let e=0;e<r.length;e++)if(r[e]){r=r.slice(e);break}if(t&&r[0]>127){const e=new Uint8Array(r.length+1);return e.set(r,1),e.buffer}return r.buffer}toAsnSignature(e,t){if("ECDSA"===e.name){const r=e.namedCurve,s=_a.namedCurveSize.get(r)||_a.defaultNamedCurveSize,n=new Gi,i=st.toUint8Array(t);return n.r=this.removePadding(i.slice(0,s),!0),n.s=this.removePadding(i.slice(s,s+s),!0),vt.serialize(n)}return null}toWebSignature(e,t){if("ECDSA"===e.name){const r=vt.parse(t,Gi),s=e.namedCurve,n=_a.namedCurveSize.get(s)||_a.defaultNamedCurveSize;return function(...e){const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),r=new Uint8Array(t);let s=0;return e.map((e=>new Uint8Array(e))).forEach((e=>{for(const t of e)r[s++]=t})),r.buffer}(this.addPadding(n,this.removePadding(r.r)),this.addPadding(n,this.removePadding(r.s)))}return null}}_a.namedCurveSize=new Map,_a.defaultNamedCurveSize=32;let Va=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t="1.3.101.112";break;case"ed448":t="1.3.101.113"}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t="1.3.101.110";break;case"x448":t="1.3.101.111"}}return t?new Vr({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case"1.3.101.112":return{name:"EdDSA",namedCurve:"Ed25519"};case"1.3.101.113":return{name:"EdDSA",namedCurve:"Ed448"};case"1.3.101.110":return{name:"ECDH-ES",namedCurve:"X25519"};case"1.3.101.111":return{name:"ECDH-ES",namedCurve:"X448"}}return null}};Va=wt([zs()],Va),Gs.registerSingleton("crypto.algorithm",Va);class Fa extends Array{constructor(e){if(super(),ra.isAsnEncoded(e))this.import(e);else if(e instanceof la)this.push(e);else if(Array.isArray(e))for(const t of e)this.push(t)}export(e){const t=new qn;t.certificates=new xn(this.map((e=>new In({certificate:vt.parse(e.rawData,Gr)}))));const r=new En({contentType:"1.2.840.113549.1.7.2",content:vt.serialize(t)}),s=vt.serialize(r);return"raw"===e?s:this.toString(e)}import(e){const t=ra.toArrayBuffer(e),r=vt.parse(t,En);if("1.2.840.113549.1.7.2"!==r.contentType)throw new TypeError("Cannot parse CMS package. Incoming data is not a SignedData object.");const s=vt.parse(r.content,qn);this.clear();for(const e of s.certificates||[])e.certificate&&this.push(new la(e.certificate))}clear(){for(;this.pop(););}toString(e="pem"){const t=this.export("raw");switch(e){case"pem":return ta.encode(t,"CMS");case"hex":return at.ToHex(t);case"base64":return at.ToBase64(t);case"base64url":return at.ToBase64Url(t);default:throw TypeError("Argument 'format' is unsupported value")}}}ca.register("2.5.29.19",class extends Qi{constructor(...e){if(st.isBufferSource(e[0])){super(e[0]);const t=vt.parse(this.value,Ht);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new Ht({cA:e[0],pathLenConstraint:e[1]});super("2.5.29.19",e[2],vt.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}}),ca.register("2.5.29.37",class extends Qi{constructor(...e){if(st.isBufferSource(e[0])){super(e[0]);const t=vt.parse(this.value,fr);this.usages=t.map((e=>e))}else{const t=new fr(e[0]);super("2.5.29.37",e[1],vt.serialize(t)),this.usages=e[0]}}}),ca.register("2.5.29.15",class extends Qi{constructor(...e){if(st.isBufferSource(e[0])){super(e[0]);const t=vt.parse(this.value,Sr);this.usages=t.toNumber()}else{const t=new Sr(e[0]);super("2.5.29.15",e[1],vt.serialize(t)),this.usages=e[0]}}}),ca.register("2.5.29.14",pa),ca.register("2.5.29.35",ha),ca.register("2.5.29.17",fa),ga.register("1.2.840.113549.1.9.7",class extends ma{constructor(...e){var t;if(st.isBufferSource(e[0]))super(e[0]);else{const t=new Oi({printableString:e[0]});super("1.2.840.113549.1.9.7",[vt.serialize(t)])}null!==(t=this.password)&&void 0!==t||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const e=vt.parse(this.values[0],Oi);this.password=e.toString()}}}),ga.register("1.2.840.113549.1.9.14",class extends ma{constructor(...e){var t;if(st.isBufferSource(e[0]))super(e[0]);else{const t=new Kr(e[0]);super("1.2.840.113549.1.9.14",[vt.serialize(t)])}null!==(t=this.items)&&void 0!==t||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const e=vt.parse(this.values[0],Kr);this.items=e.map((e=>ca.create(vt.serialize(e))))}}}),Gs.registerSingleton("crypto.signatureFormatter",class{toAsnSignature(e,t){return st.toArrayBuffer(t)}toWebSignature(e,t){return st.toArrayBuffer(t)}}),Gs.registerSingleton("crypto.signatureFormatter",_a),_a.namedCurveSize.set("P-256",32),_a.namedCurveSize.set("K-256",32),_a.namedCurveSize.set("P-384",48),_a.namedCurveSize.set("P-521",66);class La{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}toString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let s=e;s<e+t;s++)r+=String.fromCharCode(this.view[s]);return r}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);let s=0,n=0;for(let i=0;i<t;i++)i%2?(n|=r.get(e.charAt(i)),this.view[s]=n,s++):n=r.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let s=e;s<e+t;s++){const e=this.view[s].toString(16).toUpperCase();r=r+(1==e.length?"0":"")+e}return r}copy(e=0,t=this.length-e){if(!e&&!this.length)return new La;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new La({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new La;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new La({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,r=e.length,s=e._view.subarray();this.realloc(t+r),this._view.set(s,t)}insert(e,t=0,r=this.length-t){return!(t>this.length-1)&&(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,r,s){const{start:n,length:i,backward:a}=this.prepareFindParameters(t,r,s),o=e.length;if(o>i)return-1;const c=[];for(let t=0;t<o;t++)c.push(e.view[t]);for(let e=0;e<=i-o;e++){let t=!0;const r=a?n-o-e:n+e;for(let e=0;e<o;e++)if(this.view[e+r]!=c[e]){t=!1;break}if(t)return a?n-o-e:n+o+e}return-1}findFirstIn(e,t,r,s){const{start:n,length:i,backward:a}=this.prepareFindParameters(t,r,s),o={id:-1,position:a?0:n+i,length:0};for(let t=0;t<e.length;t++){const r=this.findPattern(e[t],n,i,a);if(-1!=r){let s=!1;const n=e[t].length;a?r-n>=o.position-o.length&&(s=!0):r-n<=o.position-o.length&&(s=!0),s&&(o.position=r,o.id=t,o.length=n)}}return o}findAllIn(e,t,r){let{start:s,length:n}=this.prepareFindParameters(t,r);const i=[];let a={id:-1,position:s};for(;;){const t=a.position;if(a=this.findFirstIn(e,a.position,n),-1==a.id)break;n-=a.position-t,i.push({id:a.id,position:a.position})}return i}findAllPatternIn(e,t,r){const{start:s,length:n}=this.prepareFindParameters(t,r),i=[],a=e.length;if(a>n)return-1;const o=Array.from(e.view);for(let e=0;e<=n-a;e++){let t=!0;const r=s+e;for(let e=0;e<a;e++)if(this.view[e+r]!=o[e]){t=!1;break}t&&(i.push(s+a+e),e+=a-1)}return i}findFirstNotIn(e,t,r,s){let{start:n,length:i,backward:a}=this.prepareFindParameters(t,r,s);const o={left:{id:-1,position:n},right:{id:-1,position:0},value:new La};let c=i;for(;c>0;){if(o.right=this.findFirstIn(e,a?n-i+c:n+i-c,c,a),-1==o.right.id){i=c,a?n-=i:n=o.left.position,o.value=new La({buffer:this._buffer.slice(n,n+i)});break}if(o.right.position!=(a?o.left.position-e[o.right.id].length:o.left.position+e[o.right.id].length)){a?(n=o.right.position+e[o.right.id].length,i=o.left.position-o.right.position-e[o.right.id].length):(n=o.left.position,i=o.right.position-o.left.position-e[o.right.id].length),o.value=new La({buffer:this._buffer.slice(n,n+i)});break}o.left=o.right,c-=e[o.right.id].length}if(a){const e=o.right;o.right=o.left,o.left=e}return o}findAllNotIn(e,t,r){let{start:s,length:n}=this.prepareFindParameters(t,r);const i=[];let a={left:{id:-1,position:s},right:{id:-1,position:s},value:new La};do{const t=a.right.position;a=this.findFirstNotIn(e,a.right.position,n),n-=a.right.position-t,i.push({left:{id:a.left.id,position:a.left.position},right:{id:a.right.id,position:a.right.position},value:a.value})}while(-1!=a.right.id);return i}findFirstSequence(e,t,r,s){let{start:n,length:i,backward:a}=this.prepareFindParameters(t,r,s);const o=this.skipNotPatterns(e,n,i,a);if(-1==o)return{position:-1,value:new La};const c=this.skipPatterns(e,o,i-(a?n-o:o-n),a);a?(n=c,i=o-c):(n=o,i=c-o);return{position:c,value:new La({buffer:this._buffer.slice(n,n+i)})}}findAllSequences(e,t,r){let{start:s,length:n}=this.prepareFindParameters(t,r);const i=[];let a={position:s,value:new La};do{const t=a.position;a=this.findFirstSequence(e,a.position,n),-1!=a.position&&(n-=a.position-t,i.push({position:a.position,value:a.value}))}while(-1!=a.position);return i}findPairedPatterns(e,t,r,s){const n=[];if(e.isEqual(t))return n;const{start:i,length:a}=this.prepareFindParameters(r,s);let o=0;const c=this.findAllPatternIn(e,i,a);if(!Array.isArray(c)||0==c.length)return n;const l=this.findAllPatternIn(t,i,a);if(!Array.isArray(l)||0==l.length)return n;for(;o<c.length&&0!=l.length;)if(c[0]!=l[0]){if(c[o]>l[0])break;for(;c[o]<l[0]&&(o++,!(o>=c.length)););n.push({left:c[o-1],right:l[0]}),c.splice(o-1,1),l.splice(0,1),o=0}else n.push({left:c[0],right:l[0]}),c.splice(0,1),l.splice(0,1);return n.sort(((e,t)=>e.left-t.left)),n}findPairedArrays(e,t,r,s){const{start:n,length:i}=this.prepareFindParameters(r,s),a=[];let o=0;const c=this.findAllIn(e,n,i);if(0==c.length)return a;const l=this.findAllIn(t,n,i);if(0==l.length)return a;for(;o<c.length&&0!=l.length;)if(c[0].position!=l[0].position){if(c[o].position>l[0].position)break;for(;c[o].position<l[0].position&&(o++,!(o>=c.length)););a.push({left:c[o-1],right:l[0]}),c.splice(o-1,1),l.splice(0,1),o=0}else a.push({left:c[0],right:l[0]}),c.splice(0,1),l.splice(0,1);return a.sort(((e,t)=>e.left.position-t.left.position)),a}replacePattern(e,t,r,s,n=null){let i,a=[];const o={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:c,length:l}=this.prepareFindParameters(r,s);if(null==n){if(a=this.findAllIn([e],c,l),0==a.length)return o}else a=n;o.searchPatternPositions.push(...Array.from(a,(e=>e.position)));const h=e.length-t.length,u=new ArrayBuffer(this.view.length-a.length*h),p=new Uint8Array(u);for(p.set(new Uint8Array(this.buffer,0,c)),i=0;i<a.length;i++){const r=0==i?c:a[i-1].position;p.set(new Uint8Array(this.buffer,r,a[i].position-e.length-r),r-i*h),p.set(t.view,a[i].position-e.length-i*h),o.replacePatternPositions.push(a[i].position-e.length-i*h)}return i--,p.set(new Uint8Array(this.buffer,a[i].position,this.length-a[i].position),a[i].position-e.length+t.length-i*h),this.buffer=u,this.view=new Uint8Array(this.buffer),o.status=1,o}skipPatterns(e,t,r,s){const{start:n,length:i,backward:a}=this.prepareFindParameters(t,r,s);let o=n;for(let t=0;t<e.length;t++){const r=e[t].length,s=a?o-r:o;let c=!0;for(let n=0;n<r;n++)if(this.view[n+s]!=e[t].view[n]){c=!1;break}if(c)if(t=-1,a){if(o-=r,o<=0)return o}else if(o+=r,o>=n+i)return o}return o}skipNotPatterns(e,t,r,s){const{start:n,length:i,backward:a}=this.prepareFindParameters(t,r,s);let o=-1;for(let t=0;t<i;t++){for(let r=0;r<e.length;r++){const s=e[r].length,i=a?n-t-s:n+t;let c=!0;for(let t=0;t<s;t++)if(this.view[t+i]!=e[r].view[t]){c=!1;break}if(c){o=a?n-t:n+t;break}}if(-1!=o)break}return o}prepareFindParameters(e=null,t=null,r=!1){return null===e&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}class ja{constructor(e={}){this._stream=new La,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in e?new La({view:e.view}):"buffer"in e?new La({buffer:e.buffer}):"string"in e?new La({string:e.string}):"hexstring"in e?new La({hexstring:e.hexstring}):"stream"in e?e.stream.slice():new La,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(null==t||t>this.length)&&(t=this.length);const r=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==r)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}findFirstIn(e,t=null){(null==t||t>this.length)&&(t=this.length);const r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==r.id)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(null==t||t>this._length)&&(t=this._length);const r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==r.left.id&&-1==r.right.id)return r;if(this.backward){if(-1!=r.right.id&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new La}}else if(-1!=r.left.id&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new La};return this.backward?-1==r.left.id?this.start=0:this.start=r.left.position:-1==r.right.id?this.start=this._start+this._length:this.start=r.right.position,r}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,r=null){(null==t||t>this._length)&&(t=this._length),(null==r||r>t)&&(r=t);const s=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==s.value.length)return s;if(this.backward){if(s.position<this._start-s.value.length-r)return{position:-1,value:new La}}else if(s.position>this._start+s.value.length+r)return{position:-1,value:new La};return this.start=s.position,s}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,r=null){(null==r||r>this.length)&&(r=this.length);const s=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,s,this.length);if(n.length)if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[];return n}findPairedArrays(e,t,r=null){(null==r||r>this.length)&&(r=this.length);const s=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,s,this.length);if(n.length)if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[];return n}replacePattern(e,t){const r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);let r;if(this._length<e&&(e=this._length),this.backward){const t=this._stream.view.subarray(this._length-e,this._length);r=new Uint8Array(e);for(let s=0;s<e;s++)r[e-1-s]=t[s]}else r=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),r}getUint16(e=!0){const t=this.getBlock(2,e);if(t.length<2)return 0;const r=new Uint16Array(1),s=new Uint8Array(r.buffer);return s[0]=t[1],s[1]=t[0],r[0]}getInt16(e=!0){const t=this.getBlock(2,e);if(t.length<2)return 0;const r=new Int16Array(1),s=new Uint8Array(r.buffer);return s[0]=t[1],s[1]=t[0],r[0]}getUint24(e=!0){const t=this.getBlock(3,e);if(t.length<3)return 0;const r=new Uint32Array(1),s=new Uint8Array(r.buffer);for(let e=3;e>=1;e--)s[3-e]=t[e-1];return r[0]}getUint32(e=!0){const t=this.getBlock(4,e);if(t.length<4)return 0;const r=new Uint32Array(1),s=new Uint8Array(r.buffer);for(let e=3;e>=0;e--)s[3-e]=t[e];return r[0]}getInt32(e=!0){const t=this.getBlock(4,e);if(t.length<4)return 0;const r=new Int32Array(1),s=new Uint8Array(r.buffer);for(let e=3;e>=0;e--)s[3-e]=t[e];return r[0]}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+ja.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}ja.APPEND_BLOCK=1e3;function Ha(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ma=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ka=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),qa=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Wa=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ga=new Array(576);Ha(Ga);const za=new Array(60);Ha(za);const Ja=new Array(512);Ha(Ja);const $a=new Array(256);Ha($a);const Ya=new Array(29);Ha(Ya);const Xa=new Array(30);function Qa(e,t,r,s,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=s,this.max_length=n,this.has_stree=e&&e.length}let Za,eo,to;function ro(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ha(Xa);const so=e=>e<256?Ja[e]:Ja[256+(e>>>7)],no=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},io=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,no(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},ao=(e,t,r)=>{io(e,r[2*t],r[2*t+1])},oo=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},co=(e,t,r)=>{const s=new Array(16);let n,i,a=0;for(n=1;n<=15;n++)s[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=oo(s[t]++,t))}},lo=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},ho=e=>{e.bi_valid>8?no(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},uo=(e,t,r,s)=>{const n=2*t,i=2*r;return e[n]<e[i]||e[n]===e[i]&&s[t]<=s[r]},po=(e,t,r)=>{const s=e.heap[r];let n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&uo(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!uo(t,s,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=s},fo=(e,t,r)=>{let s,n,i,a,o=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],n=e.pending_buf[e.l_buf+o],o++,0===s?ao(e,n,t):(i=$a[n],ao(e,i+256+1,t),a=Ma[i],0!==a&&(n-=Ya[i],io(e,n,a)),s--,i=so(s),ao(e,i,r),a=Ka[i],0!==a&&(s-=Xa[i],io(e,s,a)))}while(o<e.last_lit);ao(e,256,t)},mo=(e,t)=>{const r=t.dyn_tree,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,i=t.stat_desc.elems;let a,o,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<i;a++)0!==r[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):r[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,n&&(e.static_len-=s[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)po(e,r,a);c=i;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],po(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,r[2*c]=r[2*a]+r[2*o],e.depth[c]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,r[2*a+1]=r[2*o+1]=c,e.heap[1]=c++,po(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,s=t.max_code,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,h,u,p,d,f,m=0;for(p=0;p<=15;p++)e.bl_count[p]=0;for(r[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)h=e.heap[l],p=r[2*r[2*h+1]+1]+1,p>c&&(p=c,m++),r[2*h+1]=p,h>s||(e.bl_count[p]++,d=0,h>=o&&(d=a[h-o]),f=r[2*h],e.opt_len+=f*(p+d),i&&(e.static_len+=f*(n[2*h+1]+d)));if(0!==m){do{for(p=c-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(p=c;0!==p;p--)for(h=e.bl_count[p];0!==h;)u=e.heap[--l],u>s||(r[2*u+1]!==p&&(e.opt_len+=(p-r[2*u+1])*r[2*u],r[2*u+1]=p),h--)}})(e,t),co(r,l,e.bl_count)},go=(e,t,r)=>{let s,n,i=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(r+1)+1]=65535,s=0;s<=r;s++)n=a,a=t[2*(s+1)+1],++o<c&&n===a||(o<l?e.bl_tree[2*n]+=o:0!==n?(n!==i&&e.bl_tree[2*n]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=n,0===a?(c=138,l=3):n===a?(c=6,l=3):(c=7,l=4))},yo=(e,t,r)=>{let s,n,i=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),s=0;s<=r;s++)if(n=a,a=t[2*(s+1)+1],!(++o<c&&n===a)){if(o<l)do{ao(e,n,e.bl_tree)}while(0!=--o);else 0!==n?(n!==i&&(ao(e,n,e.bl_tree),o--),ao(e,16,e.bl_tree),io(e,o-3,2)):o<=10?(ao(e,17,e.bl_tree),io(e,o-3,3)):(ao(e,18,e.bl_tree),io(e,o-11,7));o=0,i=n,0===a?(c=138,l=3):n===a?(c=6,l=3):(c=7,l=4)}};let vo=!1;const wo=(e,t,r,s)=>{io(e,0+(s?1:0),3),((e,t,r,s)=>{ho(e),s&&(no(e,r),no(e,~r)),e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r})(e,t,r,!0)};var bo=(e,t,r,s)=>{let n,i,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),mo(e,e.l_desc),mo(e,e.d_desc),a=(e=>{let t;for(go(e,e.dyn_ltree,e.l_desc.max_code),go(e,e.dyn_dtree,e.d_desc.max_code),mo(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Wa[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=n&&(n=i)):n=i=r+5,r+4<=n&&-1!==t?wo(e,t,r,s):4===e.strategy||i===n?(io(e,2+(s?1:0),3),fo(e,Ga,za)):(io(e,4+(s?1:0),3),((e,t,r,s)=>{let n;for(io(e,t-257,5),io(e,r-1,5),io(e,s-4,4),n=0;n<s;n++)io(e,e.bl_tree[2*Wa[n]+1],3);yo(e,e.dyn_ltree,t-1),yo(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),fo(e,e.dyn_ltree,e.dyn_dtree)),lo(e),s&&ho(e)},So={_tr_init:e=>{vo||((()=>{let e,t,r,s,n;const i=new Array(16);for(r=0,s=0;s<28;s++)for(Ya[s]=r,e=0;e<1<<Ma[s];e++)$a[r++]=s;for($a[r-1]=s,n=0,s=0;s<16;s++)for(Xa[s]=n,e=0;e<1<<Ka[s];e++)Ja[n++]=s;for(n>>=7;s<30;s++)for(Xa[s]=n<<7,e=0;e<1<<Ka[s]-7;e++)Ja[256+n++]=s;for(t=0;t<=15;t++)i[t]=0;for(e=0;e<=143;)Ga[2*e+1]=8,e++,i[8]++;for(;e<=255;)Ga[2*e+1]=9,e++,i[9]++;for(;e<=279;)Ga[2*e+1]=7,e++,i[7]++;for(;e<=287;)Ga[2*e+1]=8,e++,i[8]++;for(co(Ga,287,i),e=0;e<30;e++)za[2*e+1]=5,za[2*e]=oo(e,5);Za=new Qa(Ga,Ma,257,286,15),eo=new Qa(za,Ka,0,30,15),to=new Qa(new Array(0),qa,0,19,7)})(),vo=!0),e.l_desc=new ro(e.dyn_ltree,Za),e.d_desc=new ro(e.dyn_dtree,eo),e.bl_desc=new ro(e.bl_tree,to),e.bi_buf=0,e.bi_valid=0,lo(e)},_tr_stored_block:wo,_tr_flush_block:bo,_tr_tally:(e,t,r)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*($a[r]+256+1)]++,e.dyn_dtree[2*so(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{io(e,2,3),ao(e,256,Ga),(e=>{16===e.bi_valid?(no(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Ao=(e,t,r,s)=>{let n=65535&e|0,i=e>>>16&65535|0,a=0;for(;0!==r;){a=r>2e3?2e3:r,r-=a;do{n=n+t[s++]|0,i=i+n|0}while(--a);n%=65521,i%=65521}return n|i<<16|0};const ko=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Co=(e,t,r,s)=>{const n=ko,i=s+r;e^=-1;for(let r=s;r<i;r++)e=e>>>8^n[255&(e^t[r])];return-1^e},Io={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},xo={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Eo,_tr_stored_block:Bo,_tr_flush_block:No,_tr_tally:Po,_tr_align:Do}=So,{Z_NO_FLUSH:Uo,Z_PARTIAL_FLUSH:Oo,Z_FULL_FLUSH:To,Z_FINISH:Ro,Z_BLOCK:_o,Z_OK:Vo,Z_STREAM_END:Fo,Z_STREAM_ERROR:Lo,Z_DATA_ERROR:jo,Z_BUF_ERROR:Ho,Z_DEFAULT_COMPRESSION:Mo,Z_FILTERED:Ko,Z_HUFFMAN_ONLY:qo,Z_RLE:Wo,Z_FIXED:Go,Z_DEFAULT_STRATEGY:zo,Z_UNKNOWN:Jo,Z_DEFLATED:$o}=xo,Yo=(e,t)=>(e.msg=Io[t],t),Xo=e=>(e<<1)-(e>4?9:0),Qo=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let Zo=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const ec=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},tc=(e,t)=>{No(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ec(e.strm)},rc=(e,t)=>{e.pending_buf[e.pending++]=t},sc=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},nc=(e,t,r,s)=>{let n=e.avail_in;return n>s&&(n=s),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=Ao(e.adler,t,n,r):2===e.state.wrap&&(e.adler=Co(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},ic=(e,t)=>{let r,s,n=e.max_chain_length,i=e.strstart,a=e.prev_length,o=e.nice_match;const c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,h=e.w_mask,u=e.prev,p=e.strstart+258;let d=l[i+a-1],f=l[i+a];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do{if(r=t,l[r+a]===f&&l[r+a-1]===d&&l[r]===l[i]&&l[++r]===l[i+1]){i+=2,r++;do{}while(l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&i<p);if(s=258-(p-i),i=p-258,s>a){if(e.match_start=t,a=s,s>=o)break;d=l[i+a-1],f=l[i+a]}}}while((t=u[t&h])>c&&0!=--n);return a<=e.lookahead?a:e.lookahead},ac=e=>{const t=e.w_size;let r,s,n,i,a;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-262)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,s=e.hash_size,r=s;do{n=e.head[--r],e.head[r]=n>=t?n-t:0}while(--s);s=t,r=s;do{n=e.prev[--r],e.prev[r]=n>=t?n-t:0}while(--s);i+=t}if(0===e.strm.avail_in)break;if(s=nc(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=Zo(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=Zo(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)},oc=(e,t)=>{let r,s;for(;;){if(e.lookahead<262){if(ac(e),e.lookahead<262&&t===Uo)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=Zo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=ic(e,r)),e.match_length>=3)if(s=Po(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Zo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Zo(e,e.ins_h,e.window[e.strstart+1]);else s=Po(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(tc(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ro?(tc(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(tc(e,!1),0===e.strm.avail_out)?1:2},cc=(e,t)=>{let r,s,n;for(;;){if(e.lookahead<262){if(ac(e),e.lookahead<262&&t===Uo)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=Zo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=ic(e,r),e.match_length<=5&&(e.strategy===Ko||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,s=Po(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=Zo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(tc(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=Po(e,0,e.window[e.strstart-1]),s&&tc(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Po(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ro?(tc(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(tc(e,!1),0===e.strm.avail_out)?1:2};function lc(e,t,r,s,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=s,this.func=n}const hc=[new lc(0,0,0,0,((e,t)=>{let r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ac(e),0===e.lookahead&&t===Uo)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const s=e.block_start+r;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,tc(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(tc(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ro?(tc(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(tc(e,!1),e.strm.avail_out),1)})),new lc(4,4,8,4,oc),new lc(4,5,16,8,oc),new lc(4,6,32,32,oc),new lc(4,4,16,16,cc),new lc(8,16,32,32,cc),new lc(8,16,128,128,cc),new lc(8,32,128,256,cc),new lc(32,128,258,1024,cc),new lc(32,258,258,4096,cc)];function uc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$o,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Qo(this.dyn_ltree),Qo(this.dyn_dtree),Qo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Qo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Qo(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const pc=e=>{if(!e||!e.state)return Yo(e,Lo);e.total_in=e.total_out=0,e.data_type=Jo;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=Uo,Eo(t),Vo},dc=e=>{const t=pc(e);var r;return t===Vo&&((r=e.state).window_size=2*r.w_size,Qo(r.head),r.max_lazy_match=hc[r.level].max_lazy,r.good_match=hc[r.level].good_length,r.nice_match=hc[r.level].nice_length,r.max_chain_length=hc[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},fc=(e,t,r,s,n,i)=>{if(!e)return Lo;let a=1;if(t===Mo&&(t=6),s<0?(a=0,s=-s):s>15&&(a=2,s-=16),n<1||n>9||r!==$o||s<8||s>15||t<0||t>9||i<0||i>Go)return Yo(e,Lo);8===s&&(s=9);const o=new uc;return e.state=o,o.strm=e,o.wrap=a,o.gzhead=null,o.w_bits=s,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=i,o.method=r,dc(e)};var mc={deflateInit:(e,t)=>fc(e,t,$o,15,8,zo),deflateInit2:fc,deflateReset:dc,deflateResetKeep:pc,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?Lo:(e.state.gzhead=t,Vo):Lo,deflate:(e,t)=>{let r,s;if(!e||!e.state||t>_o||t<0)return e?Yo(e,Lo):Lo;const n=e.state;if(!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==Ro)return Yo(e,0===e.avail_out?Ho:Lo);n.strm=e;const i=n.last_flush;if(n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,rc(n,31),rc(n,139),rc(n,8),n.gzhead?(rc(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),rc(n,255&n.gzhead.time),rc(n,n.gzhead.time>>8&255),rc(n,n.gzhead.time>>16&255),rc(n,n.gzhead.time>>24&255),rc(n,9===n.level?2:n.strategy>=qo||n.level<2?4:0),rc(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(rc(n,255&n.gzhead.extra.length),rc(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Co(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(rc(n,0),rc(n,0),rc(n,0),rc(n,0),rc(n,0),rc(n,9===n.level?2:n.strategy>=qo||n.level<2?4:0),rc(n,3),n.status=113);else{let t=$o+(n.w_bits-8<<4)<<8,r=-1;r=n.strategy>=qo||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,n.status=113,sc(n,t),0!==n.strstart&&(sc(n,e.adler>>>16),sc(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(r=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>r&&(e.adler=Co(e.adler,n.pending_buf,n.pending-r,r)),ec(e),r=n.pending,n.pending!==n.pending_buf_size));)rc(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>r&&(e.adler=Co(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(e.adler=Co(e.adler,n.pending_buf,n.pending-r,r)),ec(e),r=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,rc(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>r&&(e.adler=Co(e.adler,n.pending_buf,n.pending-r,r)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(e.adler=Co(e.adler,n.pending_buf,n.pending-r,r)),ec(e),r=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,rc(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>r&&(e.adler=Co(e.adler,n.pending_buf,n.pending-r,r)),0===s&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&ec(e),n.pending+2<=n.pending_buf_size&&(rc(n,255&e.adler),rc(n,e.adler>>8&255),e.adler=0,n.status=113)):n.status=113),0!==n.pending){if(ec(e),0===e.avail_out)return n.last_flush=-1,Vo}else if(0===e.avail_in&&Xo(t)<=Xo(i)&&t!==Ro)return Yo(e,Ho);if(666===n.status&&0!==e.avail_in)return Yo(e,Ho);if(0!==e.avail_in||0!==n.lookahead||t!==Uo&&666!==n.status){let r=n.strategy===qo?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(ac(e),0===e.lookahead)){if(t===Uo)return 1;break}if(e.match_length=0,r=Po(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(tc(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ro?(tc(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(tc(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Wo?((e,t)=>{let r,s,n,i;const a=e.window;for(;;){if(e.lookahead<=258){if(ac(e),e.lookahead<=258&&t===Uo)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,s=a[n],s===a[++n]&&s===a[++n]&&s===a[++n])){i=e.strstart+258;do{}while(s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&n<i);e.match_length=258-(i-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Po(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Po(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(tc(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ro?(tc(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(tc(e,!1),0===e.strm.avail_out)?1:2})(n,t):hc[n.level].func(n,t);if(3!==r&&4!==r||(n.status=666),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),Vo;if(2===r&&(t===Oo?Do(n):t!==_o&&(Bo(n,0,0,!1),t===To&&(Qo(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ec(e),0===e.avail_out))return n.last_flush=-1,Vo}return t!==Ro?Vo:n.wrap<=0?Fo:(2===n.wrap?(rc(n,255&e.adler),rc(n,e.adler>>8&255),rc(n,e.adler>>16&255),rc(n,e.adler>>24&255),rc(n,255&e.total_in),rc(n,e.total_in>>8&255),rc(n,e.total_in>>16&255),rc(n,e.total_in>>24&255)):(sc(n,e.adler>>>16),sc(n,65535&e.adler)),ec(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Vo:Fo)},deflateEnd:e=>{if(!e||!e.state)return Lo;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?Yo(e,Lo):(e.state=null,113===t?Yo(e,jo):Vo)},deflateSetDictionary:(e,t)=>{let r=t.length;if(!e||!e.state)return Lo;const s=e.state,n=s.wrap;if(2===n||1===n&&42!==s.status||s.lookahead)return Lo;if(1===n&&(e.adler=Ao(e.adler,t,r,0)),s.wrap=0,r>=s.w_size){0===n&&(Qo(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(r-s.w_size,r),0),t=e,r=s.w_size}const i=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,ac(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=Zo(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,ac(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=a,e.input=o,e.avail_in=i,s.wrap=n,Vo},deflateInfo:"pako deflate (from Nodeca project)"};const gc=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var yc=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)gc(r,t)&&(e[t]=r[t])}}return e},vc=e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,s=0,n=e.length;t<n;t++){let n=e[t];r.set(n,s),s+=n.length}return r};let wc=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){wc=!1}const bc=new Uint8Array(256);for(let e=0;e<256;e++)bc[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;bc[254]=bc[254]=1;var Sc=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,s,n,i,a=e.length,o=0;for(n=0;n<a;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<a&&(s=e.charCodeAt(n+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),n++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),i=0,n=0;i<o;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<a&&(s=e.charCodeAt(n+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),n++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},Ac=(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,n;const i=new Array(2*r);for(n=0,s=0;s<r;){let t=e[s++];if(t<128){i[n++]=t;continue}let a=bc[t];if(a>4)i[n++]=65533,s+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&s<r;)t=t<<6|63&e[s++],a--;a>1?i[n++]=65533:t<65536?i[n++]=t:(t-=65536,i[n++]=55296|t>>10&1023,i[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&wc)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let s=0;s<t;s++)r+=String.fromCharCode(e[s]);return r})(i,n)},kc=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+bc[e[r]]>t?r:t};var Cc=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ic=Object.prototype.toString,{Z_NO_FLUSH:xc,Z_SYNC_FLUSH:Ec,Z_FULL_FLUSH:Bc,Z_FINISH:Nc,Z_OK:Pc,Z_STREAM_END:Dc,Z_DEFAULT_COMPRESSION:Uc,Z_DEFAULT_STRATEGY:Oc,Z_DEFLATED:Tc}=xo;function Rc(e){this.options=yc({level:Uc,method:Tc,chunkSize:16384,windowBits:15,memLevel:8,strategy:Oc},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cc,this.strm.avail_out=0;let r=mc.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Pc)throw new Error(Io[r]);if(t.header&&mc.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Sc(t.dictionary):"[object ArrayBuffer]"===Ic.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=mc.deflateSetDictionary(this.strm,e),r!==Pc)throw new Error(Io[r]);this._dict_set=!0}}function _c(e,t){const r=new Rc(t);if(r.push(e,!0),r.err)throw r.msg||Io[r.err];return r.result}Rc.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize;let n,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Nc:xc,"string"==typeof e?r.input=Sc(e):"[object ArrayBuffer]"===Ic.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),(i===Ec||i===Bc)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(n=mc.deflate(r,i),n===Dc)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=mc.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Pc;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Rc.prototype.onData=function(e){this.chunks.push(e)},Rc.prototype.onEnd=function(e){e===Pc&&(this.result=vc(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Vc={Deflate:Rc,deflate:_c,deflateRaw:function(e,t){return(t=t||{}).raw=!0,_c(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,_c(e,t)},constants:xo};var Fc=function(e,t){let r,s,n,i,a,o,c,l,h,u,p,d,f,m,g,y,v,w,b,S,A,k,C,I;const x=e.state;r=e.next_in,C=e.input,s=r+(e.avail_in-5),n=e.next_out,I=e.output,i=n-(t-e.avail_out),a=n+(e.avail_out-257),o=x.dmax,c=x.wsize,l=x.whave,h=x.wnext,u=x.window,p=x.hold,d=x.bits,f=x.lencode,m=x.distcode,g=(1<<x.lenbits)-1,y=(1<<x.distbits)-1;e:do{d<15&&(p+=C[r++]<<d,d+=8,p+=C[r++]<<d,d+=8),v=f[p&g];t:for(;;){if(w=v>>>24,p>>>=w,d-=w,w=v>>>16&255,0===w)I[n++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=f[(65535&v)+(p&(1<<w)-1)];continue t}if(32&w){x.mode=12;break e}e.msg="invalid literal/length code",x.mode=30;break e}b=65535&v,w&=15,w&&(d<w&&(p+=C[r++]<<d,d+=8),b+=p&(1<<w)-1,p>>>=w,d-=w),d<15&&(p+=C[r++]<<d,d+=8,p+=C[r++]<<d,d+=8),v=m[p&y];r:for(;;){if(w=v>>>24,p>>>=w,d-=w,w=v>>>16&255,!(16&w)){if(0==(64&w)){v=m[(65535&v)+(p&(1<<w)-1)];continue r}e.msg="invalid distance code",x.mode=30;break e}if(S=65535&v,w&=15,d<w&&(p+=C[r++]<<d,d+=8,d<w&&(p+=C[r++]<<d,d+=8)),S+=p&(1<<w)-1,S>o){e.msg="invalid distance too far back",x.mode=30;break e}if(p>>>=w,d-=w,w=n-i,S>w){if(w=S-w,w>l&&x.sane){e.msg="invalid distance too far back",x.mode=30;break e}if(A=0,k=u,0===h){if(A+=c-w,w<b){b-=w;do{I[n++]=u[A++]}while(--w);A=n-S,k=I}}else if(h<w){if(A+=c+h-w,w-=h,w<b){b-=w;do{I[n++]=u[A++]}while(--w);if(A=0,h<b){w=h,b-=w;do{I[n++]=u[A++]}while(--w);A=n-S,k=I}}}else if(A+=h-w,w<b){b-=w;do{I[n++]=u[A++]}while(--w);A=n-S,k=I}for(;b>2;)I[n++]=k[A++],I[n++]=k[A++],I[n++]=k[A++],b-=3;b&&(I[n++]=k[A++],b>1&&(I[n++]=k[A++]))}else{A=n-S;do{I[n++]=I[A++],I[n++]=I[A++],I[n++]=I[A++],b-=3}while(b>2);b&&(I[n++]=I[A++],b>1&&(I[n++]=I[A++]))}break}}break}}while(r<s&&n<a);b=d>>3,r-=b,d-=b<<3,p&=(1<<d)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?s-r+5:5-(r-s),e.avail_out=n<a?a-n+257:257-(n-a),x.hold=p,x.bits=d};const Lc=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),jc=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Hc=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Mc=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Kc=(e,t,r,s,n,i,a,o)=>{const c=o.bits;let l,h,u,p,d,f,m=0,g=0,y=0,v=0,w=0,b=0,S=0,A=0,k=0,C=0,I=null,x=0;const E=new Uint16Array(16),B=new Uint16Array(16);let N,P,D,U=null,O=0;for(m=0;m<=15;m++)E[m]=0;for(g=0;g<s;g++)E[t[r+g]]++;for(w=c,v=15;v>=1&&0===E[v];v--);if(w>v&&(w=v),0===v)return n[i++]=20971520,n[i++]=20971520,o.bits=1,0;for(y=1;y<v&&0===E[y];y++);for(w<y&&(w=y),A=1,m=1;m<=15;m++)if(A<<=1,A-=E[m],A<0)return-1;if(A>0&&(0===e||1!==v))return-1;for(B[1]=0,m=1;m<15;m++)B[m+1]=B[m]+E[m];for(g=0;g<s;g++)0!==t[r+g]&&(a[B[t[r+g]]++]=g);if(0===e?(I=U=a,f=19):1===e?(I=Lc,x-=257,U=jc,O-=257,f=256):(I=Hc,U=Mc,f=-1),C=0,g=0,m=y,d=i,b=w,S=0,u=-1,k=1<<w,p=k-1,1===e&&k>852||2===e&&k>592)return 1;for(;;){N=m-S,a[g]<f?(P=0,D=a[g]):a[g]>f?(P=U[O+a[g]],D=I[x+a[g]]):(P=96,D=0),l=1<<m-S,h=1<<b,y=h;do{h-=l,n[d+(C>>S)+h]=N<<24|P<<16|D|0}while(0!==h);for(l=1<<m-1;C&l;)l>>=1;if(0!==l?(C&=l-1,C+=l):C=0,g++,0==--E[m]){if(m===v)break;m=t[r+a[g]]}if(m>w&&(C&p)!==u){for(0===S&&(S=w),d+=y,b=m-S,A=1<<b;b+S<v&&(A-=E[b+S],!(A<=0));)b++,A<<=1;if(k+=1<<b,1===e&&k>852||2===e&&k>592)return 1;u=C&p,n[u]=w<<24|b<<16|d-i|0}}return 0!==C&&(n[d+C]=m-S<<24|64<<16|0),o.bits=w,0};const{Z_FINISH:qc,Z_BLOCK:Wc,Z_TREES:Gc,Z_OK:zc,Z_STREAM_END:Jc,Z_NEED_DICT:$c,Z_STREAM_ERROR:Yc,Z_DATA_ERROR:Xc,Z_MEM_ERROR:Qc,Z_BUF_ERROR:Zc,Z_DEFLATED:el}=xo,tl=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function rl(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const sl=e=>{if(!e||!e.state)return Yc;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,zc},nl=e=>{if(!e||!e.state)return Yc;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,sl(e)},il=(e,t)=>{let r;if(!e||!e.state)return Yc;const s=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Yc:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=r,s.wbits=t,nl(e))},al=(e,t)=>{if(!e)return Yc;const r=new rl;e.state=r,r.window=null;const s=il(e,t);return s!==zc&&(e.state=null),s};let ol,cl,ll=!0;const hl=e=>{if(ll){ol=new Int32Array(512),cl=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Kc(1,e.lens,0,288,ol,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Kc(2,e.lens,0,32,cl,0,e.work,{bits:5}),ll=!1}e.lencode=ol,e.lenbits=9,e.distcode=cl,e.distbits=5},ul=(e,t,r,s)=>{let n;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),s>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(n=i.wsize-i.wnext,n>s&&(n=s),i.window.set(t.subarray(r-s,r-s+n),i.wnext),(s-=n)?(i.window.set(t.subarray(r-s,r),0),i.wnext=s,i.whave=i.wsize):(i.wnext+=n,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=n))),0};var pl={inflateReset:nl,inflateReset2:il,inflateResetKeep:sl,inflateInit:e=>al(e,15),inflateInit2:al,inflate:(e,t)=>{let r,s,n,i,a,o,c,l,h,u,p,d,f,m,g,y,v,w,b,S,A,k,C=0;const I=new Uint8Array(4);let x,E;const B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Yc;r=e.state,12===r.mode&&(r.mode=13),a=e.next_out,n=e.output,c=e.avail_out,i=e.next_in,s=e.input,o=e.avail_in,l=r.hold,h=r.bits,u=o,p=c,k=zc;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;h<16;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(2&r.wrap&&35615===l){r.check=0,I[0]=255&l,I[1]=l>>>8&255,r.check=Co(r.check,I,2,0),l=0,h=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=30;break}if((15&l)!==el){e.msg="unknown compression method",r.mode=30;break}if(l>>>=4,h-=4,A=8+(15&l),0===r.wbits)r.wbits=A;else if(A>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&l?10:12,l=0,h=0;break;case 2:for(;h<16;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(r.flags=l,(255&r.flags)!==el){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&(I[0]=255&l,I[1]=l>>>8&255,r.check=Co(r.check,I,2,0)),l=0,h=0,r.mode=3;case 3:for(;h<32;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}r.head&&(r.head.time=l),512&r.flags&&(I[0]=255&l,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,r.check=Co(r.check,I,4,0)),l=0,h=0,r.mode=4;case 4:for(;h<16;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&(I[0]=255&l,I[1]=l>>>8&255,r.check=Co(r.check,I,2,0)),l=0,h=0,r.mode=5;case 5:if(1024&r.flags){for(;h<16;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&(I[0]=255&l,I[1]=l>>>8&255,r.check=Co(r.check,I,2,0)),l=0,h=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(d=r.length,d>o&&(d=o),d&&(r.head&&(A=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(i,i+d),A)),512&r.flags&&(r.check=Co(r.check,s,d,i)),o-=d,i+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;d=0;do{A=s[i+d++],r.head&&A&&r.length<65536&&(r.head.name+=String.fromCharCode(A))}while(A&&d<o);if(512&r.flags&&(r.check=Co(r.check,s,d,i)),o-=d,i+=d,A)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;d=0;do{A=s[i+d++],r.head&&A&&r.length<65536&&(r.head.comment+=String.fromCharCode(A))}while(A&&d<o);if(512&r.flags&&(r.check=Co(r.check,s,d,i)),o-=d,i+=d,A)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;h<16;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}l=0,h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;h<32;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}e.adler=r.check=tl(l),l=0,h=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=l,r.bits=h,$c;e.adler=r.check=1,r.mode=12;case 12:if(t===Wc||t===Gc)break e;case 13:if(r.last){l>>>=7&h,h-=7&h,r.mode=27;break}for(;h<3;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}switch(r.last=1&l,l>>>=1,h-=1,3&l){case 0:r.mode=14;break;case 1:if(hl(r),r.mode=20,t===Gc){l>>>=2,h-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}l>>>=2,h-=2;break;case 14:for(l>>>=7&h,h-=7&h;h<32;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&l,l=0,h=0,r.mode=15,t===Gc)break e;case 15:r.mode=16;case 16:if(d=r.length,d){if(d>o&&(d=o),d>c&&(d=c),0===d)break e;n.set(s.subarray(i,i+d),a),o-=d,i+=d,c-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;h<14;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(r.nlen=257+(31&l),l>>>=5,h-=5,r.ndist=1+(31&l),l>>>=5,h-=5,r.ncode=4+(15&l),l>>>=4,h-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;h<3;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}r.lens[B[r.have++]]=7&l,l>>>=3,h-=3}for(;r.have<19;)r.lens[B[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,x={bits:r.lenbits},k=Kc(0,r.lens,0,19,r.lencode,0,r.work,x),r.lenbits=x.bits,k){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;C=r.lencode[l&(1<<r.lenbits)-1],g=C>>>24,y=C>>>16&255,v=65535&C,!(g<=h);){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(v<16)l>>>=g,h-=g,r.lens[r.have++]=v;else{if(16===v){for(E=g+2;h<E;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(l>>>=g,h-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}A=r.lens[r.have-1],d=3+(3&l),l>>>=2,h-=2}else if(17===v){for(E=g+3;h<E;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}l>>>=g,h-=g,A=0,d=3+(7&l),l>>>=3,h-=3}else{for(E=g+7;h<E;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}l>>>=g,h-=g,A=0,d=11+(127&l),l>>>=7,h-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=A}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,x={bits:r.lenbits},k=Kc(1,r.lens,0,r.nlen,r.lencode,0,r.work,x),r.lenbits=x.bits,k){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,x={bits:r.distbits},k=Kc(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,x),r.distbits=x.bits,k){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,t===Gc)break e;case 20:r.mode=21;case 21:if(o>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=l,r.bits=h,Fc(e,p),a=e.next_out,n=e.output,c=e.avail_out,i=e.next_in,s=e.input,o=e.avail_in,l=r.hold,h=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;C=r.lencode[l&(1<<r.lenbits)-1],g=C>>>24,y=C>>>16&255,v=65535&C,!(g<=h);){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(y&&0==(240&y)){for(w=g,b=y,S=v;C=r.lencode[S+((l&(1<<w+b)-1)>>w)],g=C>>>24,y=C>>>16&255,v=65535&C,!(w+g<=h);){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}l>>>=w,h-=w,r.back+=w}if(l>>>=g,h-=g,r.back+=g,r.length=v,0===y){r.mode=26;break}if(32&y){r.back=-1,r.mode=12;break}if(64&y){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&y,r.mode=22;case 22:if(r.extra){for(E=r.extra;h<E;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;C=r.distcode[l&(1<<r.distbits)-1],g=C>>>24,y=C>>>16&255,v=65535&C,!(g<=h);){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(0==(240&y)){for(w=g,b=y,S=v;C=r.distcode[S+((l&(1<<w+b)-1)>>w)],g=C>>>24,y=C>>>16&255,v=65535&C,!(w+g<=h);){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}l>>>=w,h-=w,r.back+=w}if(l>>>=g,h-=g,r.back+=g,64&y){e.msg="invalid distance code",r.mode=30;break}r.offset=v,r.extra=15&y,r.mode=24;case 24:if(r.extra){for(E=r.extra;h<E;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===c)break e;if(d=p-c,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}d>r.wnext?(d-=r.wnext,f=r.wsize-d):f=r.wnext-d,d>r.length&&(d=r.length),m=r.window}else m=n,f=a-r.offset,d=r.length;d>c&&(d=c),c-=d,r.length-=d;do{n[a++]=m[f++]}while(--d);0===r.length&&(r.mode=21);break;case 26:if(0===c)break e;n[a++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;h<32;){if(0===o)break e;o--,l|=s[i++]<<h,h+=8}if(p-=c,e.total_out+=p,r.total+=p,p&&(e.adler=r.check=r.flags?Co(r.check,n,p,a-p):Ao(r.check,n,p,a-p)),p=c,(r.flags?l:tl(l))!==r.check){e.msg="incorrect data check",r.mode=30;break}l=0,h=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;h<32;){if(0===o)break e;o--,l+=s[i++]<<h,h+=8}if(l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}l=0,h=0}r.mode=29;case 29:k=Jc;break e;case 30:k=Xc;break e;case 31:return Qc;default:return Yc}return e.next_out=a,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=l,r.bits=h,(r.wsize||p!==e.avail_out&&r.mode<30&&(r.mode<27||t!==qc))&&ul(e,e.output,e.next_out,p-e.avail_out),u-=e.avail_in,p-=e.avail_out,e.total_in+=u,e.total_out+=p,r.total+=p,r.wrap&&p&&(e.adler=r.check=r.flags?Co(r.check,n,p,e.next_out-p):Ao(r.check,n,p,e.next_out-p)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===u&&0===p||t===qc)&&k===zc&&(k=Zc),k},inflateEnd:e=>{if(!e||!e.state)return Yc;let t=e.state;return t.window&&(t.window=null),e.state=null,zc},inflateGetHeader:(e,t)=>{if(!e||!e.state)return Yc;const r=e.state;return 0==(2&r.wrap)?Yc:(r.head=t,t.done=!1,zc)},inflateSetDictionary:(e,t)=>{const r=t.length;let s,n,i;return e&&e.state?(s=e.state,0!==s.wrap&&11!==s.mode?Yc:11===s.mode&&(n=1,n=Ao(n,t,r,0),n!==s.check)?Xc:(i=ul(e,t,r,r),i?(s.mode=31,Qc):(s.havedict=1,zc))):Yc},inflateInfo:"pako inflate (from Nodeca project)"};var dl=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const fl=Object.prototype.toString,{Z_NO_FLUSH:ml,Z_FINISH:gl,Z_OK:yl,Z_STREAM_END:vl,Z_NEED_DICT:wl,Z_STREAM_ERROR:bl,Z_DATA_ERROR:Sl,Z_MEM_ERROR:Al}=xo;function kl(e){this.options=yc({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cc,this.strm.avail_out=0;let r=pl.inflateInit2(this.strm,t.windowBits);if(r!==yl)throw new Error(Io[r]);if(this.header=new dl,pl.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Sc(t.dictionary):"[object ArrayBuffer]"===fl.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=pl.inflateSetDictionary(this.strm,t.dictionary),r!==yl)))throw new Error(Io[r])}function Cl(e,t){const r=new kl(t);if(r.push(e),r.err)throw r.msg||Io[r.err];return r.result}kl.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize,n=this.options.dictionary;let i,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?gl:ml,"[object ArrayBuffer]"===fl.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),i=pl.inflate(r,a),i===wl&&n&&(i=pl.inflateSetDictionary(r,n),i===yl?i=pl.inflate(r,a):i===Sl&&(i=wl));r.avail_in>0&&i===vl&&r.state.wrap>0&&0!==e[r.next_in];)pl.inflateReset(r),i=pl.inflate(r,a);switch(i){case bl:case Sl:case wl:case Al:return this.onEnd(i),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(0===r.avail_out||i===vl))if("string"===this.options.to){let e=kc(r.output,r.next_out),t=r.next_out-e,n=Ac(r.output,e);r.next_out=t,r.avail_out=s-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(n)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==yl||0!==o){if(i===vl)return i=pl.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},kl.prototype.onData=function(e){this.chunks.push(e)},kl.prototype.onEnd=function(e){e===yl&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=vc(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Il={Inflate:kl,inflate:Cl,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Cl(e,t)},ungzip:Cl,constants:xo};const{Deflate:xl,deflate:El,deflateRaw:Bl,gzip:Nl}=Vc,{Inflate:Pl,inflate:Dl,inflateRaw:Ul,ungzip:Ol}=Il;var Tl=El,Rl=Pl,_l=Dl,Vl=Ol;const Fl=globalThis.EventEmitter;class Ll{constructor(e={}){this.algorithmId=t(e,"algorithmId",Ll.defaultValues("algorithmId")),"algorithmParams"in e&&(this.algorithmParams=t(e,"algorithmParams",Ll.defaultValues("algorithmParams"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new ke;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof ke;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",optional:r.optional||!1,value:[new J({name:r.algorithmIdentifier||""}),new ke({name:r.algorithmParams||"",optional:!0})]})}fromSchema(e){w(e,["algorithm","params"]);const t=Be(e,e,Ll.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=t.result.algorithm.valueBlock.toString(),"params"in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new J({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof ke==!1&&e.push(this.algorithmParams),new _({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof ke==!1&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return e instanceof Ll!=!1&&(this.algorithmId===e.algorithmId&&("algorithmParams"in this?"algorithmParams"in e&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!("algorithmParams"in e)))}}class jl{static register(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}jl.namedCurves={},jl.register("P-256","1.2.840.10045.3.1.7",32),jl.register("P-384","1.3.132.0.34",48),jl.register("P-521","1.3.132.0.35",66),jl.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),jl.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),jl.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);class Hl{constructor(e={}){this.x=t(e,"x",Hl.defaultValues("x")),this.y=t(e,"y",Hl.defaultValues("y")),this.namedCurve=t(e,"namedCurve",Hl.defaultValues("namedCurve")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"x":case"y":return l(t,Hl.defaultValues(e));case"namedCurve":return""===t;default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static schema(e={}){return new Ie}fromSchema(e){if(e instanceof ArrayBuffer==!1)throw new Error("Object's schema was not verified against input data for ECPublicKey");if(4!==new Uint8Array(e)[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");const t=jl.find(this.namedCurve);if(!t)throw new Error(`Incorrect curve OID: ${this.namedCurve}`);const r=t.size;if(e.byteLength!==2*r+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,r+1),this.y=e.slice(1+r,2*r+1)}toSchema(){return new Ie({data:a(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=jl.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:d(m(this.x),!0,!0,!1),y:d(m(this.y),!0,!0,!1)}}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');{const r=jl.find(e.crv);r&&(this.namedCurve=r.id,t=r.size)}if(!("x"in e))throw new Error('Absent mandatory parameter "x"');{const r=g(f(e.x,!0));if(r.byteLength<t){this.x=new ArrayBuffer(t);const e=new Uint8Array(this.x),s=new Uint8Array(r);e.set(s,1)}else this.x=r.slice(0,t)}if(!("y"in e))throw new Error('Absent mandatory parameter "y"');{const r=g(f(e.y,!0));if(r.byteLength<t){this.y=new ArrayBuffer(t);const e=new Uint8Array(this.y),s=new Uint8Array(r);e.set(s,1)}else this.y=r.slice(0,t)}}}class Ml{constructor(e={}){this.modulus=t(e,"modulus",Ml.defaultValues("modulus")),this.publicExponent=t(e,"publicExponent",Ml.defaultValues("publicExponent")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"modulus":case"publicExponent":return new q;default:throw new Error(`Invalid member name for RSAPublicKey class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.modulus||""}),new q({name:r.publicExponent||""})]})}fromSchema(e){w(e,["modulus","publicExponent"]);const t=Be(e,e,Ml.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new _({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:d(m(this.modulus.valueBlock.valueHex),!0,!0,!0),e:d(m(this.publicExponent.valueBlock.valueHex),!0,!0,!0)}}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');{const t=g(f(e.n,!0));this.modulus=new q({valueHex:t.slice(0,Math.pow(2,v(t.byteLength)))})}if(!("e"in e))throw new Error('Absent mandatory parameter "e"');this.publicExponent=new q({valueHex:g(f(e.e,!0)).slice(0,3)})}}class Kl{constructor(e={}){this.algorithm=t(e,"algorithm",Kl.defaultValues("algorithm")),this.subjectPublicKey=t(e,"subjectPublicKey",Kl.defaultValues("subjectPublicKey")),"parsedKey"in e&&(this.parsedKey=t(e,"parsedKey",Kl.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"algorithm":return new Ll;case"subjectPublicKey":return new M;default:throw new Error(`Invalid member name for PublicKeyInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Ll.schema(r.algorithm||{}),new M({name:r.subjectPublicKey||""})]})}fromSchema(e){w(e,["algorithm","subjectPublicKey"]);const t=Be(e,e,Kl.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PublicKeyInfo");switch(this.algorithm=new Ll({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey,this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===J.blockName())try{this.parsedKey=new Hl({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Ee(this.subjectPublicKey.valueBlock.valueHex);if(-1!==e.offset)try{this.parsedKey=new Ml({schema:e.result})}catch(e){}}}}toSchema(){return new _({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if("parsedKey"in this==!1)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const r of Object.keys(t))e[r]=t[r];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Hl({json:e}),this.algorithm=new Ll({algorithmId:"1.2.840.10045.2.1",algorithmParams:new J({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Ml({json:e}),this.algorithm=new Ll({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new F});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new M({valueHex:this.parsedKey.toSchema().toBER(!1)})}}importKey(e){let t=Promise.resolve();const r=this;if(void 0===e)return Promise.reject("Need to provide publicKey input parameter");const s=nh();return void 0===s?Promise.reject("Unable to create WebCrypto object"):(t=t.then((()=>s.exportKey("spki",e))),t=t.then((e=>{const t=Ee(e);try{r.fromSchema(t.result)}catch(e){return Promise.reject("Error during initializing object from schema")}}),(e=>Promise.reject(`Error during exporting public key: ${e}`))),t)}}class ql{constructor(e={}){this.type=t(e,"type",ql.defaultValues("type")),this.values=t(e,"values",ql.defaultValues("values")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"values":return[];default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return""===t;case"values":return 0===t.length;default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.type||""}),new V({name:r.setName||"",value:[new Ce({name:r.values||"",value:new ke})]})]})}fromSchema(e){w(e,["type","values"]);const t=Be(e,e,ql.schema({names:{type:"type",values:"values"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Attribute");this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new _({value:[new J({value:this.type}),new V({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,(e=>e.toJSON()))}}}class Wl{constructor(e={}){this.version=t(e,"version",Wl.defaultValues("version")),this.privateKey=t(e,"privateKey",Wl.defaultValues("privateKey")),"namedCurve"in e&&(this.namedCurve=t(e,"namedCurve",Wl.defaultValues("namedCurve"))),"publicKey"in e&&(this.publicKey=t(e,"publicKey",Wl.defaultValues("publicKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 1;case"privateKey":return new j;case"namedCurve":return"";case"publicKey":return new Hl;default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return t===Wl.defaultValues(e);case"privateKey":return t.isEqual(Wl.defaultValues(e));case"namedCurve":return""===t;case"publicKey":return Hl.compareWithDefault("namedCurve",t.namedCurve)&&Hl.compareWithDefault("x",t.x)&&Hl.compareWithDefault("y",t.y);default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),new j({name:r.privateKey||""}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new J({name:r.namedCurve||""})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new M({name:r.publicKey||""})]})]})}fromSchema(e){w(e,["version","privateKey","namedCurve","publicKey"]);const t=Be(e,e,Wl.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ECPrivateKey");if(this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,"namedCurve"in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),"publicKey"in t.result){const e={schema:t.result.publicKey.valueBlock.valueHex};"namedCurve"in this&&(e.namedCurve=this.namedCurve),this.publicKey=new Hl(e)}}toSchema(){const e=[new q({value:this.version}),this.privateKey];return"namedCurve"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[new J({value:this.namedCurve})]})),"publicKey"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:[new M({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new _({value:e})}toJSON(){if("namedCurve"in this==!1||Wl.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');let e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}const t={crv:e,d:d(m(this.privateKey.valueBlock.valueHex),!0,!0,!1)};if("publicKey"in this){const e=this.publicKey.toJSON();t.x=e.x,t.y=e.y}return t}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("d"in e))throw new Error('Absent mandatory parameter "d"');{const r=g(f(e.d,!0));if(r.byteLength<t){const e=new ArrayBuffer(t),s=new Uint8Array(e),n=new Uint8Array(r);s.set(n,1),this.privateKey=new j({valueHex:e})}else this.privateKey=new j({valueHex:r.slice(0,t)})}"x"in e&&"y"in e&&(this.publicKey=new Hl({json:e}))}}class Gl{constructor(e={}){this.prime=t(e,"prime",Gl.defaultValues("prime")),this.exponent=t(e,"exponent",Gl.defaultValues("exponent")),this.coefficient=t(e,"coefficient",Gl.defaultValues("coefficient")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"prime":case"exponent":case"coefficient":return new q;default:throw new Error(`Invalid member name for OtherPrimeInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.prime||""}),new q({name:r.exponent||""}),new q({name:r.coefficient||""})]})}fromSchema(e){w(e,["prime","exponent","coefficient"]);const t=Be(e,e,Gl.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new _({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:d(m(this.prime.valueBlock.valueHex),!0,!0),d:d(m(this.exponent.valueBlock.valueHex),!0,!0),t:d(m(this.coefficient.valueBlock.valueHex),!0,!0)}}fromJSON(e){if(!("r"in e))throw new Error('Absent mandatory parameter "r"');if(this.prime=new q({valueHex:g(f(e.r,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.exponent=new q({valueHex:g(f(e.d,!0))}),!("t"in e))throw new Error('Absent mandatory parameter "t"');this.coefficient=new q({valueHex:g(f(e.t,!0))})}}class zl{constructor(e={}){this.version=t(e,"version",zl.defaultValues("version")),this.modulus=t(e,"modulus",zl.defaultValues("modulus")),this.publicExponent=t(e,"publicExponent",zl.defaultValues("publicExponent")),this.privateExponent=t(e,"privateExponent",zl.defaultValues("privateExponent")),this.prime1=t(e,"prime1",zl.defaultValues("prime1")),this.prime2=t(e,"prime2",zl.defaultValues("prime2")),this.exponent1=t(e,"exponent1",zl.defaultValues("exponent1")),this.exponent2=t(e,"exponent2",zl.defaultValues("exponent2")),this.coefficient=t(e,"coefficient",zl.defaultValues("coefficient")),"otherPrimeInfos"in e&&(this.otherPrimeInfos=t(e,"otherPrimeInfos",zl.defaultValues("otherPrimeInfos"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"modulus":case"publicExponent":case"privateExponent":case"prime1":case"prime2":case"exponent1":case"exponent2":case"coefficient":return new q;case"otherPrimeInfos":return[];default:throw new Error(`Invalid member name for RSAPrivateKey class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),new q({name:r.modulus||""}),new q({name:r.publicExponent||""}),new q({name:r.privateExponent||""}),new q({name:r.prime1||""}),new q({name:r.prime2||""}),new q({name:r.exponent1||""}),new q({name:r.exponent2||""}),new q({name:r.coefficient||""}),new _({optional:!0,value:[new Ce({name:r.otherPrimeInfosName||"",value:Gl.schema(r.otherPrimeInfo||{})})]})]})}fromSchema(e){w(e,["version","modulus","publicExponent","privateExponent","prime1","prime2","exponent1","exponent2","coefficient","otherPrimeInfos"]);const t=Be(e,e,zl.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),"otherPrimeInfos"in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,(e=>new Gl({schema:e}))))}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),"otherPrimeInfos"in this&&e.push(new _({value:Array.from(this.otherPrimeInfos,(e=>e.toSchema()))})),new _({value:e})}toJSON(){const e={n:d(m(this.modulus.valueBlock.valueHex),!0,!0,!0),e:d(m(this.publicExponent.valueBlock.valueHex),!0,!0,!0),d:d(m(this.privateExponent.valueBlock.valueHex),!0,!0,!0),p:d(m(this.prime1.valueBlock.valueHex),!0,!0,!0),q:d(m(this.prime2.valueBlock.valueHex),!0,!0,!0),dp:d(m(this.exponent1.valueBlock.valueHex),!0,!0,!0),dq:d(m(this.exponent2.valueBlock.valueHex),!0,!0,!0),qi:d(m(this.coefficient.valueBlock.valueHex),!0,!0,!0)};return"otherPrimeInfos"in this&&(e.oth=Array.from(this.otherPrimeInfos,(e=>e.toJSON()))),e}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new q({valueHex:g(f(e.n,!0,!0))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');if(this.publicExponent=new q({valueHex:g(f(e.e,!0,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.privateExponent=new q({valueHex:g(f(e.d,!0,!0))}),!("p"in e))throw new Error('Absent mandatory parameter "p"');if(this.prime1=new q({valueHex:g(f(e.p,!0,!0))}),!("q"in e))throw new Error('Absent mandatory parameter "q"');if(this.prime2=new q({valueHex:g(f(e.q,!0,!0))}),!("dp"in e))throw new Error('Absent mandatory parameter "dp"');if(this.exponent1=new q({valueHex:g(f(e.dp,!0,!0))}),!("dq"in e))throw new Error('Absent mandatory parameter "dq"');if(this.exponent2=new q({valueHex:g(f(e.dq,!0,!0))}),!("qi"in e))throw new Error('Absent mandatory parameter "qi"');this.coefficient=new q({valueHex:g(f(e.qi,!0,!0))}),"oth"in e&&(this.otherPrimeInfos=Array.from(e.oth,(e=>new Gl({json:e}))))}}class Jl{constructor(e={}){this.version=t(e,"version",Jl.defaultValues("version")),this.privateKeyAlgorithm=t(e,"privateKeyAlgorithm",Jl.defaultValues("privateKeyAlgorithm")),this.privateKey=t(e,"privateKey",Jl.defaultValues("privateKey")),"attributes"in e&&(this.attributes=t(e,"attributes",Jl.defaultValues("attributes"))),"parsedKey"in e&&(this.parsedKey=t(e,"parsedKey",Jl.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new Ll;case"privateKey":return new j;case"attributes":return[];case"parsedKey":return{};default:throw new Error(`Invalid member name for PrivateKeyInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),Ll.schema(r.privateKeyAlgorithm||{}),new j({name:r.privateKey||""}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ce({name:r.attributes||"",value:ql.schema()})]})]})}fromSchema(e){w(e,["version","privateKeyAlgorithm","privateKey","attributes"]);const t=Be(e,e,Jl.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyInfo");switch(this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Ll({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,"attributes"in t.result&&(this.attributes=Array.from(t.result.attributes,(e=>new ql({schema:e})))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const e=Ee(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new zl({schema:e.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof J){const e=Ee(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new Wl({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:e.result}))}}}toSchema(){const e=[new q({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return"attributes"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,(e=>e.toSchema()))})),new _({value:e})}toJSON(){if("parsedKey"in this==!1){const e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,(e=>e.toJSON()))),e}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const r of Object.keys(t))e[r]=t[r];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Wl({json:e}),this.privateKeyAlgorithm=new Ll({algorithmId:"1.2.840.10045.2.1",algorithmParams:new J({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new zl({json:e}),this.privateKeyAlgorithm=new Ll({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new F});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new j({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}class $l{constructor(e={}){if(this.contentType=t(e,"contentType",$l.defaultValues("contentType")),this.contentEncryptionAlgorithm=t(e,"contentEncryptionAlgorithm",$l.defaultValues("contentEncryptionAlgorithm")),"encryptedContent"in e&&(this.encryptedContent=e.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed)){const e=new j({idBlock:{isConstructed:!0},isConstructed:!0});let t=0,r=this.encryptedContent.valueBlock.valueHex.byteLength;for(;r>0;){const s=new Uint8Array(this.encryptedContent.valueBlock.valueHex,t,t+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-t:1024),n=new ArrayBuffer(s.length),i=new Uint8Array(n);for(let e=0;e<i.length;e++)i[e]=s[e];e.valueBlock.value.push(new j({valueHex:n})),r-=s.length,t+=s.length}this.encryptedContent=e}"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new Ll;case"encryptedContent":return new j;default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"contentType":return""===t;case"contentEncryptionAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==!1;case"encryptedContent":return t.isEqual($l.defaultValues(e));default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.contentType||""}),Ll.schema(r.contentEncryptionAlgorithm||{}),new Ae({value:[new D({name:r.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new Ce({value:new j})]}),new N({name:r.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){w(e,["contentType","contentEncryptionAlgorithm","encryptedContent"]);const t=Be(e,e,$l.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Ll({schema:t.result.contentEncryptionAlgorithm}),"encryptedContent"in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new J({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new _({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e}}class Yl{constructor(e={}){this.hashAlgorithm=t(e,"hashAlgorithm",Yl.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=t(e,"maskGenAlgorithm",Yl.defaultValues("maskGenAlgorithm")),this.saltLength=t(e,"saltLength",Yl.defaultValues("saltLength")),this.trailerField=t(e,"trailerField",Yl.defaultValues("trailerField")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"hashAlgorithm":return new Ll({algorithmId:"1.3.14.3.2.26",algorithmParams:new F});case"maskGenAlgorithm":return new Ll({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Ll({algorithmId:"1.3.14.3.2.26",algorithmParams:new F}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error(`Invalid member name for RSASSAPSSParams class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new D({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Ll.schema(r.hashAlgorithm||{})]}),new D({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Ll.schema(r.maskGenAlgorithm||{})]}),new D({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new q({name:r.saltLength||""})]}),new D({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new q({name:r.trailerField||""})]})]})}fromSchema(e){w(e,["hashAlgorithm","maskGenAlgorithm","saltLength","trailerField"]);const t=Be(e,e,Yl.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSASSAPSSParams");"hashAlgorithm"in t.result&&(this.hashAlgorithm=new Ll({schema:t.result.hashAlgorithm})),"maskGenAlgorithm"in t.result&&(this.maskGenAlgorithm=new Ll({schema:t.result.maskGenAlgorithm})),"saltLength"in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),"trailerField"in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Yl.defaultValues("hashAlgorithm"))||e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Yl.defaultValues("maskGenAlgorithm"))||e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==Yl.defaultValues("saltLength")&&e.push(new D({idBlock:{tagClass:3,tagNumber:2},value:[new q({value:this.saltLength})]})),this.trailerField!==Yl.defaultValues("trailerField")&&e.push(new D({idBlock:{tagClass:3,tagNumber:3},value:[new q({value:this.trailerField})]})),new _({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Yl.defaultValues("hashAlgorithm"))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Yl.defaultValues("maskGenAlgorithm"))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==Yl.defaultValues("saltLength")&&(e.saltLength=this.saltLength),this.trailerField!==Yl.defaultValues("trailerField")&&(e.trailerField=this.trailerField),e}}class Xl{constructor(e={}){this.salt=t(e,"salt",Xl.defaultValues("salt")),this.iterationCount=t(e,"iterationCount",Xl.defaultValues("iterationCount")),"keyLength"in e&&(this.keyLength=t(e,"keyLength",Xl.defaultValues("keyLength"))),"prf"in e&&(this.prf=t(e,"prf",Xl.defaultValues("prf"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new Ll({algorithmId:"1.3.14.3.2.26",algorithmParams:new F});default:throw new Error(`Invalid member name for PBKDF2Params class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ae({value:[new j({name:r.saltPrimitive||""}),Ll.schema(r.saltConstructed||{})]}),new q({name:r.iterationCount||""}),new q({name:r.keyLength||"",optional:!0}),Ll.schema(r.prf||{names:{optional:!0}})]})}fromSchema(e){w(e,["salt","iterationCount","keyLength","prf"]);const t=Be(e,e,Xl.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:!0}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBKDF2Params");this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,"keyLength"in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),"prf"in t.result&&(this.prf=new Ll({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new q({value:this.iterationCount})),"keyLength"in this&&Xl.defaultValues("keyLength")!==this.keyLength&&e.push(new q({value:this.keyLength})),"prf"in this&&!1===Xl.defaultValues("prf").isEqual(this.prf)&&e.push(this.prf.toSchema()),new _({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return"keyLength"in this&&Xl.defaultValues("keyLength")!==this.keyLength&&(e.keyLength=this.keyLength),"prf"in this&&!1===Xl.defaultValues("prf").isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}class Ql{constructor(e={}){this.keyDerivationFunc=t(e,"keyDerivationFunc",Ql.defaultValues("keyDerivationFunc")),this.encryptionScheme=t(e,"encryptionScheme",Ql.defaultValues("encryptionScheme")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyDerivationFunc":case"encryptionScheme":return new Ll;default:throw new Error(`Invalid member name for PBES2Params class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Ll.schema(r.keyDerivationFunc||{}),Ll.schema(r.encryptionScheme||{})]})}fromSchema(e){w(e,["keyDerivationFunc","encryptionScheme"]);const t=Be(e,e,Ql.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBES2Params");this.keyDerivationFunc=new Ll({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new Ll({schema:t.result.encryptionScheme})}toSchema(){return new _({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}function Zl(e,t,r,s,n,i){let a,o;const c=[];switch(t.toUpperCase()){case"SHA-1":a=20,o=64;break;case"SHA-256":a=32,o=64;break;case"SHA-384":a=48,o=128;break;case"SHA-512":a=64,o=128;break;default:throw new Error("Unsupported hashing algorithm")}const l=new Uint8Array(s),h=new ArrayBuffer(2*s.byteLength+2),u=new Uint8Array(h);for(let e=0;e<l.length;e++)u[2*e]=0,u[2*e+1]=l[e];u[u.length-2]=0,u[u.length-1]=0,s=h.slice(0);const p=new ArrayBuffer(o),d=new Uint8Array(p);for(let e=0;e<p.byteLength;e++)d[e]=3;const f=n.byteLength,m=o*Math.ceil(f/o),g=new ArrayBuffer(m),y=new Uint8Array(g),v=new Uint8Array(n);for(let e=0;e<m;e++)y[e]=v[e%f];const w=s.byteLength,b=o*Math.ceil(w/o),S=new ArrayBuffer(b),A=new Uint8Array(S),k=new Uint8Array(s);for(let e=0;e<b;e++)A[e]=k[e%w];const C=g.byteLength+S.byteLength;let I=new ArrayBuffer(C),x=new Uint8Array(I);x.set(y),x.set(A,y.length);const E=Math.ceil((r>>3)/a);let B=Promise.resolve(I);for(let r=0;r<=E;r++){B=B.then((e=>{const t=new ArrayBuffer(p.byteLength+e.byteLength),r=new Uint8Array(t);return r.set(d),r.set(x,d.length),t}));for(let r=0;r<i;r++)B=B.then((r=>e.digest({name:t},new Uint8Array(r))));B=B.then((e=>{const t=new ArrayBuffer(o),r=new Uint8Array(t);for(let s=0;s<t.byteLength;s++)r[s]=e[s%e.length];const s=Math.ceil(f/o)+Math.ceil(w/o),n=[];let i=0,a=o;for(let e=0;e<s;e++){const e=Array.from(new Uint8Array(I.slice(i,i+a)));i+=o,i+o>I.byteLength&&(a=I.byteLength-i);let s=511;for(let n=t.byteLength-1;n>=0;n--)s>>=8,s+=r[n]+e[n],e[n]=255&s;n.push(...e)}return I=new ArrayBuffer(n.length),x=new Uint8Array(I),x.set(n),c.push(...new Uint8Array(e)),I}))}return B=B.then((()=>{const e=new ArrayBuffer(r>>3);return new Uint8Array(e).set(new Uint8Array(c).slice(0,r>>3)),e})),B}class eh{constructor(e={}){this.crypto=t(e,"crypto",{}),this.subtle=t(e,"subtle",{}),this.name=t(e,"name","")}importKey(e,t,r,s,n){let i={};switch(t instanceof Uint8Array&&(t=t.buffer),e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,s,n);case"spki":{const e=Ee(t);if(-1===e.offset)return Promise.reject("Incorrect keyData");const a=new Kl;try{a.fromSchema(e.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="PS1";break;case"SHA-256":i.alg="PS256";break;case"SHA-384":i.alg="PS384";break;case"SHA-512":i.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],i.kty="RSA",i.ext=s,i.key_ops=n,"1.2.840.113549.1.1.1"!==a.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`);if("alg"in i==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RS1";break;case"SHA-256":i.alg="RS256";break;case"SHA-384":i.alg="RS384";break;case"SHA-512":i.alg="RS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const e=a.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;case"ECDSA":n=["verify"];case"ECDH":{if(i={kty:"EC",ext:s,key_ops:n},"1.2.840.10045.2.1"!==a.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`);const e=a.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;case"RSA-OAEP":{if(i.kty="RSA",i.ext=s,i.key_ops=n,"safari"===this.name.toLowerCase())i.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RSA-OAEP";break;case"SHA-256":i.alg="RSA-OAEP-256";break;case"SHA-384":i.alg="RSA-OAEP-384";break;case"SHA-512":i.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const e=a.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;case"RSAES-PKCS1-V1_5":{i.kty="RSA",i.ext=s,i.key_ops=n,i.alg="PS1";const e=a.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;default:return Promise.reject(`Incorrect algorithm name: ${r.name.toUpperCase()}`)}}break;case"pkcs8":{const e=new Jl,a=Ee(t);if(-1===a.offset)return Promise.reject("Incorrect keyData");try{e.fromSchema(a.result)}catch(e){return Promise.reject("Incorrect keyData")}if("parsedKey"in e==!1)return Promise.reject("Incorrect keyData");switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="PS1";break;case"SHA-256":i.alg="PS256";break;case"SHA-384":i.alg="PS384";break;case"SHA-512":i.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],i.kty="RSA",i.ext=s,i.key_ops=n,"1.2.840.113549.1.1.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect private key algorithm: ${e.privateKeyAlgorithm.algorithmId}`);if("alg"in i==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RS1";break;case"SHA-256":i.alg="RS256";break;case"SHA-384":i.alg="RS384";break;case"SHA-512":i.alg="RS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;case"ECDSA":n=["sign"];case"ECDH":{if(i={kty:"EC",ext:s,key_ops:n},"1.2.840.10045.2.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect algorithm: ${e.privateKeyAlgorithm.algorithmId}`);const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;case"RSA-OAEP":{if(i.kty="RSA",i.ext=s,i.key_ops=n,"safari"===this.name.toLowerCase())i.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RSA-OAEP";break;case"SHA-256":i.alg="RSA-OAEP-256";break;case"SHA-384":i.alg="RSA-OAEP-384";break;case"SHA-512":i.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],i.kty="RSA",i.ext=s,i.key_ops=n,i.alg="PS1";const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;default:return Promise.reject(`Incorrect algorithm name: ${r.name.toUpperCase()}`)}}break;case"jwk":i=t;break;default:return Promise.reject(`Incorrect format: ${e}`)}return"safari"===this.name.toLowerCase()?Promise.resolve().then((()=>this.subtle.importKey("jwk",g(JSON.stringify(i)),r,s,n))).then((e=>e),(()=>this.subtle.importKey("jwk",i,r,s,n))):this.subtle.importKey("jwk",i,r,s,n)}exportKey(e,t){let r=this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&(r=r.then((e=>e instanceof ArrayBuffer?JSON.parse(m(e)):e))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":r=r.then((e=>{const t=new Kl;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)}));break;case"pkcs8":r=r.then((e=>{const t=new Jl;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)}));break;case"jwk":break;default:return Promise.reject(`Incorrect format: ${e}`)}return r}convert(e,t,r,s,n,i){switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(r);case"spki":return Promise.resolve().then((()=>this.importKey("raw",r,s,n,i))).then((e=>this.exportKey("spki",e)));case"pkcs8":return Promise.resolve().then((()=>this.importKey("raw",r,s,n,i))).then((e=>this.exportKey("pkcs8",e)));case"jwk":return Promise.resolve().then((()=>this.importKey("raw",r,s,n,i))).then((e=>this.exportKey("jwk",e)));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((()=>this.importKey("spki",r,s,n,i))).then((e=>this.exportKey("raw",e)));case"spki":return Promise.resolve(r);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then((()=>this.importKey("spki",r,s,n,i))).then((e=>this.exportKey("jwk",e)));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((()=>this.importKey("pkcs8",r,s,n,i))).then((e=>this.exportKey("raw",e)));case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(r);case"jwk":return Promise.resolve().then((()=>this.importKey("pkcs8",r,s,n,i))).then((e=>this.exportKey("jwk",e)));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((()=>this.importKey("jwk",r,s,n,i))).then((e=>this.exportKey("raw",e)));case"spki":return Promise.resolve().then((()=>this.importKey("jwk",r,s,n,i))).then((e=>this.exportKey("spki",e)));case"pkcs8":return Promise.resolve().then((()=>this.importKey("jwk",r,s,n,i))).then((e=>this.exportKey("pkcs8",e)));case"jwk":return Promise.resolve(r);default:return Promise.reject(`Incorrect outputFormat: ${t}`)}default:return Promise.reject(`Incorrect inputFormat: ${e}`)}}encrypt(...e){return this.subtle.encrypt(...e)}decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}verify(...e){return this.subtle.verify(...e)}digest(...e){return this.subtle.digest(...e)}generateKey(...e){return this.subtle.generateKey(...e)}deriveKey(...e){return this.subtle.deriveKey(...e)}deriveBits(...e){return this.subtle.deriveBits(...e)}wrapKey(...e){return this.subtle.wrapKey(...e)}unwrapKey(...e){return this.subtle.unwrapKey(...e)}getRandomValues(e){if("getRandomValues"in this.crypto==!1)throw new Error("No support for getRandomValues");return this.crypto.getRandomValues(e)}getAlgorithmByOID(e){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}}getOIDByAlgorithm(e){let t="";switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":t="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13"}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11"}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35"}return t}getAlgorithmParameters(e,t){let r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return r}getHashAlgorithm(e){let t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const r=new Yl({schema:e.algorithmParams});if("hashAlgorithm"in r){const e=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in e==!1)return"";t=e.name}else t="SHA-1"}catch(e){}}return t}encryptEncryptedContentInfo(e){if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e==!1)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');if("contentType"in e==!1)return Promise.reject('Absent mandatory parameter "contentType"');const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm);if(""===t)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');const r=this.getOIDByAlgorithm({name:"PBKDF2"});if(""===r)return Promise.reject("Can not find OID for PBKDF2");const s=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(""===s)return Promise.reject(`Incorrect value for "hmacHashAlgorithm": ${e.hmacHashAlgorithm}`);let n=Promise.resolve();const i=new ArrayBuffer(16),a=new Uint8Array(i);this.getRandomValues(a);const o=new ArrayBuffer(64),c=new Uint8Array(o);this.getRandomValues(c);const l=new Uint8Array(e.contentToEncrypt),h=new Xl({salt:new j({valueHex:o}),iterationCount:e.iterationCount,prf:new Ll({algorithmId:s,algorithmParams:new F})});return n=n.then((()=>{const t=new Uint8Array(e.password);return this.importKey("raw",t,"PBKDF2",!1,["deriveKey"])}),(e=>Promise.reject(e))),n=n.then((t=>this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:c,iterations:e.iterationCount},t,e.contentEncryptionAlgorithm,!1,["encrypt"])),(e=>Promise.reject(e))),n=n.then((t=>this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:a},t,l)),(e=>Promise.reject(e))),n=n.then((s=>{const n=new Ql({keyDerivationFunc:new Ll({algorithmId:r,algorithmParams:h.toSchema()}),encryptionScheme:new Ll({algorithmId:t,algorithmParams:new j({valueHex:i})})});return new $l({contentType:e.contentType,contentEncryptionAlgorithm:new Ll({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:n.toSchema()}),encryptedContent:new j({valueHex:s})})}),(e=>Promise.reject(e))),n}decryptEncryptedContentInfo(e){if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("encryptedContentInfo"in e==!1)return Promise.reject('Absent mandatory parameter "encryptedContentInfo"');if("1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)return Promise.reject(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t,r,s=Promise.resolve();try{t=new Ql({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}try{r=new Xl({schema:t.keyDerivationFunc.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}const n=this.getAlgorithmByOID(t.encryptionScheme.algorithmId);if("name"in n==!1)return Promise.reject(`Incorrect OID for "contentEncryptionAlgorithm": ${t.encryptionScheme.algorithmId}`);const i=t.encryptionScheme.algorithmParams.valueBlock.valueHex,o=new Uint8Array(i),c=r.salt.valueBlock.valueHex,l=new Uint8Array(c),h=r.iterationCount;let u="SHA-1";if("prf"in r){const e=this.getAlgorithmByOID(r.prf.algorithmId);if("name"in e==!1)return Promise.reject("Incorrect OID for HMAC hash algorithm");u=e.hash.name}return s=s.then((()=>this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"])),(e=>Promise.reject(e))),s=s.then((e=>this.deriveKey({name:"PBKDF2",hash:{name:u},salt:l,iterations:h},e,n,!1,["decrypt"])),(e=>Promise.reject(e))),s=s.then((t=>{let r=new ArrayBuffer(0);if(!1===e.encryptedContentInfo.encryptedContent.idBlock.isConstructed)r=e.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else for(const t of e.encryptedContentInfo.encryptedContent.valueBlock.value)r=a(r,t.valueBlock.valueHex);return this.decrypt({name:n.name,iv:o},t,r)}),(e=>Promise.reject(e))),s}stampDataWithPassword(e){if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "salt"');if("contentToStamp"in e==!1)return Promise.reject('Absent mandatory parameter "contentToStamp"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let r=Promise.resolve();const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return r=r.then((()=>Zl(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount))),r=r.then((e=>this.importKey("raw",new Uint8Array(e),s,!1,["sign"]))),r=r.then((t=>this.sign(s,t,new Uint8Array(e.contentToStamp))),(e=>Promise.reject(e))),r}verifyDataStampedWithPassword(e){if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "salt"');if("contentToVerify"in e==!1)return Promise.reject('Absent mandatory parameter "contentToVerify"');if("signatureToVerify"in e==!1)return Promise.reject('Absent mandatory parameter "signatureToVerify"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let r=Promise.resolve();const s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return r=r.then((()=>Zl(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount))),r=r.then((e=>this.importKey("raw",new Uint8Array(e),s,!1,["verify"]))),r=r.then((t=>this.verify(s,t,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))),(e=>Promise.reject(e))),r}getSignatureParameters(e,t="SHA-1"){if(""===this.getOIDByAlgorithm({name:t}))return Promise.reject(`Unsupported hash algorithm: ${t}`);const r=new Ll,s=this.getAlgorithmParameters(e.algorithm.name,"sign");switch(s.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(s.algorithm);break;case"RSA-PSS":{switch(t.toUpperCase()){case"SHA-256":s.algorithm.saltLength=32;break;case"SHA-384":s.algorithm.saltLength=48;break;case"SHA-512":s.algorithm.saltLength=64}const e={};if("SHA-1"!==t.toUpperCase()){const r=this.getOIDByAlgorithm({name:t});if(""===r)return Promise.reject(`Unsupported hash algorithm: ${t}`);e.hashAlgorithm=new Ll({algorithmId:r,algorithmParams:new F}),e.maskGenAlgorithm=new Ll({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.hashAlgorithm.toSchema()})}20!==s.algorithm.saltLength&&(e.saltLength=s.algorithm.saltLength);const n=new Yl(e);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=n.toSchema()}break;default:return Promise.reject(`Unsupported signature algorithm: ${e.algorithm.name}`)}return Promise.resolve().then((()=>({signatureAlgorithm:r,parameters:s})))}signWithPrivateKey(e,t,r){return this.sign(r.algorithm,t,new Uint8Array(e)).then((e=>("ECDSA"===r.algorithm.name&&(e=function(e){if(e.byteLength%2!=0)return new ArrayBuffer(0);const t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));const s=new q({valueHex:r}),n=new ArrayBuffer(t);new Uint8Array(n).set(new Uint8Array(e,t,t));const i=new q({valueHex:n});return new _({value:[s.convertToDER(),i.convertToDER()]}).toBER(!1)}(e)),e)),(e=>Promise.reject(`Signing error: ${e}`)))}fillPublicKeyParameters(e,t){const r={},s=this.getHashAlgorithm(t);if(""===s)return Promise.reject(`Unsupported signature algorithm: ${t.algorithmId}`);let n;n="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n);if("name"in i==="")return Promise.reject(`Unsupported public key algorithm: ${t.algorithmId}`);if(r.algorithm=this.getAlgorithmParameters(i.name,"importkey"),"hash"in r.algorithm.algorithm&&(r.algorithm.algorithm.hash.name=s),"ECDSA"===i.name){let t=!1;if("algorithmParams"in e.algorithm==!0&&"idBlock"in e.algorithm.algorithmParams&&1===e.algorithm.algorithmParams.idBlock.tagClass&&6===e.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const s=this.getAlgorithmByOID(e.algorithm.algorithmParams.valueBlock.toString());if("name"in s==!1)return Promise.reject(`Unsupported named curve algorithm: ${e.algorithm.algorithmParams.valueBlock.toString()}`);r.algorithm.algorithm.namedCurve=s.name}return r}getPublicKey(e,t,r=null){null===r&&(r=this.fillPublicKeyParameters(e,t));const s=e.toSchema().toBER(!1),n=new Uint8Array(s);return this.importKey("spki",n,r.algorithm.algorithm,!0,r.algorithm.usages)}verifyWithPublicKey(e,t,r,s,n=null){let i=Promise.resolve();if(null===n){if(""===(n=this.getHashAlgorithm(s)))return Promise.reject(`Unsupported signature algorithm: ${s.algorithmId}`);i=i.then((()=>this.getPublicKey(r,s)))}else{const e={};let t;t="1.2.840.113549.1.1.10"===s.algorithmId?s.algorithmId:r.algorithm.algorithmId;const a=this.getAlgorithmByOID(t);if("name"in a==="")return Promise.reject(`Unsupported public key algorithm: ${s.algorithmId}`);if(e.algorithm=this.getAlgorithmParameters(a.name,"importkey"),"hash"in e.algorithm.algorithm&&(e.algorithm.algorithm.hash.name=n),"ECDSA"===a.name){let t=!1;if("algorithmParams"in r.algorithm==!0&&"idBlock"in r.algorithm.algorithmParams&&1===r.algorithm.algorithmParams.idBlock.tagClass&&6===r.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const s=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString());if("name"in s==!1)return Promise.reject(`Unsupported named curve algorithm: ${r.algorithm.algorithmParams.valueBlock.toString()}`);e.algorithm.algorithm.namedCurve=s.name}i=i.then((()=>this.getPublicKey(r,null,e)))}return i=i.then((r=>{const i=this.getAlgorithmParameters(r.algorithm.name,"verify");"hash"in i.algorithm&&(i.algorithm.hash.name=n);let o=t.valueBlock.valueHex;if("ECDSA"===r.algorithm.name){o=function(e){if(e instanceof _==!1)return new ArrayBuffer(0);if(2!==e.valueBlock.value.length)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof q==!1)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof q==!1)return new ArrayBuffer(0);const t=e.valueBlock.value[0].convertFromDER(),r=e.valueBlock.value[1].convertFromDER();switch(!0){case t.valueBlock.valueHex.byteLength<r.valueBlock.valueHex.byteLength:{if(r.valueBlock.valueHex.byteLength-t.valueBlock.valueHex.byteLength!=1)throw new Error("Incorrect DER integer decoding");const e=r.valueBlock.valueHex.byteLength,s=new Uint8Array(t.valueBlock.valueHex),n=new ArrayBuffer(e),i=new Uint8Array(n);return i.set(s,1),i[0]=0,a(n,r.valueBlock.valueHex)}case t.valueBlock.valueHex.byteLength>r.valueBlock.valueHex.byteLength:{if(t.valueBlock.valueHex.byteLength-r.valueBlock.valueHex.byteLength!=1)throw new Error("Incorrect DER integer decoding");const e=t.valueBlock.valueHex.byteLength,s=new Uint8Array(r.valueBlock.valueHex),n=new ArrayBuffer(e),i=new Uint8Array(n);return i.set(s,1),i[0]=0,a(t.valueBlock.valueHex,n)}default:if(t.valueBlock.valueHex.byteLength%2){const e=t.valueBlock.valueHex.byteLength+1,s=new Uint8Array(t.valueBlock.valueHex),n=new ArrayBuffer(e),i=new Uint8Array(n);i.set(s,1),i[0]=0;const o=new Uint8Array(r.valueBlock.valueHex),c=new ArrayBuffer(e),l=new Uint8Array(c);return l.set(o,1),l[0]=0,a(n,c)}}return a(t.valueBlock.valueHex,r.valueBlock.valueHex)}(Ee(o).result)}if("RSA-PSS"===r.algorithm.name){let e;try{e=new Yl({schema:s.algorithmParams})}catch(e){return Promise.reject(e)}i.algorithm.saltLength="saltLength"in e?e.saltLength:20;let t="SHA-1";if("hashAlgorithm"in e){const r=this.getAlgorithmByOID(e.hashAlgorithm.algorithmId);if("name"in r==!1)return Promise.reject(`Unrecognized hash algorithm: ${e.hashAlgorithm.algorithmId}`);t=r.name}i.algorithm.hash.name=t}return this.verify(i.algorithm,r,new Uint8Array(o),new Uint8Array(e))})),i}}let th={name:"none",crypto:null,subtle:null};function rh(e,t,r){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){if(void 0===global[process.pid])global[process.pid]={};else if("object"!=typeof global[process.pid])throw new Error(`Name global.${process.pid} already exists and it is not an object`);if(void 0===global[process.pid].pkijs)global[process.pid].pkijs={};else if("object"!=typeof global[process.pid].pkijs)throw new Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);global[process.pid].pkijs.engine={name:e,crypto:t,subtle:r}}else th.name!==e&&(th={name:e,crypto:t,subtle:r})}function sh(){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){let e;try{e=global[process.pid].pkijs.engine}catch(e){throw new Error('Please call "setEngine" before call to "getEngine"')}return e}return th}function nh(){const e=sh();if(null!==e.subtle)return e.subtle}function ih(e){return sh().subtle.getRandomValues(e)}function ah(e){return sh().subtle.getOIDByAlgorithm(e)}function oh(e){let t=!1,r="";const s=e.trim();for(let e=0;e<s.length;e++)32===s.charCodeAt(e)?!1===t&&(t=!0):(t&&(r+=" ",t=!1),r+=s[e]);return r.toLowerCase()}function ch(e){return sh().subtle.getAlgorithmByOID(e)}function lh(e,t,r,s){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:return Promise.reject(`Unknown hash function: ${e}`)}if(t instanceof ArrayBuffer==!1)return Promise.reject('Please set "Zbuffer" as "ArrayBuffer"');if(0===t.byteLength)return Promise.reject('"Zbuffer" has zero length, error');if(s instanceof ArrayBuffer==!1)return Promise.reject('Please set "SharedInfo" as "ArrayBuffer"');if(r>255)return Promise.reject('Please set "Counter" variable to value less or equal to 255');const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=r;let o=new ArrayBuffer(0);const c=nh();return void 0===c?Promise.reject("Unable to create WebCrypto object"):(o=a(o,t),o=a(o,n),o=a(o,s),c.digest({name:e},o).then((e=>({counter:r,result:e}))))}function hh(e,t,r,s){let n=0,i=1;const o=[];switch(e.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:return Promise.reject(`Unknown hash function: ${e}`)}if(t instanceof ArrayBuffer==!1)return Promise.reject('Please set "Zbuffer" as "ArrayBuffer"');if(0===t.byteLength)return Promise.reject('"Zbuffer" has zero length, error');if(s instanceof ArrayBuffer==!1)return Promise.reject('Please set "SharedInfo" as "ArrayBuffer"');const c=r/n;Math.floor(c)>0&&(i=Math.floor(c),c-i>0&&i++);for(let r=1;r<=i;r++)o.push(lh(e,t,r,s));return Promise.all(o).then((e=>{let t=new ArrayBuffer(0),s=1,n=!0;for(;n;){n=!1;for(const r of e)if(r.counter===s){t=a(t,r.result),n=!0;break}s++}if(r>>=3,t.byteLength>r){const e=new ArrayBuffer(r),s=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r;e++)s[e]=n[e];return e}return t}))}!function(){if("undefined"!=typeof self&&"crypto"in self){let e="webcrypto";const t=self.crypto;let r;if("webkitSubtle"in self.crypto){try{r=self.crypto.webkitSubtle}catch(e){r=self.crypto.subtle}e="safari"}"subtle"in self.crypto&&(r=self.crypto.subtle),th=void 0===r?{name:e,crypto:t,subtle:null}:{name:e,crypto:t,subtle:new eh({name:e,crypto:self.crypto,subtle:r})}}rh(th.name,th.crypto,th.subtle)}();class uh{constructor(e={}){this.type=t(e,"type",uh.defaultValues("type")),this.value=t(e,"value",uh.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"value":return{};default:throw new Error(`Invalid member name for AttributeTypeAndValue class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.type||""}),new ke({name:r.value||""})]})}static blockName(){return"AttributeTypeAndValue"}fromSchema(e){w(e,["type","typeValue"]);const t=Be(e,e,uh.schema({names:{type:"type",value:"typeValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeTypeAndValue");this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new _({value:[new J({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[Y.blockName(),te.blockName(),se.blockName(),ae.blockName(),oe.blockName(),ce.blockName(),le.blockName(),he.blockName(),ue.blockName(),pe.blockName(),de.blockName(),fe.blockName()];if(e.constructor.blockName()===uh.blockName()){if(this.type!==e.type)return!1;let r=[!1,!1];const s=this.value.constructor.blockName();for(const n of t)s===n&&(r[0]=!0),e.value.constructor.blockName()===n&&(r[1]=!0);if(r[0]^r[1])return!1;if(r=r[0]&&r[1],r){const t=oh(this.value.valueBlock.value),r=oh(e.value.valueBlock.value);if(0!==t.localeCompare(r))return!1}else if(!1===l(this.value.valueBeforeDecode,e.value.valueBeforeDecode))return!1;return!0}return e instanceof ArrayBuffer&&l(this.value.valueBeforeDecode,e)}}class ph{constructor(e={}){this.typesAndValues=t(e,"typesAndValues",ph.defaultValues("typesAndValues")),this.valueBeforeDecode=t(e,"valueBeforeDecode",ph.defaultValues("valueBeforeDecode")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"typesAndValues":return 0===t.length;case"valueBeforeDecode":return 0===t.byteLength;default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.repeatedSequence||"",value:new V({value:[new Ce({name:r.repeatedSet||"",value:uh.schema(r.typeAndValue||{})})]})})]})}fromSchema(e){w(e,["RDN","typesAndValues"]);const t=Be(e,e,ph.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RelativeDistinguishedNames");"typesAndValues"in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,(e=>new uh({schema:e})))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecode}toSchema(){if(0===this.valueBeforeDecode.byteLength)return new _({value:[new V({value:Array.from(this.typesAndValues,(e=>e.toSchema()))})]});return Ee(this.valueBeforeDecode).result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,(e=>e.toJSON()))}}isEqual(e){if(e instanceof ph){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,r]of this.typesAndValues.entries())if(!1===r.isEqual(e.typesAndValues[t]))return!1;return!0}return e instanceof ArrayBuffer&&l(this.valueBeforeDecode,e)}}function dh(e={},r=!1){const s=t(e,"names",{});return new _({optional:r,value:[new D({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:s.country_name||"",value:[new Ae({value:[new ae,new oe]})]}),new D({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:s.administration_domain_name||"",value:[new Ae({value:[new ae,new oe]})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:s.network_address||"",isHexOnly:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:s.terminal_identifier||"",isHexOnly:!0}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:s.private_domain_name||"",value:[new Ae({value:[new ae,new oe]})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:s.organization_name||"",isHexOnly:!0}),new N({optional:!0,name:s.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new D({optional:!0,name:s.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new N({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new D({optional:!0,name:s.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new Ce({value:new oe})]})]})}function fh(e=!1){return new _({optional:e,value:[new oe,new oe]})}function mh(e=!1){return new V({optional:e,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ke]})]})}class gh{constructor(e={}){this.type=t(e,"type",gh.defaultValues("type")),this.value=t(e,"value",gh.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return t===gh.defaultValues(e);case"value":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new Ae({value:[new D({idBlock:{tagClass:3,tagNumber:0},name:r.blockName||"",value:[new J,new D({idBlock:{tagClass:3,tagNumber:0},value:[new ke]})]}),new N({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new N({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new D({idBlock:{tagClass:3,tagNumber:3},name:r.blockName||"",value:[dh(r.builtInStandardAttributes||{},!1),fh(!0),mh(!0)]}),new D({idBlock:{tagClass:3,tagNumber:4},name:r.blockName||"",value:[ph.schema(r.directoryName||{})]}),new D({idBlock:{tagClass:3,tagNumber:5},name:r.blockName||"",value:[new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ae({value:[new ce,new oe,new se,new Y,new te]})]}),new D({idBlock:{tagClass:3,tagNumber:1},value:[new Ae({value:[new ce,new oe,new se,new Y,new te]})]})]}),new N({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new N({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new N({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){w(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=Be(e,e,gh.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralName");switch(this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=22;const r=e.toBER(!1);this.value=Ee(r).result.valueBlock.value}break;case 4:this.value=new ph({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new j({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=6;const r=e.toBER(!1);this.value=Ee(r).result.valueBlock.toString()}}}toSchema(){switch(this.type){case 0:case 3:case 5:return new D({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new he({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new D({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new J({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return gh.schema()}}toJSON(){const e={type:this.type,value:""};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}class yh{constructor(e={}){this.accessMethod=t(e,"accessMethod",yh.defaultValues("accessMethod")),this.accessLocation=t(e,"accessLocation",yh.defaultValues("accessLocation")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"accessMethod":return"";case"accessLocation":return new gh;default:throw new Error(`Invalid member name for AccessDescription class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.accessMethod||""}),gh.schema(r.accessLocation||{})]})}fromSchema(e){w(e,["accessMethod","accessLocation"]);const t=Be(e,e,yh.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new gh({schema:t.result.accessLocation})}toSchema(){return new _({value:[new J({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}class vh{constructor(e={}){"seconds"in e&&(this.seconds=t(e,"seconds",vh.defaultValues("seconds"))),"millis"in e&&(this.millis=t(e,"millis",vh.defaultValues("millis"))),"micros"in e&&(this.micros=t(e,"micros",vh.defaultValues("micros"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"seconds":case"millis":case"micros":return 0;default:throw new Error(`Invalid member name for Accuracy class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"seconds":case"millis":case"micros":return t===vh.defaultValues(e);default:throw new Error(`Invalid member name for Accuracy class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",optional:!0,value:[new q({optional:!0,name:r.seconds||""}),new N({name:r.millis||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new N({name:r.micros||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){w(e,["seconds","millis","micros"]);const t=Be(e,e,vh.schema({names:{seconds:"seconds",millis:"millis",micros:"micros"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Accuracy");if("seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const e=new q({valueHex:t.result.millis.valueBlock.valueHex});this.millis=e.valueBlock.valueDec}if("micros"in t.result){const e=new q({valueHex:t.result.micros.valueBlock.valueHex});this.micros=e.valueBlock.valueDec}}toSchema(){const e=[];if("seconds"in this&&e.push(new q({value:this.seconds})),"millis"in this){const t=new q({value:this.millis});e.push(new N({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHex}))}if("micros"in this){const t=new q({value:this.micros});e.push(new N({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHex}))}return new _({value:e})}toJSON(){const e={};return"seconds"in this&&(e.seconds=this.seconds),"millis"in this&&(e.millis=this.millis),"micros"in this&&(e.micros=this.micros),e}}class wh{constructor(e={}){this.altNames=t(e,"altNames",wh.defaultValues("altNames")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("altNames"===e)return[];throw new Error(`Invalid member name for AltName class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.altNames||"",value:gh.schema()})]})}fromSchema(e){w(e,["altNames"]);const t=Be(e,e,wh.schema({names:{altNames:"altNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AltName");"altNames"in t.result&&(this.altNames=Array.from(t.result.altNames,(e=>new gh({schema:e}))))}toSchema(){return new _({value:Array.from(this.altNames,(e=>e.toSchema()))})}toJSON(){return{altNames:Array.from(this.altNames,(e=>e.toJSON()))}}}class bh{constructor(e={}){this.contentType=t(e,"contentType",bh.defaultValues("contentType")),this.content=t(e,"content",bh.defaultValues("content")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"contentType":return"";case"content":return new ke;default:throw new Error(`Invalid member name for ContentInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"contentType":return""===t;case"content":return t instanceof ke;default:throw new Error(`Invalid member name for ContentInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return"optional"in r==!1&&(r.optional=!1),new _({name:r.blockName||"ContentInfo",optional:r.optional,value:[new J({name:r.contentType||"contentType"}),new D({idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:r.content||"content"})]})]})}fromSchema(e){w(e,["contentType","content"]);const t=Be(e,e,bh.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ContentInfo");this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new _({value:[new J({value:this.contentType}),new D({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof ke||(e.content=this.content.toJSON()),e}}class Sh{constructor(e={}){this.type=t(e,"type",Sh.defaultValues("type")),this.value=t(e,"value",Sh.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error(`Invalid member name for Time class: ${e}`)}}static schema(e={},r=!1){const s=t(e,"names",{});return new Ae({optional:r,value:[new me({name:s.utcTimeName||""}),new ge({name:s.generalTimeName||""})]})}fromSchema(e){w(e,["utcTimeName","generalTimeName"]);const t=Be(e,e,Sh.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Time");"utcTimeName"in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),"generalTimeName"in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){let e={};return 0===this.type&&(e=new me({valueDate:this.value})),1===this.type&&(e=new ge({valueDate:this.value})),e}toJSON(){return{type:this.type,value:this.value}}}class Ah{constructor(e={}){this.attributes=t(e,"attributes",Ah.defaultValues("attributes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("attributes"===e)return[];throw new Error(`Invalid member name for SubjectDirectoryAttributes class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.attributes||"",value:ql.schema()})]})}fromSchema(e){w(e,["attributes"]);const t=Be(e,e,Ah.schema({names:{attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(t.result.attributes,(e=>new ql({schema:e})))}toSchema(){return new _({value:Array.from(this.attributes,(e=>e.toSchema()))})}toJSON(){return{attributes:Array.from(this.attributes,(e=>e.toJSON()))}}}class kh{constructor(e={}){"notBefore"in e&&(this.notBefore=t(e,"notBefore",kh.defaultValues("notBefore"))),"notAfter"in e&&(this.notAfter=t(e,"notAfter",kh.defaultValues("notAfter"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"notBefore":case"notAfter":return new Date;default:throw new Error(`Invalid member name for PrivateKeyUsagePeriod class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new N({name:r.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new N({name:r.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){w(e,["notBefore","notAfter"]);const t=Be(e,e,kh.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in t.result){const e=new ge;e.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=e.toDate()}if("notAfter"in t.result){const e=new ge({valueHex:t.result.notAfter.valueBlock.valueHex});e.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=e.toDate()}}toSchema(){const e=[];return"notBefore"in this&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},valueHex:new ge({valueDate:this.notBefore}).valueBlock.valueHex})),"notAfter"in this&&e.push(new N({idBlock:{tagClass:3,tagNumber:1},valueHex:new ge({valueDate:this.notAfter}).valueBlock.valueHex})),new _({value:e})}toJSON(){const e={};return"notBefore"in this&&(e.notBefore=this.notBefore),"notAfter"in this&&(e.notAfter=this.notAfter),e}}class Ch{constructor(e={}){this.cA=t(e,"cA",!1),"pathLenConstraint"in e&&(this.pathLenConstraint=t(e,"pathLenConstraint",0)),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("cA"===e)return!1;throw new Error(`Invalid member name for BasicConstraints class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new R({optional:!0,name:r.cA||""}),new q({optional:!0,name:r.pathLenConstraint||""})]})}fromSchema(e){w(e,["cA","pathLenConstraint"]);const t=Be(e,e,Ch.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for BasicConstraints");"cA"in t.result&&(this.cA=t.result.cA.valueBlock.value),"pathLenConstraint"in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Ch.defaultValues("cA")&&e.push(new R({value:this.cA})),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof q?e.push(this.pathLenConstraint):e.push(new q({value:this.pathLenConstraint}))),new _({value:e})}toJSON(){const e={};return this.cA!==Ch.defaultValues("cA")&&(e.cA=this.cA),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof q?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}class Ih{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=t(e,"distributionPoint",Ih.defaultValues("distributionPoint"))),this.onlyContainsUserCerts=t(e,"onlyContainsUserCerts",Ih.defaultValues("onlyContainsUserCerts")),this.onlyContainsCACerts=t(e,"onlyContainsCACerts",Ih.defaultValues("onlyContainsCACerts")),"onlySomeReasons"in e&&(this.onlySomeReasons=t(e,"onlySomeReasons",Ih.defaultValues("onlySomeReasons"))),this.indirectCRL=t(e,"indirectCRL",Ih.defaultValues("indirectCRL")),this.onlyContainsAttributeCerts=t(e,"onlyContainsAttributeCerts",Ih.defaultValues("onlyContainsAttributeCerts")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":case"onlyContainsCACerts":case"indirectCRL":case"onlyContainsAttributeCerts":return!1;case"onlySomeReasons":return 0;default:throw new Error(`Invalid member name for IssuingDistributionPoint class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ae({value:[new D({name:r.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new Ce({name:r.distributionPointNames||"",value:gh.schema()})]}),new D({name:r.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:ph.schema().valueBlock.value})]})]}),new N({name:r.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new N({name:r.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new N({name:r.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new N({name:r.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new N({name:r.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){w(e,["distributionPoint","distributionPointNames","onlyContainsUserCerts","onlyContainsCACerts","onlySomeReasons","indirectCRL","onlyContainsAttributeCerts"]);const t=Be(e,e,Ih.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,(e=>new gh({schema:e})));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new ph({schema:new _({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if("onlyContainsUserCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==e[0]}if("onlyContainsCACerts"in t.result){const e=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==e[0]}if("onlySomeReasons"in t.result){const e=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=e[0]}if("indirectCRL"in t.result){const e=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==e[0]}if("onlyContainsAttributeCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==e[0]}}toSchema(){const e=[];if("distributionPoint"in this){let t;this.distributionPoint instanceof Array?t=new D({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(e=>e.toSchema()))}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==Ih.defaultValues("onlyContainsUserCerts")&&e.push(new N({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==Ih.defaultValues("onlyContainsCACerts")&&e.push(new N({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),"onlySomeReasons"in this){const t=new ArrayBuffer(1);new Uint8Array(t)[0]=this.onlySomeReasons,e.push(new N({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==Ih.defaultValues("indirectCRL")&&e.push(new N({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==Ih.defaultValues("onlyContainsAttributeCerts")&&e.push(new N({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new _({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(e=>e.toJSON())):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==Ih.defaultValues("onlyContainsUserCerts")&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==Ih.defaultValues("onlyContainsCACerts")&&(e.onlyContainsCACerts=this.onlyContainsCACerts),"onlySomeReasons"in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==Ih.defaultValues("indirectCRL")&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==Ih.defaultValues("onlyContainsAttributeCerts")&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}class xh{constructor(e={}){this.names=t(e,"names",xh.defaultValues("names")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("names"===e)return[];throw new Error(`Invalid member name for GeneralNames class: ${e}`)}static schema(e={},r=!1){const s=t(e,"names",{});return new _({optional:r,name:s.blockName||"",value:[new Ce({name:s.generalNames||"",value:gh.schema()})]})}fromSchema(e){w(e,["names","generalNames"]);const t=Be(e,e,xh.schema({names:{blockName:"names",generalNames:"generalNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(t.result.generalNames,(e=>new gh({schema:e})))}toSchema(){return new _({value:Array.from(this.names,(e=>e.toSchema()))})}toJSON(){return{names:Array.from(this.names,(e=>e.toJSON()))}}}class Eh{constructor(e={}){this.base=t(e,"base",Eh.defaultValues("base")),this.minimum=t(e,"minimum",Eh.defaultValues("minimum")),"maximum"in e&&(this.maximum=t(e,"maximum",Eh.defaultValues("maximum"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"base":return new gh;case"minimum":case"maximum":return 0;default:throw new Error(`Invalid member name for GeneralSubtree class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[gh.schema(r.base||{}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({name:r.minimum||""})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new q({name:r.maximum||""})]})]})}fromSchema(e){w(e,["base","minimum","maximum"]);const t=Be(e,e,Eh.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralSubtree");this.base=new gh({schema:t.result.base}),"minimum"in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),"maximum"in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),0!==this.minimum){let t=0;t=this.minimum instanceof q?this.minimum:new q({value:this.minimum}),e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){let t=0;t=this.maximum instanceof q?this.maximum:new q({value:this.maximum}),e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new _({value:e})}toJSON(){const e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),"maximum"in this&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}class Bh{constructor(e={}){"permittedSubtrees"in e&&(this.permittedSubtrees=t(e,"permittedSubtrees",Bh.defaultValues("permittedSubtrees"))),"excludedSubtrees"in e&&(this.excludedSubtrees=t(e,"excludedSubtrees",Bh.defaultValues("excludedSubtrees"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"permittedSubtrees":case"excludedSubtrees":return[];default:throw new Error(`Invalid member name for NameConstraints class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ce({name:r.permittedSubtrees||"",value:Eh.schema()})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ce({name:r.excludedSubtrees||"",value:Eh.schema()})]})]})}fromSchema(e){w(e,["permittedSubtrees","excludedSubtrees"]);const t=Be(e,e,Bh.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for NameConstraints");"permittedSubtrees"in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,(e=>new Eh({schema:e})))),"excludedSubtrees"in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,(e=>new Eh({schema:e}))))}toSchema(){const e=[];return"permittedSubtrees"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,(e=>e.toSchema()))})),"excludedSubtrees"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,(e=>e.toSchema()))})),new _({value:e})}toJSON(){const e={};return"permittedSubtrees"in this&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,(e=>e.toJSON()))),"excludedSubtrees"in this&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,(e=>e.toJSON()))),e}}class Nh{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=t(e,"distributionPoint",Nh.defaultValues("distributionPoint"))),"reasons"in e&&(this.reasons=t(e,"reasons",Nh.defaultValues("reasons"))),"cRLIssuer"in e&&(this.cRLIssuer=t(e,"cRLIssuer",Nh.defaultValues("cRLIssuer"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":case"cRLIssuer":return[];case"reasons":return new M;default:throw new Error(`Invalid member name for DistributionPoint class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ae({value:[new D({name:r.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ce({name:r.distributionPointNames||"",value:gh.schema()})]}),new D({name:r.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:ph.schema().valueBlock.value})]})]}),new N({name:r.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new D({name:r.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Ce({name:r.cRLIssuerNames||"",value:gh.schema()})]})]})}fromSchema(e){w(e,["distributionPoint","distributionPointNames","reasons","cRLIssuer","cRLIssuerNames"]);const t=Be(e,e,Nh.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for DistributionPoint");"distributionPoint"in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,(e=>new gh({schema:e})))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new ph({schema:new _({value:t.result.distributionPoint.valueBlock.value})}))),"reasons"in t.result&&(this.reasons=new M({valueHex:t.result.reasons.valueBlock.valueHex})),"cRLIssuer"in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,(e=>new gh({schema:e}))))}toSchema(){const e=[];if("distributionPoint"in this){let t;t=this.distributionPoint instanceof Array?new D({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(e=>e.toSchema()))}):new D({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return"reasons"in this&&e.push(new N({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex})),"cRLIssuer"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,(e=>e.toSchema()))})),new _({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(e=>e.toJSON())):e.distributionPoint=this.distributionPoint.toJSON()),"reasons"in this&&(e.reasons=this.reasons.toJSON()),"cRLIssuer"in this&&(e.cRLIssuer=Array.from(this.cRLIssuer,(e=>e.toJSON()))),e}}class Ph{constructor(e={}){this.distributionPoints=t(e,"distributionPoints",Ph.defaultValues("distributionPoints")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("distributionPoints"===e)return[];throw new Error(`Invalid member name for CRLDistributionPoints class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.distributionPoints||"",value:Nh.schema()})]})}fromSchema(e){w(e,["distributionPoints"]);const t=Be(e,e,Ph.schema({names:{distributionPoints:"distributionPoints"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(t.result.distributionPoints,(e=>new Nh({schema:e})))}toSchema(){return new _({value:Array.from(this.distributionPoints,(e=>e.toSchema()))})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,(e=>e.toJSON()))}}}class Dh{constructor(e={}){this.policyQualifierId=t(e,"policyQualifierId",Dh.defaultValues("policyQualifierId")),this.qualifier=t(e,"qualifier",Dh.defaultValues("qualifier")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new ke;default:throw new Error(`Invalid member name for PolicyQualifierInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.policyQualifierId||""}),new ke({name:r.qualifier||""})]})}fromSchema(e){w(e,["policyQualifierId","qualifier"]);const t=Be(e,e,Dh.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new _({value:[new J({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}class Uh{constructor(e={}){this.policyIdentifier=t(e,"policyIdentifier",Uh.defaultValues("policyIdentifier")),"policyQualifiers"in e&&(this.policyQualifiers=t(e,"policyQualifiers",Uh.defaultValues("policyQualifiers"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error(`Invalid member name for PolicyInformation class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.policyIdentifier||""}),new _({optional:!0,value:[new Ce({name:r.policyQualifiers||"",value:Dh.schema()})]})]})}fromSchema(e){w(e,["policyIdentifier","policyQualifiers"]);const t=Be(e,e,Uh.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),"policyQualifiers"in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,(e=>new Dh({schema:e}))))}toSchema(){const e=[];return e.push(new J({value:this.policyIdentifier})),"policyQualifiers"in this&&e.push(new _({value:Array.from(this.policyQualifiers,(e=>e.toSchema()))})),new _({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return"policyQualifiers"in this&&(e.policyQualifiers=Array.from(this.policyQualifiers,(e=>e.toJSON()))),e}}class Oh{constructor(e={}){this.certificatePolicies=t(e,"certificatePolicies",Oh.defaultValues("certificatePolicies")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("certificatePolicies"===e)return[];throw new Error(`Invalid member name for CertificatePolicies class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.certificatePolicies||"",value:Uh.schema()})]})}fromSchema(e){w(e,["certificatePolicies"]);const t=Be(e,e,Oh.schema({names:{certificatePolicies:"certificatePolicies"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(t.result.certificatePolicies,(e=>new Uh({schema:e})))}toSchema(){return new _({value:Array.from(this.certificatePolicies,(e=>e.toSchema()))})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,(e=>e.toJSON()))}}}class Th{constructor(e={}){this.issuerDomainPolicy=t(e,"issuerDomainPolicy",Th.defaultValues("issuerDomainPolicy")),this.subjectDomainPolicy=t(e,"subjectDomainPolicy",Th.defaultValues("subjectDomainPolicy")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"issuerDomainPolicy":case"subjectDomainPolicy":return"";default:throw new Error(`Invalid member name for PolicyMapping class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.issuerDomainPolicy||""}),new J({name:r.subjectDomainPolicy||""})]})}fromSchema(e){w(e,["issuerDomainPolicy","subjectDomainPolicy"]);const t=Be(e,e,Th.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new _({value:[new J({value:this.issuerDomainPolicy}),new J({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}class Rh{constructor(e={}){this.mappings=t(e,"mappings",Rh.defaultValues("mappings")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("mappings"===e)return[];throw new Error(`Invalid member name for PolicyMappings class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.mappings||"",value:Th.schema()})]})}fromSchema(e){w(e,["mappings"]);const t=Be(e,e,Rh.schema({names:{mappings:"mappings"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(t.result.mappings,(e=>new Th({schema:e})))}toSchema(){return new _({value:Array.from(this.mappings,(e=>e.toSchema()))})}toJSON(){return{mappings:Array.from(this.mappings,(e=>e.toJSON()))}}}class _h{constructor(e={}){"keyIdentifier"in e&&(this.keyIdentifier=t(e,"keyIdentifier",_h.defaultValues("keyIdentifier"))),"authorityCertIssuer"in e&&(this.authorityCertIssuer=t(e,"authorityCertIssuer",_h.defaultValues("authorityCertIssuer"))),"authorityCertSerialNumber"in e&&(this.authorityCertSerialNumber=t(e,"authorityCertSerialNumber",_h.defaultValues("authorityCertSerialNumber"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyIdentifier":return new j;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new q;default:throw new Error(`Invalid member name for AuthorityKeyIdentifier class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new N({name:r.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ce({name:r.authorityCertIssuer||"",value:gh.schema()})]}),new N({name:r.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){w(e,["keyIdentifier","authorityCertIssuer","authorityCertSerialNumber"]);const t=Be(e,e,_h.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");"keyIdentifier"in t.result&&(this.keyIdentifier=new j({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,(e=>new gh({schema:e})))),"authorityCertSerialNumber"in t.result&&(this.authorityCertSerialNumber=new q({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return"keyIdentifier"in this&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,(e=>e.toSchema()))})),"authorityCertSerialNumber"in this&&e.push(new N({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHex})),new _({value:e})}toJSON(){const e={};return"keyIdentifier"in this&&(e.keyIdentifier=this.keyIdentifier.toJSON()),"authorityCertIssuer"in this&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,(e=>e.toJSON()))),"authorityCertSerialNumber"in this&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}class Vh{constructor(e={}){"requireExplicitPolicy"in e&&(this.requireExplicitPolicy=t(e,"requireExplicitPolicy",Vh.defaultValues("requireExplicitPolicy"))),"inhibitPolicyMapping"in e&&(this.inhibitPolicyMapping=t(e,"inhibitPolicyMapping",Vh.defaultValues("inhibitPolicyMapping"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"requireExplicitPolicy":case"inhibitPolicyMapping":return 0;default:throw new Error(`Invalid member name for PolicyConstraints class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new N({name:r.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new N({name:r.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){w(e,["requireExplicitPolicy","inhibitPolicyMapping"]);const t=Be(e,e,Vh.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in t.result){const e=t.result.requireExplicitPolicy;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const r=Ee(e.toBER(!1));this.requireExplicitPolicy=r.result.valueBlock.valueDec}if("inhibitPolicyMapping"in t.result){const e=t.result.inhibitPolicyMapping;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const r=Ee(e.toBER(!1));this.inhibitPolicyMapping=r.result.valueBlock.valueDec}}toSchema(){const e=[];if("requireExplicitPolicy"in this){const t=new q({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("inhibitPolicyMapping"in this){const t=new q({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new _({value:e})}toJSON(){const e={};return"requireExplicitPolicy"in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),"inhibitPolicyMapping"in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}class Fh{constructor(e={}){this.keyPurposes=t(e,"keyPurposes",Fh.defaultValues("keyPurposes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("keyPurposes"===e)return[];throw new Error(`Invalid member name for ExtKeyUsage class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.keyPurposes||"",value:new J})]})}fromSchema(e){w(e,["keyPurposes"]);const t=Be(e,e,Fh.schema({names:{keyPurposes:"keyPurposes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(t.result.keyPurposes,(e=>e.valueBlock.toString()))}toSchema(){return new _({value:Array.from(this.keyPurposes,(e=>new J({value:e})))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}class Lh{constructor(e={}){this.accessDescriptions=t(e,"accessDescriptions",Lh.defaultValues("accessDescriptions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("accessDescriptions"===e)return[];throw new Error(`Invalid member name for InfoAccess class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.accessDescriptions||"",value:yh.schema()})]})}fromSchema(e){w(e,["accessDescriptions"]);const t=Be(e,e,Lh.schema({names:{accessDescriptions:"accessDescriptions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(t.result.accessDescriptions,(e=>new yh({schema:e})))}toSchema(){return new _({value:Array.from(this.accessDescriptions,(e=>e.toSchema()))})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,(e=>e.toJSON()))}}}class jh{constructor(e={}){this.version=t(e,"version",jh.defaultValues("version")),this.logID=t(e,"logID",jh.defaultValues("logID")),this.timestamp=t(e,"timestamp",jh.defaultValues("timestamp")),this.extensions=t(e,"extensions",jh.defaultValues("extensions")),this.hashAlgorithm=t(e,"hashAlgorithm",jh.defaultValues("hashAlgorithm")),this.signatureAlgorithm=t(e,"signatureAlgorithm",jh.defaultValues("signatureAlgorithm")),this.signature=t(e,"signature",jh.defaultValues("signature")),"schema"in e&&this.fromSchema(e.schema),"stream"in e&&this.fromStream(e.stream)}static defaultValues(e){switch(e){case"version":return 0;case"logID":case"extensions":return new ArrayBuffer(0);case"timestamp":return new Date(0);case"hashAlgorithm":case"signatureAlgorithm":return"";case"signature":return new ke;default:throw new Error(`Invalid member name for SignedCertificateTimestamp class: ${e}`)}}fromSchema(e){if(e instanceof Ie==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new ja({stream:new La({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(n(new Uint8Array(e.getBlock(8)),8));const r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm="none";break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm="sha1";break;case 3:this.hashAlgorithm="sha224";break;case 4:this.hashAlgorithm="sha256";break;case 5:this.hashAlgorithm="sha384";break;case 6:this.hashAlgorithm="sha512";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm="anonymous";break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm="ecdsa";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const s=e.getUint16(),i=Ee(new Uint8Array(e.getBlock(s)).buffer.slice(0));if(-1===i.offset)throw new Error("Object's stream was not correct for SignedCertificateTimestamp");if(this.signature=i.result,t!==47+r+s)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Ie({data:e.stream.buffer})}toStream(){const e=new ja;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecode.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),r=new Uint8Array(t),s=i(this.timestamp.valueOf(),8);let n,a;switch(r.set(new Uint8Array(s),8-s.byteLength),e.appendView(r),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case"none":n=0;break;case"md5":n=1;break;case"sha1":n=2;break;case"sha224":n=3;break;case"sha256":n=4;break;case"sha384":n=5;break;case"sha512":n=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}switch(e.appendChar(n),this.signatureAlgorithm.toLowerCase()){case"anonymous":a=0;break;case"rsa":a=1;break;case"dsa":a=2;break;case"ecdsa":a=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(a);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:r(this.logID),timestamp:this.timestamp,extensions:r(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,r=0){let s,n=d(m(this.logID)),a=null,o=new ja;for(const t of e)if(t.log_id===n){a=t.key;break}if(null===a)throw new Error(`Public key not found for CT with logId: ${n}`);const c=Ee(g(f(a)));if(-1===c.offset)throw new Error(`Incorrect key value for CT Log with logId: ${n}`);s=new Kl({schema:c.result}),o.appendChar(0),o.appendChar(0);const l=new ArrayBuffer(8),h=new Uint8Array(l),u=i(this.timestamp.valueOf(),8);return h.set(new Uint8Array(u),8-u.byteLength),o.appendView(h),o.appendUint16(r),0===r&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&o.appendView(new Uint8Array(this.extensions)),sh().subtle.verifyWithPublicKey(o._stream._buffer.slice(0,o._length),{valueBlock:{valueHex:this.signature.toBER(!1)}},s,{algorithmId:""},"SHA-256")}}class Hh{constructor(e={}){this.timestamps=t(e,"timestamps",Hh.defaultValues("timestamps")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("timestamps"===e)return[];throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static compareWithDefault(e,t){if("timestamps"===e)return 0===t.length;throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return"optional"in r==!1&&(r.optional=!1),new j({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}fromSchema(e){if(e instanceof j==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new ja({stream:new La({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new jh({stream:t}))}toSchema(){const e=new ja;let t=0;const r=[];for(const e of this.timestamps){const s=e.toStream();r.push(s),t+=s.stream.buffer.byteLength}e.appendUint16(t);for(const t of r)e.appendView(t.stream.view);return new j({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,(e=>e.toJSON()))}}}class Mh{constructor(e={}){this.templateID=t(e,"templateID",Mh.defaultValues("templateID")),"templateMajorVersion"in e&&(this.templateMajorVersion=t(e,"templateMajorVersion",Mh.defaultValues("templateMajorVersion"))),"templateMinorVersion"in e&&(this.templateMinorVersion=t(e,"templateMinorVersion",Mh.defaultValues("templateMinorVersion"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"templateID":return"";case"templateMajorVersion":case"templateMinorVersion":return 0;default:throw new Error(`Invalid member name for CertificateTemplate class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.templateID||""}),new q({name:r.templateMajorVersion||"",optional:!0}),new q({name:r.templateMinorVersion||"",optional:!0})]})}fromSchema(e){w(e,["templateID","templateMajorVersion","templateMinorVersion"]);let t=Be(e,e,Mh.schema({names:{templateID:"templateID",templateMajorVersion:"templateMajorVersion",templateMinorVersion:"templateMinorVersion"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertificateTemplate");this.templateID=t.result.templateID.valueBlock.toString(),"templateMajorVersion"in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),"templateMinorVersion"in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new J({value:this.templateID})),"templateMajorVersion"in this&&e.push(new q({value:this.templateMajorVersion})),"templateMinorVersion"in this&&e.push(new q({value:this.templateMinorVersion})),new _({value:e})}toJSON(){const e={extnID:this.templateID};return"templateMajorVersion"in this&&(e.templateMajorVersion=this.templateMajorVersion),"templateMinorVersion"in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}class Kh{constructor(e={}){this.certificateIndex=t(e,"certificateIndex",Kh.defaultValues("certificateIndex")),this.keyIndex=t(e,"keyIndex",Kh.defaultValues("keyIndex")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"certificateIndex":case"keyIndex":return 0;default:throw new Error(`Invalid member name for CAVersion class: ${e}`)}}static schema(e={}){return new q}fromSchema(e){if(e.constructor.blockName()!==q.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const r=new Uint8Array(t);switch(!0){case t.byteLength<4:{const e=new ArrayBuffer(4);new Uint8Array(e).set(r,4-t.byteLength),t=e.slice(0)}break;case t.byteLength>4:{const e=new ArrayBuffer(4);new Uint8Array(e).set(r.slice(0,4)),t=e.slice(0)}}const s=t.slice(0,2),n=new Uint8Array(s);let i=n[0];n[0]=n[1],n[1]=i;const a=new Uint16Array(s);this.keyIndex=a[0];const o=t.slice(2),c=new Uint8Array(o);i=c[0],c[0]=c[1],c[1]=i;const l=new Uint16Array(o);this.certificateIndex=l[0]}toSchema(){const e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;const t=new Uint8Array(e);let r=t[0];t[0]=t[1],t[1]=r;const s=new ArrayBuffer(2);new Uint16Array(s)[0]=this.keyIndex;const n=new Uint8Array(s);return r=n[0],n[0]=n[1],n[1]=r,new q({valueHex:a(s,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}class qh{constructor(e={}){this.id=t(e,"id",qh.defaultValues("id")),"type"in e&&(this.type=t(e,"type",qh.defaultValues("type"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"id":return"";case"type":return new F;default:throw new Error(`Invalid member name for QCStatement class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"id":return""===t;case"type":return t instanceof F;default:throw new Error(`Invalid member name for QCStatement class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.id||""}),new ke({name:r.type||"",optional:!0})]})}fromSchema(e){w(e,["id","type"]);const t=Be(e,e,qh.schema({names:{id:"id",type:"type"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for QCStatement");this.id=t.result.id.valueBlock.toString(),"type"in t.result&&(this.type=t.result.type)}toSchema(){const e=[new J({value:this.id})];return"type"in this&&e.push(this.type),new _({value:e})}toJSON(){const e={id:this.id};return"type"in this&&(e.type=this.type.toJSON()),e}}class Wh{constructor(e={}){this.values=t(e,"values",Wh.defaultValues("values")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("values"===e)return[];throw new Error(`Invalid member name for QCStatements class: ${e}`)}static compareWithDefault(e,t){if("values"===e)return 0===t.length;throw new Error(`Invalid member name for QCStatements class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.values||"",value:qh.schema(r.value||{})})]})}fromSchema(e){w(e,["values"]);const t=Be(e,e,Wh.schema({names:{values:"values"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for QCStatements");this.values=Array.from(t.result.values,(e=>new qh({schema:e})))}toSchema(){return new _({value:Array.from(this.values,(e=>e.toSchema()))})}toJSON(){return{extensions:Array.from(this.values,(e=>e.toJSON()))}}}class Gh{constructor(e={}){this.extnID=t(e,"extnID",Gh.defaultValues("extnID")),this.critical=t(e,"critical",Gh.defaultValues("critical")),this.extnValue="extnValue"in e?new j({valueHex:e.extnValue}):Gh.defaultValues("extnValue"),"parsedValue"in e&&(this.parsedValue=t(e,"parsedValue",Gh.defaultValues("parsedValue"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"extnID":return"";case"critical":return!1;case"extnValue":return new j;case"parsedValue":return{};default:throw new Error(`Invalid member name for Extension class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.extnID||""}),new R({name:r.critical||"",optional:!0}),new j({name:r.extnValue||""})]})}fromSchema(e){w(e,["extnID","critical","extnValue"]);let t=Be(e,e,Gh.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extension");if(this.extnID=t.result.extnID.valueBlock.toString(),"critical"in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue,t=Ee(this.extnValue.valueBlock.valueHex),-1!==t.offset)switch(this.extnID){case"2.5.29.9":try{this.parsedValue=new Ah({schema:t.result})}catch(e){this.parsedValue=new Ah,this.parsedValue.parsingError="Incorrectly formated SubjectDirectoryAttributes"}break;case"2.5.29.14":case"2.5.29.15":case"2.5.29.20":case"2.5.29.27":case"2.5.29.21":case"2.5.29.24":case"2.5.29.54":case"1.3.6.1.4.1.311.20.2":case"1.3.6.1.4.1.311.21.2":this.parsedValue=t.result;break;case"2.5.29.16":try{this.parsedValue=new kh({schema:t.result})}catch(e){this.parsedValue=new kh,this.parsedValue.parsingError="Incorrectly formated PrivateKeyUsagePeriod"}break;case"2.5.29.17":case"2.5.29.18":try{this.parsedValue=new wh({schema:t.result})}catch(e){this.parsedValue=new wh,this.parsedValue.parsingError="Incorrectly formated AltName"}break;case"2.5.29.19":try{this.parsedValue=new Ch({schema:t.result})}catch(e){this.parsedValue=new Ch,this.parsedValue.parsingError="Incorrectly formated BasicConstraints"}break;case"2.5.29.28":try{this.parsedValue=new Ih({schema:t.result})}catch(e){this.parsedValue=new Ih,this.parsedValue.parsingError="Incorrectly formated IssuingDistributionPoint"}break;case"2.5.29.29":try{this.parsedValue=new xh({schema:t.result})}catch(e){this.parsedValue=new xh,this.parsedValue.parsingError="Incorrectly formated GeneralNames"}break;case"2.5.29.30":try{this.parsedValue=new Bh({schema:t.result})}catch(e){this.parsedValue=new Bh,this.parsedValue.parsingError="Incorrectly formated NameConstraints"}break;case"2.5.29.31":case"2.5.29.46":try{this.parsedValue=new Ph({schema:t.result})}catch(e){this.parsedValue=new Ph,this.parsedValue.parsingError="Incorrectly formated CRLDistributionPoints"}break;case"2.5.29.32":case"1.3.6.1.4.1.311.21.10":try{this.parsedValue=new Oh({schema:t.result})}catch(e){this.parsedValue=new Oh,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.33":try{this.parsedValue=new Rh({schema:t.result})}catch(e){this.parsedValue=new Rh,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.35":try{this.parsedValue=new _h({schema:t.result})}catch(e){this.parsedValue=new _h,this.parsedValue.parsingError="Incorrectly formated AuthorityKeyIdentifier"}break;case"2.5.29.36":try{this.parsedValue=new Vh({schema:t.result})}catch(e){this.parsedValue=new Vh,this.parsedValue.parsingError="Incorrectly formated PolicyConstraints"}break;case"2.5.29.37":try{this.parsedValue=new Fh({schema:t.result})}catch(e){this.parsedValue=new Fh,this.parsedValue.parsingError="Incorrectly formated ExtKeyUsage"}break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":try{this.parsedValue=new Lh({schema:t.result})}catch(e){this.parsedValue=new Lh,this.parsedValue.parsingError="Incorrectly formated InfoAccess"}break;case"1.3.6.1.4.1.11129.2.4.2":try{this.parsedValue=new Hh({schema:t.result})}catch(e){this.parsedValue=new Hh,this.parsedValue.parsingError="Incorrectly formated SignedCertificateTimestampList"}break;case"1.3.6.1.4.1.311.21.7":try{this.parsedValue=new Mh({schema:t.result})}catch(e){this.parsedValue=new Mh,this.parsedValue.parsingError="Incorrectly formated CertificateTemplate"}break;case"1.3.6.1.4.1.311.21.1":try{this.parsedValue=new Kh({schema:t.result})}catch(e){this.parsedValue=new Kh,this.parsedValue.parsingError="Incorrectly formated CAVersion"}break;case"1.3.6.1.5.5.7.1.3":try{this.parsedValue=new Wh({schema:t.result})}catch(e){this.parsedValue=new Wh,this.parsedValue.parsingError="Incorrectly formated QCStatements"}}}toSchema(){const e=[];return e.push(new J({value:this.extnID})),this.critical!==Gh.defaultValues("critical")&&e.push(new R({value:this.critical})),e.push(this.extnValue),new _({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Gh.defaultValues("critical")&&(e.critical=this.critical),"parsedValue"in this&&"toJSON"in this.parsedValue&&(e.parsedValue=this.parsedValue.toJSON()),e}}class zh{constructor(e={}){this.extensions=t(e,"extensions",zh.defaultValues("extensions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("extensions"===e)return[];throw new Error(`Invalid member name for Extensions class: ${e}`)}static schema(e={},r=!1){const s=t(e,"names",{});return new _({optional:r,name:s.blockName||"",value:[new Ce({name:s.extensions||"",value:Gh.schema(s.extension||{})})]})}fromSchema(e){w(e,["extensions"]);const t=Be(e,e,zh.schema({names:{extensions:"extensions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extensions");this.extensions=Array.from(t.result.extensions,(e=>new Gh({schema:e})))}toSchema(){return new _({value:Array.from(this.extensions,(e=>e.toSchema()))})}toJSON(){return{extensions:Array.from(this.extensions,(e=>e.toJSON()))}}}function Jh(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"tbsCertificate",value:[new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({name:r.tbsCertificateVersion||"tbsCertificate.version"})]}),new q({name:r.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),Ll.schema(r.signature||{names:{blockName:"tbsCertificate.signature"}}),ph.schema(r.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new _({name:r.tbsCertificateValidity||"tbsCertificate.validity",value:[Sh.schema(r.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),Sh.schema(r.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),ph.schema(r.subject||{names:{blockName:"tbsCertificate.subject"}}),Kl.schema(r.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new N({name:r.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new N({name:r.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[zh.schema(r.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}class $h{constructor(e={}){this.tbs=t(e,"tbs",$h.defaultValues("tbs")),this.version=t(e,"version",$h.defaultValues("version")),this.serialNumber=t(e,"serialNumber",$h.defaultValues("serialNumber")),this.signature=t(e,"signature",$h.defaultValues("signature")),this.issuer=t(e,"issuer",$h.defaultValues("issuer")),this.notBefore=t(e,"notBefore",$h.defaultValues("notBefore")),this.notAfter=t(e,"notAfter",$h.defaultValues("notAfter")),this.subject=t(e,"subject",$h.defaultValues("subject")),this.subjectPublicKeyInfo=t(e,"subjectPublicKeyInfo",$h.defaultValues("subjectPublicKeyInfo")),"issuerUniqueID"in e&&(this.issuerUniqueID=t(e,"issuerUniqueID",$h.defaultValues("issuerUniqueID"))),"subjectUniqueID"in e&&(this.subjectUniqueID=t(e,"subjectUniqueID",$h.defaultValues("subjectUniqueID"))),"extensions"in e&&(this.extensions=t(e,"extensions",$h.defaultValues("extensions"))),this.signatureAlgorithm=t(e,"signatureAlgorithm",$h.defaultValues("signatureAlgorithm")),this.signatureValue=t(e,"signatureValue",$h.defaultValues("signatureValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":case"issuerUniqueID":case"subjectUniqueID":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new q;case"signature":case"signatureAlgorithm":return new Ll;case"issuer":case"subject":return new ph;case"notBefore":case"notAfter":return new Sh;case"subjectPublicKeyInfo":return new Kl;case"extensions":return[];case"signatureValue":return new M;default:throw new Error(`Invalid member name for Certificate class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Jh(r.tbsCertificate),Ll.schema(r.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new M({name:r.signatureValue||"signatureValue"})]})}fromSchema(e){w(e,["tbsCertificate","tbsCertificate.extensions","tbsCertificate.version","tbsCertificate.serialNumber","tbsCertificate.signature","tbsCertificate.issuer","tbsCertificate.notBefore","tbsCertificate.notAfter","tbsCertificate.subject","tbsCertificate.subjectPublicKeyInfo","tbsCertificate.issuerUniqueID","tbsCertificate.subjectUniqueID","signatureAlgorithm","signatureValue"]);const t=Be(e,e,$h.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Certificate");this.tbs=t.result.tbsCertificate.valueBeforeDecode,"tbsCertificate.version"in t.result&&(this.version=t.result["tbsCertificate.version"].valueBlock.valueDec),this.serialNumber=t.result["tbsCertificate.serialNumber"],this.signature=new Ll({schema:t.result["tbsCertificate.signature"]}),this.issuer=new ph({schema:t.result["tbsCertificate.issuer"]}),this.notBefore=new Sh({schema:t.result["tbsCertificate.notBefore"]}),this.notAfter=new Sh({schema:t.result["tbsCertificate.notAfter"]}),this.subject=new ph({schema:t.result["tbsCertificate.subject"]}),this.subjectPublicKeyInfo=new Kl({schema:t.result["tbsCertificate.subjectPublicKeyInfo"]}),"tbsCertificate.issuerUniqueID"in t.result&&(this.issuerUniqueID=t.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex),"tbsCertificate.subjectUniqueID"in t.result&&(this.subjectUniqueID=t.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex),"tbsCertificate.extensions"in t.result&&(this.extensions=Array.from(t.result["tbsCertificate.extensions"],(e=>new Gh({schema:e})))),this.signatureAlgorithm=new Ll({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return"version"in this&&this.version!==$h.defaultValues("version")&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new _({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),"issuerUniqueID"in this&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),"subjectUniqueID"in this&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),"extensions"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new _({value:Array.from(this.extensions,(e=>e.toSchema()))})]})),new _({value:e})}toSchema(e=!1){let t={};if(!1===e){if(0===this.tbs.length)return $h.schema().value[0];t=Ee(this.tbs).result}else t=this.encodeTBS();return new _({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:r(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"version"in this&&this.version!==$h.defaultValues("version")&&(e.version=this.version),"issuerUniqueID"in this&&(e.issuerUniqueID=r(this.issuerUniqueID,0,this.issuerUniqueID.byteLength)),"subjectUniqueID"in this&&(e.subjectUniqueID=r(this.subjectUniqueID,0,this.subjectUniqueID.byteLength)),"extensions"in this&&(e.extensions=Array.from(this.extensions,(e=>e.toJSON()))),e}getPublicKey(e=null){return sh().subtle.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}getKeyHash(e="SHA-1"){const t=nh();return void 0===t?Promise.reject("Unable to create WebCrypto object"):t.digest({name:e},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))}sign(e,t="SHA-1"){if(void 0===e)return Promise.reject("Need to provide a private key for signing");let r,s=Promise.resolve();const n=sh();return s=s.then((()=>n.subtle.getSignatureParameters(e,t))),s=s.then((e=>{r=e.parameters,this.signature=e.signatureAlgorithm,this.signatureAlgorithm=e.signatureAlgorithm})),s=s.then((()=>{this.tbs=this.encodeTBS().toBER(!1)})),s=s.then((()=>n.subtle.signWithPrivateKey(this.tbs,e,r))),s=s.then((e=>{this.signatureValue=new M({valueHex:e})})),s}verify(e=null){let t={};return null!==e?t=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(t=this.subjectPublicKeyInfo),t instanceof Kl==!1?Promise.reject("Please provide issuer certificate as a parameter"):sh().subtle.verifyWithPublicKey(this.tbs,this.signatureValue,t,this.signatureAlgorithm)}}class Yh{constructor(e={}){this.notBeforeTime=t(e,"notBeforeTime",Yh.defaultValues("notBeforeTime")),this.notAfterTime=t(e,"notAfterTime",Yh.defaultValues("notAfterTime")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"notBeforeTime":case"notAfterTime":return new Date(0,0,0);default:throw new Error(`Invalid member name for AttCertValidityPeriod class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new ge({name:r.notBeforeTime||""}),new ge({name:r.notAfterTime||""})]})}fromSchema(e){w(e,["notBeforeTime","notAfterTime"]);const t=Be(e,e,Yh.schema({names:{notBeforeTime:"notBeforeTime",notAfterTime:"notAfterTime"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttCertValidityPeriod");this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new _({value:[new ge({valueDate:this.notBeforeTime}),new ge({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}class Xh{constructor(e={}){this.issuer=t(e,"issuer",Xh.defaultValues("issuer")),this.serialNumber=t(e,"serialNumber",Xh.defaultValues("serialNumber")),"issuerUID"in e&&(this.issuerUID=t(e,"issuerUID",Xh.defaultValues("issuerUID"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"issuer":return new xh;case"serialNumber":return new q;case"issuerUID":return new M;default:throw new Error(`Invalid member name for IssuerSerial class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[xh.schema(r.issuer||{}),new q({name:r.serialNumber||""}),new M({optional:!0,name:r.issuerUID||""})]})}fromSchema(e){w(e,["issuer","serialNumber","issuerUID"]);const t=Be(e,e,Xh.schema({names:{issuer:{names:{blockName:"issuer"}},serialNumber:"serialNumber",issuerUID:"issuerUID"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for IssuerSerial");this.issuer=new xh({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,"issuerUID"in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new _({value:[this.issuer.toSchema(),this.serialNumber]});return"issuerUID"in this&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return"issuerUID"in this&&(e.issuerUID=this.issuerUID.toJSON()),e}}class Qh{constructor(e={}){this.version=t(e,"version",Qh.defaultValues("version")),"baseCertificateID"in e&&(this.baseCertificateID=t(e,"baseCertificateID",Qh.defaultValues("baseCertificateID"))),"subjectName"in e&&(this.subjectName=t(e,"subjectName",Qh.defaultValues("subjectName"))),this.issuer=t(e,"issuer",Qh.defaultValues("issuer")),this.signature=t(e,"signature",Qh.defaultValues("signature")),this.serialNumber=t(e,"serialNumber",Qh.defaultValues("serialNumber")),this.attrCertValidityPeriod=t(e,"attrCertValidityPeriod",Qh.defaultValues("attrCertValidityPeriod")),this.attributes=t(e,"attributes",Qh.defaultValues("attributes")),"issuerUniqueID"in e&&(this.issuerUniqueID=t(e,"issuerUniqueID",Qh.defaultValues("issuerUniqueID"))),"extensions"in e&&(this.extensions=t(e,"extensions",Qh.defaultValues("extensions"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 0;case"baseCertificateID":return new Xh;case"subjectName":return new xh;case"issuer":return{};case"signature":return new Ll;case"serialNumber":return new q;case"attrCertValidityPeriod":return new Yh;case"attributes":return[];case"issuerUniqueID":return new M;case"extensions":return new zh;default:throw new Error(`Invalid member name for AttributeCertificateInfoV1 class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),new Ae({value:[new D({name:r.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:Xh.schema().valueBlock.value}),new D({name:r.subjectName||"",idBlock:{tagClass:3,tagNumber:1},value:xh.schema().valueBlock.value})]}),xh.schema({names:{blockName:r.issuer||""}}),Ll.schema(r.signature||{}),new q({name:r.serialNumber||""}),Yh.schema(r.attrCertValidityPeriod||{}),new _({name:r.attributes||"",value:[new Ce({value:ql.schema()})]}),new M({optional:!0,name:r.issuerUniqueID||""}),zh.schema(r.extensions||{},!0)]})}fromSchema(e){w(e,["version","baseCertificateID","subjectName","issuer","signature","serialNumber","attrCertValidityPeriod","attributes","issuerUniqueID","extensions"]);const t=Be(e,e,Qh.schema({names:{version:"version",baseCertificateID:"baseCertificateID",subjectName:"subjectName",issuer:"issuer",signature:{names:{blockName:"signature"}},serialNumber:"serialNumber",attrCertValidityPeriod:{names:{blockName:"attrCertValidityPeriod"}},attributes:"attributes",issuerUniqueID:"issuerUniqueID",extensions:{names:{blockName:"extensions"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeCertificateInfoV1");this.version=t.result.version.valueBlock.valueDec,"baseCertificateID"in t.result&&(this.baseCertificateID=new Xh({schema:new _({value:t.result.baseCertificateID.valueBlock.value})})),"subjectName"in t.result&&(this.subjectName=new xh({schema:new _({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new Ll({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Yh({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,(e=>new ql({schema:e}))),"issuerUniqueID"in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),"extensions"in t.result&&(this.extensions=new zh({schema:t.result.extensions}))}toSchema(){const e=new _({value:[new q({value:this.version})]});return"baseCertificateID"in this&&e.valueBlock.value.push(new D({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),"subjectName"in this&&e.valueBlock.value.push(new D({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new _({value:Array.from(this.attributes,(e=>e.toSchema()))})),"issuerUniqueID"in this&&e.valueBlock.value.push(this.issuerUniqueID),"extensions"in this&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return"baseCertificateID"in this&&(e.baseCertificateID=this.baseCertificateID.toJSON()),"subjectName"in this&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,(e=>e.toJSON())),"issuerUniqueID"in this&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),"extensions"in this&&(e.extensions=this.extensions.toJSON()),e}}class Zh{constructor(e={}){this.acinfo=t(e,"acinfo",Zh.defaultValues("acinfo")),this.signatureAlgorithm=t(e,"signatureAlgorithm",Zh.defaultValues("signatureAlgorithm")),this.signatureValue=t(e,"signatureValue",Zh.defaultValues("signatureValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"acinfo":return new Qh;case"signatureAlgorithm":return new Ll;case"signatureValue":return new M;default:throw new Error(`Invalid member name for AttributeCertificateV1 class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Qh.schema(r.acinfo||{}),Ll.schema(r.signatureAlgorithm||{}),new M({name:r.signatureValue||""})]})}fromSchema(e){w(e,["acinfo","signatureValue","signatureAlgorithm"]);const t=Be(e,e,Zh.schema({names:{acinfo:{names:{blockName:"acinfo"}},signatureAlgorithm:{names:{blockName:"signatureAlgorithm"}},signatureValue:"signatureValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeCertificateV1");this.acinfo=new Qh({schema:t.result.acinfo}),this.signatureAlgorithm=new Ll({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new _({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}class eu{constructor(e={}){this.digestedObjectType=t(e,"digestedObjectType",eu.defaultValues("digestedObjectType")),"otherObjectTypeID"in e&&(this.otherObjectTypeID=t(e,"otherObjectTypeID",eu.defaultValues("otherObjectTypeID"))),this.digestAlgorithm=t(e,"digestAlgorithm",eu.defaultValues("digestAlgorithm")),this.objectDigest=t(e,"objectDigest",eu.defaultValues("objectDigest")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"digestedObjectType":return new W;case"otherObjectTypeID":return new J;case"digestAlgorithm":return new Ll;case"objectDigest":return new M;default:throw new Error(`Invalid member name for ObjectDigestInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new W({name:r.digestedObjectType||""}),new J({optional:!0,name:r.otherObjectTypeID||""}),Ll.schema(r.digestAlgorithm||{}),new M({name:r.objectDigest||""})]})}fromSchema(e){w(e,["digestedObjectType","otherObjectTypeID","digestAlgorithm","objectDigest"]);const t=Be(e,e,eu.schema({names:{digestedObjectType:"digestedObjectType",otherObjectTypeID:"otherObjectTypeID",digestAlgorithm:{names:{blockName:"digestAlgorithm"}},objectDigest:"objectDigest"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ObjectDigestInfo");this.digestedObjectType=t.result.digestedObjectType,"otherObjectTypeID"in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new Ll({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new _({value:[this.digestedObjectType]});return"otherObjectTypeID"in this&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON()};return"otherObjectTypeID"in this&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e.digestAlgorithm=this.digestAlgorithm.toJSON(),e.objectDigest=this.objectDigest.toJSON(),e}}class tu{constructor(e={}){"issuerName"in e&&(this.issuerName=t(e,"issuerName",tu.defaultValues("issuerName"))),"baseCertificateID"in e&&(this.baseCertificateID=t(e,"baseCertificateID",tu.defaultValues("baseCertificateID"))),"objectDigestInfo"in e&&(this.objectDigestInfo=t(e,"objectDigestInfo",tu.defaultValues("objectDigestInfo"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"issuerName":return new xh;case"baseCertificateID":return new Xh;case"objectDigestInfo":return new eu;default:throw new Error(`Invalid member name for V2Form class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[xh.schema({names:{blockName:r.issuerName}},!0),new D({optional:!0,name:r.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:Xh.schema().valueBlock.value}),new D({optional:!0,name:r.objectDigestInfo||"",idBlock:{tagClass:3,tagNumber:1},value:eu.schema().valueBlock.value})]})}fromSchema(e){w(e,["issuerName","baseCertificateID","objectDigestInfo"]);const t=Be(e,e,tu.schema({names:{issuerName:"issuerName",baseCertificateID:"baseCertificateID",objectDigestInfo:"objectDigestInfo"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for V2Form");"issuerName"in t.result&&(this.issuerName=new xh({schema:t.result.issuerName})),"baseCertificateID"in t.result&&(this.baseCertificateID=new Xh({schema:new _({value:t.result.baseCertificateID.valueBlock.value})})),"objectDigestInfo"in t.result&&(this.objectDigestInfo=new eu({schema:new _({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new _;return"issuerName"in this&&e.valueBlock.value.push(this.issuerName.toSchema()),"baseCertificateID"in this&&e.valueBlock.value.push(new D({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),"objectDigestInfo"in this&&e.valueBlock.value.push(new D({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return"issuerName"in this&&(e.issuerName=this.issuerName.toJSON()),"baseCertificateID"in this&&(e.baseCertificateID=this.baseCertificateID.toJSON()),"objectDigestInfo"in this&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}class ru{constructor(e={}){"baseCertificateID"in e&&(this.baseCertificateID=t(e,"baseCertificateID",ru.defaultValues("baseCertificateID"))),"entityName"in e&&(this.entityName=t(e,"entityName",ru.defaultValues("entityName"))),"objectDigestInfo"in e&&(this.objectDigestInfo=t(e,"objectDigestInfo",ru.defaultValues("objectDigestInfo"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"baseCertificateID":return new Xh;case"entityName":return new xh;case"objectDigestInfo":return new eu;default:throw new Error(`Invalid member name for Holder class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new D({optional:!0,name:r.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:Xh.schema().valueBlock.value}),new D({optional:!0,name:r.entityName||"",idBlock:{tagClass:3,tagNumber:1},value:xh.schema().valueBlock.value}),new D({optional:!0,name:r.objectDigestInfo||"",idBlock:{tagClass:3,tagNumber:2},value:eu.schema().valueBlock.value})]})}fromSchema(e){w(e,["baseCertificateID","entityName","objectDigestInfo"]);const t=Be(e,e,ru.schema({names:{baseCertificateID:"baseCertificateID",entityName:"entityName",objectDigestInfo:"objectDigestInfo"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Holder");"baseCertificateID"in t.result&&(this.baseCertificateID=new Xh({schema:new _({value:t.result.baseCertificateID.valueBlock.value})})),"entityName"in t.result&&(this.entityName=new xh({schema:new _({value:t.result.entityName.valueBlock.value})})),"objectDigestInfo"in t.result&&(this.objectDigestInfo=new eu({schema:new _({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new _;return"baseCertificateID"in this&&e.valueBlock.value.push(new D({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),"entityName"in this&&e.valueBlock.value.push(new D({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),"objectDigestInfo"in this&&e.valueBlock.value.push(new D({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return"baseCertificateID"in this&&(e.baseCertificateID=this.baseCertificateID.toJSON()),"entityName"in this&&(e.entityName=this.entityName.toJSON()),"objectDigestInfo"in this&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}class su{constructor(e={}){this.version=t(e,"version",su.defaultValues("version")),this.holder=t(e,"holder",su.defaultValues("holder")),this.issuer=t(e,"issuer",su.defaultValues("issuer")),this.signature=t(e,"signature",su.defaultValues("signature")),this.serialNumber=t(e,"serialNumber",su.defaultValues("serialNumber")),this.attrCertValidityPeriod=t(e,"attrCertValidityPeriod",su.defaultValues("attrCertValidityPeriod")),this.attributes=t(e,"attributes",su.defaultValues("attributes")),"issuerUniqueID"in e&&(this.issuerUniqueID=t(e,"issuerUniqueID",su.defaultValues("issuerUniqueID"))),"extensions"in e&&(this.extensions=t(e,"extensions",su.defaultValues("extensions"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 1;case"holder":return new ru;case"issuer":return{};case"signature":return new Ll;case"serialNumber":return new q;case"attrCertValidityPeriod":return new Yh;case"attributes":return[];case"issuerUniqueID":return new M;case"extensions":return new zh;default:throw new Error(`Invalid member name for AttributeCertificateInfoV2 class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),ru.schema(r.holder||{}),new Ae({value:[xh.schema({names:{blockName:r.issuer||""}}),new D({name:r.issuer||"",idBlock:{tagClass:3,tagNumber:0},value:tu.schema().valueBlock.value})]}),Ll.schema(r.signature||{}),new q({name:r.serialNumber||""}),Yh.schema(r.attrCertValidityPeriod||{}),new _({name:r.attributes||"",value:[new Ce({value:ql.schema()})]}),new M({optional:!0,name:r.issuerUniqueID||""}),zh.schema(r.extensions||{},!0)]})}fromSchema(e){w(e,["version","holder","issuer","signature","serialNumber","attrCertValidityPeriod","attributes","issuerUniqueID","extensions"]);const t=Be(e,e,su.schema({names:{version:"version",holder:{names:{blockName:"holder"}},issuer:"issuer",signature:{names:{blockName:"signature"}},serialNumber:"serialNumber",attrCertValidityPeriod:{names:{blockName:"attrCertValidityPeriod"}},attributes:"attributes",issuerUniqueID:"issuerUniqueID",extensions:{names:{blockName:"extensions"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeCertificateInfoV2");if(this.version=t.result.version.valueBlock.valueDec,this.holder=new ru({schema:t.result.holder}),3!==t.result.issuer.idBlock.tagClass)throw new Error("Incorect value for 'issuer' in AttributeCertificateInfoV2");this.issuer=new tu({schema:new _({value:t.result.issuer.valueBlock.value})}),this.signature=new Ll({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new Yh({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,(e=>new ql({schema:e}))),"issuerUniqueID"in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),"extensions"in t.result&&(this.extensions=new zh({schema:t.result.extensions}))}toSchema(){const e=new _({value:[new q({value:this.version}),this.holder.toSchema(),new D({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new _({value:Array.from(this.attributes,(e=>e.toSchema()))})]});return"issuerUniqueID"in this&&e.valueBlock.value.push(this.issuerUniqueID),"extensions"in this&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,(e=>e.toJSON()))};return"issuerUniqueID"in this&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),"extensions"in this&&(e.extensions=this.extensions.toJSON()),e}}class nu{constructor(e={}){this.acinfo=t(e,"acinfo",nu.defaultValues("acinfo")),this.signatureAlgorithm=t(e,"signatureAlgorithm",nu.defaultValues("signatureAlgorithm")),this.signatureValue=t(e,"signatureValue",nu.defaultValues("signatureValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"acinfo":return new su;case"signatureAlgorithm":return new Ll;case"signatureValue":return new M;default:throw new Error(`Invalid member name for AttributeCertificateV2 class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[su.schema(r.acinfo||{}),Ll.schema(r.signatureAlgorithm||{}),new M({name:r.signatureValue||""})]})}fromSchema(e){w(e,["acinfo","signatureAlgorithm","signatureValue"]);const t=Be(e,e,nu.schema({names:{acinfo:{names:{blockName:"acinfo"}},signatureAlgorithm:{names:{blockName:"signatureAlgorithm"}},signatureValue:"signatureValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeCertificateV2");this.acinfo=new su({schema:t.result.acinfo}),this.signatureAlgorithm=new Ll({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new _({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}class iu{constructor(e={}){this.userCertificate=t(e,"userCertificate",iu.defaultValues("userCertificate")),this.revocationDate=t(e,"revocationDate",iu.defaultValues("revocationDate")),"crlEntryExtensions"in e&&(this.crlEntryExtensions=t(e,"crlEntryExtensions",iu.defaultValues("crlEntryExtensions"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"userCertificate":return new q;case"revocationDate":return new Sh;case"crlEntryExtensions":return new zh;default:throw new Error(`Invalid member name for RevokedCertificate class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.userCertificate||"userCertificate"}),Sh.schema({names:{utcTimeName:r.revocationDate||"revocationDate",generalTimeName:r.revocationDate||"revocationDate"}}),zh.schema({names:{blockName:r.crlEntryExtensions||"crlEntryExtensions"}},!0)]})}fromSchema(e){w(e,["userCertificate","revocationDate","crlEntryExtensions"]);const t=Be(e,e,iu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RevokedCertificate");this.userCertificate=t.result.userCertificate,this.revocationDate=new Sh({schema:t.result.revocationDate}),"crlEntryExtensions"in t.result&&(this.crlEntryExtensions=new zh({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return"crlEntryExtensions"in this&&e.push(this.crlEntryExtensions.toSchema()),new _({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON};return"crlEntryExtensions"in this&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}function au(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"tbsCertList",value:[new q({optional:!0,name:r.tbsCertListVersion||"tbsCertList.version",value:2}),Ll.schema(r.signature||{names:{blockName:"tbsCertList.signature"}}),ph.schema(r.issuer||{names:{blockName:"tbsCertList.issuer"}}),Sh.schema(r.tbsCertListThisUpdate||{names:{utcTimeName:"tbsCertList.thisUpdate",generalTimeName:"tbsCertList.thisUpdate"}}),Sh.schema(r.tbsCertListNextUpdate||{names:{utcTimeName:"tbsCertList.nextUpdate",generalTimeName:"tbsCertList.nextUpdate"}},!0),new _({optional:!0,value:[new Ce({name:r.tbsCertListRevokedCertificates||"tbsCertList.revokedCertificates",value:new _({value:[new q,Sh.schema(),zh.schema({},!0)]})})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[zh.schema(r.crlExtensions||{names:{blockName:"tbsCertList.extensions"}})]})]})}class ou{constructor(e={}){this.tbs=t(e,"tbs",ou.defaultValues("tbs")),this.version=t(e,"version",ou.defaultValues("version")),this.signature=t(e,"signature",ou.defaultValues("signature")),this.issuer=t(e,"issuer",ou.defaultValues("issuer")),this.thisUpdate=t(e,"thisUpdate",ou.defaultValues("thisUpdate")),"nextUpdate"in e&&(this.nextUpdate=t(e,"nextUpdate",ou.defaultValues("nextUpdate"))),"revokedCertificates"in e&&(this.revokedCertificates=t(e,"revokedCertificates",ou.defaultValues("revokedCertificates"))),"crlExtensions"in e&&(this.crlExtensions=t(e,"crlExtensions",ou.defaultValues("crlExtensions"))),this.signatureAlgorithm=t(e,"signatureAlgorithm",ou.defaultValues("signatureAlgorithm")),this.signatureValue=t(e,"signatureValue",ou.defaultValues("signatureValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 1;case"signature":case"signatureAlgorithm":return new Ll;case"issuer":return new ph;case"thisUpdate":case"nextUpdate":return new Sh;case"revokedCertificates":return[];case"crlExtensions":return new zh;case"signatureValue":return new M;default:throw new Error(`Invalid member name for CertificateRevocationList class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"CertificateList",value:[au(e),Ll.schema(r.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new M({name:r.signatureValue||"signatureValue"})]})}fromSchema(e){w(e,["tbsCertList","tbsCertList.version","tbsCertList.signature","tbsCertList.issuer","tbsCertList.thisUpdate","tbsCertList.nextUpdate","tbsCertList.revokedCertificates","tbsCertList.extensions","signatureAlgorithm","signatureValue"]);const t=Be(e,e,ou.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertificateRevocationList");this.tbs=t.result.tbsCertList.valueBeforeDecode,"tbsCertList.version"in t.result&&(this.version=t.result["tbsCertList.version"].valueBlock.valueDec),this.signature=new Ll({schema:t.result["tbsCertList.signature"]}),this.issuer=new ph({schema:t.result["tbsCertList.issuer"]}),this.thisUpdate=new Sh({schema:t.result["tbsCertList.thisUpdate"]}),"tbsCertList.nextUpdate"in t.result&&(this.nextUpdate=new Sh({schema:t.result["tbsCertList.nextUpdate"]})),"tbsCertList.revokedCertificates"in t.result&&(this.revokedCertificates=Array.from(t.result["tbsCertList.revokedCertificates"],(e=>new iu({schema:e})))),"tbsCertList.extensions"in t.result&&(this.crlExtensions=new zh({schema:t.result["tbsCertList.extensions"]})),this.signatureAlgorithm=new Ll({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==ou.defaultValues("version")&&e.push(new q({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),"nextUpdate"in this&&e.push(this.nextUpdate.toSchema()),"revokedCertificates"in this&&e.push(new _({value:Array.from(this.revokedCertificates,(e=>e.toSchema()))})),"crlExtensions"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new _({value:e})}toSchema(e=!1){let t;if(!1===e){if(0===this.tbs.length)return ou.schema();t=Ee(this.tbs).result}else t=this.encodeTBS();return new _({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:r(this.tbs,0,this.tbs.byteLength),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==ou.defaultValues("version")&&(e.version=this.version),"nextUpdate"in this&&(e.nextUpdate=this.nextUpdate.toJSON()),"revokedCertificates"in this&&(e.revokedCertificates=Array.from(this.revokedCertificates,(e=>e.toJSON()))),"crlExtensions"in this&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!1===this.issuer.isEqual(e.issuer))return!1;if("revokedCertificates"in this==!1)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}sign(e,t="SHA-1"){if(void 0===e)return Promise.reject("Need to provide a private key for signing");let r,s=Promise.resolve();const n=sh();return s=s.then((()=>n.subtle.getSignatureParameters(e,t))),s=s.then((e=>{r=e.parameters,this.signature=e.signatureAlgorithm,this.signatureAlgorithm=e.signatureAlgorithm})),s=s.then((()=>{this.tbs=this.encodeTBS().toBER(!1)})),s=s.then((()=>n.subtle.signWithPrivateKey(this.tbs,e,r))),s=s.then((e=>{this.signatureValue=new M({valueHex:e})})),s}verify(e={}){let t=Promise.resolve(),r=-1;const s=sh();if("issuerCertificate"in e&&(r=e.issuerCertificate.subjectPublicKeyInfo,!1===this.issuer.isEqual(e.issuerCertificate.subject)))return Promise.resolve(!1);if("publicKeyInfo"in e&&(r=e.publicKeyInfo),"subjectPublicKey"in r==!1)return Promise.reject("Issuer's certificate must be provided as an input parameter");if("crlExtensions"in this)for(const e of this.crlExtensions.extensions)if(e.critical&&"parsedValue"in e==!1)return Promise.resolve(!1);return t=t.then((()=>s.subtle.verifyWithPublicKey(this.tbs,this.signatureValue,r,this.signatureAlgorithm))),t}}class cu{constructor(e={}){this.otherCertFormat=t(e,"otherCertFormat",cu.defaultValues("otherCertFormat")),this.otherCert=t(e,"otherCert",cu.defaultValues("otherCert")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"otherCertFormat":return"";case"otherCert":return new ke;default:throw new Error(`Invalid member name for OtherCertificateFormat class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.otherCertFormat||"otherCertFormat"}),new ke({name:r.otherCert||"otherCert"})]})}fromSchema(e){w(e,["otherCertFormat","otherCert"]);const t=Be(e,e,cu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherCertificateFormat");this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new _({value:[new J({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof ke||(e.otherCert=this.otherCert.toJSON()),e}}class lu{constructor(e={}){this.certificates=t(e,"certificates",lu.defaultValues("certificates")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("certificates"===e)return[];throw new Error(`Invalid member name for Attribute class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new V({name:r.blockName||"",value:[new Ce({name:r.certificates||"certificates",value:new Ae({value:[$h.schema(),new D({idBlock:{tagClass:3,tagNumber:0},value:[new ke]}),new D({idBlock:{tagClass:3,tagNumber:1},value:[new _]}),new D({idBlock:{tagClass:3,tagNumber:2},value:nu.schema().valueBlock.value}),new D({idBlock:{tagClass:3,tagNumber:3},value:cu.schema().valueBlock.value})]})})]})}fromSchema(e){w(e,["certificates"]);const t=Be(e,e,lu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertificateSet");this.certificates=Array.from(t.result.certificates||[],(e=>{const t=e.idBlock.tagNumber;if(1===e.idBlock.tagClass)return new $h({schema:e});const r=new _({value:e.valueBlock.value});switch(t){case 1:return 1===r.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec?new nu({schema:r}):new Zh({schema:r});case 2:return new nu({schema:r});case 3:return new cu({schema:r})}return e}))}toSchema(){return new V({value:Array.from(this.certificates,(e=>{switch(!0){case e instanceof $h:return e.toSchema();case e instanceof Zh:return new D({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof nu:return new D({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof cu:return new D({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e}))})}toJSON(){return{certificates:Array.from(this.certificates,(e=>e.toJSON()))}}}class hu{constructor(e={}){this.otherRevInfoFormat=t(e,"otherRevInfoFormat",hu.defaultValues("otherRevInfoFormat")),this.otherRevInfo=t(e,"otherRevInfo",hu.defaultValues("otherRevInfo")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"otherRevInfoFormat":return"";case"otherRevInfo":return new ke;default:throw new Error(`Invalid member name for OtherRevocationInfoFormat class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.otherRevInfoFormat||"otherRevInfoFormat"}),new ke({name:r.otherRevInfo||"otherRevInfo"})]})}fromSchema(e){w(e,["otherRevInfoFormat","otherRevInfo"]);const t=Be(e,e,hu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherRevocationInfoFormat");this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new _({value:[new J({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof ke||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}class uu{constructor(e={}){this.crls=t(e,"crls",uu.defaultValues("crls")),this.otherRevocationInfos=t(e,"otherRevocationInfos",uu.defaultValues("otherRevocationInfos")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"crls":case"otherRevocationInfos":return[];default:throw new Error(`Invalid member name for RevocationInfoChoices class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new V({name:r.blockName||"",value:[new Ce({name:r.crls||"",value:new Ae({value:[ou.schema(),new D({idBlock:{tagClass:3,tagNumber:1},value:[new J,new ke]})]})})]})}fromSchema(e){w(e,["crls"]);const t=Be(e,e,uu.schema({names:{crls:"crls"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RevocationInfoChoices");for(const e of t.result.crls)1===e.idBlock.tagClass?this.crls.push(new ou({schema:e})):this.otherRevocationInfos.push(new hu({schema:e}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,(e=>e.toSchema()))),e.push(...Array.from(this.otherRevocationInfos,(e=>{const t=e.toSchema();return t.idBlock.tagClass=3,t.idBlock.tagNumber=1,t}))),new V({value:e})}toJSON(){return{crls:Array.from(this.crls,(e=>e.toJSON())),otherRevocationInfos:Array.from(this.otherRevocationInfos,(e=>e.toJSON()))}}}class pu{constructor(e={}){"certs"in e&&(this.certs=t(e,"certs",pu.defaultValues("certs"))),"crls"in e&&(this.crls=t(e,"crls",pu.defaultValues("crls"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"certs":return new lu;case"crls":return new uu;default:throw new Error(`Invalid member name for OriginatorInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"certs":return 0===t.certificates.length;case"crls":return 0===t.crls.length&&0===t.otherRevocationInfos.length;default:throw new Error(`Invalid member name for OriginatorInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new D({name:r.certs||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:lu.schema().valueBlock.value}),new D({name:r.crls||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:uu.schema().valueBlock.value})]})}fromSchema(e){w(e,["certs","crls"]);const t=Be(e,e,pu.schema({names:{certs:"certs",crls:"crls"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OriginatorInfo");"certs"in t.result&&(this.certs=new lu({schema:new V({value:t.result.certs.valueBlock.value})})),"crls"in t.result&&(this.crls=new uu({schema:new V({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return"certs"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),"crls"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new _({value:e})}toJSON(){const e={};return"certs"in this&&(e.certs=this.certs.toJSON()),"crls"in this&&(e.crls=this.crls.toJSON()),e}}class du{constructor(e={}){this.issuer=t(e,"issuer",du.defaultValues("issuer")),this.serialNumber=t(e,"serialNumber",du.defaultValues("serialNumber")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"issuer":return new ph;case"serialNumber":return new q;default:throw new Error(`Invalid member name for IssuerAndSerialNumber class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[ph.schema(r.issuer||{}),new q({name:r.serialNumber||""})]})}fromSchema(e){w(e,["issuer","serialNumber"]);const t=Be(e,e,du.schema({names:{issuer:{names:{blockName:"issuer"}},serialNumber:"serialNumber"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for IssuerAndSerialNumber");this.issuer=new ph({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new _({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}class fu{constructor(e={}){this.variant=t(e,"variant",fu.defaultValues("variant")),"value"in e&&(this.value=t(e,"value",fu.defaultValues("value"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error(`Invalid member name for RecipientIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"variant":return-1===t;case"values":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for RecipientIdentifier class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new Ae({value:[du.schema({names:{blockName:r.blockName||""}}),new N({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){w(e,["blockName"]);const t=Be(e,e,fu.schema({names:{blockName:"blockName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RecipientIdentifier");1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new du({schema:t.result.blockName})):(this.variant=2,this.value=new j({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new N({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHex});default:return new ke}}toJSON(){const e={variant:this.variant};return 1!==this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e}}class mu{constructor(e={}){this.version=t(e,"version",mu.defaultValues("version")),this.rid=t(e,"rid",mu.defaultValues("rid")),this.keyEncryptionAlgorithm=t(e,"keyEncryptionAlgorithm",mu.defaultValues("keyEncryptionAlgorithm")),this.encryptedKey=t(e,"encryptedKey",mu.defaultValues("encryptedKey")),this.recipientCertificate=t(e,"recipientCertificate",mu.defaultValues("recipientCertificate")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return-1;case"rid":return{};case"keyEncryptionAlgorithm":return new Ll;case"encryptedKey":return new j;case"recipientCertificate":return new $h;default:throw new Error(`Invalid member name for KeyTransRecipientInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return t===mu.defaultValues("version");case"rid":return 0===Object.keys(t).length;case"keyEncryptionAlgorithm":case"encryptedKey":return t.isEqual(mu.defaultValues(e));case"recipientCertificate":return!1;default:throw new Error(`Invalid member name for KeyTransRecipientInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),fu.schema(r.rid||{}),Ll.schema(r.keyEncryptionAlgorithm||{}),new j({name:r.encryptedKey||""})]})}fromSchema(e){w(e,["version","rid","keyEncryptionAlgorithm","encryptedKey"]);const t=Be(e,e,mu.schema({names:{version:"version",rid:{names:{blockName:"rid"}},keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for KeyTransRecipientInfo");this.version=t.result.version.valueBlock.valueDec,3===t.result.rid.idBlock.tagClass?this.rid=new j({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new du({schema:t.result.rid}),this.keyEncryptionAlgorithm=new Ll({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof du?(this.version=0,e.push(new q({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new q({value:this.version})),e.push(new N({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHex}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new _({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}class gu{constructor(e={}){this.algorithm=t(e,"algorithm",gu.defaultValues("algorithm")),this.publicKey=t(e,"publicKey",gu.defaultValues("publicKey")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"algorithm":return new Ll;case"publicKey":return new M;default:throw new Error(`Invalid member name for OriginatorPublicKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"algorithm":case"publicKey":return t.isEqual(gu.defaultValues(e));default:throw new Error(`Invalid member name for OriginatorPublicKey class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Ll.schema(r.algorithm||{}),new M({name:r.publicKey||""})]})}fromSchema(e){w(e,["algorithm","publicKey"]);const t=Be(e,e,gu.schema({names:{algorithm:{names:{blockName:"algorithm"}},publicKey:"publicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OriginatorPublicKey");this.algorithm=new Ll({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new _({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}class yu{constructor(e={}){this.variant=t(e,"variant",yu.defaultValues("variant")),"value"in e&&(this.value=t(e,"value",yu.defaultValues("value"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error(`Invalid member name for OriginatorIdentifierOrKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"variant":return-1===t;case"value":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for OriginatorIdentifierOrKey class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new Ae({value:[du.schema({names:{blockName:r.blockName||""}}),new N({idBlock:{tagClass:3,tagNumber:0},name:r.blockName||""}),new D({idBlock:{tagClass:3,tagNumber:1},name:r.blockName||"",value:gu.schema().valueBlock.value})]})}fromSchema(e){w(e,["blockName"]);const t=Be(e,e,yu.schema({names:{blockName:"blockName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OriginatorIdentifierOrKey");1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new du({schema:t.result.blockName})):0===t.result.blockName.idBlock.tagNumber?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new gu({schema:new _({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new ke}}toJSON(){const e={variant:this.variant};return 1!==this.variant&&2!==this.variant&&3!==this.variant||(e.value=this.value.toJSON()),e}}class vu{constructor(e={}){this.keyAttrId=t(e,"keyAttrId",vu.defaultValues("keyAttrId")),"keyAttr"in e&&(this.keyAttr=t(e,"keyAttr",vu.defaultValues("keyAttr"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyAttrId":return"";case"keyAttr":return{};default:throw new Error(`Invalid member name for OtherKeyAttribute class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"keyAttrId":return""===t;case"keyAttr":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for OtherKeyAttribute class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({optional:r.optional||!0,name:r.blockName||"",value:[new J({name:r.keyAttrId||""}),new ke({optional:!0,name:r.keyAttr||""})]})}fromSchema(e){w(e,["keyAttrId","keyAttr"]);const t=Be(e,e,vu.schema({names:{keyAttrId:"keyAttrId",keyAttr:"keyAttr"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherKeyAttribute");this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),"keyAttr"in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new J({value:this.keyAttrId})),"keyAttr"in this&&e.push(this.keyAttr),new _({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return"keyAttr"in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}class wu{constructor(e={}){this.subjectKeyIdentifier=t(e,"subjectKeyIdentifier",wu.defaultValues("subjectKeyIdentifier")),"date"in e&&(this.date=t(e,"date",wu.defaultValues("date"))),"other"in e&&(this.other=t(e,"other",wu.defaultValues("other"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"subjectKeyIdentifier":return new j;case"date":return new ge;case"other":return new vu;default:throw new Error(`Invalid member name for RecipientKeyIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"subjectKeyIdentifier":return t.isEqual(wu.defaultValues("subjectKeyIdentifier"));case"date":return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case"other":return""===t.keyAttrId&&"keyAttr"in t==!1;default:throw new Error(`Invalid member name for RecipientKeyIdentifier class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new j({name:r.subjectKeyIdentifier||""}),new ge({optional:!0,name:r.date||""}),vu.schema(r.other||{})]})}fromSchema(e){w(e,["subjectKeyIdentifier","date","other"]);const t=Be(e,e,wu.schema({names:{subjectKeyIdentifier:"subjectKeyIdentifier",date:"date",other:{names:{blockName:"other"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RecipientKeyIdentifier");this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,"date"in t.result&&(this.date=t.result.date),"other"in t.result&&(this.other=new vu({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),"date"in this&&e.push(this.date),"other"in this&&e.push(this.other.toSchema()),new _({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e}}class bu{constructor(e={}){this.variant=t(e,"variant",bu.defaultValues("variant")),this.value=t(e,"value",bu.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error(`Invalid member name for KeyAgreeRecipientIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"variant":return-1===t;case"value":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for KeyAgreeRecipientIdentifier class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new Ae({value:[du.schema(r.issuerAndSerialNumber||{names:{blockName:r.blockName||""}}),new D({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:0},value:wu.schema(r.rKeyId||{names:{blockName:r.blockName||""}}).valueBlock.value})]})}fromSchema(e){w(e,["blockName"]);const t=Be(e,e,bu.schema({names:{blockName:"blockName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientIdentifier");1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new du({schema:t.result.blockName})):(this.variant=2,this.value=new wu({schema:new _({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new D({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new ke}}toJSON(){const e={variant:this.variant};return 1!==this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e}}class Su{constructor(e={}){this.rid=t(e,"rid",Su.defaultValues("rid")),this.encryptedKey=t(e,"encryptedKey",Su.defaultValues("encryptedKey")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"rid":return new bu;case"encryptedKey":return new j;default:throw new Error(`Invalid member name for RecipientEncryptedKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"rid":return-1===t.variant&&"value"in t==!1;case"encryptedKey":return t.isEqual(Su.defaultValues("encryptedKey"));default:throw new Error(`Invalid member name for RecipientEncryptedKey class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[bu.schema(r.rid||{}),new j({name:r.encryptedKey||""})]})}fromSchema(e){w(e,["rid","encryptedKey"]);const t=Be(e,e,Su.schema({names:{rid:{names:{blockName:"rid"}},encryptedKey:"encryptedKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKey");this.rid=new bu({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new _({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}class Au{constructor(e={}){this.encryptedKeys=t(e,"encryptedKeys",Au.defaultValues("encryptedKeys")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("encryptedKeys"===e)return[];throw new Error(`Invalid member name for RecipientEncryptedKeys class: ${e}`)}static compareWithDefault(e,t){if("encryptedKeys"===e)return 0===t.length;throw new Error(`Invalid member name for RecipientEncryptedKeys class: ${e}`)}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new Ce({name:r.RecipientEncryptedKeys||"",value:Su.schema()})]})}fromSchema(e){w(e,["RecipientEncryptedKeys"]);const t=Be(e,e,Au.schema({names:{RecipientEncryptedKeys:"RecipientEncryptedKeys"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKeys");this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,(e=>new Su({schema:e})))}toSchema(){return new _({value:Array.from(this.encryptedKeys,(e=>e.toSchema()))})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,(e=>e.toJSON()))}}}class ku{constructor(e={}){this.version=t(e,"version",ku.defaultValues("version")),this.originator=t(e,"originator",ku.defaultValues("originator")),"ukm"in e&&(this.ukm=t(e,"ukm",ku.defaultValues("ukm"))),this.keyEncryptionAlgorithm=t(e,"keyEncryptionAlgorithm",ku.defaultValues("keyEncryptionAlgorithm")),this.recipientEncryptedKeys=t(e,"recipientEncryptedKeys",ku.defaultValues("recipientEncryptedKeys")),this.recipientCertificate=t(e,"recipientCertificate",ku.defaultValues("recipientCertificate")),this.recipientPublicKey=t(e,"recipientPublicKey",ku.defaultValues("recipientPublicKey")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 0;case"originator":return new yu;case"ukm":return new j;case"keyEncryptionAlgorithm":return new Ll;case"recipientEncryptedKeys":return new Au;case"recipientCertificate":return new $h;case"recipientPublicKey":return null;default:throw new Error(`Invalid member name for KeyAgreeRecipientInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return 0===t;case"originator":return-1===t.variant&&"value"in t==!1;case"ukm":return t.isEqual(ku.defaultValues("ukm"));case"keyEncryptionAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==!1;case"recipientEncryptedKeys":return 0===t.encryptedKeys.length;case"recipientCertificate":case"recipientPublicKey":return!1;default:throw new Error(`Invalid member name for KeyAgreeRecipientInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),new D({idBlock:{tagClass:3,tagNumber:0},value:[yu.schema(r.originator||{})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new j({name:r.ukm||""})]}),Ll.schema(r.keyEncryptionAlgorithm||{}),Au.schema(r.recipientEncryptedKeys||{})]})}fromSchema(e){w(e,["version","originator","ukm","keyEncryptionAlgorithm","recipientEncryptedKeys"]);const t=Be(e,e,ku.schema({names:{version:"version",originator:{names:{blockName:"originator"}},ukm:"ukm",keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},recipientEncryptedKeys:{names:{blockName:"recipientEncryptedKeys"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientInfo");this.version=t.result.version.valueBlock.valueDec,this.originator=new yu({schema:t.result.originator}),"ukm"in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new Ll({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new Au({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),"ukm"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new _({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON()};return"ukm"in this&&(e.ukm=this.ukm.toJSON()),e.keyEncryptionAlgorithm=this.keyEncryptionAlgorithm.toJSON(),e.recipientEncryptedKeys=this.recipientEncryptedKeys.toJSON(),e}}class Cu{constructor(e={}){this.keyIdentifier=t(e,"keyIdentifier",Cu.defaultValues("keyIdentifier")),"date"in e&&(this.date=t(e,"date",Cu.defaultValues("date"))),"other"in e&&(this.other=t(e,"other",Cu.defaultValues("other"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyIdentifier":return new j;case"date":return new ge;case"other":return new vu;default:throw new Error(`Invalid member name for KEKIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"keyIdentifier":return t.isEqual(Cu.defaultValues("keyIdentifier"));case"date":return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case"other":return t.compareWithDefault("keyAttrId",t.keyAttrId)&&"keyAttr"in t==!1;default:throw new Error(`Invalid member name for KEKIdentifier class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new j({name:r.keyIdentifier||""}),new ge({optional:!0,name:r.date||""}),vu.schema(r.other||{})]})}fromSchema(e){w(e,["keyIdentifier","date","other"]);const t=Be(e,e,Cu.schema({names:{keyIdentifier:"keyIdentifier",date:"date",other:{names:{blockName:"other"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for KEKIdentifier");this.keyIdentifier=t.result.keyIdentifier,"date"in t.result&&(this.date=t.result.date),"other"in t.result&&(this.other=new vu({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),"date"in this&&e.push(this.date),"other"in this&&e.push(this.other.toSchema()),new _({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e}}class Iu{constructor(e={}){this.version=t(e,"version",Iu.defaultValues("version")),this.kekid=t(e,"kekid",Iu.defaultValues("kekid")),this.keyEncryptionAlgorithm=t(e,"keyEncryptionAlgorithm",Iu.defaultValues("keyEncryptionAlgorithm")),this.encryptedKey=t(e,"encryptedKey",Iu.defaultValues("encryptedKey")),this.preDefinedKEK=t(e,"preDefinedKEK",Iu.defaultValues("preDefinedKEK")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 0;case"kekid":return new Cu;case"keyEncryptionAlgorithm":return new Ll;case"encryptedKey":return new j;case"preDefinedKEK":return new ArrayBuffer(0);default:throw new Error(`Invalid member name for KEKRecipientInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Iu.defaultValues("version");case"kekid":return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&"date"in t==!1&&"other"in t==!1;case"keyEncryptionAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==!1;case"encryptedKey":return t.isEqual(Iu.defaultValues("encryptedKey"));case"preDefinedKEK":return 0===t.byteLength;default:throw new Error(`Invalid member name for KEKRecipientInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),Cu.schema(r.kekid||{}),Ll.schema(r.keyEncryptionAlgorithm||{}),new j({name:r.encryptedKey||""})]})}fromSchema(e){w(e,["version","kekid","keyEncryptionAlgorithm","encryptedKey"]);const t=Be(e,e,Iu.schema({names:{version:"version",kekid:{names:{blockName:"kekid"}},keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for KEKRecipientInfo");this.version=t.result.version.valueBlock.valueDec,this.kekid=new Cu({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new Ll({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new _({value:[new q({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}class xu{constructor(e={}){this.version=t(e,"version",xu.defaultValues("version")),"keyDerivationAlgorithm"in e&&(this.keyDerivationAlgorithm=t(e,"keyDerivationAlgorithm",xu.defaultValues("keyDerivationAlgorithm"))),this.keyEncryptionAlgorithm=t(e,"keyEncryptionAlgorithm",xu.defaultValues("keyEncryptionAlgorithm")),this.encryptedKey=t(e,"encryptedKey",xu.defaultValues("encryptedKey")),this.password=t(e,"password",xu.defaultValues("password")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return-1;case"keyDerivationAlgorithm":case"keyEncryptionAlgorithm":return new Ll;case"encryptedKey":return new j;case"password":return new ArrayBuffer(0);default:throw new Error(`Invalid member name for PasswordRecipientinfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return-1===t;case"keyDerivationAlgorithm":case"keyEncryptionAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==!1;case"encryptedKey":return t.isEqual(xu.defaultValues("encryptedKey"));case"password":return 0===t.byteLength;default:throw new Error(`Invalid member name for PasswordRecipientinfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),new D({name:r.keyDerivationAlgorithm||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ll.schema().valueBlock.value}),Ll.schema(r.keyEncryptionAlgorithm||{}),new j({name:r.encryptedKey||""})]})}fromSchema(e){w(e,["version","keyDerivationAlgorithm","keyEncryptionAlgorithm","encryptedKey"]);const t=Be(e,e,xu.schema({names:{version:"version",keyDerivationAlgorithm:"keyDerivationAlgorithm",keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PasswordRecipientinfo");this.version=t.result.version.valueBlock.valueDec,"keyDerivationAlgorithm"in t.result&&(this.keyDerivationAlgorithm=new Ll({schema:new _({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new Ll({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new q({value:this.version})),"keyDerivationAlgorithm"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new _({value:e})}toJSON(){return{version:this.version,keyDerivationAlgorithm:this.keyDerivationAlgorithm.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}class Eu{constructor(e={}){this.oriType=t(e,"oriType",Eu.defaultValues("oriType")),this.oriValue=t(e,"oriValue",Eu.defaultValues("oriValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"oriType":return"";case"oriValue":return{};default:throw new Error(`Invalid member name for OtherRecipientInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"oriType":return""===t;case"oriValue":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for OtherRecipientInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.oriType||""}),new ke({name:r.oriValue||""})]})}fromSchema(e){w(e,["oriType","oriValue"]);const t=Be(e,e,Eu.schema({names:{oriType:"oriType",oriValue:"oriValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherRecipientInfo");this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new _({value:[new J({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return!1===Eu.compareWithDefault("oriValue",this.oriValue)&&(e.oriValue=this.oriValue.toJSON()),e}}class Bu{constructor(e={}){this.variant=t(e,"variant",Bu.defaultValues("variant")),"value"in e&&(this.value=t(e,"value",Bu.defaultValues("value"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error(`Invalid member name for RecipientInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"variant":return t===Bu.defaultValues(e);case"value":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for RecipientInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new Ae({value:[mu.schema({names:{blockName:r.blockName||""}}),new D({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:1},value:ku.schema().valueBlock.value}),new D({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:2},value:Iu.schema().valueBlock.value}),new D({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:3},value:xu.schema().valueBlock.value}),new D({name:r.blockName||"",idBlock:{tagClass:3,tagNumber:4},value:Eu.schema().valueBlock.value})]})}fromSchema(e){w(e,["blockName"]);const t=Be(e,e,Bu.schema({names:{blockName:"blockName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RecipientInfo");if(1===t.result.blockName.idBlock.tagClass)this.variant=1,this.value=new mu({schema:t.result.blockName});else{const e=new _({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new ku({schema:e});break;case 2:this.variant=3,this.value=new Iu({schema:e});break;case 3:this.variant=4,this.value=new xu({schema:e});break;case 4:this.variant=5,this.value=new Eu({schema:e});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new ke}}toJSON(){const e={variant:this.variant};return this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}class Nu{constructor(e={}){this.hashAlgorithm=t(e,"hashAlgorithm",Nu.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=t(e,"maskGenAlgorithm",Nu.defaultValues("maskGenAlgorithm")),this.pSourceAlgorithm=t(e,"pSourceAlgorithm",Nu.defaultValues("pSourceAlgorithm")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"hashAlgorithm":return new Ll({algorithmId:"1.3.14.3.2.26",algorithmParams:new F});case"maskGenAlgorithm":return new Ll({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Ll({algorithmId:"1.3.14.3.2.26",algorithmParams:new F}).toSchema()});case"pSourceAlgorithm":return new Ll({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new j({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:throw new Error(`Invalid member name for RSAESOAEPParams class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new D({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Ll.schema(r.hashAlgorithm||{})]}),new D({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Ll.schema(r.maskGenAlgorithm||{})]}),new D({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[Ll.schema(r.pSourceAlgorithm||{})]})]})}fromSchema(e){w(e,["hashAlgorithm","maskGenAlgorithm","pSourceAlgorithm"]);const t=Be(e,e,Nu.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},pSourceAlgorithm:{names:{blockName:"pSourceAlgorithm"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAESOAEPParams");"hashAlgorithm"in t.result&&(this.hashAlgorithm=new Ll({schema:t.result.hashAlgorithm})),"maskGenAlgorithm"in t.result&&(this.maskGenAlgorithm=new Ll({schema:t.result.maskGenAlgorithm})),"pSourceAlgorithm"in t.result&&(this.pSourceAlgorithm=new Ll({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Nu.defaultValues("hashAlgorithm"))||e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Nu.defaultValues("maskGenAlgorithm"))||e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(Nu.defaultValues("pSourceAlgorithm"))||e.push(new D({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new _({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Nu.defaultValues("hashAlgorithm"))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Nu.defaultValues("maskGenAlgorithm"))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(Nu.defaultValues("pSourceAlgorithm"))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}class Pu{constructor(e={}){this.keyInfo=t(e,"keyInfo",Pu.defaultValues("keyInfo")),"entityUInfo"in e&&(this.entityUInfo=t(e,"entityUInfo",Pu.defaultValues("entityUInfo"))),this.suppPubInfo=t(e,"suppPubInfo",Pu.defaultValues("suppPubInfo")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyInfo":return new Ll;case"entityUInfo":case"suppPubInfo":return new j;default:throw new Error(`Invalid member name for ECCCMSSharedInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"keyInfo":case"entityUInfo":case"suppPubInfo":return t.isEqual(Pu.defaultValues(e));default:throw new Error(`Invalid member name for ECCCMSSharedInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Ll.schema(r.keyInfo||{}),new D({name:r.entityUInfo||"",idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new j]}),new D({name:r.suppPubInfo||"",idBlock:{tagClass:3,tagNumber:2},value:[new j]})]})}fromSchema(e){w(e,["keyInfo","entityUInfo","suppPubInfo"]);const t=Be(e,e,Pu.schema({names:{keyInfo:{names:{blockName:"keyInfo"}},entityUInfo:"entityUInfo",suppPubInfo:"suppPubInfo"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ECCCMSSharedInfo");this.keyInfo=new Ll({schema:t.result.keyInfo}),"entityUInfo"in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),"entityUInfo"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new D({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new _({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON()};return"entityUInfo"in this&&(e.entityUInfo=this.entityUInfo.toJSON()),e.suppPubInfo=this.suppPubInfo.toJSON(),e}}const Du={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},Uu={"P-256":256,"P-384":384,"P-521":528};class Ou{constructor(e={}){this.version=t(e,"version",Ou.defaultValues("version")),"originatorInfo"in e&&(this.originatorInfo=t(e,"originatorInfo",Ou.defaultValues("originatorInfo"))),this.recipientInfos=t(e,"recipientInfos",Ou.defaultValues("recipientInfos")),this.encryptedContentInfo=t(e,"encryptedContentInfo",Ou.defaultValues("encryptedContentInfo")),"unprotectedAttrs"in e&&(this.unprotectedAttrs=t(e,"unprotectedAttrs",Ou.defaultValues("unprotectedAttrs"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 0;case"originatorInfo":return new pu;case"recipientInfos":case"unprotectedAttrs":return[];case"encryptedContentInfo":return new $l;default:throw new Error(`Invalid member name for EnvelopedData class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return t===Ou.defaultValues(e);case"originatorInfo":return 0===t.certs.certificates.length&&0===t.crls.crls.length;case"recipientInfos":case"unprotectedAttrs":return 0===t.length;case"encryptedContentInfo":return $l.compareWithDefault("contentType",t.contentType)&&$l.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&$l.compareWithDefault("encryptedContent",t.encryptedContent);default:throw new Error(`Invalid member name for EnvelopedData class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new q({name:r.version||""}),new D({name:r.originatorInfo||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:pu.schema().valueBlock.value}),new V({value:[new Ce({name:r.recipientInfos||"",value:Bu.schema()})]}),$l.schema(r.encryptedContentInfo||{}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ce({name:r.unprotectedAttrs||"",value:ql.schema()})]})]})}fromSchema(e){w(e,["version","originatorInfo","recipientInfos","encryptedContentInfo","unprotectedAttrs"]);const t=Be(e,e,Ou.schema({names:{version:"version",originatorInfo:"originatorInfo",recipientInfos:"recipientInfos",encryptedContentInfo:{names:{blockName:"encryptedContentInfo"}},unprotectedAttrs:"unprotectedAttrs"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for EnvelopedData");this.version=t.result.version.valueBlock.valueDec,"originatorInfo"in t.result&&(this.originatorInfo=new pu({schema:new _({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,(e=>new Bu({schema:e}))),this.encryptedContentInfo=new $l({schema:t.result.encryptedContentInfo}),"unprotectedAttrs"in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,(e=>new ql({schema:e}))))}toSchema(){const e=[];return e.push(new q({value:this.version})),"originatorInfo"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new V({value:Array.from(this.recipientInfos,(e=>e.toSchema()))})),e.push(this.encryptedContentInfo.toSchema()),"unprotectedAttrs"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,(e=>e.toSchema()))})),new _({value:e})}toJSON(){const e={version:this.version};return"originatorInfo"in this&&(e.originatorInfo=this.originatorInfo.toJSON()),e.recipientInfos=Array.from(this.recipientInfos,(e=>e.toJSON())),e.encryptedContentInfo=this.encryptedContentInfo.toJSON(),"unprotectedAttrs"in this&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,(e=>e.toJSON()))),e}addRecipientByCertificate(e,t,r){const s=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},Du,t||{});if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))r=1;else{if(-1===e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))throw new Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);r=2}switch(r){case 1:{let t,r;if(!0===s.useOAEP){if(t=ah({name:"RSA-OAEP"}),""===t)throw new Error("Can not find OID for RSA-OAEP");const e=ah({name:s.oaepHashAlgorithm});if(""===e)throw new Error(`Unknown OAEP hash algorithm: ${s.oaepHashAlgorithm}`);const n=new Ll({algorithmId:e,algorithmParams:new F});r=new Nu({hashAlgorithm:n,maskGenAlgorithm:new Ll({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:n.toSchema()})}).toSchema()}else{if(t=ah({name:"RSAES-PKCS1-v1_5"}),""===t)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");r=new F}const n=new mu({version:0,rid:new du({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new Ll({algorithmId:t,algorithmParams:r}),recipientCertificate:e});this.recipientInfos.push(new Bu({variant:1,value:n}))}break;case 2:{const t=new bu({variant:1,value:new du({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(t,s,{recipientCertificate:e})}break;default:throw new Error(`Unknown "variant" value: ${r}`)}return!0}addRecipientByPreDefinedData(e,t,r){const s=t||{};if(e instanceof ArrayBuffer==!1)throw new Error('Please pass "preDefinedData" in ArrayBuffer type');if(0===e.byteLength)throw new Error("Pre-defined data could have zero length");if("keyIdentifier"in s==!1){const e=new ArrayBuffer(16);ih(new Uint8Array(e)),s.keyIdentifier=e}switch("hmacHashAlgorithm"in s==!1&&(s.hmacHashAlgorithm="SHA-512"),"iterationCount"in s==!1&&(s.iterationCount=2048),"keyEncryptionAlgorithm"in s==!1&&(s.keyEncryptionAlgorithm={name:"AES-KW",length:256}),"keyEncryptionAlgorithmParams"in s==!1&&(s.keyEncryptionAlgorithmParams=new F),r){case 1:{const t=ah(s.keyEncryptionAlgorithm);if(""===t)throw new Error('Incorrect value for "keyEncryptionAlgorithm"');const r=new Iu({version:4,kekid:new Cu({keyIdentifier:new j({valueHex:s.keyIdentifier})}),keyEncryptionAlgorithm:new Ll({algorithmId:t,algorithmParams:s.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new Bu({variant:3,value:r}))}break;case 2:{const t=ah({name:"PBKDF2"});if(""===t)throw new Error("Can not find OID for PBKDF2");const r=new ArrayBuffer(64);ih(new Uint8Array(r));const n=ah({name:"HMAC",hash:{name:s.hmacHashAlgorithm}});if(""===n)throw new Error(`Incorrect value for "hmacHashAlgorithm": ${s.hmacHashAlgorithm}`);const i=new Xl({salt:new j({valueHex:r}),iterationCount:s.iterationCount,prf:new Ll({algorithmId:n,algorithmParams:new F})}),a=ah(s.keyEncryptionAlgorithm);if(""===a)throw new Error('Incorrect value for "keyEncryptionAlgorithm"');const o=new xu({version:0,keyDerivationAlgorithm:new Ll({algorithmId:t,algorithmParams:i.toSchema()}),keyEncryptionAlgorithm:new Ll({algorithmId:a,algorithmParams:s.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new Bu({variant:4,value:o}))}break;default:throw new Error(`Unknown value for "variant": ${r}`)}}addRecipientByKeyIdentifier(e,t,r){const s=Object.assign({},Du,r||{}),n=new bu({variant:2,value:new wu({subjectKeyIdentifier:new j({valueHex:t})})});this._addKeyAgreeRecipientInfo(n,s,{recipientPublicKey:e})}_addKeyAgreeRecipientInfo(e,t,r){const s=new Su({rid:e}),n=ah({name:"AES-KW",length:t.kekEncryptionLength});if(""===n)throw new Error(`Unknown length for key encryption algorithm: ${t.kekEncryptionLength}`);const i=new Ll({algorithmId:n}),a=ah({name:"ECDH",kdf:t.kdfAlgorithm});if(""===a)throw new Error(`Unknown KDF algorithm: ${t.kdfAlgorithm}`);const o=new ArrayBuffer(64);ih(new Uint8Array(o));const c={version:3,ukm:new j({valueHex:o}),keyEncryptionAlgorithm:new Ll({algorithmId:a,algorithmParams:i.toSchema()}),recipientEncryptedKeys:new Au({encryptedKeys:[s]})},l=new ku(Object.assign(c,r));this.recipientInfos.push(new Bu({variant:2,value:l}))}encrypt(e,t){let r=Promise.resolve();const s=new ArrayBuffer(16),n=new Uint8Array(s);ih(n);const i=new Uint8Array(t);let a,o,c;const l=[],h=this,u=ah(e);if(""===u)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');const p=nh();if(void 0===p)return Promise.reject("Unable to create WebCrypto object");function d(e){let t=Promise.resolve();const r=h.recipientInfos[e];let s,n,i,o,c,l;return t=t.then((()=>{if(r.value.recipientPublicKey)return o=r.value.recipientPublicKey.algorithm.namedCurve,r.value.recipientPublicKey;{const t=r.value.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(t.constructor.blockName()!==J.blockName())return Promise.reject(`Incorrect "recipientCertificate" for index ${e}`);switch(t.valueBlock.toString()){case"1.2.840.10045.3.1.7":o="P-256";break;case"1.3.132.0.34":o="P-384";break;case"1.3.132.0.35":o="P-521";break;default:return Promise.reject(`Incorrect curve OID for index ${e}`)}return r.value.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:o},usages:[]}})}}),(e=>Promise.reject(e))),t=t.then((e=>(i=e,c=Uu[o],p.generateKey({name:"ECDH",namedCurve:o},!0,["deriveBits"]))),(e=>Promise.reject(e))),t=t.then((e=>(s=e.publicKey,n=e.privateKey,p.exportKey("spki",s))),(e=>Promise.reject(e))),t=t.then((e=>{l=e}),(e=>Promise.reject(e))),t=t.then((()=>p.deriveBits({name:"ECDH",public:i},n,c)),(e=>Promise.reject(e))),t=t.then((e=>{const t=new Ll({schema:r.value.keyEncryptionAlgorithm.algorithmParams}),s=ch(t.algorithmId);if("name"in s==!1)return Promise.reject(`Incorrect OID for key encryption algorithm: ${t.algorithmId}`);let n=s.length;const i=new ArrayBuffer(4),a=new Uint8Array(i);for(let e=3;e>=0;e--)a[e]=n,n>>=8;const o=new Pu({keyInfo:new Ll({algorithmId:t.algorithmId}),entityUInfo:r.value.ukm,suppPubInfo:new j({valueHex:i})}).toSchema().toBER(!1),c=ch(r.value.keyEncryptionAlgorithm.algorithmId);return"name"in c==!1?Promise.reject(`Incorrect OID for key encryption algorithm: ${r.value.keyEncryptionAlgorithm.algorithmId}`):hh(c.kdf,e,s.length,o)}),(e=>Promise.reject(e))),t=t.then((e=>p.importKey("raw",e,{name:"AES-KW"},!0,["wrapKey"])),(e=>Promise.reject(e))),t=t.then((e=>p.wrapKey("raw",a,e,{name:"AES-KW"})),(e=>Promise.reject(e))),t=t.then((e=>{const t=Ee(l),s=new yu;return s.variant=3,s.value=new gu({schema:t.result}),r.value.originator=s,r.value.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new j({valueHex:e}),{ecdhPrivateKey:n}}),(e=>Promise.reject(e))),t}async function f(e){const t=ch(h.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId);if("name"in t==!1)throw new Error(`Unknown keyEncryptionAlgorithm: ${h.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId}`);if("RSA-OAEP"===t.name){const r=h.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmParams,s=new Nu({schema:r});if(t.hash=ch(s.hashAlgorithm.algorithmId),"name"in t.hash==!1)throw new Error(`Incorrect OID for hash algorithm: ${s.hashAlgorithm.algorithmId}`)}try{const r=await h.recipientInfos[e].value.recipientCertificate.getPublicKey({algorithm:{algorithm:t,usages:["encrypt","wrapKey"]}}),s=await p.encrypt(r.algorithm,r,c);h.recipientInfos[e].value.encryptedKey=new j({valueHex:s})}catch(e){}}function m(e){let t,r=Promise.resolve();return r=r.then((()=>(t=ch(h.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId),"name"in t==!1?Promise.reject(`Incorrect OID for "keyEncryptionAlgorithm": ${h.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId}`):p.importKey("raw",new Uint8Array(h.recipientInfos[e].value.preDefinedKEK),t,!0,["wrapKey"]))),(e=>Promise.reject(e))),r=r.then((e=>p.wrapKey("raw",a,e,t)),(e=>Promise.reject(e))),r=r.then((t=>{h.recipientInfos[e].value.encryptedKey=new j({valueHex:t})}),(e=>Promise.reject(e))),r}function g(e){let t,r,s=Promise.resolve();return s=s.then((()=>{if("keyDerivationAlgorithm"in h.recipientInfos[e].value==!1)return Promise.reject('Please append encoded "keyDerivationAlgorithm"');if("algorithmParams"in h.recipientInfos[e].value.keyDerivationAlgorithm==!1)return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"');try{t=new Xl({schema:h.recipientInfos[e].value.keyDerivationAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"')}return Promise.resolve()}),(e=>Promise.reject(e))),s=s.then((()=>{const t=new Uint8Array(h.recipientInfos[e].value.password);return p.importKey("raw",t,"PBKDF2",!1,["deriveKey"])}),(e=>Promise.reject(e))),s=s.then((s=>{if(r=ch(h.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId),"name"in r==!1)return Promise.reject(`Incorrect OID for "keyEncryptionAlgorithm": ${h.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId}`);let n="SHA-1";if("prf"in t){const e=ch(t.prf.algorithmId);if("name"in e==!1)return Promise.reject("Incorrect OID for HMAC hash algorithm");n=e.hash.name}const i=new Uint8Array(t.salt.valueBlock.valueHex),a=t.iterationCount;return p.deriveKey({name:"PBKDF2",hash:{name:n},salt:i,iterations:a},s,r,!0,["wrapKey"])}),(e=>Promise.reject(e))),s=s.then((e=>p.wrapKey("raw",a,e,r)),(e=>Promise.reject(e))),s=s.then((t=>{h.recipientInfos[e].value.encryptedKey=new j({valueHex:t})}),(e=>Promise.reject(e))),s}return r=r.then((()=>p.generateKey(e,!0,["encrypt"]))),r=r.then((t=>(a=t,p.encrypt({name:e.name,iv:n},a,i))),(e=>Promise.reject(e))),r=r.then((e=>(o=e,p.exportKey("raw",a))),(e=>Promise.reject(e))).then((e=>(c=e,!0)),(e=>Promise.reject(e))),r=r.then((()=>{this.version=2,this.encryptedContentInfo=new $l({contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new Ll({algorithmId:u,algorithmParams:new j({valueHex:s})}),encryptedContent:new j({valueHex:o})})}),(e=>Promise.reject(e))),r=r.then((()=>{for(let e=0;e<this.recipientInfos.length;e++){let t=Promise.resolve();switch(this.recipientInfos[e].variant){case 1:t=f(e);break;case 2:t=d(e);break;case 3:t=m(e);break;case 4:t=g(e);break;default:return Promise.reject(`Uknown recipient type in array with index ${e}`)}l.push(t)}return Promise.all(l)}),(e=>Promise.reject(e))),r}decrypt(e,t){let r=Promise.resolve();const s=t||{},n=this;if(e+1>this.recipientInfos.length)return Promise.reject('Maximum value for "index" is: '+(this.recipientInfos.length-1));const i=nh();if(void 0===i)return Promise.reject("Unable to create WebCrypto object");return r=r.then((()=>{let t=Promise.resolve();switch(this.recipientInfos[e].variant){case 1:t=async function(e){if("recipientPrivateKey"in s==0)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const t=ch(n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId);if("name"in t==0)throw new Error(`Unknown keyEncryptionAlgorithm: ${n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId}`);if("RSA-OAEP"===t.name){const r=n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmParams,s=new Nu({schema:r});if(t.hash=ch(s.hashAlgorithm.algorithmId),"name"in t.hash==0)throw new Error(`Incorrect OID for hash algorithm: ${s.hashAlgorithm.algorithmId}`)}const r=await i.importKey("pkcs8",s.recipientPrivateKey,t,!0,["decrypt"]),a=await i.decrypt(r.algorithm,r,n.recipientInfos[e].value.encryptedKey.valueBlock.valueHex),o=ch(n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);if("name"in o==0)throw new Error(`Incorrect "contentEncryptionAlgorithm": ${n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);return i.importKey("raw",a,o,!0,["decrypt"])}(e);break;case 2:t=function(e){let t,r,a,o,c=Promise.resolve();const l=n.recipientInfos[e].value.originator;function h(t){t=t||!1;const r=new Ll({schema:n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmParams}),s=ch(r.algorithmId);if("name"in s==0)return Promise.reject(`Incorrect OID for key encryption algorithm: ${r.algorithmId}`);let i=s.length;const a=new ArrayBuffer(4),o=new Uint8Array(a);for(let e=3;e>=0;e--)o[e]=i,i>>=8;const c={algorithmId:r.algorithmId};t&&(c.algorithmParams=new F);const l=new Pu({keyInfo:new Ll(c),entityUInfo:n.recipientInfos[e].value.ukm,suppPubInfo:new j({valueHex:a})}).toSchema().toBER(!1),h=ch(n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId);return"name"in h==0?Promise.reject(`Incorrect OID for key encryption algorithm: ${n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId}`):hh(h.kdf,u,s.length,l)}let u;function p(e){return i.importKey("raw",e,{name:"AES-KW"},!0,["unwrapKey"])}function d(t){const r=ch(n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);return"name"in r==0?Promise.reject(`Incorrect "contentEncryptionAlgorithm": ${n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`):i.unwrapKey("raw",n.recipientInfos[e].value.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHex,t,{name:"AES-KW"},r,!0,["decrypt"])}return c=c.then((()=>{if("recipientCertificate"in s){const t=s.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(t.constructor.blockName()!==J.blockName())return Promise.reject(`Incorrect "recipientCertificate" for index ${e}`);a=t.valueBlock.toString()}else{if(!("algorithmParams"in l.value.algorithm))return Promise.reject('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');{const t=l.value.algorithm.algorithmParams;if(t.constructor.blockName()!==J.blockName())return Promise.reject(`Incorrect originator for index ${e}`);a=t.valueBlock.toString()}}if("recipientPrivateKey"in s==0)return Promise.reject('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(a){case"1.2.840.10045.3.1.7":t="P-256",r=256;break;case"1.3.132.0.34":t="P-384",r=384;break;case"1.3.132.0.35":t="P-521",r=528;break;default:return Promise.reject(`Incorrect curve OID for index ${e}`)}return i.importKey("pkcs8",s.recipientPrivateKey,{name:"ECDH",namedCurve:t},!0,["deriveBits"])}),(e=>Promise.reject(e))),c=c.then((e=>{o=e,"algorithmParams"in l.value.algorithm==0&&(l.value.algorithm.algorithmParams=new J({value:a}));const r=l.value.toSchema().toBER(!1);return i.importKey("spki",r,{name:"ECDH",namedCurve:t},!0,[])}),(e=>Promise.reject(e))),c=c.then((e=>i.deriveBits({name:"ECDH",public:e},o,r)),(e=>Promise.reject(e))),c=c.then((e=>(u=e,h())),(e=>Promise.reject(e))),c=c.then(p,(e=>Promise.reject(e))),c=c.then((e=>d(e).catch((()=>h(!0).then(p).then(d)))),(e=>Promise.reject(e))),c}(e);break;case 3:t=function(e){let t,r=Promise.resolve();return r=r.then((()=>"preDefinedData"in s==0?Promise.reject('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"'):(t=ch(n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId),"name"in t==0?Promise.reject(`Incorrect OID for "keyEncryptionAlgorithm": ${n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId}`):i.importKey("raw",s.preDefinedData,t,!0,["unwrapKey"]))),(e=>Promise.reject(e))),r=r.then((r=>{const s=ch(n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);return"name"in s==0?Promise.reject(`Incorrect "contentEncryptionAlgorithm": ${n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`):i.unwrapKey("raw",n.recipientInfos[e].value.encryptedKey.valueBlock.valueHex,r,t,s,!0,["decrypt"])}),(e=>Promise.reject(e))),r}(e);break;case 4:t=function(e){let t,r,a=Promise.resolve();return a=a.then((()=>{if("preDefinedData"in s==0)return Promise.reject('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if("keyDerivationAlgorithm"in n.recipientInfos[e].value==0)return Promise.reject('Please append encoded "keyDerivationAlgorithm"');if("algorithmParams"in n.recipientInfos[e].value.keyDerivationAlgorithm==0)return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"');try{t=new Xl({schema:n.recipientInfos[e].value.keyDerivationAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"')}return i.importKey("raw",s.preDefinedData,"PBKDF2",!1,["deriveKey"])}),(e=>Promise.reject(e))),a=a.then((s=>{if(r=ch(n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId),"name"in r==0)return Promise.reject(`Incorrect OID for "keyEncryptionAlgorithm": ${n.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId}`);let a="SHA-1";if("prf"in t){const e=ch(t.prf.algorithmId);if("name"in e==0)return Promise.reject("Incorrect OID for HMAC hash algorithm");a=e.hash.name}const o=new Uint8Array(t.salt.valueBlock.valueHex),c=t.iterationCount;return i.deriveKey({name:"PBKDF2",hash:{name:a},salt:o,iterations:c},s,r,!0,["unwrapKey"])}),(e=>Promise.reject(e))),a=a.then((t=>{const s=ch(n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);return"name"in s==0?Promise.reject(`Incorrect "contentEncryptionAlgorithm": ${n.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`):i.unwrapKey("raw",n.recipientInfos[e].value.encryptedKey.valueBlock.valueHex,t,r,s,!0,["decrypt"])}),(e=>Promise.reject(e))),a}(e);break;default:return Promise.reject(`Uknown recipient type in array with index ${e}`)}return t}),(e=>Promise.reject(e))),r=r.then((e=>{const t=ch(this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);if("name"in t==!1)return Promise.reject(`Incorrect "contentEncryptionAlgorithm": ${this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);const r=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,s=new Uint8Array(r);let n=new ArrayBuffer(0);if(!1===this.encryptedContentInfo.encryptedContent.idBlock.isConstructed)n=this.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else for(const e of this.encryptedContentInfo.encryptedContent.valueBlock.value)n=a(n,e.valueBlock.valueHex);return i.decrypt({name:t.name,iv:s},e,n)}),(e=>Promise.reject(e))),r}}class Tu{constructor(e={}){this.hashAlgorithm=t(e,"hashAlgorithm",Tu.defaultValues("hashAlgorithm")),this.issuerNameHash=t(e,"issuerNameHash",Tu.defaultValues("issuerNameHash")),this.issuerKeyHash=t(e,"issuerKeyHash",Tu.defaultValues("issuerKeyHash")),this.serialNumber=t(e,"serialNumber",Tu.defaultValues("serialNumber")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"hashAlgorithm":return new Ll;case"issuerNameHash":case"issuerKeyHash":return new j;case"serialNumber":return new q;default:throw new Error(`Invalid member name for CertID class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"hashAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==!1;case"issuerNameHash":case"issuerKeyHash":case"serialNumber":return t.isEqual(Tu.defaultValues(e));default:throw new Error(`Invalid member name for CertID class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Ll.schema(r.hashAlgorithmObject||{names:{blockName:r.hashAlgorithm||""}}),new j({name:r.issuerNameHash||""}),new j({name:r.issuerKeyHash||""}),new q({name:r.serialNumber||""})]})}fromSchema(e){w(e,["hashAlgorithm","issuerNameHash","issuerKeyHash","serialNumber"]);const t=Be(e,e,Tu.schema({names:{hashAlgorithm:"hashAlgorithm",issuerNameHash:"issuerNameHash",issuerKeyHash:"issuerKeyHash",serialNumber:"serialNumber"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertID");this.hashAlgorithm=new Ll({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new _({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId&&(!1!==l(this.issuerNameHash.valueBlock.valueHex,e.issuerNameHash.valueBlock.valueHex)&&(!1!==l(this.issuerKeyHash.valueBlock.valueHex,e.issuerKeyHash.valueBlock.valueHex)&&!!this.serialNumber.isEqual(e.serialNumber)))}createForCertificate(e,t){let r,s=Promise.resolve();const n=nh();if(void 0===n)return Promise.reject("Unable to create WebCrypto object");if("hashAlgorithm"in t==!1)return Promise.reject('Parameter "hashAlgorithm" is mandatory for "OCSP_REQUEST.createForCertificate"');const i=ah({name:t.hashAlgorithm});return""===i?Promise.reject(`Incorrect "hashAlgorithm": ${this.hashAlgorithm}`):(this.hashAlgorithm=new Ll({algorithmId:i,algorithmParams:new F}),"issuerCertificate"in t?(r=t.issuerCertificate,this.serialNumber=e.serialNumber,s=s.then((()=>n.digest({name:t.hashAlgorithm},r.subject.toSchema().toBER(!1))),(e=>Promise.reject(e))),s=s.then((e=>{this.issuerNameHash=new j({valueHex:e});const s=r.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex;return n.digest({name:t.hashAlgorithm},s)}),(e=>Promise.reject(e))).then((e=>{this.issuerKeyHash=new j({valueHex:e})}),(e=>Promise.reject(e))),s):Promise.reject('Parameter "issuerCertificate" is mandatory for "OCSP_REQUEST.createForCertificate"'))}}class Ru{constructor(e={}){this.certID=t(e,"certID",Ru.defaultValues("certID")),this.certStatus=t(e,"certStatus",Ru.defaultValues("certStatus")),this.thisUpdate=t(e,"thisUpdate",Ru.defaultValues("thisUpdate")),"nextUpdate"in e&&(this.nextUpdate=t(e,"nextUpdate",Ru.defaultValues("nextUpdate"))),"singleExtensions"in e&&(this.singleExtensions=t(e,"singleExtensions",Ru.defaultValues("singleExtensions"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"certID":return new Tu;case"certStatus":return{};case"thisUpdate":case"nextUpdate":return new Date(0,0,0);case"singleExtensions":return[];default:throw new Error(`Invalid member name for SingleResponse class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"certID":return Tu.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Tu.compareWithDefault("issuerNameHash",t.issuerNameHash)&&Tu.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&Tu.compareWithDefault("serialNumber",t.serialNumber);case"certStatus":return 0===Object.keys(t).length;case"thisUpdate":case"nextUpdate":return t===Ru.defaultValues(e);default:throw new Error(`Invalid member name for SingleResponse class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Tu.schema(r.certID||{}),new Ae({value:[new N({name:r.certStatus||"",idBlock:{tagClass:3,tagNumber:0},lenBlockLength:1}),new D({name:r.certStatus||"",idBlock:{tagClass:3,tagNumber:1},value:[new ge,new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new W]})]}),new N({name:r.certStatus||"",idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new ge({name:r.thisUpdate||""}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ge({name:r.nextUpdate||""})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[zh.schema(r.singleExtensions||{})]})]})}fromSchema(e){w(e,["certID","certStatus","thisUpdate","nextUpdate","singleExtensions"]);const t=Be(e,e,Ru.schema({names:{certID:{names:{blockName:"certID"}},certStatus:"certStatus",thisUpdate:"thisUpdate",nextUpdate:"nextUpdate",singleExtensions:{names:{blockName:"singleExtensions"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SingleResponse");this.certID=new Tu({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),"nextUpdate"in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),"singleExtensions"in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,(e=>new Gh({schema:e}))))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new ge({valueDate:this.thisUpdate})),"nextUpdate"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[new ge({valueDate:this.nextUpdate})]})),"singleExtensions"in this&&e.push(new _({value:Array.from(this.singleExtensions,(e=>e.toSchema()))})),new _({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return"nextUpdate"in this&&(e.nextUpdate=this.nextUpdate),"singleExtensions"in this&&(e.singleExtensions=Array.from(this.singleExtensions,(e=>e.toJSON()))),e}}class _u{constructor(e={}){this.tbs=t(e,"tbs",_u.defaultValues("tbs")),this.responderID=t(e,"responderID",_u.defaultValues("responderID")),this.producedAt=t(e,"producedAt",_u.defaultValues("producedAt")),this.responses=t(e,"responses",_u.defaultValues("responses")),"responseExtensions"in e&&(this.responseExtensions=t(e,"responseExtensions",_u.defaultValues("responseExtensions"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return new ArrayBuffer(0);case"responderID":return{};case"producedAt":return new Date(0,0,0);case"responses":case"responseExtensions":return[];default:throw new Error(`Invalid member name for ResponseData class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"tbs":return 0===t.byteLength;case"responderID":return 0===Object.keys(t).length;case"producedAt":return t===_u.defaultValues(e);case"responses":case"responseExtensions":return 0===t.length;default:throw new Error(`Invalid member name for ResponseData class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"ResponseData",value:[new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new q({name:r.version||"ResponseData.version"})]}),new Ae({value:[new D({name:r.responderID||"ResponseData.responderID",idBlock:{tagClass:3,tagNumber:1},value:[ph.schema(r.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new D({name:r.responderID||"ResponseData.responderID",idBlock:{tagClass:3,tagNumber:2},value:[new j({name:r.ResponseDataByKey||"ResponseData.byKey"})]})]}),new ge({name:r.producedAt||"ResponseData.producedAt"}),new _({value:[new Ce({name:"ResponseData.responses",value:Ru.schema(r.response||{})})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[zh.schema(r.extensions||{names:{blockName:"ResponseData.responseExtensions"}})]})]})}fromSchema(e){w(e,["ResponseData","ResponseData.version","ResponseData.responderID","ResponseData.producedAt","ResponseData.responses","ResponseData.responseExtensions"]);const t=Be(e,e,_u.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ResponseData");this.tbs=t.result.ResponseData.valueBeforeDecode,"ResponseData.version"in t.result&&(this.version=t.result["ResponseData.version"].valueBlock.valueDec),1===t.result["ResponseData.responderID"].idBlock.tagNumber?this.responderID=new ph({schema:t.result["ResponseData.responderID"].valueBlock.value[0]}):this.responderID=t.result["ResponseData.responderID"].valueBlock.value[0],this.producedAt=t.result["ResponseData.producedAt"].toDate(),this.responses=Array.from(t.result["ResponseData.responses"],(e=>new Ru({schema:e}))),"ResponseData.responseExtensions"in t.result&&(this.responseExtensions=Array.from(t.result["ResponseData.responseExtensions"].valueBlock.value,(e=>new Gh({schema:e}))))}toSchema(e=!1){let t;if(!1===e){if(0===this.tbs.length)return _u.schema();t=Ee(this.tbs).result}else{const e=[];"version"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[new q({value:this.version})]})),this.responderID instanceof ph?e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):e.push(new D({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),e.push(new ge({valueDate:this.producedAt})),e.push(new _({value:Array.from(this.responses,(e=>e.toSchema()))})),"responseExtensions"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:1},value:[new _({value:Array.from(this.responseExtensions,(e=>e.toSchema()))})]})),t=new _({value:e})}return t}toJSON(){const e={};return"version"in this&&(e.version=this.version),"responderID"in this&&(e.responderID=this.responderID),"producedAt"in this&&(e.producedAt=this.producedAt),"responses"in this&&(e.responses=Array.from(this.responses,(e=>e.toJSON()))),"responseExtensions"in this&&(e.responseExtensions=Array.from(this.responseExtensions,(e=>e.toJSON()))),e}}class Vu{constructor(e={}){this.trustedCerts=t(e,"trustedCerts",this.defaultValues("trustedCerts")),this.certs=t(e,"certs",this.defaultValues("certs")),this.crls=t(e,"crls",this.defaultValues("crls")),this.ocsps=t(e,"ocsps",this.defaultValues("ocsps")),this.checkDate=t(e,"checkDate",this.defaultValues("checkDate")),this.findOrigin=t(e,"findOrigin",this.defaultValues("findOrigin")),this.findIssuer=t(e,"findIssuer",this.defaultValues("findIssuer"))}static defaultFindOrigin(e,t){0===e.tbs.byteLength&&(e.tbs=e.encodeTBS());for(const r of t.certs)if(0===r.tbs.byteLength&&(r.tbs=r.encodeTBS()),l(e.tbs,r.tbs))return"Intermediate Certificates";for(const r of t.trustedCerts)if(0===r.tbs.byteLength&&(r.tbs=r.encodeTBS()),l(e.tbs,r.tbs))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t){let r=[],s=null,n=null,i=null;if(e.subject.isEqual(e.issuer))try{if(!0===await e.verify())return[e]}catch(e){}if("extensions"in e)for(const t of e.extensions)if("2.5.29.35"===t.extnID){"keyIdentifier"in t.parsedValue?s=t.parsedValue.keyIdentifier:("authorityCertIssuer"in t.parsedValue&&(n=t.parsedValue.authorityCertIssuer),"authorityCertSerialNumber"in t.parsedValue&&(i=t.parsedValue.authorityCertSerialNumber));break}function a(t){if(null!==s&&"extensions"in t){let e=!1;for(const n of t.extensions)if("2.5.29.14"===n.extnID){e=!0,l(n.parsedValue.valueBlock.valueHex,s.valueBlock.valueHex)&&r.push(t);break}if(e)return}let a=!1;null!==i&&(a=t.serialNumber.isEqual(i)),null!==n?t.subject.isEqual(n)&&a&&r.push(t):e.issuer.isEqual(t.subject)&&r.push(t)}for(const e of t.trustedCerts)a(e);for(const e of t.certs)a(e);for(let t=0;t<r.length;t++)try{!1===await e.verify(r[t])&&r.splice(t,1)}catch(e){r.splice(t,1)}return r}defaultValues(e){switch(e){case"trustedCerts":case"certs":case"crls":case"ocsps":return[];case"checkDate":return new Date;case"findOrigin":return Vu.defaultFindOrigin;case"findIssuer":return this.defaultFindIssuer;default:throw new Error(`Invalid member name for CertificateChainValidationEngine class: ${e}`)}}async sort(e=!1){const t=[],r=this;async function s(e){const s=[],n=[],i=[];if(s.push(...t.filter((t=>e.issuer.isEqual(t.subject)))),0===s.length)return{status:1,statusMessage:"No certificate's issuers"};if(n.push(...r.crls.filter((t=>t.issuer.isEqual(e.issuer)))),0===n.length)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let e=0;e<n.length;e++)if(!(n[e].nextUpdate.value<r.checkDate))for(let t=0;t<s.length;t++)try{if(await n[e].verify({issuerCertificate:s[t]})){i.push({crl:n[e],certificate:s[t]});break}}catch(e){}return i.length?{status:0,statusMessage:"",result:i}:{status:3,statusMessage:"No valid CRLs found"}}async function n(e,t){const s=ch(e.signatureAlgorithm.algorithmId);if("name"in s==!1)return 1;if("hash"in s==!1)return 1;for(let s=0;s<r.ocsps.length;s++){const n=await r.ocsps[s].getCertificateStatus(e,t);if(n.isForCertificate)return 0===n.status?0:1}return 2}async function i(e,t=!1){let r=!1,s=!1,n=!1,i=!1;if("extensions"in e){for(let t=0;t<e.extensions.length;t++){if(!0===e.extensions[t].critical&&"parsedValue"in e.extensions[t]==!1)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${e.extensions[t].extnID}`};if("2.5.29.15"===e.extensions[t].extnID){n=!0;const r=new Uint8Array(e.extensions[t].parsedValue.valueBlock.valueHex);4==(4&r[0])&&(s=!0),2==(2&r[0])&&(i=!0)}"2.5.29.19"===e.extensions[t].extnID&&"cA"in e.extensions[t].parsedValue&&!0===e.extensions[t].parsedValue.cA&&(r=!0)}if(!0===s&&!1===r)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstaints'};if(!0===n&&!0===r&&!1===s)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(!0===r&&!0===n&&t&&!1===i)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return!1===r?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:""}}t.push(...r.trustedCerts),t.push(...r.certs);for(let e=0;e<t.length;e++)for(let r=0;r<t.length;r++)if(e!==r&&l(t[e].tbs,t[r].tbs)){t.splice(r,1),e=0;break}let a;const o=[t[t.length-1]];if(a=await async function e(t){const s=[];function n(e){let t=!0;for(let r=0;r<e.length;r++){for(let s=0;s<e.length;s++)if(s!==r&&e[r]===e[s]){t=!1;break}if(!t)break}return t}const i=await r.findIssuer(t,r);if(0===i.length)throw new Error("No valid certificate paths found");for(let r=0;r<i.length;r++){if(l(i[r].tbs,t.tbs)){s.push([i[r]]);continue}const a=await e(i[r]);for(let e=0;e<a.length;e++){const t=a[e].slice();t.splice(0,0,i[r]),n(t)?s.push(t):s.push(a[e])}}return s}(t[t.length-1]),0===a.length)return{result:!1,resultCode:60,resultMessage:"Unable to find certificate path"};for(let e=0;e<a.length;e++){let t=!1;for(let s=0;s<a[e].length;s++){const n=a[e][s];for(let e=0;e<r.trustedCerts.length;e++)if(l(n.tbs,r.trustedCerts[e].tbs)){t=!0;break}if(t)break}t||(a.splice(e,1),e=0)}if(0===a.length)throw{result:!1,resultCode:97,resultMessage:"No valid certificate paths found"};let c=a[0].length,h=0;for(let e=0;e<a.length;e++)a[e].length<c&&(c=a[e].length,h=e);for(let e=0;e<a[h].length;e++)o.push(a[h][e]);if(a=await async function(t,a){for(let e=0;e<t.length;e++)if(t[e].notBefore.value>a||t[e].notAfter.value<a)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(t.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let e=t.length-2;e>=0;e--)if(!1===t[e].issuer.isEqual(t[e].subject)&&!1===t[e].issuer.isEqual(t[e+1].subject))return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(0!==r.crls.length||0!==r.ocsps.length)for(let a=0;a<t.length-1;a++){let o=2,c={status:0,statusMessage:""};if(0!==r.ocsps.length)switch(o=await n(t[a],t[a+1]),o){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(0!==r.crls.length){if(c=await s(t[a]),0===c.status)for(let e=0;e<c.result.length;e++){if(c.result[e].crl.isCertificateRevoked(t[a]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if(!1===(await i(c.result[e].certificate,!0)).result)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(!1===e)throw{result:!1,resultCode:11,resultMessage:`No revocation values found for one of certificates: ${c.statusMessage}`}}else if(2===o)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(2===o&&2===c.status&&e){const e=t[a+1];let r=!1;if("extensions"in e)for(const t of e.extensions)switch(t.extnID){case"2.5.29.31":case"2.5.29.46":case"1.3.6.1.5.5.7.1.1":r=!0}if(r)throw{result:!1,resultCode:11,resultMessage:`No revocation values found for one of certificates: ${c.statusMessage}`}}}for(let e=1;e<t.length;e++){if(!1===(await i(t[e])).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"}}return{result:!0}}(o,r.checkDate),!1===a.result)throw a;return o}async verify(e={}){function t(e,t){const r=oh(e),s=oh(t),n=r.split("."),i=s.split("."),a=n.length,o=i.length;if(0===a||0===o||a<o)return!1;for(let e=0;e<a;e++)if(0===n[e].length)return!1;for(let e=0;e<o;e++)if(0===i[e].length){if(0===e){if(1===o)return!1;continue}return!1}for(let e=0;e<o;e++)if(0!==i[o-1-e].length&&0!==n[a-1-e].localeCompare(i[o-1-e]))return!1;return!0}function r(e,r){const s=oh(e),n=oh(r),i=s.split("@"),a=n.split("@");if(0===i.length||0===a.length||i.length<a.length)return!1;if(1===a.length){if(t(i[1],a[0])){const e=i[1].split("."),t=a[0].split(".");return 0===t[0].length||e.length===t.length}return!1}return 0===s.localeCompare(n)}function s(e,r){let s=oh(e);const n=oh(r),i=s.split("/");if(n.split("/").length>1)return!1;if(i.length>1)for(let e=0;e<i.length;e++)if(i[e].length>0&&":"!==i[e].charAt(i[e].length-1)){s=i[e].split(":")[0];break}if(t(s,n)){const e=s.split("."),t=n.split(".");return 0===t[0].length||e.length===t.length}return!1}function n(e,t){const r=new Uint8Array(e.valueBlock.valueHex),s=new Uint8Array(t.valueBlock.valueHex);if(4===r.length&&8===s.length){for(let e=0;e<4;e++)if((r[e]^s[e])&s[e+4])return!1;return!0}if(16===r.length&&32===s.length){for(let e=0;e<16;e++)if((r[e]^s[e])&s[e+16])return!1;return!0}return!1}function i(e,t){if(0===e.typesAndValues.length||0===t.typesAndValues.length)return!0;if(e.typesAndValues.length<t.typesAndValues.length)return!1;let r=!0,s=0;for(let n=0;n<t.typesAndValues.length;n++){let i=!1;for(let a=s;a<e.typesAndValues.length;a++)if(i=e.typesAndValues[a].isEqual(t.typesAndValues[n]),e.typesAndValues[a].type===t.typesAndValues[n].type&&(r=r&&i),!0===i){if(0===s||s===a){s=a+1;break}return!1}if(!1===i)return!1}return 0!==s&&r}try{if(0===this.certs.length)throw"Empty certificate array";let a=!1;"passedWhenNotRevValues"in e&&(a=e.passedWhenNotRevValues);let o=[];o.push("2.5.29.32.0");let c=!1,l=!1,h=!1,u=[],p=[],d=[];"initialPolicySet"in e&&(o=e.initialPolicySet),"initialExplicitPolicy"in e&&(c=e.initialExplicitPolicy),"initialPolicyMappingInhibit"in e&&(l=e.initialPolicyMappingInhibit),"initialInhibitPolicy"in e&&(h=e.initialInhibitPolicy),"initialPermittedSubtreesSet"in e&&(u=e.initialPermittedSubtreesSet),"initialExcludedSubtreesSet"in e&&(p=e.initialExcludedSubtreesSet),"initialRequiredNameForms"in e&&(d=e.initialRequiredNameForms);let f=c,m=l,g=h;const y=new Array(3);y[0]=!1,y[1]=!1,y[2]=!1;let v=0,w=0,b=0,S=u,A=p;const k=d;let C=1;this.certs=await this.sort(a);const I=[];I.push("2.5.29.32.0");const x=[],E=new Array(this.certs.length-1);for(let e=0;e<this.certs.length-1;e++)E[e]=!0;x.push(E);const B=new Array(this.certs.length-1),N=new Array(this.certs.length-1);let P=f?this.certs.length-1:-1;for(let e=this.certs.length-2;e>=0;e--,C++)if("extensions"in this.certs[e]){for(let t=0;t<this.certs[e].extensions.length;t++){if("2.5.29.32"===this.certs[e].extensions[t].extnID){N[e]=this.certs[e].extensions[t].parsedValue;for(let t=0;t<I.length;t++)if("2.5.29.32.0"===I[t]){delete x[t][e];break}for(let r=0;r<this.certs[e].extensions[t].parsedValue.certificatePolicies.length;r++){let s=-1;for(let n=0;n<I.length;n++)if(this.certs[e].extensions[t].parsedValue.certificatePolicies[r].policyIdentifier===I[n]){s=n;break}if(-1===s){I.push(this.certs[e].extensions[t].parsedValue.certificatePolicies[r].policyIdentifier);const s=new Array(this.certs.length-1);s[e]=!0,x.push(s)}else x[s][e]=!0}}if("2.5.29.33"===this.certs[e].extensions[t].extnID){if(m)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};B[e]=this.certs[e].extensions[t].parsedValue}"2.5.29.36"===this.certs[e].extensions[t].extnID&&!1===f&&(0===this.certs[e].extensions[t].parsedValue.requireExplicitPolicy?(f=!0,P=e):!1===y[0]?(y[0]=!0,v=this.certs[e].extensions[t].parsedValue.requireExplicitPolicy):v=v>this.certs[e].extensions[t].parsedValue.requireExplicitPolicy?this.certs[e].extensions[t].parsedValue.requireExplicitPolicy:v,0===this.certs[e].extensions[t].parsedValue.inhibitPolicyMapping?m=!0:!1===y[1]?(y[1]=!0,w=this.certs[e].extensions[t].parsedValue.inhibitPolicyMapping+1):w=w>this.certs[e].extensions[t].parsedValue.inhibitPolicyMapping+1?this.certs[e].extensions[t].parsedValue.inhibitPolicyMapping+1:w),"2.5.29.54"===this.certs[e].extensions[t].extnID&&!1===g&&(0===this.certs[e].extensions[t].parsedValue.valueBlock.valueDec?g=!0:!1===y[2]?(y[2]=!0,b=this.certs[e].extensions[t].parsedValue.valueBlock.valueDec):b=b>this.certs[e].extensions[t].parsedValue.valueBlock.valueDec?this.certs[e].extensions[t].parsedValue.valueBlock.valueDec:b)}if(!0===g){let t=-1;for(let e=0;e<I.length;e++)if("2.5.29.32.0"===I[e]){t=e;break}-1!==t&&delete x[0][e]}!1===f&&!0===y[0]&&(v--,0===v&&(f=!0,P=e,y[0]=!1)),!1===m&&!0===y[1]&&(w--,0===w&&(m=!0,y[1]=!1)),!1===g&&!0===y[2]&&(b--,0===b&&(g=!0,y[2]=!1))}for(let e=0;e<this.certs.length-1;e++)if(e<this.certs.length-2&&void 0!==B[e+1])for(let t=0;t<B[e+1].mappings.length;t++){if("2.5.29.32.0"===B[e+1].mappings[t].issuerDomainPolicy||"2.5.29.32.0"===B[e+1].mappings[t].subjectDomainPolicy)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let r=-1,s=-1;for(let n=0;n<I.length;n++)I[n]===B[e+1].mappings[t].issuerDomainPolicy&&(r=n),I[n]===B[e+1].mappings[t].subjectDomainPolicy&&(s=n);void 0!==x[r][e]&&delete x[r][e];for(let n=0;n<N[e].certificatePolicies.length;n++)if(B[e+1].mappings[t].subjectDomainPolicy===N[e].certificatePolicies[n].policyIdentifier&&-1!==r&&-1!==s)for(let t=0;t<=e;t++)void 0!==x[s][t]&&(x[r][t]=!0,delete x[s][t])}for(let e=0;e<I.length;e++)if("2.5.29.32.0"===I[e])for(let t=0;t<P;t++)delete x[e][t];const D=[];for(let e=0;e<x.length;e++){let t=!0;for(let r=0;r<this.certs.length-1;r++){let s=!1;if(r<P&&"2.5.29.32.0"===I[e]&&I.length>1){t=!1;break}if(void 0===x[e][r]){if(r>=P)for(let e=0;e<I.length;e++)if("2.5.29.32.0"===I[e]){!0===x[e][r]&&(s=!0);break}if(!s){t=!1;break}}}!0===t&&D.push(I[e])}let U=[];if(1===o.length&&"2.5.29.32.0"===o[0]&&!1===f)U=o;else if(1===D.length&&"2.5.29.32.0"===D[0])U=o;else for(let e=0;e<D.length;e++)for(let t=0;t<o.length;t++)if(o[t]===D[e]||"2.5.29.32.0"===o[t]){U.push(D[e]);break}const O={result:U.length>0,resultCode:0,resultMessage:U.length>0?"":'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:D,userConstrPolicies:U,explicitPolicyIndicator:f,policyMappings:B,certificatePath:this.certs};if(0===U.length)return O;if(!1===O.result)return O;C=1;for(let e=this.certs.length-2;e>=0;e--,C++){let a=[],o=[],c=[];if("extensions"in this.certs[e])for(let t=0;t<this.certs[e].extensions.length;t++)"2.5.29.30"===this.certs[e].extensions[t].extnID&&("permittedSubtrees"in this.certs[e].extensions[t].parsedValue&&(o=o.concat(this.certs[e].extensions[t].parsedValue.permittedSubtrees)),"excludedSubtrees"in this.certs[e].extensions[t].parsedValue&&(c=c.concat(this.certs[e].extensions[t].parsedValue.excludedSubtrees))),"2.5.29.17"===this.certs[e].extensions[t].extnID&&(a=a.concat(this.certs[e].extensions[t].parsedValue.altNames));let l=k.length<=0;for(let t=0;t<k.length;t++)switch(k[t].base.type){case 4:if(k[t].base.value.typesAndValues.length!==this.certs[e].subject.typesAndValues.length)continue;l=!0;for(let r=0;r<this.certs[e].subject.typesAndValues.length;r++)if(this.certs[e].subject.typesAndValues[r].type!==k[t].base.value.typesAndValues[r].type){l=!1;break}if(!0===l)break}if(!1===l)throw O.result=!1,O.resultCode=21,O.resultMessage="No neccessary name form found",O;const h=[];h[0]=[],h[1]=[],h[2]=[],h[3]=[],h[4]=[];for(let e=0;e<S.length;e++)switch(S[e].base.type){case 1:h[0].push(S[e]);break;case 2:h[1].push(S[e]);break;case 4:h[2].push(S[e]);break;case 6:h[3].push(S[e]);break;case 7:h[4].push(S[e])}for(let o=0;o<5;o++){let c=!1,l=!1;const u=h[o];for(let h=0;h<u.length;h++){switch(o){case 0:if(a.length>0)for(let e=0;e<a.length;e++)1===a[e].type&&(l=!0,c=c||r(a[e].value,u[h].base.value));else for(let t=0;t<this.certs[e].subject.typesAndValues.length;t++)"1.2.840.113549.1.9.1"!==this.certs[e].subject.typesAndValues[t].type&&"0.9.2342.19200300.100.1.3"!==this.certs[e].subject.typesAndValues[t].type||(l=!0,c=c||r(this.certs[e].subject.typesAndValues[t].value.valueBlock.value,u[h].base.value));break;case 1:if(a.length>0)for(let e=0;e<a.length;e++)2===a[e].type&&(l=!0,c=c||t(a[e].value,u[h].base.value));break;case 2:l=!0,c=i(this.certs[e].subject,u[h].base.value);break;case 3:if(a.length>0)for(let e=0;e<a.length;e++)6===a[e].type&&(l=!0,c=c||s(a[e].value,u[h].base.value));break;case 4:if(a.length>0)for(let e=0;e<a.length;e++)7===a[e].type&&(l=!0,c=c||n(a[e].value,u[h].base.value))}if(c)break}if(!1===c&&u.length>0&&l)throw O.result=!1,O.resultCode=41,O.resultMessage='Failed to meet "permitted sub-trees" name constraint',O}let u=!1;for(let o=0;o<A.length;o++){switch(A[o].base.type){case 1:if(a.length>=0)for(let e=0;e<a.length;e++)1===a[e].type&&(u=u||r(a[e].value,A[o].base.value));else for(let t=0;t<this.certs[e].subject.typesAndValues.length;t++)"1.2.840.113549.1.9.1"!==this.certs[e].subject.typesAndValues[t].type&&"0.9.2342.19200300.100.1.3"!==this.certs[e].subject.typesAndValues[t].type||(u=u||r(this.certs[e].subject.typesAndValues[t].value.valueBlock.value,A[o].base.value));break;case 2:if(a.length>0)for(let e=0;e<a.length;e++)2===a[e].type&&(u=u||t(a[e].value,A[o].base.value));break;case 4:u=u||i(this.certs[e].subject,A[o].base.value);break;case 6:if(a.length>0)for(let e=0;e<a.length;e++)6===a[e].type&&(u=u||s(a[e].value,A[o].base.value));break;case 7:if(a.length>0)for(let e=0;e<a.length;e++)7===a[e].type&&(u=u||n(a[e].value,A[o].base.value))}if(u)break}if(!0===u)throw O.result=!1,O.resultCode=42,O.resultMessage='Failed to meet "excluded sub-trees" name constraint',O;S=S.concat(o),A=A.concat(c)}return O}catch(e){if(e instanceof Object){if("resultMessage"in e)return e;if("message"in e)return{result:!1,resultCode:-1,resultMessage:e.message}}return{result:!1,resultCode:-1,resultMessage:e}}}}class Fu{constructor(e={}){this.tbsResponseData=t(e,"tbsResponseData",Fu.defaultValues("tbsResponseData")),this.signatureAlgorithm=t(e,"signatureAlgorithm",Fu.defaultValues("signatureAlgorithm")),this.signature=t(e,"signature",Fu.defaultValues("signature")),"certs"in e&&(this.certs=t(e,"certs",Fu.defaultValues("certs"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbsResponseData":return new _u;case"signatureAlgorithm":return new Ll;case"signature":return new M;case"certs":return[];default:throw new Error(`Invalid member name for BasicOCSPResponse class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":{let e=_u.compareWithDefault("tbs",t.tbs)&&_u.compareWithDefault("responderID",t.responderID)&&_u.compareWithDefault("producedAt",t.producedAt)&&_u.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(e=e&&_u.compareWithDefault("responseExtensions",t.responseExtensions)),e}case"signatureAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==!1;case"signature":return t.isEqual(Fu.defaultValues(e));case"certs":return 0===t.length;default:throw new Error(`Invalid member name for BasicOCSPResponse class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"BasicOCSPResponse",value:[_u.schema(r.tbsResponseData||{names:{blockName:"BasicOCSPResponse.tbsResponseData"}}),Ll.schema(r.signatureAlgorithm||{names:{blockName:"BasicOCSPResponse.signatureAlgorithm"}}),new M({name:r.signature||"BasicOCSPResponse.signature"}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _({value:[new Ce({name:"BasicOCSPResponse.certs",value:$h.schema(r.certs||{})})]})]})]})}fromSchema(e){w(e,["BasicOCSPResponse.tbsResponseData","BasicOCSPResponse.signatureAlgorithm","BasicOCSPResponse.signature","BasicOCSPResponse.certs"]);const t=Be(e,e,Fu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for BasicOCSPResponse");this.tbsResponseData=new _u({schema:t.result["BasicOCSPResponse.tbsResponseData"]}),this.signatureAlgorithm=new Ll({schema:t.result["BasicOCSPResponse.signatureAlgorithm"]}),this.signature=t.result["BasicOCSPResponse.signature"],"BasicOCSPResponse.certs"in t.result&&(this.certs=Array.from(t.result["BasicOCSPResponse.certs"],(e=>new $h({schema:e}))))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),"certs"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[new _({value:Array.from(this.certs,(e=>e.toSchema()))})]})),new _({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return"certs"in this&&(e.certs=Array.from(this.certs,(e=>e.toJSON()))),e}getCertificateStatus(e,t){let r=Promise.resolve();const s={isForCertificate:!1,status:2},n={},i=[],a=[];for(const r of this.tbsResponseData.responses){const s=ch(r.certID.hashAlgorithm.algorithmId);if("name"in s==!1)return Promise.reject(`Wrong CertID hashing algorithm: ${r.certID.hashAlgorithm.algorithmId}`);if(s.name in n==!1){n[s.name]=1;const r=new Tu;i.push(r),a.push(r.createForCertificate(e,{hashAlgorithm:s.name,issuerCertificate:t}))}}return r=r.then((()=>Promise.all(a))),r=r.then((()=>{for(const e of this.tbsResponseData.responses)for(const t of i)if(e.certID.isEqual(t)){s.isForCertificate=!0;try{switch(e.certStatus.idBlock.isConstructed){case!0:1===e.certStatus.idBlock.tagNumber&&(s.status=1);break;case!1:switch(e.certStatus.idBlock.tagNumber){case 0:s.status=0;break;case 2:s.status=2}}}catch(e){}return s}return s})),r}sign(e,t="SHA-1"){if(void 0===e)return Promise.reject("Need to provide a private key for signing");let r,s=Promise.resolve();const n=sh();return s=s.then((()=>n.subtle.getSignatureParameters(e,t))),s=s.then((e=>{r=e.parameters,this.signatureAlgorithm=e.signatureAlgorithm})),s=s.then((()=>{this.tbsResponseData.tbs=this.tbsResponseData.toSchema(!0).toBER(!1)})),s=s.then((()=>n.subtle.signWithPrivateKey(this.tbsResponseData.tbs,e,r))),s=s.then((e=>{this.signature=new M({valueHex:e})})),s}verify(e={}){let t=null,r=-1,s=Promise.resolve(),n=[];const i=this,a=sh();if("certs"in this==!1)return Promise.reject("No certificates attached to the BasicOCSPResponce");"trustedCerts"in e&&(n=e.trustedCerts);const o=nh();if(void 0===o)return Promise.reject("Unable to create WebCrypto object");switch(!0){case this.tbsResponseData.responderID instanceof ph:s=s.then((()=>{for(const[e,t]of i.certs.entries())if(t.subject.isEqual(i.tbsResponseData.responderID)){r=e;break}}));break;case this.tbsResponseData.responderID instanceof j:s=s.then((()=>Promise.all(Array.from(i.certs,(e=>o.digest({name:"sha-1"},new Uint8Array(e.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))))).then((e=>{for(const[t]of i.certs.entries())if(l(e[t],i.tbsResponseData.responderID.valueBlock.valueHex)){r=t;break}}))));break;default:return Promise.reject("Wrong value for responderID")}return s=s.then((()=>-1===r?Promise.reject("Correct certificate was not found in OCSP response"):(t=this.certs[r],Promise.all(Array.from(i.certs,(e=>function(e){if(!0===e.issuer.isEqual(t.issuer)&&!0===e.serialNumber.isEqual(t.serialNumber))return null;let r=!1;for(const t of e.extensions)"2.5.29.19"===t.extnID&&"cA"in t.parsedValue&&!0===t.parsedValue.cA&&(r=!0);return r?e:null}(e)))).then((e=>{const r=[];r.push(t);for(const t of e)null!==t&&r.push(t);return new Vu({certs:r,trustedCerts:n}).verify().then((e=>!0===e.result?Promise.resolve():Promise.reject("Validation of signer's certificate failed")),(e=>Promise.reject(`Validation of signer's certificate failed with error: ${e instanceof Object?e.resultMessage:e}`)))}),(e=>Promise.reject(`Error during checking certificates for CA flag: ${e}`)))))),s=s.then((()=>a.subtle.verifyWithPublicKey(this.tbsResponseData.tbs,this.signature,this.certs[r].subjectPublicKeyInfo,this.signatureAlgorithm))),s}}class Lu{constructor(e={}){if(this.eContentType=t(e,"eContentType",Lu.defaultValues("eContentType")),"eContent"in e&&(this.eContent=t(e,"eContent",Lu.defaultValues("eContent")),1===this.eContent.idBlock.tagClass&&4===this.eContent.idBlock.tagNumber&&!1===this.eContent.idBlock.isConstructed)){const e=new j({idBlock:{isConstructed:!0},isConstructed:!0});let t=0,r=this.eContent.valueBlock.valueHex.byteLength;for(;r>0;){const s=new Uint8Array(this.eContent.valueBlock.valueHex,t,t+65536>this.eContent.valueBlock.valueHex.byteLength?this.eContent.valueBlock.valueHex.byteLength-t:65536),n=new ArrayBuffer(s.length),i=new Uint8Array(n);for(let e=0;e<i.length;e++)i[e]=s[e];e.valueBlock.value.push(new j({valueHex:n})),r-=s.length,t+=s.length}this.eContent=e}"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"eContentType":return"";case"eContent":return new j;default:throw new Error(`Invalid member name for EncapsulatedContentInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"eContentType":return""===t;case"eContent":return 1===t.idBlock.tagClass&&4===t.idBlock.tagNumber&&t.isEqual(Lu.defaultValues("eContent"));default:throw new Error(`Invalid member name for EncapsulatedContentInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.eContentType||""}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:r.eContent||""})]})]})}fromSchema(e){w(e,["eContentType","eContent"]);const t=Be(e,e,Lu.schema({names:{eContentType:"eContentType",eContent:"eContent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for EncapsulatedContentInfo");this.eContentType=t.result.eContentType.valueBlock.toString(),"eContent"in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new J({value:this.eContentType})),"eContent"in this&&!1===Lu.compareWithDefault("eContent",this.eContent)&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new _({value:e})}toJSON(){const e={eContentType:this.eContentType};return"eContent"in this&&!1===Lu.compareWithDefault("eContent",this.eContent)&&(e.eContent=this.eContent.toJSON()),e}}class ju{constructor(e={}){this.hashAlgorithm=t(e,"hashAlgorithm",ju.defaultValues("hashAlgorithm")),this.hashedMessage=t(e,"hashedMessage",ju.defaultValues("hashedMessage")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"hashAlgorithm":return new Ll;case"hashedMessage":return new j;default:throw new Error(`Invalid member name for MessageImprint class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"hashAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==!1;case"hashedMessage":return 0===t.isEqual(ju.defaultValues(e));default:throw new Error(`Invalid member name for MessageImprint class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[Ll.schema(r.hashAlgorithm||{}),new j({name:r.hashedMessage||""})]})}fromSchema(e){w(e,["hashAlgorithm","hashedMessage"]);const t=Be(e,e,ju.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},hashedMessage:"hashedMessage"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for MessageImprint");this.hashAlgorithm=new Ll({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new _({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}class Hu{constructor(e={}){this.responseType=t(e,"responseType",Hu.defaultValues("responseType")),this.response=t(e,"response",Hu.defaultValues("response")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"responseType":return"";case"response":return new j;default:throw new Error(`Invalid member name for ResponseBytes class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"responseType":return""===t;case"response":return t.isEqual(Hu.defaultValues(e));default:throw new Error(`Invalid member name for ResponseBytes class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"",value:[new J({name:r.responseType||""}),new j({name:r.response||""})]})}fromSchema(e){w(e,["responseType","response"]);const t=Be(e,e,Hu.schema({names:{responseType:"responseType",response:"response"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ResponseBytes");this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new _({value:[new J({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}class Mu{constructor(e={}){this.responseStatus=t(e,"responseStatus",Mu.defaultValues("responseStatus")),"responseBytes"in e&&(this.responseBytes=t(e,"responseBytes",Mu.defaultValues("responseBytes"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"responseStatus":return new W;case"responseBytes":return new Hu;default:throw new Error(`Invalid member name for OCSPResponse class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"responseStatus":return t.isEqual(Mu.defaultValues(e));case"responseBytes":return Hu.compareWithDefault("responseType",t.responseType)&&Hu.compareWithDefault("response",t.response);default:throw new Error(`Invalid member name for OCSPResponse class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"OCSPResponse",value:[new W({name:r.responseStatus||"responseStatus"}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Hu.schema(r.responseBytes||{names:{blockName:"responseBytes"}})]})]})}fromSchema(e){w(e,["responseStatus","responseBytes"]);const t=Be(e,e,Mu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OCSPResponse");this.responseStatus=t.result.responseStatus,"responseBytes"in t.result&&(this.responseBytes=new Hu({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),"responseBytes"in this&&e.push(new D({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new _({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return"responseBytes"in this&&(e.responseBytes=this.responseBytes.toJSON()),e}getCertificateStatus(e,t){let r;const s={isForCertificate:!1,status:2};if("responseBytes"in this==!1)return s;if("1.3.6.1.5.5.7.48.1.1"!==this.responseBytes.responseType)return s;try{const e=Ee(this.responseBytes.response.valueBlock.valueHex);r=new Fu({schema:e.result})}catch(e){return s}return r.getCertificateStatus(e,t)}sign(e,t){if("1.3.6.1.5.5.7.48.1.1"===this.responseBytes.responseType){const r=Ee(this.responseBytes.response.valueBlock.valueHex);return new Fu({schema:r.result}).sign(e,t)}return Promise.reject(`Unknown ResponseBytes type: ${this.responseBytes.responseType}`)}verify(e=null){if("responseBytes"in this==!1)return Promise.reject("Empty ResponseBytes field");if("1.3.6.1.5.5.7.48.1.1"===this.responseBytes.responseType){const t=Ee(this.responseBytes.response.valueBlock.valueHex),r=new Fu({schema:t.result});return null!==e&&("certs"in r==!1&&(r.certs=[]),r.certs.push(e)),r.verify()}return Promise.reject(`Unknown ResponseBytes type: ${this.responseBytes.responseType}`)}}class Ku{constructor(e={}){this.type=t(e,"type",Ku.defaultValues("type")),this.attributes=t(e,"attributes",Ku.defaultValues("attributes")),this.encodedValue=t(e,"encodedValue",Ku.defaultValues("encodedValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return-1;case"attributes":return[];case"encodedValue":return new ArrayBuffer(0);default:throw new Error(`Invalid member name for SignedAndUnsignedAttributes class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return t===Ku.defaultValues("type");case"attributes":return 0===t.length;case"encodedValue":return 0===t.byteLength;default:throw new Error(`Invalid member name for SignedAndUnsignedAttributes class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new D({name:r.blockName||"",optional:!0,idBlock:{tagClass:3,tagNumber:r.tagNumber},value:[new Ce({name:r.attributes||"",value:ql.schema()})]})}fromSchema(e){w(e,["attributes"]);const t=Be(e,e,Ku.schema({names:{tagNumber:this.type,attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SignedAndUnsignedAttributes");this.type=t.result.idBlock.tagNumber,this.encodedValue=t.result.valueBeforeDecode;if(new Uint8Array(this.encodedValue)[0]=49,"attributes"in t.result!=!1)this.attributes=Array.from(t.result.attributes,(e=>new ql({schema:e})));else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")}toSchema(){if(Ku.compareWithDefault("type",this.type)||Ku.compareWithDefault("attributes",this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new D({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,(e=>e.toSchema()))})}toJSON(){if(Ku.compareWithDefault("type",this.type)||Ku.compareWithDefault("attributes",this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,(e=>e.toJSON()))}}}class qu{constructor(e={}){this.version=t(e,"version",qu.defaultValues("version")),this.sid=t(e,"sid",qu.defaultValues("sid")),this.digestAlgorithm=t(e,"digestAlgorithm",qu.defaultValues("digestAlgorithm")),"signedAttrs"in e&&(this.signedAttrs=t(e,"signedAttrs",qu.defaultValues("signedAttrs"))),this.signatureAlgorithm=t(e,"signatureAlgorithm",qu.defaultValues("signatureAlgorithm")),this.signature=t(e,"signature",qu.defaultValues("signature")),"unsignedAttrs"in e&&(this.unsignedAttrs=t(e,"unsignedAttrs",qu.defaultValues("unsignedAttrs"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 0;case"sid":return new ke;case"digestAlgorithm":case"signatureAlgorithm":return new Ll;case"signedAttrs":return new Ku({type:0});case"signature":return new j;case"unsignedAttrs":return new Ku({type:1});default:throw new Error(`Invalid member name for SignerInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return qu.defaultValues("version")===t;case"sid":return t instanceof ke;case"digestAlgorithm":return t instanceof Ll!=!1&&t.isEqual(qu.defaultValues("digestAlgorithm"));case"signedAttrs":case"signature":case"unsignedAttrs":return Ku.compareWithDefault("type",t.type)&&Ku.compareWithDefault("attributes",t.attributes)&&Ku.compareWithDefault("encodedValue",t.encodedValue);case"signatureAlgorithm":return t instanceof Ll!=!1&&t.isEqual(qu.defaultValues("signatureAlgorithm"));default:throw new Error(`Invalid member name for SignerInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:"SignerInfo",value:[new q({name:r.version||"SignerInfo.version"}),new Ae({value:[du.schema(r.sid||{names:{blockName:"SignerInfo.sid"}}),new Ae({value:[new D({optional:!0,name:r.sid||"SignerInfo.sid",idBlock:{tagClass:3,tagNumber:0},value:[new j]}),new N({optional:!0,name:r.sid||"SignerInfo.sid",idBlock:{tagClass:3,tagNumber:0},value:[new j]})]})]}),Ll.schema(r.digestAlgorithm||{names:{blockName:"SignerInfo.digestAlgorithm"}}),Ku.schema(r.signedAttrs||{names:{blockName:"SignerInfo.signedAttrs",tagNumber:0}}),Ll.schema(r.signatureAlgorithm||{names:{blockName:"SignerInfo.signatureAlgorithm"}}),new j({name:r.signature||"SignerInfo.signature"}),Ku.schema(r.unsignedAttrs||{names:{blockName:"SignerInfo.unsignedAttrs",tagNumber:1}})]})}fromSchema(e){w(e,["SignerInfo.version","SignerInfo.sid","SignerInfo.digestAlgorithm","SignerInfo.signedAttrs","SignerInfo.signatureAlgorithm","SignerInfo.signature","SignerInfo.unsignedAttrs"]);const t=Be(e,e,qu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SignerInfo");this.version=t.result["SignerInfo.version"].valueBlock.valueDec;const r=t.result["SignerInfo.sid"];1===r.idBlock.tagClass?this.sid=new du({schema:r}):this.sid=r,this.digestAlgorithm=new Ll({schema:t.result["SignerInfo.digestAlgorithm"]}),"SignerInfo.signedAttrs"in t.result&&(this.signedAttrs=new Ku({type:0,schema:t.result["SignerInfo.signedAttrs"]})),this.signatureAlgorithm=new Ll({schema:t.result["SignerInfo.signatureAlgorithm"]}),this.signature=t.result["SignerInfo.signature"],"SignerInfo.unsignedAttrs"in t.result&&(this.unsignedAttrs=new Ku({type:1,schema:t.result["SignerInfo.unsignedAttrs"]}))}toSchema(){if(qu.compareWithDefault("sid",this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new q({value:this.version})),this.sid instanceof du?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),"signedAttrs"in this&&!1===qu.compareWithDefault("signedAttrs",this.signedAttrs)&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),"unsignedAttrs"in this&&!1===qu.compareWithDefault("unsignedAttrs",this.unsignedAttrs)&&e.push(this.unsignedAttrs.toSchema()),new _({value:e})}toJSON(){if(qu.compareWithDefault("sid",this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version};return this.sid instanceof ke||(e.sid=this.sid.toJSON()),e.digestAlgorithm=this.digestAlgorithm.toJSON(),!1===qu.compareWithDefault("signedAttrs",this.signedAttrs)&&(e.signedAttrs=this.signedAttrs.toJSON()),e.signatureAlgorithm=this.signatureAlgorithm.toJSON(),e.signature=this.signature.toJSON(),!1===qu.compareWithDefault("unsignedAttrs",this.unsignedAttrs)&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}class Wu{constructor(e={}){this.version=t(e,"version",Wu.defaultValues("version")),this.policy=t(e,"policy",Wu.defaultValues("policy")),this.messageImprint=t(e,"messageImprint",Wu.defaultValues("messageImprint")),this.serialNumber=t(e,"serialNumber",Wu.defaultValues("serialNumber")),this.genTime=t(e,"genTime",Wu.defaultValues("genTime")),"accuracy"in e&&(this.accuracy=t(e,"accuracy",Wu.defaultValues("accuracy"))),"ordering"in e&&(this.ordering=t(e,"ordering",Wu.defaultValues("ordering"))),"nonce"in e&&(this.nonce=t(e,"nonce",Wu.defaultValues("nonce"))),"tsa"in e&&(this.tsa=t(e,"tsa",Wu.defaultValues("tsa"))),"extensions"in e&&(this.extensions=t(e,"extensions",Wu.defaultValues("extensions"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 0;case"policy":return"";case"messageImprint":return new ju;case"serialNumber":case"nonce":return new q;case"genTime":return new Date(0,0,0);case"accuracy":return new vh;case"ordering":return!1;case"tsa":return new gh;case"extensions":return[];default:throw new Error(`Invalid member name for TSTInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":case"policy":case"genTime":case"ordering":return t===Wu.defaultValues(e);case"messageImprint":return ju.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&ju.compareWithDefault("hashedMessage",t.hashedMessage);case"serialNumber":case"nonce":return t.isEqual(Wu.defaultValues(e));case"accuracy":return vh.compareWithDefault("seconds",t.seconds)&&vh.compareWithDefault("millis",t.millis)&&vh.compareWithDefault("micros",t.micros);case"tsa":return gh.compareWithDefault("type",t.type)&&gh.compareWithDefault("value",t.value);case"extensions":return 0===t.length;default:throw new Error(`Invalid member name for TSTInfo class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return new _({name:r.blockName||"TSTInfo",value:[new q({name:r.version||"TSTInfo.version"}),new J({name:r.policy||"TSTInfo.policy"}),ju.schema(r.messageImprint||{names:{blockName:"TSTInfo.messageImprint"}}),new q({name:r.serialNumber||"TSTInfo.serialNumber"}),new ge({name:r.genTime||"TSTInfo.genTime"}),vh.schema(r.accuracy||{names:{blockName:"TSTInfo.accuracy"}}),new R({name:r.ordering||"TSTInfo.ordering",optional:!0}),new q({name:r.nonce||"TSTInfo.nonce",optional:!0}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[gh.schema(r.tsa||{names:{blockName:"TSTInfo.tsa"}})]}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ce({name:r.extensions||"TSTInfo.extensions",value:Gh.schema(r.extension||{})})]})]})}fromSchema(e){w(e,["TSTInfo.version","TSTInfo.policy","TSTInfo.messageImprint","TSTInfo.serialNumber","TSTInfo.genTime","TSTInfo.accuracy","TSTInfo.ordering","TSTInfo.nonce","TSTInfo.tsa","TSTInfo.extensions"]);const t=Be(e,e,Wu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for TSTInfo");this.version=t.result["TSTInfo.version"].valueBlock.valueDec,this.policy=t.result["TSTInfo.policy"].valueBlock.toString(),this.messageImprint=new ju({schema:t.result["TSTInfo.messageImprint"]}),this.serialNumber=t.result["TSTInfo.serialNumber"],this.genTime=t.result["TSTInfo.genTime"].toDate(),"TSTInfo.accuracy"in t.result&&(this.accuracy=new vh({schema:t.result["TSTInfo.accuracy"]})),"TSTInfo.ordering"in t.result&&(this.ordering=t.result["TSTInfo.ordering"].valueBlock.value),"TSTInfo.nonce"in t.result&&(this.nonce=t.result["TSTInfo.nonce"]),"TSTInfo.tsa"in t.result&&(this.tsa=new gh({schema:t.result["TSTInfo.tsa"]})),"TSTInfo.extensions"in t.result&&(this.extensions=Array.from(t.result["TSTInfo.extensions"],(e=>new Gh({schema:e}))))}toSchema(){const e=[];return e.push(new q({value:this.version})),e.push(new J({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new ge({valueDate:this.genTime})),"accuracy"in this&&e.push(this.accuracy.toSchema()),"ordering"in this&&e.push(new R({value:this.ordering})),"nonce"in this&&e.push(this.nonce),"tsa"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),"extensions"in this&&e.push(new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,(e=>e.toSchema()))})),new _({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return"accuracy"in this&&(e.accuracy=this.accuracy.toJSON()),"ordering"in this&&(e.ordering=this.ordering),"nonce"in this&&(e.nonce=this.nonce.toJSON()),"tsa"in this&&(e.tsa=this.tsa.toJSON()),"extensions"in this&&(e.extensions=Array.from(this.extensions,(e=>e.toJSON()))),e}verify(e={}){let t,r=Promise.resolve(),s=null,n=null;const i=nh();if(void 0===i)return Promise.reject("Unable to create WebCrypto object");if(!("data"in e))return Promise.reject('"data" is a mandatory attribute for TST_INFO verification');if(t=e.data,"notBefore"in e&&(s=e.notBefore),"notAfter"in e&&(n=e.notAfter),null!==s&&this.genTime<s)return Promise.reject("Generation time for TSTInfo object is less than notBefore value");if(null!==n&&this.genTime>n)return Promise.reject("Generation time for TSTInfo object is more than notAfter value");const a=ch(this.messageImprint.hashAlgorithm.algorithmId);return"name"in a==!1?Promise.reject(`Unsupported signature algorithm: ${this.messageImprint.hashAlgorithm.algorithmId}`):(r=r.then((()=>i.digest(a.name,new Uint8Array(t)))).then((e=>l(e,this.messageImprint.hashedMessage.valueBlock.valueHex))),r)}}class Gu{constructor(e={}){this.version=t(e,"version",Gu.defaultValues("version")),this.digestAlgorithms=t(e,"digestAlgorithms",Gu.defaultValues("digestAlgorithms")),this.encapContentInfo=t(e,"encapContentInfo",Gu.defaultValues("encapContentInfo")),"certificates"in e&&(this.certificates=t(e,"certificates",Gu.defaultValues("certificates"))),"crls"in e&&(this.crls=t(e,"crls",Gu.defaultValues("crls"))),"ocsps"in e&&(this.ocsps=t(e,"ocsps",Gu.defaultValues("ocsps"))),this.signerInfos=t(e,"signerInfos",Gu.defaultValues("signerInfos")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"version":return 0;case"digestAlgorithms":case"certificates":case"crls":case"ocsps":case"signerInfos":return[];case"encapContentInfo":return new Lu;default:throw new Error(`Invalid member name for SignedData class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return t===Gu.defaultValues("version");case"encapContentInfo":return new Lu;case"digestAlgorithms":case"certificates":case"crls":case"ocsps":case"signerInfos":return 0===t.length;default:throw new Error(`Invalid member name for SignedData class: ${e}`)}}static schema(e={}){const r=t(e,"names",{});return"optional"in r==!1&&(r.optional=!1),new _({name:r.blockName||"SignedData",optional:r.optional,value:[new q({name:r.version||"SignedData.version"}),new V({value:[new Ce({name:r.digestAlgorithms||"SignedData.digestAlgorithms",value:Ll.schema()})]}),Lu.schema(r.encapContentInfo||{names:{blockName:"SignedData.encapContentInfo"}}),new D({name:r.certificates||"SignedData.certificates",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:lu.schema().valueBlock.value}),new D({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:uu.schema(r.crls||{names:{crls:"SignedData.crls"}}).valueBlock.value}),new V({value:[new Ce({name:r.signerInfos||"SignedData.signerInfos",value:qu.schema()})]})]})}fromSchema(e){w(e,["SignedData.version","SignedData.digestAlgorithms","SignedData.encapContentInfo","SignedData.certificates","SignedData.crls","SignedData.signerInfos"]);const t=Be(e,e,Gu.schema());if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SignedData");if(this.version=t.result["SignedData.version"].valueBlock.valueDec,"SignedData.digestAlgorithms"in t.result&&(this.digestAlgorithms=Array.from(t.result["SignedData.digestAlgorithms"],(e=>new Ll({schema:e})))),this.encapContentInfo=new Lu({schema:t.result["SignedData.encapContentInfo"]}),"SignedData.certificates"in t.result){const e=new lu({schema:new V({value:t.result["SignedData.certificates"].valueBlock.value})});this.certificates=e.certificates.slice(0)}"SignedData.crls"in t.result&&(this.crls=Array.from(t.result["SignedData.crls"],(e=>1===e.idBlock.tagClass?new ou({schema:e}):(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new hu({schema:e}))))),"SignedData.signerInfos"in t.result&&(this.signerInfos=Array.from(t.result["SignedData.signerInfos"],(e=>new qu({schema:e}))))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some((e=>e instanceof cu))||this.crls&&this.crls.length&&this.crls.some((e=>e instanceof hu))?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some((e=>e instanceof nu))?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some((e=>e instanceof Zh))||this.signerInfos.some((e=>3===e.version))||this.encapContentInfo.eContentType!==Gu.ID_DATA?this.version=3:this.version=1,t.push(new q({value:this.version})),t.push(new V({value:Array.from(this.digestAlgorithms,(t=>t.toSchema(e)))})),t.push(this.encapContentInfo.toSchema()),"certificates"in this){const e=new lu({certificates:this.certificates}).toSchema();t.push(new D({idBlock:{tagClass:3,tagNumber:0},value:e.valueBlock.value}))}return"crls"in this&&t.push(new D({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,(t=>{if(t instanceof hu){const r=t.toSchema(e);return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r}return t.toSchema(e)}))})),t.push(new V({value:Array.from(this.signerInfos,(t=>t.toSchema(e)))})),new _({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,(e=>e.toJSON())),encapContentInfo:this.encapContentInfo.toJSON()};return"certificates"in this&&(e.certificates=Array.from(this.certificates,(e=>e.toJSON()))),"crls"in this&&(e.crls=Array.from(this.crls,(e=>e.toJSON()))),e.signerInfos=Array.from(this.signerInfos,(e=>e.toJSON())),e}verify({signer:e=-1,data:t=new ArrayBuffer(0),trustedCerts:r=[],checkDate:s=new Date,checkChain:n=!1,extendedMode:i=!1,passedWhenNotRevValues:o=!1,findOrigin:c=null,findIssuer:h=null}={}){let u=Promise.resolve(),p=new ArrayBuffer(0),d="",f={},m=null,g=[];const y=sh(),v=nh();if(void 0===v)return Promise.reject("Unable to create WebCrypto object");if(-1===e)return i?Promise.reject({date:s,code:1,message:"Unable to get signer index from input parameters",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("Unable to get signer index from input parameters");if("certificates"in this==!1)return i?Promise.reject({date:s,code:2,message:"No certificates attached to this signed data",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("No certificates attached to this signed data");return u=this.signerInfos[e].sid instanceof du?u.then((()=>{for(const t of this.certificates)if(t instanceof $h!=!1&&t.issuer.isEqual(this.signerInfos[e].sid.issuer)&&t.serialNumber.isEqual(this.signerInfos[e].sid.serialNumber))return f=t,Promise.resolve();return i?Promise.reject({date:s,code:3,message:"Unable to find signer certificate",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("Unable to find signer certificate")})):(async()=>{try{const t=this.signerInfos[e].sid,r=t.idBlock.isConstructed?t.valueBlock.value[0].valueBlock.valueHex:t.valueBlock.valueHex;for(const e of this.certificates){if(!(e instanceof $h))continue;if(l(await v.digest({name:"sha-1"},new Uint8Array(e.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex)),r)){f=e;break}}if(!f)throw new Error("Signing certificate not found")}catch(e){if(i)return Promise.reject({date:s,code:3,message:"Unable to find signer certificate",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null});throw"Unable to find signer certificate"}})(),u=u.then((()=>{if("1.2.840.113549.1.9.16.1.4"===this.encapContentInfo.eContentType){if("eContent"in this.encapContentInfo==!1)return!1;const e=Ee(this.encapContentInfo.eContent.valueBlock.valueHex);let r;try{r=new Wu({schema:e.result})}catch(e){return!1}return s=r.genTime,m=r.serialNumber.valueBlock.valueHex,0===t.byteLength?i?Promise.reject({date:s,code:4,message:"Missed detached data input array",signatureVerified:null,signerCertificate:f,signerCertificateVerified:null}):Promise.reject("Missed detached data input array"):r.verify({data:t})}return!0})),n&&(u=u.then((e=>{if(!1===e)return!1;const t=Array.from(this.certificates.filter((e=>e instanceof $h)),(e=>function(e){if(!0===e.issuer.isEqual(f.issuer)&&!0===e.serialNumber.isEqual(f.serialNumber))return null;let t=!1;if("extensions"in e)for(const r of e.extensions)"2.5.29.19"===r.extnID&&"cA"in r.parsedValue&&!0===r.parsedValue.cA&&(t=!0);return t?e:null}(e))),n={checkDate:s,certs:Array.from(t.filter((e=>null!==e))),trustedCerts:r};null!==h&&(n.findIssuer=h),null!==c&&(n.findOrigin=c);const a=new Vu(n);if(a.certs.push(f),"crls"in this)for(const e of this.crls)"thisUpdate"in e?a.crls.push(e):"1.3.6.1.5.5.7.48.1.1"===e.otherRevInfoFormat&&a.ocsps.push(new Fu({schema:e.otherRevInfo}));return"ocsps"in this&&a.ocsps.push(...this.ocsps),a.verify({passedWhenNotRevValues:o}).then((e=>("certificatePath"in e&&(g=e.certificatePath),!0===e.result?Promise.resolve(!0):i?Promise.reject({date:s,code:5,message:`Validation of signer's certificate failed: ${e.resultMessage}`,signatureVerified:null,signerCertificate:f,signerCertificateVerified:!1}):Promise.reject("Validation of signer's certificate failed"))),(e=>i?Promise.reject({date:s,code:5,message:`Validation of signer's certificate failed with error: ${e instanceof Object?e.resultMessage:e}`,signatureVerified:null,signerCertificate:f,signerCertificateVerified:!1}):Promise.reject(`Validation of signer's certificate failed with error: ${e instanceof Object?e.resultMessage:e}`)))}))),u=u.then((t=>{if(!1===t)return!1;const r=ch(this.signerInfos[e].digestAlgorithm.algorithmId);return"name"in r==!1?i?Promise.reject({date:s,code:7,message:`Unsupported signature algorithm: ${this.signerInfos[e].digestAlgorithm.algorithmId}`,signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0}):Promise.reject(`Unsupported signature algorithm: ${this.signerInfos[e].digestAlgorithm.algorithmId}`):(d=r.name,!0)})),u=u.then((r=>{if(!1===r)return!1;if("eContent"in this.encapContentInfo)if(1===this.encapContentInfo.eContent.idBlock.tagClass&&4===this.encapContentInfo.eContent.idBlock.tagNumber)if(!1===this.encapContentInfo.eContent.idBlock.isConstructed)t=this.encapContentInfo.eContent.valueBlock.valueHex;else for(const e of this.encapContentInfo.eContent.valueBlock.value)t=a(t,e.valueBlock.valueHex);else t=this.encapContentInfo.eContent.valueBlock.valueBeforeDecode;else if(0===t.byteLength)return i?Promise.reject({date:s,code:8,message:"Missed detached data input array",signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0}):Promise.reject("Missed detached data input array");if("signedAttrs"in this.signerInfos[e]){let t=!1,r=!1;for(const s of this.signerInfos[e].signedAttrs.attributes)if("1.2.840.113549.1.9.3"===s.type&&(t=!0),"1.2.840.113549.1.9.4"===s.type&&(r=!0,p=s.values[0].valueBlock.valueHex),t&&r)break;if(!1===t)return i?Promise.reject({date:s,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0}):Promise.reject('Attribute "content-type" is a mandatory attribute for "signed attributes"');if(!1===r)return i?Promise.reject({date:s,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0}):Promise.reject('Attribute "message-digest" is a mandatory attribute for "signed attributes"')}return!0})),u=u.then((r=>!1!==r&&(!("signedAttrs"in this.signerInfos[e])||v.digest(d,new Uint8Array(t))))).then((r=>!1!==r&&(!("signedAttrs"in this.signerInfos[e])||!!l(r,p)&&(t=this.signerInfos[e].signedAttrs.encodedValue,!0)))),u=u.then((r=>!1!==r&&y.subtle.verifyWithPublicKey(t,this.signerInfos[e].signature,f.subjectPublicKeyInfo,f.signatureAlgorithm,d))),u=u.then((e=>i?{date:s,code:14,message:"",signatureVerified:e,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0,certificatePath:g}:e),(e=>i?"code"in e?Promise.reject(e):Promise.reject({date:s,code:15,message:`Error during verification: ${e.message}`,signatureVerified:null,signerCertificate:f,timestampSerial:m,signerCertificateVerified:!0}):Promise.reject(e))),u}sign(e,t,r="SHA-1",s=new ArrayBuffer(0)){if(void 0===e)return Promise.reject("Need to provide a private key for signing");let n,i=Promise.resolve();const o=sh(),c=ah({name:r});return""===c?Promise.reject(`Unsupported hash algorithm: ${r}`):(0===this.digestAlgorithms.filter((e=>e.algorithmId===c)).length&&this.digestAlgorithms.push(new Ll({algorithmId:c,algorithmParams:new F})),this.signerInfos[t].digestAlgorithm=new Ll({algorithmId:c,algorithmParams:new F}),i=i.then((()=>o.subtle.getSignatureParameters(e,r))),i=i.then((e=>{n=e.parameters,this.signerInfos[t].signatureAlgorithm=e.signatureAlgorithm})),i=i.then((()=>{if("signedAttrs"in this.signerInfos[t])if(0!==this.signerInfos[t].signedAttrs.encodedValue.byteLength)s=this.signerInfos[t].signedAttrs.encodedValue;else{s=this.signerInfos[t].signedAttrs.toSchema(!0).toBER(!1);new Uint8Array(s)[0]=49}else if("eContent"in this.encapContentInfo)if(1===this.encapContentInfo.eContent.idBlock.tagClass&&4===this.encapContentInfo.eContent.idBlock.tagNumber)if(!1===this.encapContentInfo.eContent.idBlock.isConstructed)s=this.encapContentInfo.eContent.valueBlock.valueHex;else for(const e of this.encapContentInfo.eContent.valueBlock.value)s=a(s,e.valueBlock.valueHex);else s=this.encapContentInfo.eContent.valueBlock.valueBeforeDecode;else if(0===s.byteLength)return Promise.reject("Missed detached data input array");return Promise.resolve()})),i=i.then((()=>o.subtle.signWithPrivateKey(s,e,n))),i=i.then((e=>(this.signerInfos[t].signature=new j({valueHex:e}),e))),i)}}Gu.ID_DATA="1.2.840.113549.1.7.1";class zu{}zu.newLineChar=10,zu.whiteSpaceChars=new Uint8Array([0,9,10,12,13,32]),zu.lessThanChar=60,zu.greaterThanChar=62,zu.hexadecimalChars=new Uint8Array(at.FromUtf8String("01234567890abcdefABCDEF")),zu.endOfLineChars=new Uint8Array([10,13]),zu.percentChar=37,zu.whiteSpaceChar=32,zu.trailerChars=new Uint8Array([116,114,97,105,108,101,114]),zu.startXrefChars=new Uint8Array([115,116,97,114,116,120,114,101,102]),zu.xrefChars=new Uint8Array([120,114,101,102]);class Ju extends Error{constructor(e,t=-1){super(),this.name=Ju.NAME,this.message=e,this.position=t}}Ju.NAME="ParsingError";class $u{constructor(e){this.position=0,this.backward=!1,this.view=st.toUint8Array(e)}get isEOF(){return this.position<0||this.position>=this.view.length}findIndex(e){return"function"==typeof e?this.findIndexByCallback(e):"string"==typeof e?this.findIndexByString(e):this.findIndexByView(e)}findIndexByCallback(e){const t=this.backward?-1:1;for(this.position;;this.position+=t){const t=this.view[this.position];if(void 0===t)break;if(e(t,this.position,this.view,this))return this.position}return-1}findIndexByString(e){const t=at.FromUtf8String(e),r=new Uint8Array(t);return this.findIndexByView(r)}findIndexByView(e){const t=e.slice();return this.backward&&t.reverse(),this.findIndex(((e,r,s)=>{for(let e=0;e<t.length;e++)if(s[this.backward?r--:r++]!==t[e])return!1;return!0}))}readByte(){const e=this.view[this.position];return this.position+=this.backward?-1:1,e}readUint8(){return this.readByte()}readUint16(e=!1){return new DataView(this.read(2).slice().buffer).getUint16(0,e)}readUint32(e=!1){const t=this.read(4).slice();e&&t.reverse();return new Uint32Array(t.buffer)[0]}readString(e){const t=this.read(e);return at.ToBinary(t)}read(e){const t=this.position;return"number"==typeof e?this.position+=this.backward?-e:e:e?e&&(this.position=this.findIndex(e),-1!==this.position||this.backward||(this.position=this.view.length)):this.position=this.backward?-1:this.view.length,this.backward?this.view.subarray(this.position,t):this.view.subarray(t,this.position)}get current(){return this.view[this.position]}end(){this.position=this.view.length-1}start(){this.position=0}}class Yu{constructor(){this.buffer=[]}get length(){let e=0;for(const[t]of this.buffer)e+=t.length;return e}write(e,t){this.buffer.push([st.toUint8Array(e),t])}writeLine(e){e&&this.write(e),this.writeByte(zu.newLineChar)}writeByte(e){this.buffer.push([new Uint8Array([e])])}writeByteLine(e){this.buffer.push([new Uint8Array([e,zu.newLineChar])])}writeString(e){this.buffer.push([new Uint8Array(at.FromBinary(e))])}writeStringLine(e){this.writeString(e),this.writeByte(zu.newLineChar)}toArrayBuffer(){return this.toUint8Array().buffer}toUint8Array(){let e=0;this.buffer.map((e=>e[0])).map((e=>e.length)).forEach((t=>{e+=t}));const t=new Uint8Array(e);let r=0;for(const[e,s]of this.buffer)t.set(e,r),s&&s(t.subarray(r,r+e.length)),r+=e.length;return t}}class Xu{constructor(){this.ownerElement=null,this.view=Xu.DEFAULT_VIEW,this.documentUpdate=null,this.padding=0}static create(e){const t=new this;return t.documentUpdate="update"in e?e.update:e,t.onCreate(),t}onCreate(){}static getReader(e,t=0){return e instanceof $u?e:new $u("string"==typeof e?new Uint8Array(at.FromBinary(e)):st.toUint8Array(e).subarray(t))}static fromPDF(e,t=0){const r=new this;return r.fromPDF(e,t),r}isIndirect(){return!!(this.ownerElement&&"id"in this.ownerElement&&"generation"in this.ownerElement)}findIndirect(e=!1){if(this.ownerElement){if("id"in this.ownerElement&&"generation"in this.ownerElement)return this.ownerElement;if(e)return this.ownerElement.findIndirect(e)}return null}getIndirect(e=!1){const t=this.findIndirect(e);if(!t)throw new Error("Not found indirect");return t}makeIndirect(e){return this.documentUpdate&&!this.isIndirect()&&this.getDocument().append(this,e),this}getDocument(){return this.getDocumentUpdate().document}getDocumentUpdate(){if(!this.documentUpdate)throw new Error("PDF object is not assigned to the PTF document");return this.documentUpdate}toPDF(e=!1){if(e&&this.view.length)return this.view;const t=new Yu;return this.writePDF(t),t.toUint8Array()}writePDF(e,t=!1){if(t&&this.view.length)return void e.write(this.view);const r=e.length;this.onWritePDF(e);let s=e.length-r;s<this.padding&&(e.writeString("".padEnd(this.padding-s," ")),s=this.padding),e.write(new Uint8Array,(e=>{this.view=new Uint8Array(e.buffer).subarray(r,r+s)}))}fromPDF(e,t=0){const r=Xu.getReader(e,t),s=r.position;try{return this.onFromPDF(r),this.view=r.view.subarray(s,r.position),r.position}catch(e){if(e instanceof Ju)throw-1===e.position&&(e.position=s),e;let t=`Cannot create ${this.constructor.name} from PDF stream at position ${r.position}.`;throw e instanceof Error&&(t+=` ${e.message}`),new Ju(t,r.position)}}adoptChild(e){this.documentUpdate&&(e.documentUpdate=this.documentUpdate),this.ownerElement&&(e.ownerElement=this)}copy(){const e=new this.constructor;return this.onCopy(e),e}onCopy(e){e.documentUpdate=this.documentUpdate,e.ownerElement=this.ownerElement}modify(){if(this.documentUpdate){const e=this.documentUpdate.document.update;if(this.documentUpdate===e)return this;{const t=this.findIndirect(!0);if(t){const r=this.documentUpdate.getObject(t.id,t.generation);return r.value.documentUpdate===e?(this.documentUpdate=e,this):(this.documentUpdate.document.append(r),this.documentUpdate=e,r.value)}}}return this}equal(e){if(this===e)return!0;if(this.isIndirect()&&e.isIndirect()){const t=this.getIndirect(),r=e.getIndirect();return t.id===r.id&&t.generation===r.generation}return this.onEqual(e)}}Xu.DEFAULT_VIEW=new Uint8Array;class Qu extends Ju{constructor(e=0){super(`Wrong character at ${e} position.`,e),this.name=Ju.NAME}}Qu.NAME="BadCharError";const Zu=new Uint8Array([102,97,108,115,101]),ep=new Uint8Array([116,114,117,101]);class tp extends Xu{constructor(e=!1){super(),this.value=e}onWritePDF(e){this.value?e.write(ep):e.write(Zu)}onFromPDF(e){switch(e.view[e.position]){case 116:if(!ep.every((t=>t===e.readByte())))throw new Qu(e.position-1);this.value=!0;break;case 102:if(!Zu.every((t=>t===e.readByte())))throw new Qu(e.position-1);this.value=!1;break;default:throw new Qu(e.position)}}onCopy(e){super.onCopy(e),e.value=this.value}toString(){return this.value?"true":"false"}onEqual(e){return e instanceof tp&&e.value===this.value}}class rp extends Xu{constructor(e){super(),this.text=rp.DEFAULT_TEXT,e instanceof rp?(this.view=e.view,this.text=e.text):"string"==typeof e?this.text=e:st.isBufferSource(e)&&(this.text=at.ToHex(e))}onCopy(e){super.onCopy(e),e.text=this.text}onEqual(e){return e instanceof rp&&e.text===this.text}}rp.DEFAULT_TEXT="";class sp extends rp{onWritePDF(e){e.writeString(`% ${this.text}`)}onFromPDF(e){if(e.readByte()!==zu.percentChar)throw new Qu(e.position-1);const t=e.read((e=>13===e||10===e));this.text=at.ToUtf8String(t).trim()}toString(){return`% ${this.text}`}}class np extends rp{async encryptAsync(){var e;const t=this.findIndirect(!0),r=at.FromBinary(this.text);return t&&(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler)?this.documentUpdate.encryptHandler.encrypt(r,t):r}async decryptAsync(){var e;const t=this.findIndirect(!0),r=at.FromBinary(this.text);return t&&(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler)?this.documentUpdate.encryptHandler.decrypt(r,t):r}async encode(){var e;if(!1===this.encrypted&&(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler)){const e=await this.encryptAsync();this.text=at.ToBinary(e),this.encrypted=!0}return this.text}async decode(){var e;if(void 0===this.encrypted||this.encrypted){if(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler){const e=await this.decryptAsync();this.text=at.ToBinary(e)}this.encrypted=!1}return this.text}onCopy(e){super.onCopy(e),e.encrypted=this.encrypted}}class ip extends np{toArrayBuffer(){return at.FromHex(this.text)}onWritePDF(e){e.writeString(`<${this.text}>`)}onFromPDF(e){if(e.readByte()!==zu.lessThanChar)throw new Qu(e.position-1);const t=[];e.read((r=>{if(r===zu.greaterThanChar)return!0;if(zu.hexadecimalChars.includes(r))t.push(r);else if(!zu.whiteSpaceChars.includes(r))throw new Qu(e.position);return!1})),this.text=at.ToBinary(new Uint8Array(t)),e.readByte()}get data(){return new Uint8Array(at.FromHex(this.text))}toString(){return`<${this.text}>`}}class ap extends Xu{constructor(e){super(),this.value=null!=e?e:0}static assertPositiveInteger(e){if(e.value>>>0!==parseFloat(e.value.toString()))throw new Error("Number is not a positive integer")}static isDigit(e){return 48<=e&&e<=57||43===e||45===e||46===e}onWritePDF(e){e.writeString(this.toString())}onFromPDF(e){const t=e.read((e=>!ap.isDigit(e)));if(!t.length)throw new Ju(`Numeric sequence not found at position ${e.position}`,e.position);const r=new Number(at.ToUtf8String(t));if(Number.isNaN(r))throw new Ju("Parsed value is not a Number",e.position);this.value=r.valueOf()}toString(){var e;const t=new Number(this.value),r=(null===(e=/\.(.+)/.exec(this.value.toString()))||void 0===e?void 0:e[1].length)||0;return t.toFixed(r>3?3:r)}onCopy(e){super.onCopy(e),e.value=this.value}onEqual(e){return e instanceof ap&&e.value===this.value}}class op extends Xu{constructor(e=0,t=0){super(),this.id=e,this.generation=t}onFromPDF(e){const t=ap.fromPDF(e);if(ap.assertPositiveInteger(t),32!==e.readByte())throw new Qu(e.position-1);const r=ap.fromPDF(e);if(ap.assertPositiveInteger(t),32!==e.readByte())throw new Qu(e.position-1);this.id=t.value,this.generation=r.value}onCopy(e){super.onCopy(e),e.id=this.id,e.generation=this.generation}onEqual(e){return e instanceof op&&e.id===this.id&&e.generation===this.generation}}const cp=new Uint8Array([110,117,108,108]);class lp extends Xu{onWritePDF(e){e.write(cp)}onFromPDF(e){if(!cp.every((t=>t===e.readByte())))throw new Qu(e.position-1)}toString(){return"null"}onEqual(e){return e instanceof lp}}class hp{static convert(e,t,r=!1){if(t)if(t.__proto__===Xu||t.__proto__===rp||t.__proto__===np){if(!(e instanceof t))throw TypeError("Cannot convert target object to requested type")}else if(!(e instanceof t)){const s=new t(e);return r&&e.ownerElement instanceof td&&(e.ownerElement.value=s),s}return e}}class up extends op{onWritePDF(e){const t=new ap(this.id).toString(),r=new ap(this.generation).toString();return e.writeString(`${t} ${r} R`)}onFromPDF(e){if(super.onFromPDF(e),82!==e.readByte())throw new Qu(e.position-1)}getValue(e){if(this.documentUpdate){const t=this.documentUpdate.document.getObject(this).value;return hp.convert(t,e)}throw new Error("IndirectReference is not assigned to DocumentUpdate")}toString(){return`${this.id} ${this.generation} R`}}const pp=[47,40,41,91,93,60,62,123,125,37];class dp extends rp{static isNameChar(e){return!(e<33||126<e||pp.includes(e))}onWritePDF(e){const t=this.text.replace(/[^!-~[\]<>(){}%/]/gm,(e=>`#${e.charCodeAt(0).toString(16).padStart(2,"0")}`));return e.writeString(`/${t}`)}onFromPDF(e){if(47!==e.readByte())throw new Qu(e.position-1);const t=e.read((e=>!dp.isNameChar(e)));this.text=at.ToUtf8String(t).replace(/#([0-9A-F]{2})/gim,((e,t)=>String.fromCharCode(parseInt(t,16))))}toString(){return`/${this.text}`}}const fp=new Uint8Array([zu.lessThanChar,zu.lessThanChar]),mp=new Uint8Array([zu.greaterThanChar,zu.greaterThanChar]);class gp extends Xu{constructor(e){if(super(),this.items=new Map,e)if(e instanceof gp)this.items=e.items,this.ownerElement=e.ownerElement,this.view=e.view,this.documentUpdate=e.documentUpdate;else for(const[t,r]of e)this.items.set(gp.getName(t),r)}static getName(e){return"string"==typeof e?e:e.text}onWritePDF(e){e.writeStringLine("<<");for(const[t,r]of this.items){if(new dp(t).writePDF(e),e.writeByte(zu.whiteSpaceChar),r.isIndirect()){const t=r.getIndirect();new up(t.id,t.generation).writePDF(e)}else r.writePDF(e);e.writeLine()}e.writeString(">>")}onFromPDF(e){if(!fp.every((t=>t===e.readByte())))throw new Qu(e.position-1);for(this.items.clear();;){if(Qp.skip(e),mp.every(((t,r)=>t===e.view[e.position+r]))){e.read(2);break}const t=Qp.read(e,this.documentUpdate,this);if(this.adoptChild(t),t instanceof lp){if(Qp.skip(e),!mp.every(((t,r)=>t===e.view[e.position+r])))throw new Ju("Must be '>>' after the 'null' value",e.position);e.read(2);break}if(!(t instanceof dp))throw new Ju(`Dictionary key at position ${e.view.byteOffset} must be type of Name`,e.view.byteOffset);const r=Qp.read(e,this.documentUpdate,this);this.adoptChild(r),this.items.set(gp.getName(t),r)}}get size(){return this.items.size}get(e,t,r=!1){const s=gp.getName(e);let n=this.items.get(gp.getName(s));if(!n)throw new Error(`Cannot get PDF Dictionary value by name '${s.toString()}'`);n instanceof up?n=n.getValue():n.ownerElement||(n.ownerElement=this);const i=hp.convert(n,t,r);return r&&!i.isIndirect&&this.set(e,i),i}has(e){return this.items.has(gp.getName(e))}set(e,t){return this.modify(),t instanceof Yp&&t.makeIndirect(),this.items.set(gp.getName(e),t),this}delete(e){return this.modify(),this.items.delete(gp.getName(e))}clear(){this.items.clear(),this.onCreate()}onCopy(e){super.onCopy(e);const t=new Map;for(const[e,r]of this.items)t.set(e,r.copy());e.items=t}toString(e=0){const t=[],r=gp.FORMAT_SPACE.repeat(e);for(const[s,n]of this.items){const i=r+gp.FORMAT_SPACE,a=s.toString();let o="";if(n.isIndirect()){const e=n.getIndirect();o=`${e.id} ${e.generation} R`}else o=n instanceof gp?n.toString(e+1):n.toString();t.push(`${i}/${a} ${o}`)}return`<<\n${t.join("\n")}\n${r}>>`}onEqual(e){var t;if(e instanceof gp&&e.items.size===this.items.size)for(const[r,s]of e.items)if(!this.items.has(r)||!(null===(t=this.items.get(r))||void 0===t?void 0:t.equal(s)))return!1;return!1}to(e,t=!1){return hp.convert(this,e,t)}}gp.FORMAT_SPACE="  ";class yp extends np{toArrayBuffer(){return at.FromBinary(this.text)}onWritePDF(e){let t=this.text;let r=!1;yp.getMaxUnicode(this.text)>255&&(r=!0,t=at.ToBinary(at.FromUtf8String(t,"utf16be")));let s=t.replace(/[\n\r\t\f\x08\\()]/gm,(e=>{switch(!0){case"\n"===e:return"\\n";case"\r"===e:return"\\r";case"\t"===e:return"\\t";case"\b"===e:return"\\b";case"\f"===e:return"\\f";case"("===e:return"\\(";case")"===e:return"\\)";case"\\"===e:return"\\\\";default:return e}}));return r&&(s="þÿ"+s),e.writeString(`(${s})`)}static getMaxUnicode(e){let t=0;for(const r of e){const e=r.charCodeAt(0);e>t&&(t=e)}return t}onFromPDF(e){if(40!==e.readByte())throw new Qu(e.position-1);let t=1,r=0;const s=e.read((e=>{if(92===e)return r^=1,!1;if(r&&(40===e||41===e))return r=0,!1;if(40===e)t++;else if(41===e&&!--t)return!0;return r=0,!1}));if(t)throw new Ju("Cannot find out RIGHT PARENTHESIS for literal string");const n=at.ToBinary(s).replace(/\\(\d\d\d?|\r\n|\n|.)/gm,((e,t)=>{switch(!0){case"\\n"===e:return"\n";case"\\r"===e:return"\r";case"\\t"===e:return"\t";case"\\b"===e:return"\b";case"\\f"===e:return"\f";case"\\("===e:return"(";case"\\)"===e:return")";case"\\\\"===e:return"\\";case"\\\r\n"===e:case"\\\n"===e:return"";case/\d\d\d?/.test(t):return globalThis.String.fromCharCode(parseInt(t,10));default:return t}}));n.startsWith("þÿ")?this.text=at.ToUtf16String(at.FromBinary(n.substring(2))):this.text=n,e.readByte()}toString(){return`(${this.text})`}}class vp{constructor(e,t,r,s){this.parent=e,this.name=t,this.indirect=r,this._type=s}get(e=!1){if(!this.parent.has(this.name)){if(e)throw new Error(`Cannot get required field '${this.name}'. Field is empty.`);if(!this.parent.documentUpdate)throw new Error("Parent object doesn't assigned to PDF document update.");const t=this._type.create(this.parent.documentUpdate);return this.indirect&&t.makeIndirect(),this.parent.modify().set(this.name,t).view=Xu.DEFAULT_VIEW,t}return this.parent.get(this.name,this._type)}has(){return this.parent.has(this.name)}set(e){const t=this.parent.modify();t.view=Xu.DEFAULT_VIEW,null==e?t.delete(this.name):(this.indirect&&e.makeIndirect(),t.set(this.name,e))}}const wp=/D.(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:(Z)|(?:([-+])(\d{2})'(\d{2})))?/;class bp extends yp{async getDateAsync(){if(await this.decode(),void 0===this.encrypted||this.encrypted)throw new Error("Date is encrypted");return this.getDate()}getDate(){const e=wp.exec(this.text);if(!e)throw new Error(`Cannot parse date '${this.text}'.'`);let t=`${e[1]}-${e[2]}-${e[3]}T${e[4]}:${e[5]}:${e[6]}.000`;return e[7]?t+="+0000":t+=`${e[8]}${e[9]}${e[10]}`,new Date(t)}setDate(e){const t=e.getTimezoneOffset();let r="Z";const s=Math.floor(Math.abs(t/60)),n=Math.abs(t%60),i=`${s.toString().padStart(2,"0")}'${n.toString().padStart(2,"0")}'`;switch(!0){case t>0:r=`-${i}`;break;case t<0:r=`+${i}`}const a=`D:${e.getFullYear().toString().padStart(4,"0")}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}${e.getHours().toString().padStart(2,"0")}${e.getMinutes().toString().padStart(2,"0")}${e.getSeconds().toString().padStart(2,"0")}${r}`;this.encrypted=!1,this.text=a}constructor(e){super(e instanceof Date?"":e),e instanceof Date&&this.setDate(e)}static createDate(e,t=new Date){const r=this.create(e);return r.setDate(t),r}}const Sp=new WeakMap;function Ap(e){return(t,r)=>{if("type"in e&&!e.type)throw new Error(`Class not loaded for ${e.name}`);if(e.maybe&&!e.type)throw new Error("Parameter 'maybe' shall be used with parameter 'type'.");Object.defineProperty(t,r,{enumerable:!1,get:function(){var t;let s=Sp.get(this);if(s||(s=new Map,Sp.set(this,s)),e.cache&&s.has(r))return s.get(r);if(e.maybe){const t=e.type;return new vp(this,e.name,!!e.indirect,t)}if(this.has(e.name)){const t=e.type?this.get(e.name,e.type):this.get(e.name),n=e.get?e.get.call(this,t):t;return e.cache&&s.set(r,n),n}if(!e.optional&&void 0===e.defaultValue)throw new Error(`Cannot get required filed '${e.name}' from the PDF Dictionary`);return null!==(t=e.defaultValue)&&void 0!==t?t:null},set:function(t){if(null==t)this.delete(e.name);else{const r=e.set?e.set.call(this,t):t;if(e.type&&!(r instanceof e.type))throw new Error(`PDF Dictionary field '${e.name}' contains invalid data type`);if(!(r instanceof Xu))throw new Error(`PDF Dictionary field '${e.name}' must be PDF object`);e.indirect&&r.makeIndirect(),r.isIndirect()||(r.ownerElement=this),this.modify(),this.set(e.name,r)}if(this.view=Xu.DEFAULT_VIEW,e.cache){let e=Sp.get(this);e||(e=new Map,Sp.set(this,e)),e.set(r,t)}}})}}function kp(e,t=!1,r){return Ap({name:e,type:ap,get:e=>e.value,set:e=>new ap(e),optional:t,defaultValue:r})}function Cp(e,t=!1,r){return Ap({name:e,type:dp,get:e=>e.text,set:e=>new dp(e),optional:t,defaultValue:r})}function Ip(e,t=!1,r){return Ap({name:e,type:yp,get:e=>e.text,set:e=>new yp(e),optional:t,defaultValue:r})}function xp(e,t=!1,r){return Ap({name:e,type:ip,get:e=>e.text,set:e=>new ip(e),optional:t,defaultValue:r})}function Ep(e,t=!1,r){return Ap({name:e,type:tp,get:e=>e.value,set:e=>new tp(e),optional:t,defaultValue:r})}function Bp(e,t=!1,r){return Ap({name:e,type:Xp,optional:t,defaultValue:r})}function Np(e,t=!1){return Ap({name:e,type:Yp,optional:t})}function Pp(e,t=!1,r){return Ap({name:e,type:bp,optional:t,defaultValue:r})}function Dp(e,t=!1){return Ap({name:e,type:np,optional:t})}function Up(e,t,r=!1){return Ap({name:e,type:t,maybe:!0,indirect:r})}class Op{constructor(e=null){this.decodeParams=e}}class Tp extends Op{constructor(){super(...arguments),this.name=Tp.NAME}static get className(){return"ASCII85Filter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){let t=0;for(const r of e)122===r&&t++;const r=new Uint8Array(Math.floor(4*e.length/5)+4*t);let s=0,n=0;const i=new Uint8Array(5);for(const t of e)if(!zu.whiteSpaceChars.includes(t)){if(126===t)break;if(122!==t||0!=n){if(t<33||t>117)throw new Error("Illegal character in ASCII85 decode");if(i[n++]=t-33,5===n){let e=0;for(let t=0;t<5;t++)e=85*e+i[t];for(let t=3;t>=0;t--)r[s++]=e>>8*t;n=0}}else r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0}if(n){let e=0;for(let t=0;t<5;t++)e=85*e+(t>=n?85:i[t]);for(let t=3;t>4-n;t--)r[s++]=e>>8*t}return new Uint8Array(r.buffer.slice(0,s))}encodeSync(e){const t=new Uint8Array(5);let r=0,s=0;const n=Math.ceil(5*e.length/4)+4,i=new Uint8Array(n+2);let a=0,o=0;for(let n=a=o=0;n<e.length;n++)if(o=256*o+e[n],a++,!(a%4)){if(o){for(let e=4;e>=0;e--)r=o%85,t[e]=r,o=(o-r)/85;for(let e=0;e<5;e++)i[s++]=t[e]+33}else i[s++]=122;o=0,a=0}if(a)if(o){const e=4-a;for(let e=4-a;e>0;e--)o*=256;for(let e=4;e>=0;e--)r=o%85,t[e]=r,o=(o-r)/85;for(let e=0;e<5;e++)i[s++]=t[e]+33;s-=e}else for(let e=0;e<a+1;e++)i[s++]=33;return i[s++]=126,i[s++]=62,new Uint8Array(i.buffer.slice(0,s)).buffer}}Tp.NAME="ASCII85Decode";class Rp extends Op{constructor(){super(...arguments),this.name=Rp.NAME}static get className(){return"ASCIIHexFilter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){return new La({hexstring:new La({view:e}).toString()}).view.slice().buffer}encodeSync(e){return new La({string:new La({view:e}).toHexString()}).view.slice().buffer}}Rp.NAME="ASCIIHexDecode";class _p extends Op{constructor(){super(...arguments),this.name=_p.NAME}static get className(){return"CCITTFaxFilter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){throw new Error("Method not implemented")}encodeSync(e){throw new Error("Method not implemented")}}_p.NAME="CCITTFaxDecode";class Vp extends Op{constructor(){super(...arguments),this.name=Vp.NAME}static get className(){return"DCTFilter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){return e.slice().buffer}encodeSync(e){return e.slice().buffer}}Vp.NAME="DCTDecode";class Fp{constructor(e={}){var t,r,s,n;if(this.prevData=null!==(t=e.prevData)&&void 0!==t?t:new La,this.colors=null!==(r=e.colors)&&void 0!==r?r:1,this.bitsPerComponent=null!==(s=e.bitsPerComponent)&&void 0!==s?s:8,this.columns=null!==(n=e.columns)&&void 0!==n?n:1,e.parameters instanceof gp){const t=e.parameters,r=t.get("Colors",ap);r&&(this.colors=r.value);const s=t.get("BitsPerComponent",ap);s&&(this.bitsPerComponent=s.value);const n=t.get("Columns",ap);n&&(this.columns=n.value)}}}class Lp extends Fp{static get className(){return"TIFFPredictor"}decode(e){return e}encode(e){return e}}class jp extends Fp{decode(e){const t=new ja({stream:new La,appendBlock:e.buffer.byteLength}),r=e.buffer.byteLength,s=this.colors*this.bitsPerComponent+7>>3,n=this.colors*this.bitsPerComponent*this.columns+7>>3;let i=0;const a=new Uint8Array(n);for(this.prevData=e.copy(0,e.view.length);i<r;){const r=e.view[i++];switch(a.set(e.view.subarray(i,i+n)),i+=n,r){case 0:t.append(new La({view:a}));break;case 1:for(let e=0;e<s;e++)t.appendChar(a[e]);for(let e=s;e<n;e++)t.appendChar(a[e]+t.stream.view[t.start-s]&255);break;case 2:for(let e=0;e<n;e++)t.appendChar(a[e]+(t.stream.view[t.start-n]||0)&255);break;case 3:for(let e=0;e<s;++e)t.appendChar(((t.stream.view[t.start-n]||0)>>1)+a[e]);for(let e=s;e<n;++e)t.appendChar(((t.stream.view[t.start-n]||0)+(t.stream.view[t.start-s]||0)>>1)+a[e]&255);break;case 4:for(let e=0;e<s;++e)t.appendChar((t.stream.view[t.start-n]||0)+a[e]&255);for(let e=s;e<n;++e){const r=t.stream.view[t.start-s]||0,i=t.stream.view[t.start-n]||0,o=t.stream.view[t.start-n-s]||0,c=r+i-o;let l=c-r;l<0&&(l=-l);let h=c-i;h<0&&(h=-h);let u=c-o;switch(u<0&&(u=-u),!0){case l<=h&&l<=u:t.appendChar(r+a[e]&255);break;case h<=u:t.appendChar(i+a[e]&255);break;default:t.appendChar(o+a[e]&255)}}break;default:throw new Error(`Unsupported predictor type: ${r}`)}}return e.buffer=t.stream.buffer.slice(0,t.start),e.view=new Uint8Array(e.buffer),e}encode(e){return e}}jp.className="PNGPredictor";class Hp extends Op{constructor(){super(...arguments),this.name=Hp.NAME}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){let t=Hp.PREDICTOR,r=Hp.COLUMNS,s=Hp.COLORS,n=Hp.BITS_PER_COMPONENT;this.decodeParams&&(this.decodeParams.has(Hp.FIELD_PREDICTOR)&&(t=this.decodeParams.get(Hp.FIELD_PREDICTOR,ap).value),this.decodeParams.has(Hp.FIELD_COLUMNS)&&(r=this.decodeParams.get(Hp.FIELD_COLUMNS,ap).value),this.decodeParams.has(Hp.FIELD_COLORS)&&(s=this.decodeParams.get(Hp.FIELD_COLORS,ap).value),this.decodeParams.has(Hp.FIELD_BITS_PER_COMPONENT)&&(n=this.decodeParams.get(Hp.FIELD_BITS_PER_COMPONENT,ap).value));let i=Vl(e);return i?(t>1&&(i=2===t?new Lp({columns:r}).decode(new La({view:i})).view:new jp({columns:r,colors:s,bitsPerComponent:n}).decode(new La({view:i})).view),i.buffer):st.toArrayBuffer(e)}encodeSync(e){return Tl(e).buffer}}Hp.PREDICTOR=1,Hp.COLUMNS=1,Hp.COLORS=1,Hp.BITS_PER_COMPONENT=8,Hp.FIELD_PREDICTOR="Predictor",Hp.FIELD_COLUMNS="Columns",Hp.FIELD_COLORS="Colors",Hp.FIELD_BITS_PER_COMPONENT="BitsPerComponent",Hp.NAME="FlateDecode";class Mp extends Op{constructor(){super(...arguments),this.name=Mp.NAME}static get className(){return"JBIG2Filter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){throw new Error("Method not implemented")}encodeSync(e){throw new Error("Method not implemented")}}Mp.NAME="JBIG2Decode";class Kp extends Op{constructor(){super(...arguments),this.name=Kp.NAME}static get className(){return"JPXFilter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){return e.buffer}encodeSync(e){return e.buffer}}Kp.NAME="JPXDecode";class qp extends Op{constructor(){super(...arguments),this.name=qp.NAME}static get className(){return"LZWFilter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){throw new Error("Method not implemented")}encodeSync(e){throw new Error("Method not implemented")}}qp.NAME="LZWDecode";class Wp extends Op{constructor(){super(...arguments),this.name=Wp.NAME}static get className(){return"RunLengthFilter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){let t=0,r=0;const s=new ja({appendBlock:e.buffer.byteLength});for(;128!==(t=e[r++]);)if(t<128)s.append(new La(e.subarray(r,t+1))),r+=t+1;else{const n=new ArrayBuffer(257-t),i=new Uint8Array(n);for(let s=0;s<257-t;s++)i[s]=e[r];s.append(new La({buffer:n})),r++}return s.stream.buffer.slice(0,s.start)}encodeSync(e){throw new Error("Method not implemented")}}Wp.NAME="RunLengthDecode";class Gp{static register(e){this.filters.set(e.name,e)}static get(e){const t=this.filters.get(e);if(!t)throw new Error(`Filter ${e} not found`);return t}}Gp.filters=new Map([[Tp.NAME,Tp],[Rp.NAME,Rp],[_p.NAME,_p],[Vp.NAME,Vp],[Hp.NAME,Hp],[Mp.NAME,Mp],[Kp.NAME,Kp],[qp.NAME,qp],[Wp.NAME,Wp]]);class zp extends Op{constructor(){super(...arguments),this.name=zp.NAME}static get className(){return"CryptFilter"}async decode(e){return this.decodeSync(e)}async encode(e){return this.encodeSync(e)}decodeSync(e){throw new Error("Method not implemented")}encodeSync(e){throw new Error("Method not implemented")}}zp.NAME="Crypt";const Jp=new Uint8Array([115,116,114,101,97,109]),$p=new Uint8Array([101,110,100,115,116,114,101,97,109]);class Yp extends gp{constructor(e){super(),this._stream={view:Yp.DEFAULT_STREAM},e&&(e instanceof Yp?(this.ownerElement=e.ownerElement,this.view=e.view,this.items=e.items,this._stream=e._stream,this.documentUpdate=e.documentUpdate):(this.stream=st.toUint8Array(e),this.set("Length",new ap(this.stream.length))))}static skipEndOfLine(e){const t=e.view.subarray(e.position);if(13===t[0]&&10===t[1])e.read(2);else{if(10!==t[0]&&13!==t[0])throw new Error("Wrong end of line (must be \\r\\n or \\n)");e.read(1)}}static async createAsync(e,t=[],r){let s=st.toUint8Array(e);for(const e of t){const t=await e.encode(s);s=new Uint8Array(t)}const n=new Yp(s);t.length&&(1===t.length?n.filter=new dp(t[0].name):n.filter=new Xp(...t.map((e=>new dp(e.name)))));for(const e in r)n.set(e,r[e]);return n}get stream(){return this._stream.view}set stream(e){this.encrypted=!1,this._stream.view=e}onWritePDF(e){this.length.value!==this.stream.length&&(this.length.value=this.stream.length),super.onWritePDF(e),e.writeString("\nstream\n"),e.write(this.stream),e.writeString("\nendstream")}onFromPDF(e){if(super.onFromPDF(e),Qp.skip(e),!Jp.every((t=>t===e.readByte())))throw new Qu(e.position-1);const t=this.length;if(!t)throw new Error("Required filed 'Length' is missing");if(t.isIndirect())if(t.documentUpdate)ap.assertPositiveInteger(t),Yp.skipEndOfLine(e),this.stream=e.read(t.value);else{Yp.skipEndOfLine(e);let t=e.findIndex("endstream");if(-1===t)throw new Ju("Cannot find 'endstream' keyword");if(13===e.view[t-1]&&10===e.view[t-2])t-=2;else{if(10!==e.view[t-1]&&13!==e.view[t-1])throw new Error("Wrong end of line (must be \\r\\n or \\n)");t-=1}this.stream=e.view.subarray(e.position,t),e.position=t}else t.value&&(Yp.skipEndOfLine(e),this.stream=e.read(t.value));if(this.has("Filter")&&(this.encrypted=!0),Qp.skip(e),!$p.every((t=>t===e.readByte())))throw new Qu(e.position-1)}getFilters(){const e=[];if(this.filter){let t=[];if(this.filter instanceof dp)t.push(this.filter.text);else{if(!(this.filter instanceof Xp))throw new TypeError("Unsupported type of Filter in the PDF Stream");t=this.filter.items.map((e=>{if(e instanceof dp)return e.text;throw new TypeError("Unsupported type of Filter in the PDF Stream")}))}for(let r=0;r<t.length;r++){const s=t[r],n=Gp.get(s);if(this.decodeParams){const t=this.decodeParams[r];e.push(new n(t))}else e.push(new n(null))}}return e}encodeSync(){if(this.encrypted)return this.stream.slice().buffer;const e=this.getFilters();e.reverse();for(const t of e){const e=t.encodeSync(this.stream);this.stream=new Uint8Array(e),this.length.value=this.stream.length}return e.find((e=>"Crypt"===e.name)),this.encrypted=!0,this.stream}decodeSync(){if(!1===this.encrypted)return this._stream.view.slice().buffer;const e=this.getFilters();for(const t of e){const e=t.decodeSync(this._stream.view);this._stream.view=new Uint8Array(e)}return this.encrypted=!1,this._stream.view.slice()}async encode(){var e;if(this.encrypted)return this.stream.slice().buffer;const t=this.getFilters();t.reverse();for(const e of t){const t=await e.encode(this.stream);this.stream=new Uint8Array(t),this.length.value=this.stream.length}if(t.find((e=>"Crypt"===e.name)))return this.encrypted=!0,this.stream;if(!this.encrypted&&(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler)){const e=await this.encryptAsync();this.stream=st.toUint8Array(e),this.length.value=this.stream.length}return this.encrypted=!0,this.stream}async decode(){var e;if(!1===this.encrypted)return this.stream.slice().buffer;const t=this.getFilters();if((!this.filter||!t.find((e=>"Crypt"===e.name)))&&(void 0===this.encrypted||this.encrypted)&&(!this.has("Type")||"XRef"!==this.get("Type",dp).text)&&(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler)){const e=await this.decryptAsync();this.stream=st.toUint8Array(e)}for(const e of t){const t=await e.decode(this.stream);this.stream=new Uint8Array(t)}return this.encrypted=!1,this.stream.slice()}async encryptAsync(){var e;const t=this.findIndirect(!0),r=st.toArrayBuffer(this.stream);return t&&(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler)?this.documentUpdate.encryptHandler.encrypt(r,t):r}async decryptAsync(){var e;const t=this.findIndirect(!0),r=st.toArrayBuffer(this.stream);return t&&(null===(e=this.documentUpdate)||void 0===e?void 0:e.encryptHandler)?this.documentUpdate.encryptHandler.decrypt(r,t):r}onCopy(e){super.onCopy(e),e.encrypted=this.encrypted,e.stream=this.stream.slice()}onCreate(){var e;super.onCreate();const t=this.getDocumentUpdate();this.length=t.document.createNumber(this.stream.length);const r=(null===(e=this.documentUpdate)||void 0===e?void 0:e.document.options)||{};r.disableCompressedStreams||(r.disableAscii85Encoding?this.filter=t.document.createName("FlateDecode"):this.filter=t.document.createArray(t.document.createName("ASCII85Decode"),t.document.createName("FlateDecode")))}toString(){return`${super.toString()}\nstream\n${this.onToStringStream()}\nendstream`}onToStringStream(){return at.ToBinary(this.stream)}addFilter(e){if(this.filter instanceof Xp){for(const t of this.filter)if(t instanceof dp&&t.text===e)return;this.filter.push(this.getDocument().createName(e))}else this.filter?this.filter.text!==e&&this.getDocument().createName(e):this.filter=this.getDocument().createName(e)}to(e,t=!1){const r=super.to(e);return t&&this.ownerElement instanceof td&&(this.ownerElement.value=r),r}clear(e=!1){this.stream=Yp.DEFAULT_STREAM,this.length.value=0,e||super.clear()}}Yp.DEFAULT_STREAM=new Uint8Array,wt([Ap({name:"Length",type:ap})],Yp.prototype,"length",void 0),wt([Ap({name:"Filter",optional:!0,cache:!0})],Yp.prototype,"filter",void 0),wt([Ap({name:"DecodeParms",get:function(e){if(e instanceof gp)return[e];if(e instanceof Xp){const t=[];for(const r of e.items)if(r instanceof gp)t.push(r);else{if(!(r instanceof lp))throw new TypeError("Unsupported type of DecodeParms subitem in the PDF Stream");t.push(null)}return t}throw new TypeError("Unsupported type of DecodeParms in the PDF Stream")},optional:!0,cache:!0})],Yp.prototype,"decodeParams",void 0);class Xp extends Xu{constructor(...e){super(),1===e.length&&e[0]instanceof Xp?(this.items=e[0].items,this.ownerElement=e[0].ownerElement,this.documentUpdate=e[0].documentUpdate,this.view=e[0].view):this.items=new Array(...e)}[Symbol.iterator](){let e=0;const t=this;return{next:()=>e<t.items.length?{done:!1,value:t.get(e++)}:{done:!0,value:null}}}get length(){return this.items.length}get(e,t,r=!1){const s=this.items[e];if(s){const n=s instanceof up?s.getValue():s,i=hp.convert(n,t,r);return r&&!i.isIndirect&&(this.items[e]=i),i}throw new RangeError("Array index is out of bounds")}push(...e){this.modify();for(const t of e)t instanceof Yp&&t.makeIndirect(),this.items.push(t)}indexOf(e){var t;for(let r=0;r<this.items.length;r++){const s=this.items[r];if(e.equal(s)||s instanceof up&&(null===(t=e.ownerElement)||void 0===t?void 0:t.equal(s)))return r}return-1}splice(e,t){return this.modify(),this.items.splice(e,t)}onWritePDF(e){e.writeString("[ ");for(const t of this.items){if(t.isIndirect()){const r=t.getIndirect();new up(r.id,r.generation).writePDF(e)}else t.writePDF(e);e.writeString(" ")}e.writeString("]")}onFromPDF(e){if(this.items.length&&(this.items=[]),91!==e.readByte())throw new Qu(e.position-1);for(;;){if(Qp.skip(e),93===e.view[e.position]){e.readByte();break}const t=Qp.read(e,this.documentUpdate,this);this.adoptChild(t),this.items.push(t)}}onCopy(e){super.onCopy(e);const t=[];for(const e of this.items)t.push(e.copy());e.items=t}toString(){return`[ ${this.items.map((e=>{if(e.isIndirect()){const t=e.getIndirect();return`${t.id} ${t.generation} R`}return e.toString()})).join(", ")} ]`}onEqual(e){if(e instanceof Xp&&e.items.length===this.items.length)for(let t=0;t<e.length;t++){const r=e.items[t];if(!this.items[t].equal(r))return!1}return!1}}class Qp{static read(e,t=null,r=null){switch(this.skip(e),!0){case 110===e.view[e.position]:return lp.fromPDF(e);case 116===e.view[e.position]||102===e.view[e.position]:return tp.fromPDF(e);case 47===e.view[e.position]:return dp.fromPDF(e);case 40===e.view[e.position]:return yp.fromPDF(e);case 91===e.view[e.position]:{const s=new Xp;return s.documentUpdate=t,s.ownerElement=r,s.fromPDF(e),s}case ap.isDigit(e.view[e.position]):{const s=e.position;try{const s=new up;return s.documentUpdate=t,s.ownerElement=r,s.fromPDF(e),s}catch(t){return e.position=s,ap.fromPDF(e)}}case 60===e.view[e.position]:if(60===e.view[e.position+1]){const s=e.position,n=new gp;if(n.documentUpdate=t,n.ownerElement=r,n.fromPDF(e),this.skip(e),115!==e.view[e.position])return n;e.position=s;const i=new Yp;return i.documentUpdate=t,i.ownerElement=r,i.fromPDF(e),i}return ip.fromPDF(e)}throw new Ju(`Cannot read PDF object at position ${e.position}`,e.position)}static skip(e){for(;e.findIndex((e=>!zu.whiteSpaceChars.includes(e))),!e.isEOF&&e.view[e.position]===zu.percentChar;)sp.fromPDF(e)}}const Zp=new Uint8Array([111,98,106]),ed=new Uint8Array([101,110,100,111,98,106]);class td extends op{constructor(e,t=0,r=new lp){void 0===e?super():super(e,t),this.value=r||new lp,this.value.ownerElement=this}onWritePDF(e){const t=new ap(this.id).toString(),r=new ap(this.generation).toString();e.writeString(`${t} ${r} obj\n`),this.value.writePDF(e),e.writeString("\nendobj\n")}onFromPDF(e){if(super.onFromPDF(e),!Zp.every((t=>t===e.readByte())))throw new Qu(e.position-1);if(Qp.skip(e),this.value=Qp.read(e,this.documentUpdate,this),this.adoptChild(this.value),Qp.skip(e),!ed.every((t=>t===e.readByte())))throw new Qu(e.position-1)}adoptChild(e){super.adoptChild(e),e.ownerElement=this}onCopy(e){super.onCopy(e),e.value=this.value.copy()}toString(){return`${this.id} ${this.generation} obj\n${this.value.toString()}\nendobj`}}class rd{static toPoint(e){return e/.75}}rd.names=["px"];class sd{static toPoint(e){return e}}sd.names=["pt"];class nd{static toPoint(e){return 72*e}}nd.names=["in"];class id{static toPoint(e){const t=e/2.54;return nd.toPoint(t)}}id.names=["cm"];class ad{static toPoint(e){const t=e/10;return id.toPoint(t)}}ad.names=["mm"];class od{static register(e){this.converters.push(e)}static findConverter(e){const t=e.toLowerCase();for(const e of this.converters)if(e.names.includes(t))return e;return null}static toPoint(e){try{const t=/(-?[0-9.]+(?:e-[0-9]+)?) *([a-z]+)?/i.exec(`${e}`);if(!t)throw new Error("Point size doesn't match to RegEx.");let r=0;const s=parseFloat(t[1]);if(isNaN(s))throw new Error("Float number has wrong format.");const n=t[2];if(n){const e=this.findConverter(n);if(!e)throw new Error(`Unknown type of converter '${n}'`);r=e.toPoint(s)}else r=sd.toPoint(s);return Math.round(100*r)/100}catch(e){const t="Cannot parse Typography point size.";if(e instanceof Error)throw e.message=`${t} ${e.message}`,e;throw new Error(t)}}static toPDFNumeric(e){const t=this.toPoint(e);return new ap(t)}}od.converters=[rd,sd,nd,ad,id];class cd extends Xp{static toRadians(e){return e*Math.PI/180}static toMatrix(e){return[[e[0],e[1],0],[e[2],e[3],0],[e[4],e[5],1]]}static createWithoutDocument(){const e=new cd;return e.onCreate(),e}setValue(e,t){this.get(e,ap).value=t,this.modify()}getValue(e){return this.get(e,ap).value}get a(){return this.getValue(0)}set a(e){this.setValue(0,e)}get b(){return this.getValue(1)}set b(e){this.setValue(1,e)}get c(){return this.getValue(2)}set c(e){this.setValue(2,e)}get d(){return this.getValue(3)}set d(e){this.setValue(3,e)}get e(){return this.getValue(4)}set e(e){this.setValue(4,e)}get f(){return this.getValue(5)}set f(e){this.setValue(5,e)}onCreate(){this.items=[new ap(1),new ap(0),new ap(0),new ap(1),new ap(0),new ap(0)]}toArray(){return[this.get(0,ap).value,this.get(1,ap).value,this.get(2,ap).value,this.get(3,ap).value,this.get(4,ap).value,this.get(5,ap).value]}transformMetrics(e){const t=this.toArray(),r=this.multiply(cd.toMatrix(t),cd.toMatrix(e));this.a=r[0][0],this.b=r[0][1],this.c=r[1][0],this.d=r[1][1],this.e=r[2][0],this.f=r[2][1]}translate(e,t){this.transformMetrics([1,0,0,1,od.toPoint(e),od.toPoint(t)])}scale(e,t){this.transformMetrics([e,0,0,t,0,0])}rotate(e){const t=cd.toRadians(e),r=Math.cos(t),s=Math.sin(t);this.transformMetrics([r,s,-s,r,0,0])}skew(e,t){const r=cd.toRadians(e),s=cd.toRadians(t);this.transformMetrics([1,r,s,1,0,0])}transform(e){for(const t of e)switch(t.type){case"rotate":this.rotate(t.angle);break;case"scale":this.scale(t.width,t.height);break;case"skew":this.skew(t.a,t.b);break;case"translate":this.translate(t.x,t.y)}}multiply(e,t){if(!(Array.isArray(e)&&Array.isArray(t)&&e.length&&t.length))throw new Error("Arguments should be in 2-dimensional array format");const r=e.length,s=e[0].length,n=t[0].length;if(t.length!==s)throw new Error("Number of columns in the first matrix should be the same as the number of rows in the second");const i=Array.apply(null,new Array(n)).map(Number.prototype.valueOf,0),a=new Array(r);for(let e=0;e<r;e++)a[e]=i.slice();for(let i=0;i<r;i++)for(let r=0;r<n;r++)for(let n=0;n<s;n++)a[i][r]+=e[i][n]*t[n][r];return a}}class ld{constructor(){this.name=ld.DEFAULT_NAME,this.parameters=[]}static create(e,...t){const r=new ld;return r.name=e,r.parameters.push(...t),r}static fromString(e){const t=new ld;return t.fromString(e),t}fromString(e){const t=new RegExp(ld.NAME_REGEX).exec(e);if(!t)throw new Error("Cannot get operator name");this.name=t[1];const r=e.substring(0,t.index);if(r){const e=at.FromBinary(r.trimEnd()),t=new $u(e);for(;;){const e=Qp.read(t);if(this.parameters.push(e),t.isEOF)break}}}toString(){return[...this.parameters.map((e=>at.ToBinary(e.toPDF()))),this.name].join(ld.SPACE_CHAR)}}ld.NAME_REGEX=/([A-Z0-9*'"]+)\s*$/i,ld.SPACE_CHAR=" ",ld.DEFAULT_NAME="";class hd{static fromPDFNumberArray(e){const t=[];for(const r of e)t.push(r.value);return t}static fromPDFArray(e){const t=[];for(const r of e)r instanceof ap&&t.push(r.value);return t}static toPDFNumberArray(e){return"number"==typeof e?[new ap(e)]:e.map((e=>new ap(e)))}static toPDFArray(e){return new Xp(...this.toPDFNumberArray(e))}}var ud,pd,dd,fd,md,gd,yd,vd,wd,bd,Sd,Ad,kd,Cd,Id,xd,Ed,Bd,Nd,Pd,Dd,Ud,Od,Td,Rd;!function(e){e[e.buttCap=0]="buttCap",e[e.roundCap=1]="roundCap",e[e.projectingSquareCap=2]="projectingSquareCap"}(ud||(ud={})),function(e){e[e.miterJoin=0]="miterJoin",e[e.roundJoin=1]="roundJoin",e[e.bevelJoin=1]="bevelJoin"}(pd||(pd={}));class _d extends Fl{constructor(){super(...arguments),this.operators=[]}static create(...e){return(new _d).push(...e)}emit(e,...t){return super.emit(e,...t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}push(...e){if(1===e.length){const t=e[0];if(t instanceof Vd||t instanceof ld)return this.emit("push",t),this.operators.push(t),this}for(const[t,...r]of e){const e=ld.create(t,...r);this.push(e)}return this}clear(){return this.operators=[],this.emit("clear"),this}static fromString(e){const t=new _d;return t.fromString(e),t}fromString(e){const t=new $u(at.FromBinary(e));let r=[];for(;!t.isEOF;)try{const e=Qp.read(t);if(e instanceof sp)continue;r.push(e)}catch(e){const s=t.read((e=>_d.SPLITTERS.includes(String.fromCharCode(e))));if(!s.length)break;const n=new ld;n.name=at.ToUtf8String(s,"ascii"),n.parameters=r,this.operators.push(n),r=[]}}toString(e=!1){const t=e?" ":"\n";return this.operators.map((t=>t.toString(e))).join(t)}setFontAndSize(e){return this.push(["Tf",new dp(e.font),new ap(e.size)])}toArrayBuffer(){const e=this.toString();return at.FromBinary(e)}toUint8Array(){const e=this.toArrayBuffer();return new Uint8Array(e)}graphicsBegin(){return this.push(["q"])}graphicsEnd(){return this.push(["Q"])}graphicsState(e){return this.push(["gs",new dp(e)])}concatMatrix(e,t,r,s,n,i){return this.push(["cm",od.toPDFNumeric(e),od.toPDFNumeric(t),od.toPDFNumeric(r),od.toPDFNumeric(s),od.toPDFNumeric(n),od.toPDFNumeric(i)]),this}setLineWidth(e){return this.push(["w",od.toPDFNumeric(e)]),this}setLineCap(e){return this.push(["J",new ap(e)]),this}setLineJoin(e){return this.push(["j",new ap(e)]),this}moveTo(e,t){return this.push(["m",od.toPDFNumeric(e),od.toPDFNumeric(t)]),this}lineTo(e,t){return this.push(["l",od.toPDFNumeric(e),od.toPDFNumeric(t)]),this}curveTo(e,t,r,s,n,i){return this.push(["c",od.toPDFNumeric(e),od.toPDFNumeric(t),od.toPDFNumeric(r),od.toPDFNumeric(s),od.toPDFNumeric(n),od.toPDFNumeric(i)]),this}stroke(e=!1){return this.push([e?"s":"S"]),this}fill(){return this.push(["f"]),this}pathEnd(){return this.push(["n"]),this}clippingArea(e){return this.push(["re",od.toPDFNumeric(e.x),od.toPDFNumeric(e.y),od.toPDFNumeric(e.width),od.toPDFNumeric(e.height)]),this.clip(),this.pathEnd(),this}clip(){return this.push(["W"]),this}clipEO(){return this.push(["W*"]),this}textBegin(){return this.push(["BT"]),this}textEnd(){return this.push(["ET"]),this}textCharacterSpacing(e){return this.push(["Tc",od.toPDFNumeric(e)]),this}textWordSpacing(e){return this.push(["Tw",od.toPDFNumeric(e)]),this}textScale(e){return this.push(["Tz",od.toPDFNumeric(e)]),this}textLeading(e){return this.push(["TL",od.toPDFNumeric(e)]),this}textFont(e,t){return this.push(["Tf",new dp(e),od.toPDFNumeric(t)]),this}textRender(e){return this.push(["Tr",new ap(e)]),this}textRise(e){return this.push(["Ts",od.toPDFNumeric(e)]),this}textMove(e,t){return this.push(["Td",od.toPDFNumeric(e),od.toPDFNumeric(t)]),this}textMoveLeading(e,t){return this.push(["TD",od.toPDFNumeric(e),od.toPDFNumeric(t)]),this}textMatrix(e,t=0,r=0,s=1,n=0,i=0){return e instanceof cd?this.push(["Tm",e]):this.push(["Tm",od.toPDFNumeric(e),od.toPDFNumeric(t),od.toPDFNumeric(r),od.toPDFNumeric(s),od.toPDFNumeric(n),od.toPDFNumeric(i)]),this}textTransform(e){const t=cd.createWithoutDocument();return t.transform(e),this.textMatrix(t.a,t.b,t.c,t.d,t.e,t.f)}textNextLine(){return this.push(["T*"]),this}textShow(e){return"string"==typeof e?e=new yp(e):st.isBufferSource(e)&&(e=new ip(e)),this.push(["Tj",e]),this}setColor(e,t=!1){let r,s;return"number"==typeof e?(r=t?"G":"g",s=[new ap(e)]):1===e.length?(r=t?"G":"g",s=e.map((e=>new ap(e)))):3===e.length?(r=t?"RG":"rg",s=e.map((e=>new ap(e)))):(r=t?"K":"k",s=e.map((e=>new ap(e)))),this.push([r,...s]),this}drawXObject(e){return this.push(["Do",new dp(e)]),this}markedContentBegin(e,t){return t?this.push(["BMC",new dp(e),t]):this.push(["BDC",new dp(e)]),this}markedContentEnd(){return this.push(["EMC"]),this}drawCircle(e,t,r){const s=.5523,n=od.toPoint(e),i=od.toPoint(t),a=od.toPoint(r);return this.moveTo(n+a,i).curveTo(n+a,i+a*s,n+a*s,i+a,n,i+a).curveTo(n-a*s,i+a,n-a,i+a*s,n-a,i).curveTo(n-a,i-a*s,n-a*s,i-a,n,i-a).curveTo(n+a*s,i-a,n+a,i-a*s,n+a,i)}drawRectangle(e,t,r,s){const n=od.toPoint(e),i=od.toPoint(t),a=od.toPoint(s),o=od.toPoint(r);return this.push(["re",new ap(n),new ap(i),new ap(o),new ap(a)]),this}translate(e,t){return this.concatMatrix(1,0,0,1,e,t)}scale(e,t){return this.concatMatrix(e,0,0,t,0,0)}skew(e,t){return this.concatMatrix(1,Math.tan(cd.toRadians(e)),Math.tan(cd.toRadians(t)),1,0,0)}rotate(e){const t=cd.toRadians(e);return this.concatMatrix(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0)}transform(e){if(e.length){const t=cd.createWithoutDocument();return t.transform(e),this.concatMatrix(...t.toArray())}return this}graphics(){const e=new Fd;return this.push(e),e}text(e=!1){const t=e?new Vd(ld.fromString("/Tx BMC"),ld.fromString("EMC")):new Ld;return this.push(t),t}}_d.SPLITTERS=" \n\r\t";class Vd extends _d{constructor(e,t){super(),this.begin=e,this.end=t,this.push(e)}toString(e){return this.push(this.end),super.toString(e)}}class Fd extends Vd{constructor(){super(Fd.BEGIN,Fd.END)}}Fd.BEGIN=ld.create("q"),Fd.END=ld.create("Q");class Ld extends Vd{constructor(){super(Ld.BEGIN,Ld.END)}}Ld.BEGIN=ld.create("BT"),Ld.END=ld.create("ET");class jd extends Yp{constructor(e){super(e),dd.set(this,void 0),e instanceof jd&&St(this,dd,e.content,"f")}get content(){if(!bt(this,dd,"f")){const e=St(this,dd,_d.fromString(at.ToBinary(this.stream)),"f"),t=this.clear.bind(this,!0);e.once("push",t),e.once("clear",t)}return bt(this,dd,"f")}serializeContent(){const e=this.content;!this.stream.length&&e&&e.operators.length&&(this.stream=e.toUint8Array())}async encode(){return this.serializeContent(),super.encode()}clear(e=!1){super.clear(e)}}dd=new WeakMap;class Hd extends gp{}wt([Ap({name:"E",optional:!0,type:gp})],Hd.prototype,"e",void 0),wt([Ap({name:"X",optional:!0,type:gp})],Hd.prototype,"x",void 0),wt([Ap({name:"D",optional:!0,type:gp})],Hd.prototype,"d",void 0),wt([Ap({name:"U",optional:!0,type:gp})],Hd.prototype,"u",void 0),wt([Ap({name:"Fo",optional:!0,type:gp})],Hd.prototype,"fo",void 0),wt([Ap({name:"Bl",optional:!0,type:gp})],Hd.prototype,"bl",void 0),wt([Ap({name:"PO",optional:!0,type:gp})],Hd.prototype,"po",void 0),wt([Ap({name:"PC",optional:!0,type:gp})],Hd.prototype,"pc",void 0),wt([Ap({name:"PV",optional:!0,type:gp})],Hd.prototype,"pv",void 0),wt([Ap({name:"PI",optional:!0,type:gp})],Hd.prototype,"pi",void 0);class Md{static generate(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>{const t=parseInt(e,10);return(t^(256*Math.random()|0)&15>>t/4).toString(16)})).toLocaleUpperCase()}}!function(e){e[e.readOnly=1]="readOnly",e[e.required=2]="required",e[e.noExport=4]="noExport"}(fd||(fd={}));class Kd extends gp{onCreate(){super.onCreate();const e=this.getDocument();this.ft="",this.t=e.createString(Md.generate())}addKid(e){this.modify().Kids.get().push(e.makeIndirect()),e.Parent=this.makeIndirect()}}wt([Cp("FT")],Kd.prototype,"ft",void 0),wt([Ap({name:"Parent",type:Kd,optional:!0,indirect:!0})],Kd.prototype,"Parent",void 0),wt([Up("Kids",Xp)],Kd.prototype,"Kids",void 0),wt([Dp("T")],Kd.prototype,"t",void 0),wt([Ap({name:"TU",type:yp,optional:!0})],Kd.prototype,"TU",void 0),wt([Ap({name:"TM",type:yp,optional:!0})],Kd.prototype,"tm",void 0),wt([kp("Ff",!0,0)],Kd.prototype,"ff",void 0),wt([Ap({name:"V",optional:!0})],Kd.prototype,"V",void 0),wt([Ap({name:"DV",optional:!0})],Kd.prototype,"dv",void 0),wt([Ap({name:"AA",type:Hd,optional:!0})],Kd.prototype,"aa",void 0),function(e){e[e.noToggleToOff=16384]="noToggleToOff",e[e.radio=32768]="radio",e[e.pushbutton=65536]="pushbutton",e[e.radiosInUnison=33554432]="radiosInUnison"}(md||(md={}));class qd extends Kd{}wt([Bp("Opt",!0)],qd.prototype,"opt",void 0);class Wd extends gp{onCreate(){super.onCreate(),this.Type=Wd.TYPE}}function Gd(e){switch(e){case"0":return yd.notShallBe;case"1":return yd.shallBe;default:return yd.notMatter}}Wd.TYPE="DSS",wt([Cp("Type",!0,Wd.TYPE)],Wd.prototype,"Type",void 0),wt([Up("VRI",gp)],Wd.prototype,"VRI",void 0),wt([Up("Certs",Xp)],Wd.prototype,"Certs",void 0),wt([Up("OCSPs",Xp)],Wd.prototype,"OCSPs",void 0),wt([Up("CRLs",Xp)],Wd.prototype,"CRLs",void 0),function(e){e[e.subject=1]="subject",e[e.issuer=2]="issuer",e[e.oid=4]="oid",e[e.subjectDN=8]="subjectDN",e[e.reserved=16]="reserved",e[e.keyUsage=32]="keyUsage",e[e.url=64]="url"}(gd||(gd={})),function(e){e[e.notShallBe=0]="notShallBe",e[e.shallBe=1]="shallBe",e[e.notMatter=2]="notMatter"}(yd||(yd={}));class zd extends gp{}wt([Ap({name:"Type",type:dp,optional:!0})],zd.prototype,"type",void 0),wt([Ap({name:"Ff",type:ap,optional:!0,defaultValue:0,get:e=>e.value})],zd.prototype,"ff",void 0),wt([Ap({name:"Subject",type:Xp,optional:!0})],zd.prototype,"subject",void 0),wt([Ap({name:"SubjectDN",type:Xp,optional:!0})],zd.prototype,"subjectDN",void 0),wt([Ap({name:"KeyUsage",type:Xp,optional:!0,cache:!0,get:function(e){const t=[];for(const r of e.items){if(!(r instanceof yp))throw new TypeError("Wrong type of KeyUsage item. Must be PDF literal string");t.push({digitalSignature:Gd(r.text[0]),nonRepudiation:Gd(r.text[1]),keyEncipherment:Gd(r.text[2]),dataEncipherment:Gd(r.text[3]),keyAgreement:Gd(r.text[4]),keyCertSign:Gd(r.text[5]),cRLSign:Gd(r.text[6]),encipherOnly:Gd(r.text[7]),decipherOnly:Gd(r.text[8])})}return t}})],zd.prototype,"keyUsage",void 0),wt([Ap({name:"Issuer",type:Xp,optional:!0})],zd.prototype,"issuer",void 0),wt([Ap({name:"OID",type:Xp,optional:!0,get:e=>e.items.map((e=>{if(!(e instanceof yp))throw new TypeError("Wrong type of OID item. Must be PDF literal string");return e}))})],zd.prototype,"oid",void 0),wt([Ap({name:"URL",type:yp,optional:!0})],zd.prototype,"url",void 0),wt([Ap({name:"URLType",type:dp,optional:!0,get:e=>e.text})],zd.prototype,"urlType",void 0),function(e){e.docMDP="DocMDP",e.ur="UR",e.fieldMDP="FieldMDP"}(vd||(vd={}));class Jd extends gp{}wt([Ap({type:dp,name:"Type",get:e=>e.text})],Jd.prototype,"type",void 0),wt([Ap({type:dp,name:"TransformMethod",get:e=>e.text})],Jd.prototype,"transformMethod",void 0),wt([Ap({type:gp,name:"TransformParams",optional:!0})],Jd.prototype,"transformParams",void 0),wt([Ap({name:"Data",optional:!0})],Jd.prototype,"data",void 0),wt([Ap({name:"Digest",type:dp,optional:!0,get:e=>e.text,defaultValue:"MD5"})],Jd.prototype,"digest",void 0),function(e){e.signature="Sig",e.timeStamp="DocTimeStamp"}(wd||(wd={}));class $d extends gp{onCreate(){super.onCreate();const e=this.getDocument();this.type=wd.signature,this.filter="Adobe.PPKLite",this.Contents=e.createHexString()}}wt([Cp("Type",!0,wd.signature)],$d.prototype,"type",void 0),wt([Cp("Filter")],$d.prototype,"filter",void 0),wt([Cp("SubFilter",!0)],$d.prototype,"subFilter",void 0),wt([Ap({type:ip,name:"Contents"})],$d.prototype,"Contents",void 0),wt([Ap({name:"Cert",optional:!0})],$d.prototype,"cert",void 0),wt([Up("ByteRange",Xp)],$d.prototype,"ByteRange",void 0),wt([Ap({name:"Reference",type:Xp,cache:!0,get:e=>e.items.map((e=>{if(!(e instanceof gp))throw new TypeError("Unsupported type of the field 'Reference'");return new Jd(e)})),optional:!0})],$d.prototype,"reference",void 0),wt([Ap({name:"Changes",type:Xp,optional:!0})],$d.prototype,"changes",void 0),wt([Ap({name:"Name",type:yp,optional:!0})],$d.prototype,"name",void 0),wt([Ap({name:"M",type:yp,get:e=>new bp(e),optional:!0})],$d.prototype,"signingTime",void 0),wt([Up("Location",yp)],$d.prototype,"Location",void 0),wt([Up("Reason",yp)],$d.prototype,"Reason",void 0),wt([Ap({name:"ContactInfo",type:yp,optional:!0})],$d.prototype,"contactInfo",void 0),wt([Ap({name:"R",type:ap,get:e=>e.value,optional:!0})],$d.prototype,"r",void 0),wt([Ap({name:"V",type:ap,get:e=>e.value,optional:!0})],$d.prototype,"v",void 0),wt([Ap({name:"Prop_Build",type:gp,optional:!0})],$d.prototype,"propBuild",void 0),wt([Ap({name:"Prop_AuthTime",type:ap,get:e=>e.value,optional:!0})],$d.prototype,"propAuthTime",void 0),wt([Ap({name:"Prop_AuthType",type:dp,get:e=>e.text,optional:!0})],$d.prototype,"propAuthType",void 0);class Yd extends Kd{onCreate(){super.onCreate(),this.ft=Yd.FIELD_TYPE}}Yd.FIELD_TYPE="Sig",wt([Ap({name:"V",type:$d,optional:!0})],Yd.prototype,"V",void 0),wt([Ap({name:"Lock",type:gp,optional:!0})],Yd.prototype,"lock",void 0),wt([Ap({name:"SV",type:gp,optional:!0})],Yd.prototype,"sv",void 0),function(e){e.all="All",e.include="Include",e.exclude="Exclude"}(bd||(bd={}));class Xd extends gp{}wt([Ap({name:"Type",type:dp,optional:!0,get:e=>e.text})],Xd.prototype,"type",void 0),wt([Ap({name:"Action",type:dp,optional:!0,get:e=>e.text})],Xd.prototype,"action",void 0),wt([Ap({name:"Fields",type:Xp,optional:!0})],Xd.prototype,"fields",void 0);class Qd extends gp{}wt([Ap({name:"P",type:ap,get:e=>e.value})],Qd.prototype,"p",void 0),function(e){e[e.filter=1]="filter",e[e.subFilter=2]="subFilter",e[e.v=4]="v",e[e.reasons=8]="reasons",e[e.legalAttestation=16]="legalAttestation",e[e.addRevInfo=32]="addRevInfo",e[e.digestMethod=64]="digestMethod"}(Sd||(Sd={}));class Zd extends gp{}wt([Ap({name:"Type",type:dp,optional:!0,get:e=>e.text})],Zd.prototype,"type",void 0),wt([Ap({name:"Ff",type:ap,optional:!0,get:e=>e.value,defaultValue:0})],Zd.prototype,"ff",void 0),wt([Ap({name:"Filter",type:dp,optional:!0,get:e=>e.text})],Zd.prototype,"filter",void 0),wt([Ap({name:"SubFilter",type:Xp,optional:!0})],Zd.prototype,"subFilter",void 0),wt([Ap({name:"DigestMethod",type:Xp,optional:!0})],Zd.prototype,"digestMethod",void 0),wt([Ap({name:"V",type:ap,optional:!0})],Zd.prototype,"v",void 0),wt([Ap({name:"Cert",type:gp,optional:!0})],Zd.prototype,"cert",void 0),wt([Ap({name:"Reasons",type:Xp,optional:!0})],Zd.prototype,"reasons",void 0),wt([Ap({name:"MDP",type:gp,optional:!0,cache:!0,get:e=>new Qd(e)})],Zd.prototype,"mdp",void 0),wt([Ap({name:"TimeStamp",type:gp,optional:!0})],Zd.prototype,"timeStamp",void 0),wt([Ap({name:"LegalAttestation",type:Xp,optional:!0})],Zd.prototype,"legalAttestation",void 0),wt([Ap({name:"AddRevInfo",type:tp,optional:!0,defaultValue:!1})],Zd.prototype,"addRevInfo",void 0);class ef extends gp{}ef.TYPE="VRI",wt([Cp("Type",!0,ef.TYPE)],ef.prototype,"type",void 0),wt([Up("Cert",Xp)],ef.prototype,"Cert",void 0),wt([Up("CRL",Xp)],ef.prototype,"CRL",void 0),wt([Up("OCSP",Xp)],ef.prototype,"OCSP",void 0),wt([Pp("TU",!0)],ef.prototype,"TU",void 0),wt([Np("TS",!0)],ef.prototype,"TS",void 0),function(e){e[e.multiline=4096]="multiline",e[e.password=8192]="password",e[e.fileSelect=1048576]="fileSelect",e[e.doNotSpellCheck=4194304]="doNotSpellCheck",e[e.doNotScroll=8388608]="doNotScroll",e[e.comb=16777216]="comb",e[e.richText=33554432]="richText"}(Ad||(Ad={}));class tf extends Xp{static createWithData(e,t,r,s,n){const i=this.create(e);return i.get(0,ap).value=t,i.get(1,ap).value=r,i.get(2,ap).value=s,i.get(3,ap).value=n,i}get llX(){return this.get(0,ap).value}set llX(e){this.modify(),this.get(0,ap).value=e}get llY(){return this.get(1,ap).value}set llY(e){this.modify(),this.get(1,ap).value=e}get urX(){return this.get(2,ap).value}set urX(e){this.modify(),this.get(2,ap).value=e}get urY(){return this.get(3,ap).value}set urY(e){this.modify(),this.get(3,ap).value=e}onCreate(){this.items=[new ap(0),new ap(0),new ap(0),new ap(0)]}getCoordinates(){if(4!==this.items.length)throw new Error("The rectangle must have 4 coordinates");return this.items.map((e=>{if(!(e instanceof ap))throw new Error("All rectangle coordinates must be numbers");return e.value}))}}class rf extends gp{}wt([Ap({name:"Kids",type:Xp,optional:!0,get:e=>e.items})],rf.prototype,"kids",void 0),wt([Ap({name:"Names",type:Xp,optional:!0,get:e=>{const t=new Map;for(let r=0;r<e.length;r+2){const s=e.items[r],n=e.items[r+1];if(!(s instanceof yp))throw new Error("Key must be string");if(!(n instanceof up))throw new Error("Value must be Indirect Reference");t.set(s.text,n)}return t}})],rf.prototype,"names",void 0),wt([Ap({name:"Limits",type:Xp,optional:!0,get:e=>e.items})],rf.prototype,"limits",void 0);class sf extends gp{}wt([Ap({name:"Kids",type:Xp,optional:!0,get:e=>e.items})],sf.prototype,"kids",void 0),wt([Ap({name:"Names",type:Xp,optional:!0,get:e=>{const t=new Map;for(let r=0;r<e.length;r+2){const s=e.items[r],n=e.items[r+1];if(!(s instanceof ap))throw new Error("Key must be integer");if(ap.assertPositiveInteger(s),!(n instanceof up))throw new Error("Value must be Indirect Reference");t.set(s.value,n)}return t}})],sf.prototype,"names",void 0),wt([Ap({name:"Limits",type:Xp,optional:!0,get:e=>e.items})],sf.prototype,"limits",void 0);class nf extends gp{onCreate(){this.type=nf.TYPE}}nf.TYPE="Action",wt([Cp("Type",!0)],nf.prototype,"type",void 0),wt([Cp("S")],nf.prototype,"s",void 0),wt([Ap({name:"Next",optional:!0})],nf.prototype,"next",void 0);class af extends gp{}wt([Ap({name:"N"})],af.prototype,"N",void 0),wt([Ap({name:"R",optional:!0})],af.prototype,"r",void 0),wt([Ap({name:"D",optional:!0})],af.prototype,"D",void 0);class of extends gp{}wt([Ap({name:"ExtGState",type:gp,optional:!0})],of.prototype,"extGState",void 0),wt([Ap({name:"ColorSpace",type:gp,optional:!0})],of.prototype,"colorSpace",void 0),wt([Ap({name:"Pattern",type:gp,optional:!0})],of.prototype,"pattern",void 0),wt([Ap({name:"Shading",type:gp,optional:!0})],of.prototype,"Shading",void 0),wt([Ap({name:"XObject",type:gp,optional:!0})],of.prototype,"XObject",void 0),wt([Ap({name:"Font",type:gp,optional:!0})],of.prototype,"font",void 0),wt([Ap({name:"ProcSet",type:gp,optional:!0})],of.prototype,"procSet",void 0),wt([Ap({name:"Properties",type:gp,optional:!0})],of.prototype,"properties",void 0);class cf extends Yp{constructor(){super(...arguments),kd.set(this,void 0),Cd.set(this,[])}onCreate(){super.onCreate(),this.type=cf.TYPE,this.n=0,this.first=0}async decode(){if(bt(this,kd,"f"))return bt(this,kd,"f").buffer;const e=await super.decode();St(this,kd,new Uint8Array(e),"f");const t=new $u(bt(this,kd,"f"));let r=this.n;for(;r--;){const e=ap.fromPDF(t).value;t.readByte();const r=ap.fromPDF(t).value;bt(this,Cd,"f").push({id:e,offset:r}),t.readByte()}return bt(this,kd,"f").buffer}async encode(){const e=new Yu,t=new Yu,r=bt(this,Cd,"f");for(const s of r){const r=this.getDocumentUpdate().getObject(s.id);e.writeString(`${s.id} ${t.length} `),r.value.writePDF(t)}const s=new Yu;return s.write(e.toUint8Array()),s.write(t.toUint8Array()),this.n=r.length,this.first=e.length,this.stream=s.toUint8Array(),this.length.value=this.stream.length,super.encode()}setValue(e){bt(this,Cd,"f").push({id:e,offset:-1}),this.n++}getValue(e){if(!bt(this,kd,"f"))throw new Error("Compressed stream in not decoded call 'decode' method first");if(e>=bt(this,Cd,"f").length)throw new RangeError("Argument 'index' is greater than amount of indirect objects in the Compressed Object");const t=bt(this,Cd,"f")[e].offset+this.first;return Qp.read(new $u(bt(this,kd,"f").subarray(t)),this.documentUpdate)}}kd=new WeakMap,Cd=new WeakMap,cf.TYPE="ObjStm",wt([Ap({name:"Type",type:dp,get:e=>e.text,set:e=>new dp(e)})],cf.prototype,"type",void 0),wt([Ap({name:"N",type:ap,get:e=>e.value,set:e=>new ap(e),defaultValue:0})],cf.prototype,"n",void 0),wt([Ap({name:"First",type:ap,get:e=>e.value,set:e=>new ap(e),defaultValue:0})],cf.prototype,"first",void 0),wt([Ap({name:"Extends",type:cf})],cf.prototype,"extends",void 0),function(e){e.free="f",e.inUse="n",e.compressed="c"}(xd||(xd={}));class lf{constructor(e){Id.set(this,void 0),this.documentUpdate=e.documentUpdate,this.offset=e.offset,this.id=e.id,this.generation=e.generation,this.type=e.type}createReference(){const e=new up(this.id,this.type===xd.compressed?0:this.generation);return e.documentUpdate=this.documentUpdate,e}get indirect(){return bt(this,Id,"f")}copy(){const e=new lf({id:this.id,documentUpdate:this.documentUpdate,generation:this.generation,offset:0,type:this.type});return bt(this,Id,"f")||this.type===xd.free||this.value,St(e,Id,bt(this,Id,"f").copy(),"f"),e}static create(e){const t=new lf({offset:0,type:xd.inUse,id:e.id,generation:e.generation,documentUpdate:e.documentUpdate});return St(t,Id,e,"f"),t}get value(){if(!bt(this,Id,"f")){if(!this.documentUpdate.document)throw new Error("Required field 'document' is missing");if(this.type===xd.compressed){const e=this.documentUpdate.getObject(this.offset).value;if(!(e instanceof cf))throw new TypeError("Received object is not type of CompressedObject");const t=e.getValue(this.generation),r=new td(this.id,0,t);r.documentUpdate=this.documentUpdate,St(this,Id,r,"f"),t.ownerElement=r}else{const e=new td;e.documentUpdate=this.documentUpdate,e.fromPDF(this.documentUpdate.document.view,this.offset),St(this,Id,e,"f")}}return bt(this,Id,"f").value}set value(e){bt(this,Id,"f").value=e}prev(){var e;return(null===(e=this.documentUpdate.previous)||void 0===e?void 0:e.getObject(this.id))||null}toString(){const e=[];switch(this.type){case xd.compressed:e.push(`${this.id} 0 obj % compressed ObjStm(${this.offset} 0 R)`),e.push(this.value.toString()),e.push("endobj");break;case xd.inUse:e.push(`${this.id} ${this.generation} obj % in-use`),e.push(this.value.toString()),e.push("endobj");break;case xd.free:e.push(`${this.id} ${this.generation} obj endobj % free`)}return e.join("\n")}}Id=new WeakMap;class hf extends gp{onCreate(){const e=this.getDocumentUpdate();this.type=hf.TYPE,this.kids=e.document.createArray(),this.count=0}addPage(e){this.insertBefore(e)}indexOf(e){if(this.kids&&e.isIndirect())for(let t=0;t<this.kids.items.length;t++){const r=this.kids.items[t].getIndirect(),s=e.getIndirect();if(r.id===s.id&&r.generation===s.generation)return t}return-1}insertBefore(e,t){if(this.modify(),e.makeIndirect(),t){const r=this.indexOf(e),s=this.indexOf(t);-1!==r&&this.kids.items.splice(r,1),this.kids.items.splice(s,0,e)}else this.kids.items.push(e);this.count=this.kids.length,e.parent=this}remove(e){if("number"==typeof e)return this.remove(this.kids.get(e,uf));const t=this.indexOf(e);-1!==t&&(this.kids.items.splice(t,1),this.modify(),this.count=this.kids.length,e.parent=this)}async addPageOld(e){this.modify();const t=this.getDocumentUpdate();let r;if(e){if(e instanceof lf){if(!(e.value instanceof gp))throw new Error("The PDFDocumentObject must contain PageObjectDictionary");{const t=e.value.get("Type");if(!(t instanceof dp&&"Page"===t.text))throw new Error("The page must contain the Page type");r=e.value}}else r=e;const s=r.copy(),n=t.append(s),i=n.value;i.delete("Parent"),this.kids.items.push(n.createReference()),this.count++,e.documentUpdate&&e.documentUpdate.document!==t.document&&await this.copyAllRef(n,e.documentUpdate);const a=this.ownerElement;return i.set("Parent",new up(a.id,a.generation)),n}{const e=uf.create(t);e.parent=this;const r=t.append(e);return this.kids.items.push(r.createReference()),this.count++,r}}async copyAllRef(e,t,r=new Map,s){if(e instanceof lf)await this.copyAllRef(e.value,t,r);else if(e instanceof up){const n=`${e.id} ${e.generation} R`;if(r.has(n)){const t=r.get(n);if(!t)throw new Error("Wrong map reference");e.id=t.id,e.generation=t.generation}else{const s=t.getObject(e.id,e.generation).value.copy();s instanceof Yp&&await s.decode();const i=this.getDocumentUpdate().document.append(s);e.id=i.id,e.generation=i.generation,r.set(n,{id:i.id,generation:i.generation}),await this.copyAllRef(i,t,r)}s&&e.ownerElement.set(s,e)}else if(e instanceof gp)for(const[s,n]of e.items)"Annots"===s?e.delete(s):await this.copyAllRef(n,t,r,s);else{if(!(e instanceof Xp))return;for(const s of e.items)await this.copyAllRef(s,t,r)}}}hf.TYPE="Pages",wt([Cp("Type")],hf.prototype,"type",void 0),wt([Ap({name:"Parent",type:hf,optional:!0})],hf.prototype,"parent",void 0),wt([Bp("Kids",!0)],hf.prototype,"kids",void 0),wt([kp("Count")],hf.prototype,"count",void 0),function(e){e.row="R",e.column="C",e.structure="S",e.annotationsArray="A",e.widget="order"}(Ed||(Ed={}));class uf extends gp{createMediaBox(e,t){const r=od.toPoint(e),s=od.toPoint(t);return this.getDocument().createRectangle(0,0,r,s)}onCreate(){const e=this.getDocumentUpdate();this.type=uf.TYPE,this.resources=of.create(e),this.mediaBox=this.createMediaBox("210mm","297mm")}getOrCreateContents(){return this.contents||(this.modify(),this.contents=Xp.create(this.getDocumentUpdate())),this.contents}addAnnot(e){this.annots||(this.annots=this.getDocument().createArray()),this.annots.push(e.makeIndirect()),e.p=this}addContent(e){this.modify();const t=this.getOrCreateContents();if(!(t instanceof Xp))throw new Error("Stream is not supported yet");{const r=this.getDocumentUpdate().document.createStream(e.toArrayBuffer());t.items.push(r.makeIndirect())}}addResource(e,t){if(e instanceof gp&&e.has("Type")){"XObject"===e.get("Type",dp).text&&(this.resources.XObject||(this.resources.XObject=this.getDocument().createDictionary()),this.resources.XObject.set(null!=t?t:Md.generate(),e.makeIndirect()))}throw new TypeError("Cannot add the resource to the page. Unsupported type of the resource.")}}uf.TYPE="Page",wt([Cp("Type")],uf.prototype,"type",void 0),wt([Ap({name:"Parent",type:hf,indirect:!0})],uf.prototype,"parent",void 0),wt([Pp("LastModified",!0)],uf.prototype,"lastModified",void 0),wt([Ap({type:of,name:"Resources"})],uf.prototype,"resources",void 0),wt([Ap({type:tf,name:"MediaBox"})],uf.prototype,"mediaBox",void 0),wt([Ap({type:Xp,name:"CropBox",optional:!0,get:e=>new tf(e)})],uf.prototype,"cropBox",void 0),wt([Ap({type:Xp,name:"BleedBox",optional:!0,get:e=>new tf(e)})],uf.prototype,"bleedBox",void 0),wt([Ap({type:Xp,name:"TrimBox",optional:!0,get:e=>new tf(e)})],uf.prototype,"trimBox",void 0),wt([Ap({type:Xp,name:"ArtBox",optional:!0,get:e=>new tf(e)})],uf.prototype,"artBox",void 0),wt([Ap({type:gp,name:"BoxColorInfo",optional:!0})],uf.prototype,"boxColorInfo",void 0),wt([Ap({name:"Contents",optional:!0})],uf.prototype,"contents",void 0),wt([kp("Rotate",!0,0)],uf.prototype,"rotate",void 0),wt([Ap({name:"Group",type:gp,optional:!0})],uf.prototype,"group",void 0),wt([Ap({name:"Thumb",type:Yp,optional:!0})],uf.prototype,"thumb",void 0),wt([Ap({name:"B",type:Xp,optional:!0})],uf.prototype,"b",void 0),wt([kp("Dur",!0)],uf.prototype,"dur",void 0),wt([Ap({name:"Trans",type:gp,optional:!0})],uf.prototype,"trans",void 0),wt([Ap({name:"Annots",type:Xp,optional:!0})],uf.prototype,"annots",void 0),wt([Ap({name:"AA",type:gp,optional:!0})],uf.prototype,"aa",void 0),wt([Ap({name:"Metadata",type:Yp,optional:!0})],uf.prototype,"metadata",void 0),wt([Ap({name:"PieceInfo",type:gp,optional:!0})],uf.prototype,"pieceInfo",void 0),wt([kp("StructParents",!0)],uf.prototype,"structParents",void 0),wt([xp("ID",!0)],uf.prototype,"id",void 0),wt([kp("PZ",!0)],uf.prototype,"pz",void 0),wt([Ap({name:"SeparationInfo",type:gp,optional:!0})],uf.prototype,"separationInfo",void 0),wt([Cp("Tabs",!0)],uf.prototype,"tabs",void 0),wt([Cp("TemplateInstantiated",!0)],uf.prototype,"templateInstantiated",void 0),wt([Ap({name:"PresSteps",type:gp,optional:!0})],uf.prototype,"presSteps",void 0),wt([kp("UserUnit",!0,1)],uf.prototype,"userUnit",void 0),wt([Bp("VP",!0)],uf.prototype,"vp",void 0),wt([Bp("AF",!0)],uf.prototype,"af",void 0),wt([Bp("OutputIntents",!0)],uf.prototype,"outputIntents",void 0),wt([Ap({name:"DPart",type:gp,optional:!0,indirect:!0})],uf.prototype,"dPart",void 0),function(e){e[e.invisible=1]="invisible",e[e.hidden=2]="hidden",e[e.print=4]="print",e[e.noZoom=8]="noZoom",e[e.noRotate=16]="noRotate",e[e.noView=32]="noView",e[e.readOnly=64]="readOnly",e[e.locked=128]="locked",e[e.toggleNoView=256]="toggleNoView",e[e.lockedContents=512]="lockedContents"}(Bd||(Bd={})),function(e){e.text="Text",e.link="Link",e.freeText="FreeText",e.line="Line",e.square="Square",e.circle="Circle",e.polygon="Polygon",e.polyLine="PolyLine",e.highlight="Highlight",e.underline="Underline",e.squiggly="Squiggly",e.strikeOut="StrikeOut",e.caret="Caret",e.stamp="Stamp",e.ink="Ink",e.popup="Popup",e.fileAttachment="FileAttachment",e.sound="Sound",e.movie="Movie",e.screen="Screen",e.widget="Widget",e.printerMark="PrinterMark",e.trapNet="TrapNet",e.watermark="Watermark",e.redact="Redact",e.projection="Projection",e.richMedia="RichMedia",e.threeD="3D"}(Nd||(Nd={}));class pf extends gp{onCreate(){const e=this.getDocument();this.type=pf.TYPE,this.rect=tf.create(e.update)}}pf.TYPE="Annot",wt([Cp("Type",!0,pf.TYPE)],pf.prototype,"type",void 0),wt([Cp("Subtype")],pf.prototype,"subtype",void 0),wt([Ap({name:"Rect",type:tf})],pf.prototype,"rect",void 0),wt([Ap({name:"Contents",type:np,optional:!0})],pf.prototype,"contents",void 0),wt([Ap({name:"P",type:uf,optional:!0,indirect:!0})],pf.prototype,"p",void 0),wt([Ap({name:"NM",type:np,optional:!0})],pf.prototype,"nm",void 0),wt([Pp("M",!0)],pf.prototype,"m",void 0),wt([kp("F",!0,0)],pf.prototype,"f",void 0),wt([Up("AP",af)],pf.prototype,"AP",void 0),wt([Cp("AS",!0)],pf.prototype,"as",void 0),wt([Bp("Border",!0)],pf.prototype,"border",void 0),wt([Bp("C",!0)],pf.prototype,"c",void 0),wt([kp("StructParent",!0)],pf.prototype,"structParent",void 0),wt([Ap({name:"OC",type:gp,optional:!0})],pf.prototype,"oc",void 0),wt([Ap({name:"AF",type:gp,optional:!0})],pf.prototype,"af",void 0),wt([kp("ca",!0,1)],pf.prototype,"ca",void 0),wt([kp("CA",!0,1)],pf.prototype,"CA",void 0),wt([Cp("BM",!0)],pf.prototype,"bm",void 0),wt([Ap({name:"Lang",type:np,optional:!0})],pf.prototype,"lang",void 0);class df extends gp{}wt([Cp("SW",!0,"A")],df.prototype,"sw",void 0),wt([Cp("S",!0,"P")],df.prototype,"s",void 0),wt([Bp("A",!0)],df.prototype,"a",void 0),wt([Ep("FB",!0,!1)],df.prototype,"fb",void 0),function(e){e[e.noIcon=0]="noIcon",e[e.noCaption=1]="noCaption",e[e.captionBelow=2]="captionBelow",e[e.captionAbove=3]="captionAbove",e[e.captionRight=4]="captionRight",e[e.captionLeft=5]="captionLeft",e[e.captionOverlaid=6]="captionOverlaid"}(Pd||(Pd={}));class ff extends gp{}wt([kp("R",!0,0)],ff.prototype,"r",void 0),wt([Bp("BC",!0)],ff.prototype,"BC",void 0),wt([Bp("BG",!0)],ff.prototype,"BG",void 0),wt([Dp("CA",!0)],ff.prototype,"ca",void 0),wt([Dp("RC",!0)],ff.prototype,"rc",void 0),wt([Dp("AC",!0)],ff.prototype,"ac",void 0),wt([Ap({name:"I",type:Yp,optional:!0,indirect:!0})],ff.prototype,"I",void 0),wt([Ap({name:"RI",type:Yp,optional:!0,indirect:!0})],ff.prototype,"ri",void 0),wt([Ap({name:"IX",type:Yp,optional:!0,indirect:!0})],ff.prototype,"ix",void 0),wt([Ap({name:"IF",type:df,optional:!0})],ff.prototype,"if",void 0),wt([kp("TP",!0,0)],ff.prototype,"tp",void 0),function(e){e.solid="S",e.dashed="D",e.beveled="B",e.insert="I",e.underline="U"}(Dd||(Dd={}));class mf extends gp{onCreate(){this.type=mf.TYPE}}mf.TYPE="Border",wt([Cp("Type",!0)],mf.prototype,"type",void 0),wt([kp("W",!0,1)],mf.prototype,"W",void 0),wt([Cp("S",!0)],mf.prototype,"S",void 0),wt([Bp("D",!0)],mf.prototype,"D",void 0);class gf extends gp{onCreate(){super.onCreate(),this.BaseVersion="",this.ExtensionLevel=0}}gf.TYPE="DeveloperExtensions",wt([Cp("Type",!0,gf.TYPE)],gf.prototype,"Type",void 0),wt([Cp("BaseVersion")],gf.prototype,"BaseVersion",void 0),wt([kp("ExtensionLevel")],gf.prototype,"ExtensionLevel",void 0),wt([Dp("URL",!0)],gf.prototype,"URL",void 0);class yf extends gp{}yf.TYPE="Extensions",wt([Cp("Type",!0,yf.TYPE)],yf.prototype,"Type",void 0),wt([Up("ADBE",gf)],yf.prototype,"ADBE",void 0),function(e){e[e.signaturesExist=1]="signaturesExist",e[e.appendOnly=2]="appendOnly"}(Ud||(Ud={}));class vf extends gp{onCreate(){super.onCreate(),this.Fields=this.getDocument().createArray()}findFieldByGroup(e,t){const r=this.Fields.items.find((r=>{if(r instanceof Kd&&r.ft===e&&r.t.text===t)return r}));return r&&r instanceof Kd?r:null}addField(e){this.Fields.push(e.makeIndirect())}}wt([Ap({name:"Fields",type:Xp})],vf.prototype,"Fields",void 0),wt([Ep("NeedAppearances",!0,!1)],vf.prototype,"needAppearances",void 0),wt([kp("SigFlags",!0,0)],vf.prototype,"SigFlags",void 0),wt([Bp("CO",!0)],vf.prototype,"co",void 0),wt([Ap({name:"DR",type:gp,optional:!0})],vf.prototype,"dr",void 0),wt([Ip("DA",!0)],vf.prototype,"da",void 0),wt([kp("Q",!0)],vf.prototype,"q",void 0),wt([Ap({name:"XFA",optional:!0})],vf.prototype,"xfa",void 0),function(e){e.singlePage="SinglePage",e.oneColumn="OneColumn",e.twoColumnLeft="TwoColumnLeft",e.twoColumnRight="TwoColumnRight",e.twoPageLeft="TwoPageLeft",e.twoPageRight="TwoPageRight"}(Od||(Od={})),function(e){e.useNone="UseNone",e.useOutlines="UseOutlines",e.useThumbs="UseThumbs",e.fullScreen="FullScreen",e.useOC="UseOC",e.useAttachments="UseAttachments"}(Td||(Td={}));class wf extends gp{onCreate(){super.onCreate();const e=this.getDocumentUpdate();this.Type=wf.TYPE,this.Pages=hf.create(e)}}wf.TYPE="Catalog",wt([Cp("Type")],wf.prototype,"Type",void 0),wt([Cp("Version",!0)],wf.prototype,"Version",void 0),wt([Up("Extensions",yf,!0)],wf.prototype,"Extensions",void 0),wt([Ap({name:"Pages",type:hf,indirect:!0})],wf.prototype,"Pages",void 0),wt([Ap({name:"PageLabels",optional:!0})],wf.prototype,"PageLabels",void 0),wt([Ap({name:"Names",type:gp,optional:!0})],wf.prototype,"Names",void 0),wt([Ap({name:"Dests",type:gp,optional:!0,indirect:!0})],wf.prototype,"Dests",void 0),wt([Ap({name:"ViewerPreferences",type:gp,optional:!0})],wf.prototype,"ViewerPreferences",void 0),wt([Ap({name:"PageLayout",type:dp,get:e=>e.text,optional:!0,defaultValue:Od.singlePage})],wf.prototype,"PageLayout",void 0),wt([Ap({name:"PageMode",type:dp,get:e=>e.text,optional:!0,defaultValue:Td.useNone})],wf.prototype,"PageMode",void 0),wt([Ap({name:"Outlines",type:gp,optional:!0,indirect:!0})],wf.prototype,"Outlines",void 0),wt([Ap({name:"Threads",type:Xp,optional:!0,indirect:!0})],wf.prototype,"Threads",void 0),wt([Ap({name:"OpenAction",optional:!0})],wf.prototype,"OpenAction",void 0),wt([Ap({name:"AA",type:gp,optional:!0})],wf.prototype,"AA",void 0),wt([Ap({name:"URI",type:gp,optional:!0})],wf.prototype,"URI",void 0),wt([Up("AcroForm",vf,!0)],wf.prototype,"AcroForm",void 0),wt([Ap({name:"Metadata",type:Yp,optional:!0,indirect:!0})],wf.prototype,"Metadata",void 0),wt([Ap({name:"StructTreeRoot",type:gp,optional:!0})],wf.prototype,"StructTreeRoot",void 0),wt([Ap({name:"MarkInfo",type:gp,optional:!0})],wf.prototype,"MarkInfo",void 0),wt([Ip("Lang",!0)],wf.prototype,"Lang",void 0),wt([Ap({name:"SpiderInfo",type:gp,optional:!0})],wf.prototype,"SpiderInfo",void 0),wt([Bp("OutputIntents",!0)],wf.prototype,"OutputIntents",void 0),wt([Ap({name:"PieceInfo",type:gp,optional:!0})],wf.prototype,"PieceInfo",void 0),wt([Ap({name:"OCProperties",type:gp,optional:!0})],wf.prototype,"OCProperties",void 0),wt([Ap({name:"Perms",type:gp,optional:!0})],wf.prototype,"Perms",void 0),wt([Ap({name:"Legal",type:gp,optional:!0})],wf.prototype,"Legal",void 0),wt([Bp("Requirements",!0)],wf.prototype,"Requirements",void 0),wt([Ap({name:"Collection",type:gp,optional:!0})],wf.prototype,"Collection",void 0),wt([Ep("NeedsRendering",!0,!1)],wf.prototype,"NeedsRendering",void 0),wt([Ap({name:"DSS",type:Wd,optional:!0})],wf.prototype,"DSS",void 0);class bf extends gp{}wt([Cp("Filter")],bf.prototype,"filter",void 0),wt([Cp("SubFilter",!0)],bf.prototype,"subFilter",void 0),wt([kp("V",!0,0)],bf.prototype,"v",void 0),wt([kp("Length",!0,40)],bf.prototype,"length",void 0),wt([Ap({name:"CF",optional:!0,type:gp})],bf.prototype,"cf",void 0),wt([Cp("StmF",!0,"Identity")],bf.prototype,"stmF",void 0),wt([Cp("StrF",!0,"Identity")],bf.prototype,"strF",void 0),wt([Cp("EFF",!0)],bf.prototype,"eff",void 0);class Sf extends gp{onCreate(){this.Type=Sf.TYPE}}Sf.TYPE="ExtGState",wt([Cp("Type",!0,Sf.TYPE)],Sf.prototype,"Type",void 0),wt([kp("LW",!0)],Sf.prototype,"LW",void 0),wt([kp("LC",!0)],Sf.prototype,"LC",void 0),wt([kp("LJ ",!0)],Sf.prototype,"LJ",void 0),wt([kp("ML ",!0)],Sf.prototype,"ML",void 0),wt([Up("D",Xp)],Sf.prototype,"D",void 0),wt([Cp("RI",!0)],Sf.prototype,"RI",void 0),wt([Ep("OP",!0,!1)],Sf.prototype,"OP",void 0),wt([Ep("op",!0,!1)],Sf.prototype,"op",void 0),wt([kp("OPM",!0)],Sf.prototype,"OPM",void 0),wt([Up("Font",Xp)],Sf.prototype,"Font",void 0),wt([Ap({name:"BG",optional:!0})],Sf.prototype,"BG",void 0),wt([Ap({name:"BG2",optional:!0})],Sf.prototype,"BG2",void 0),wt([Ap({name:"UCR",optional:!0})],Sf.prototype,"UCR",void 0),wt([Ap({name:"UCR2",optional:!0})],Sf.prototype,"UCR2",void 0),wt([Ap({name:"TR",optional:!0})],Sf.prototype,"TR",void 0),wt([Ap({name:"TR2",optional:!0})],Sf.prototype,"TR2",void 0),wt([Ap({name:"HT",optional:!0})],Sf.prototype,"HT",void 0),wt([kp("FL",!0)],Sf.prototype,"FL",void 0),wt([kp("SM",!0)],Sf.prototype,"SM",void 0),wt([Ep("SA",!0)],Sf.prototype,"SA",void 0),wt([Ap({name:"BM",optional:!0})],Sf.prototype,"BM",void 0),wt([Ap({name:"SMask",optional:!0})],Sf.prototype,"SMask",void 0),wt([kp("CA",!0)],Sf.prototype,"CA",void 0),wt([kp("ca",!0)],Sf.prototype,"ca",void 0),wt([Ep("AIS",!0)],Sf.prototype,"AIS",void 0),wt([Ep("TK",!0)],Sf.prototype,"TK",void 0),wt([Cp("UseBlackPTComp",!0,"Default")],Sf.prototype,"UseBlackPTComp",void 0),wt([Up("HTO",Xp)],Sf.prototype,"HTO",void 0);class Af extends gp{onCreate(){super.onCreate(),this.type=Af.TYPE}}Af.TYPE="CollectionItem",wt([Cp("Type",!0,Af.TYPE)],Af.prototype,"type",void 0);class kf extends gp{onCreate(){super.onCreate(),this.type=kf.TYPE}}kf.TYPE="Filespec",wt([Cp("Type",!0,kf.TYPE)],kf.prototype,"type",void 0),wt([Cp("FS",!0)],kf.prototype,"fs",void 0),wt([Cp("F",!0)],kf.prototype,"f",void 0),wt([Dp("UF",!0)],kf.prototype,"uf",void 0),wt([Dp("DOS",!0)],kf.prototype,"dos",void 0),wt([Dp("Mac",!0)],kf.prototype,"mac",void 0),wt([Dp("Unix",!0)],kf.prototype,"unix",void 0),wt([Bp("ID",!0)],kf.prototype,"id",void 0),wt([Ep("v",!0,!1)],kf.prototype,"v",void 0),wt([Ap({name:"EF",type:gp,optional:!0})],kf.prototype,"ef",void 0),wt([Ap({name:"RF",type:gp,optional:!0})],kf.prototype,"rf",void 0),wt([Dp("Desc",!0)],kf.prototype,"desc",void 0),wt([Ap({name:"CI",type:Af,optional:!0,indirect:!0})],kf.prototype,"ci",void 0),wt([Ap({name:"Thumb",type:Yp,optional:!0})],kf.prototype,"thumb",void 0);class Cf extends gp{}wt([kp("Type",!0)],Cf.prototype,"type",void 0),wt([Cp("CFM",!0,"None")],Cf.prototype,"cfm",void 0),wt([Cp("AuthEvent",!0,"DocOpen")],Cf.prototype,"authEvent",void 0),wt([kp("Length",!0)],Cf.prototype,"length",void 0),function(e){e[e.fixedPitch=1]="fixedPitch",e[e.serif=2]="serif",e[e.symbolic=4]="symbolic",e[e.script=8]="script",e[e.nonsymbolic=32]="nonsymbolic",e[e.italic=64]="italic",e[e.allCap=65536]="allCap",e[e.smallCap=131072]="smallCap",e[e.forceBold=262144]="forceBold"}(Rd||(Rd={}));class If extends gp{onCreate(){super.onCreate(),this.type=If.TYPE,this.italicAngle=0,this.flags=0,this.fontName=""}}If.TYPE="Font",wt([Cp("Type")],If.prototype,"type",void 0),wt([Cp("FontName")],If.prototype,"fontName",void 0),wt([Ip("FontFamily",!0)],If.prototype,"fontFamily",void 0),wt([Cp("FontStretch",!0)],If.prototype,"fontStretch",void 0),wt([kp("FontWeight",!0)],If.prototype,"fontWeight",void 0),wt([kp("Flags")],If.prototype,"flags",void 0),wt([Ap({name:"FontBBox",type:tf,optional:!0})],If.prototype,"fontBBox",void 0),wt([kp("ItalicAngle")],If.prototype,"italicAngle",void 0),wt([kp("Ascent",!0)],If.prototype,"ascent",void 0),wt([kp("Descent",!0)],If.prototype,"descent",void 0),wt([kp("Leading",!0,0)],If.prototype,"leading",void 0),wt([kp("CapHeight",!0)],If.prototype,"capHeight",void 0),wt([kp("XHeight",!0,0)],If.prototype,"xHeight",void 0),wt([kp("StemV",!0)],If.prototype,"stemV",void 0),wt([kp("StemH",!0,0)],If.prototype,"stemH",void 0),wt([kp("AvgWidth",!0,0)],If.prototype,"avgWidth",void 0),wt([kp("MaxWidth",!0,0)],If.prototype,"maxWidth",void 0),wt([kp("MissingWidth",!0,0)],If.prototype,"missingWidth",void 0),wt([Ap({name:"FontFile",type:Yp,optional:!0})],If.prototype,"fontFile",void 0),wt([Ap({name:"FontFile2",type:Yp,optional:!0})],If.prototype,"fontFile2",void 0),wt([Ap({name:"FontFile3",type:Yp,optional:!0})],If.prototype,"fontFile3",void 0),wt([Ap({name:"CharSet",type:np,optional:!0})],If.prototype,"charSet",void 0);class xf extends gp{onCreate(){super.onCreate(),this.type=xf.TYPE,this.subtype=""}}xf.TYPE="Font",wt([Cp("Type")],xf.prototype,"type",void 0),wt([Cp("Subtype")],xf.prototype,"subtype",void 0),wt([Cp("Name")],xf.prototype,"Name",void 0),wt([Ap({name:"FontDescriptor",type:If})],xf.prototype,"FontDescriptor",void 0);class Ef extends gp{onCreate(){super.onCreate(),this.type=Ef.TYPE,this.subtype=Ef.SUBTYPE}}Ef.TYPE="PtData",Ef.SUBTYPE="Cloud",wt([Cp("Type",!0,Ef.TYPE)],Ef.prototype,"type",void 0),wt([Cp("Subtype",!0,Ef.SUBTYPE)],Ef.prototype,"subtype",void 0);class Bf extends Ef{onCreate(){super.onCreate();const e=this.getDocument();this.r=e.createString(""),this.x=e.createArray(),this.d=e.createArray(),this.a=e.createArray()}}wt([Dp("R")],Bf.prototype,"r",void 0),wt([Bp("X")],Bf.prototype,"x",void 0),wt([Bp("Y",!0)],Bf.prototype,"y",void 0),wt([Bp("D")],Bf.prototype,"d",void 0),wt([Bp("A")],Bf.prototype,"a",void 0),wt([Bp("T",!0)],Bf.prototype,"t",void 0),wt([Bp("S",!0)],Bf.prototype,"s",void 0),wt([Bp("O",!0)],Bf.prototype,"o",void 0),wt([kp("CYX",!0)],Bf.prototype,"cyx",void 0);class Nf extends Ef{onCreate(){super.onCreate();const e=this.getDocument();this.gcs=e.createDictionary(),this.gpts=e.createArray()}}wt([Bp("Bounds",!0)],Nf.prototype,"bounds",void 0),wt([Ap({name:"GCS"})],Nf.prototype,"gcs",void 0),wt([Ap({name:"DCS",optional:!0})],Nf.prototype,"dcs",void 0),wt([Bp("PDU",!0)],Nf.prototype,"pdu",void 0),wt([Bp("GPTS")],Nf.prototype,"gpts",void 0),wt([Bp("LPTS",!0)],Nf.prototype,"lpts",void 0),wt([Bp("PCSM",!0)],Nf.prototype,"pcsm",void 0);class Pf{static register(e,t){this.items.set(e,t)}static get(e){const t=this.items.get(e);return t||Ef}}Pf.items=new Map([[Bf.SUBTYPE,Bf],[Nf.SUBTYPE,Nf]]);class Df extends gp{onCreate(){super.onCreate();const e=this.getDocument().update;this.type=Df.TYPE,this.version=Df.VERSION,this.cropRect=tf.createWithData(e,0,0,0,0)}}Df.TYPE="OPI",Df.VERSION=1.3,wt([Cp("Type",!0,Df.TYPE)],Df.prototype,"type",void 0),wt([kp("Version")],Df.prototype,"version",void 0),wt([Ap({name:"F"})],Df.prototype,"f",void 0),wt([xp("ID",!0)],Df.prototype,"id",void 0),wt([Dp("Comments",!0)],Df.prototype,"comments",void 0),wt([Bp("Size",!0)],Df.prototype,"sizeField",void 0),wt([Ap({name:"CropRect",type:tf})],Df.prototype,"cropRect",void 0),wt([Bp("CropFixed",!0)],Df.prototype,"cropFixed",void 0),wt([Bp("Position",!0)],Df.prototype,"position",void 0),wt([Bp("Resolution",!0)],Df.prototype,"resolution",void 0),wt([Cp("ColorType",!0)],Df.prototype,"colorType",void 0),wt([Bp("Color",!0)],Df.prototype,"color",void 0),wt([kp("Tint",!0,1)],Df.prototype,"tint",void 0),wt([Ep("Overprint",!0,!1)],Df.prototype,"overprint",void 0),wt([Bp("ImageType",!0)],Df.prototype,"imageType",void 0),wt([Bp("GrayMap",!0)],Df.prototype,"grayMap",void 0),wt([Ep("Transparency",!0,!0)],Df.prototype,"transparency",void 0),wt([Bp("Tags",!0)],Df.prototype,"tags",void 0);class Uf extends gp{onCreate(){super.onCreate(),this.type=Uf.TYPE,this.version=Uf.VERSION}}Uf.TYPE="OPI",Uf.VERSION=2,wt([Cp("Type",!0,Uf.TYPE)],Uf.prototype,"type",void 0),wt([kp("Version")],Uf.prototype,"version",void 0),wt([Ap({name:"F"})],Uf.prototype,"f",void 0),wt([xp("MainImage",!0)],Uf.prototype,"mainImage",void 0),wt([Bp("Tags",!1)],Uf.prototype,"tags",void 0),wt([Bp("Size",!0)],Uf.prototype,"sizeField",void 0),wt([Ap({name:"CropRect",type:tf,optional:!0})],Uf.prototype,"cropRect",void 0),wt([Ep("Overprint",!0,!1)],Uf.prototype,"Overprint",void 0),wt([Ap({name:"Inks",optional:!0})],Uf.prototype,"Inks",void 0),wt([Ap({name:"IncludedImageDimensions",type:Xp,optional:!0})],Uf.prototype,"includedImageDimensions",void 0),wt([kp("IncludedImageQuality",!0)],Uf.prototype,"includedImageQuality",void 0);class Of extends gp{}wt([Ap({name:"1.3",optional:!0,type:Df})],Of.prototype,"v1_3",void 0),wt([Ap({name:"1.3",optional:!0,type:Uf})],Of.prototype,"v2_0",void 0);class Tf extends gp{onCreate(){super.onCreate();const e=this.getDocument();this.type=Tf.TYPE,this.subtype=Tf.SUBTYPE,this.names=e.createArray(),this.xpts=e.createArray()}}Tf.TYPE="PtData",Tf.SUBTYPE="Cloud",wt([Cp("Type")],Tf.prototype,"type",void 0),wt([Cp("Subtype")],Tf.prototype,"subtype",void 0),wt([Bp("Names")],Tf.prototype,"names",void 0),wt([Bp("XPTS")],Tf.prototype,"xpts",void 0);class Rf extends jd{onCreate(){super.onCreate(),this.Type="XObject",this.Subtype=Rf.SUBTYPE,this.bBox=tf.createWithData(this.getDocumentUpdate(),0,0,0,0),this.formType=1,this.Resources.set(of.create(this.getDocumentUpdate()))}}Rf.SUBTYPE="Form",wt([Cp("Type",!0,"XObject")],Rf.prototype,"Type",void 0),wt([Cp("Subtype",!1,Rf.SUBTYPE)],Rf.prototype,"Subtype",void 0),wt([kp("FormType",!0,1)],Rf.prototype,"formType",void 0),wt([Ap({name:"BBox",type:tf})],Rf.prototype,"bBox",void 0),wt([Up("Matrix",cd)],Rf.prototype,"matrix",void 0),wt([Up("Resources",of)],Rf.prototype,"Resources",void 0),wt([Ap({name:"Group",type:gp,optional:!0})],Rf.prototype,"group",void 0),wt([Ap({name:"Ref",type:gp,optional:!0})],Rf.prototype,"ref",void 0),wt([Ap({name:"Metadata",type:Yp,optional:!0})],Rf.prototype,"metadata",void 0),wt([Ap({name:"PieceInfo",type:gp,optional:!0})],Rf.prototype,"pieceInfo",void 0),wt([Pp("LastModified",!0)],Rf.prototype,"lastModified",void 0),wt([kp("StructParent",!0)],Rf.prototype,"structParent",void 0),wt([kp("StructParents",!0)],Rf.prototype,"structParents",void 0),wt([Ap({name:"OPI",optional:!0,type:Of})],Rf.prototype,"opi",void 0),wt([Ap({name:"OC",optional:!0,type:gp})],Rf.prototype,"oc",void 0),wt([Cp("Name",!0)],Rf.prototype,"name",void 0),wt([function(e,t=!1){return Ap({name:e,optional:t})}("AF",!0)],Rf.prototype,"af",void 0),wt([Ap({name:"Measure",optional:!0,type:Ef,get:e=>new(Pf.get(e.subtype))(e)})],Rf.prototype,"measure",void 0),wt([Ap({name:"PtData",optional:!0,type:Tf})],Rf.prototype,"ptData",void 0);class _f extends Yp{onCreate(){super.onCreate(),this.Type=this.Type="XObject",this.Subtype=_f.SUBTYPE,this.Width=_f.WIDTH,this.Height=_f.HEIGHT}}_f.SUBTYPE="Image",_f.WIDTH=0,_f.HEIGHT=0,wt([Cp("Type",!0,"XObject")],_f.prototype,"Type",void 0),wt([Cp("Subtype")],_f.prototype,"Subtype",void 0),wt([kp("Width")],_f.prototype,"Width",void 0),wt([kp("Height")],_f.prototype,"Height",void 0),wt([Ap({name:"ColorSpace",optional:!0})],_f.prototype,"ColorSpace",void 0),wt([kp("BitsPerComponent",!0)],_f.prototype,"BitsPerComponent",void 0),wt([Cp("Intent",!0)],_f.prototype,"Intent",void 0),wt([Ep("ImageMask",!0,!1)],_f.prototype,"ImageMask",void 0),wt([Ap({name:"Mask",optional:!0})],_f.prototype,"Mask",void 0),wt([Bp("Decode",!0)],_f.prototype,"Decode",void 0),wt([Ep("Interpolate",!0,!1)],_f.prototype,"Interpolate",void 0),wt([Bp("Alternates",!0)],_f.prototype,"Alternates",void 0),wt([Np("SMask",!1)],_f.prototype,"SMask",void 0),wt([kp("SMaskInData",!0)],_f.prototype,"SMaskInData",void 0),wt([Cp("Name",!1)],_f.prototype,"Name",void 0),wt([kp("StructParent",!0)],_f.prototype,"StructParent",void 0),wt([Ap({name:"ID",optional:!0,indirect:!0})],_f.prototype,"ID",void 0),wt([Ap({name:"OPI",type:gp,optional:!0})],_f.prototype,"OPI",void 0),wt([Np("Metadata",!0)],_f.prototype,"Metadata",void 0),wt([Ap({name:"OC",type:gp,optional:!0})],_f.prototype,"OC",void 0),wt([Bp("AF",!0)],_f.prototype,"AF",void 0),wt([Ap({name:"Measure",type:gp,optional:!0})],_f.prototype,"Measure",void 0),wt([Ap({name:"PtData",type:gp,optional:!0})],_f.prototype,"PtData",void 0);class Vf extends gp{}wt([Ip("Title",!0)],Vf.prototype,"title",void 0),wt([Ip("Author",!0)],Vf.prototype,"author",void 0),wt([Ip("Subject",!0)],Vf.prototype,"subject",void 0),wt([Ip("Keywords",!0)],Vf.prototype,"keywords",void 0),wt([Ip("Creator",!0)],Vf.prototype,"creator",void 0),wt([Ip("Producer",!0)],Vf.prototype,"producer",void 0),wt([Pp("CreationDate",!0)],Vf.prototype,"creationDate",void 0),wt([Pp("ModDate")],Vf.prototype,"modDate",void 0),wt([Cp("Trapped",!0,"Unknown")],Vf.prototype,"trapped",void 0);class Ff extends bf{}wt([Ap({name:"Recipients",type:Xp,get:e=>{e.items.map((e=>{if(e instanceof yp)return e.text;throw new Error("Recipients contain an invalid format")}))}})],Ff.prototype,"recipients",void 0),wt([kp("P")],Ff.prototype,"p",void 0);class Lf extends bf{}wt([kp("R")],Lf.prototype,"r",void 0),wt([Ap({name:"O",type:np})],Lf.prototype,"o",void 0),wt([Ip("U")],Lf.prototype,"u",void 0),wt([Ip("OE",!0)],Lf.prototype,"oe",void 0),wt([Ip("UE",!0)],Lf.prototype,"ue",void 0),wt([kp("P")],Lf.prototype,"p",void 0),wt([xp("Perms",!0)],Lf.prototype,"perms",void 0),wt([Ep("EncryptMetadata",!0,!0)],Lf.prototype,"encryptMetadata",void 0);class jf extends gp{onCreate(){var e;super.onCreate();const t=this.getDocumentUpdate(),r=(null===(e=t.previous)||void 0===e?void 0:e.xref)||null;if(r){for(const[e,t]of r.items)"Filters"!==e&&"DecodeParms"!==e&&this.items.set(e,t.copy());this.Prev=r.documentUpdate.startXref}else{this.Size=0;const e=wf.create(t),r=t.append(e);this.set("Root",r.createReference()),t.document.version}}}wt([kp("Size")],jf.prototype,"Size",void 0),wt([kp("Prev",!0)],jf.prototype,"Prev",void 0),wt([Ap({name:"Root",type:wf,optional:!0,indirect:!0})],jf.prototype,"Root",void 0),wt([Ap({name:"Encrypt",type:gp,optional:!0,get:e=>{const t=e.get("Filter");if(t instanceof dp)return"Standard"===t.text?new Lf(e):new Ff(e);throw new Error("Wrong type for 'Filter'")}})],jf.prototype,"Encrypt",void 0),wt([Ap({name:"Info",type:Vf,optional:!0,indirect:!0})],jf.prototype,"Info",void 0),wt([Ap({name:"ID",type:Xp,optional:!0,get:e=>e.items})],jf.prototype,"ID",void 0);class Hf extends xf{onCreate(){super.onCreate(),this.subtype=Hf.SUBTYPE}}Hf.SUBTYPE="TrueType",wt([Cp("Subtype")],Hf.prototype,"subtype",void 0),wt([Cp("BaseFont")],Hf.prototype,"BaseFont",void 0),wt([kp("FirstChar")],Hf.prototype,"FirstChar",void 0),wt([kp("LastChar")],Hf.prototype,"LastChar",void 0),wt([Bp("Widths")],Hf.prototype,"Widths",void 0),wt([Cp("Encoding",!0)],Hf.prototype,"Encoding",void 0),wt([Ap({name:"ToUnicode",type:Yp,optional:!0})],Hf.prototype,"ToUnicode",void 0);class Mf extends xf{onCreate(){super.onCreate(),this.subtype=Mf.SUBTYPE,this.Encoding="Identity-H"}}Mf.SUBTYPE="Type0",wt([Cp("Subtype")],Mf.prototype,"subtype",void 0),wt([Cp("BaseFont")],Mf.prototype,"BaseFont",void 0),wt([Cp("Encoding")],Mf.prototype,"Encoding",void 0),wt([Ap({name:"DescendantFonts",type:Xp})],Mf.prototype,"DescendantFonts",void 0),wt([Ap({name:"ToUnicode",type:Yp,optional:!0})],Mf.prototype,"ToUnicode",void 0);class Kf extends xf{onCreate(){super.onCreate(),this.subtype=Kf.SUBTYPE,this.BaseFont=""}}Kf.SUBTYPE="Type1",wt([Cp("Subtype")],Kf.prototype,"subtype",void 0),wt([Cp("BaseFont")],Kf.prototype,"BaseFont",void 0),wt([kp("FirstChar",!0)],Kf.prototype,"FirstChar",void 0),wt([kp("LastChar",!0)],Kf.prototype,"LastChar",void 0),wt([Bp("Widths",!0)],Kf.prototype,"Widths",void 0),wt([Ap({name:"Encoding",type:gp,optional:!0})],Kf.prototype,"Encoding",void 0),wt([Ap({name:"ToUnicode",type:Yp,optional:!0})],Kf.prototype,"ToUnicode",void 0);class qf extends xf{onCreate(){super.onCreate(),this.subtype=qf.SUBTYPE}}var Wf;qf.SUBTYPE="Type3",wt([Cp("Subtype")],qf.prototype,"subtype",void 0),wt([Ap({name:"FontBBox",type:tf})],qf.prototype,"FontBBox",void 0),wt([Ap({name:"FontMatrix",type:cd})],qf.prototype,"FontMatrix",void 0),wt([Ap({name:"CharProcs",type:gp})],qf.prototype,"CharProcs",void 0),wt([Ap({name:"Encoding",type:gp})],qf.prototype,"Encoding",void 0),wt([kp("FirstChar")],qf.prototype,"FirstChar",void 0),wt([kp("LastChar")],qf.prototype,"LastChar",void 0),wt([Bp("Widths")],qf.prototype,"Widths",void 0),wt([Ap({name:"Resources",type:gp})],qf.prototype,"Resources",void 0),wt([Ap({name:"ToUnicode",type:Yp,optional:!0})],qf.prototype,"ToUnicode",void 0),function(e){e.none="N",e.invert="I",e.outline="O",e.push="P",e.toggle="T"}(Wf||(Wf={}));class Gf extends pf{onCreate(){super.onCreate(),this.subtype=Gf.SUBTYPE}}Gf.SUBTYPE="Widget",wt([Cp("Subtype",!1,Gf.SUBTYPE)],Gf.prototype,"subtype",void 0),wt([Cp("H",!0,Wf.invert)],Gf.prototype,"h",void 0),wt([Up("MK",ff)],Gf.prototype,"MK",void 0),wt([Up("A",nf)],Gf.prototype,"A",void 0),wt([Ap({name:"AA",optional:!0,type:Hd})],Gf.prototype,"aa",void 0),wt([Up("BS",mf)],Gf.prototype,"BS",void 0),wt([Ap({name:"Parent",optional:!0,type:Kd,indirect:!0})],Gf.prototype,"Parent",void 0);class zf extends Gf{}wt([Cp("FT")],zf.prototype,"ft",void 0),wt([Up("Kids",Xp)],zf.prototype,"Kids",void 0),wt([Dp("T")],zf.prototype,"t",void 0),wt([Ap({name:"TU",type:yp,optional:!0})],zf.prototype,"TU",void 0),wt([Ap({name:"TM",type:yp,optional:!0})],zf.prototype,"tm",void 0),wt([kp("Ff",!0,0)],zf.prototype,"ff",void 0),wt([Ap({name:"V",optional:!0})],zf.prototype,"V",void 0),wt([Ap({name:"DV",optional:!0})],zf.prototype,"dv",void 0);class Jf extends gp{}wt([Ip("Registry")],Jf.prototype,"Registry",void 0),wt([Ip("Ordering")],Jf.prototype,"Ordering",void 0),wt([kp("Supplement")],Jf.prototype,"Supplement",void 0);class $f extends xf{onCreate(){super.onCreate(),this.subtype=$f.SUBTYPE}}$f.SUBTYPE="CIDFontType2",wt([Cp("Subtype")],$f.prototype,"subtype",void 0),wt([Cp("BaseFont")],$f.prototype,"BaseFont",void 0),wt([Ap({name:"CIDSystemInfo",type:Jf})],$f.prototype,"CIDSystemInfo",void 0),wt([kp("DW",!0,1e3)],$f.prototype,"DW",void 0),wt([Up("W",Xp)],$f.prototype,"W",void 0),wt([Up("DW2",Xp)],$f.prototype,"DW2",void 0),wt([Up("W2",Xp)],$f.prototype,"W2",void 0),wt([Ap({name:"CIDToGIDMap",optional:!0})],$f.prototype,"CIDToGIDMap",void 0);class Yf extends gp{onCreate(){super.onCreate(),this.Type=Yf.TYPE}}Yf.TYPE="FixedPrint",Yf.DEFAULT_0=0,wt([Cp("Type")],Yf.prototype,"Type",void 0),wt([Up("Matrix",cd)],Yf.prototype,"Matrix",void 0),wt([kp("H",!0,Yf.DEFAULT_0)],Yf.prototype,"H",void 0),wt([kp("V",!0,Yf.DEFAULT_0)],Yf.prototype,"V",void 0);class Xf extends pf{onCreate(){super.onCreate(),this.subtype=Xf.SUBTYPE}}function Qf(e,t){if(e.id>t.id)return 1;if(e.id<t.id)return-1;throw new Error("Cross-Reference cannot have objects with the same identifiers")}Xf.SUBTYPE="Watermark",wt([Cp("Subtype",!1,Xf.SUBTYPE)],Xf.prototype,"subtype",void 0),wt([Ap({name:"FixedPrint",optional:!0,type:Yf})],Xf.prototype,"FixedPrint",void 0);class Zf{static group(e){const t=[];if(e.length){e.sort(Qf);let r=0,s=[];for(const n of e)n.id!==r+1&&s.length&&(t.push(s),s=[]),s.push(n),r=n.id;t.push(s)}return t}}class em extends Yp{constructor(){super(...arguments),this.objects=[]}static getIdentifier(e,t){let r=0;for(const s of e){if(r+s.size>t)return s.start+(t-r);r+=s.size}throw new RangeError("Argument 'position' is greater than amount of items in the Cross-Reference Stream")}computerNumberLength(e,t){const r=e.toString(16);let s=0;return s=r.length%2?(r.length+1)/2:r.length/2,t>s?t:s}computeWidths(e){let t=0,r=0,s=0;for(const n of e){let e=0;switch(n.type){case xd.inUse:e=1;break;case xd.compressed:e=2}t=this.computerNumberLength(e,t),r=this.computerNumberLength(n.offset,r),s=this.computerNumberLength(n.generation,s)}return[t,r,s]}numberToUint8Array(e,t){const r=new Uint8Array(t),s=at.FromHex(e.toString(16));return r.set(new Uint8Array(s),r.byteLength-s.byteLength),r}async prepare(){const e=this.objects,t=this.computeWidths(e),r=Zf.group(e);this.W=t;const s=new Yu,n=[];for(const e of r){n.push({start:e[0].id,size:e.length});for(const r of e){let e=0;switch(r.type){case xd.inUse:e=1;break;case xd.compressed:e=2}s.write(this.numberToUint8Array(e,t[0])),s.write(this.numberToUint8Array(r.offset,t[1])),s.write(this.numberToUint8Array(r.generation,t[2]))}}this.documentUpdate&&this.documentUpdate.previous&&(this.Prev=this.documentUpdate.previous.startXref),this.stream=s.toUint8Array(),await this.encode(),this.Index=n}onCreate(){var e;super.onCreate(),this.Type=em.TYPE;const t=this.getDocumentUpdate();((null===(e=this.documentUpdate)||void 0===e?void 0:e.document.options)||{}).disableCompressedStreams||(this.filter=t.document.createName("FlateDecode")),jf.prototype.onCreate.call(this)}onToStringStream(){const e=[];for(const t of this.objects)switch(t.type){case xd.compressed:e.push(`  compressed id:${t.id} stream:${t.offset} index:${t.generation}`);break;case xd.free:e.push(`  free       id:${t.id} next:${t.offset} gen:${t.generation}`);break;case xd.inUse:e.push(`  in-use     id:${t.id} offset:${t.offset} gen:${t.generation}`)}return e.join("\n")}addObject(e){this.objects.push(e)}}em.TYPE="XRef",wt([Cp("Type")],em.prototype,"Type",void 0),wt([kp("Size")],em.prototype,"Size",void 0),wt([kp("Prev",!0)],em.prototype,"Prev",void 0),wt([Ap({name:"Root",type:wf,optional:!0,indirect:!0})],em.prototype,"Root",void 0),wt([Ap({name:"Encrypt",type:gp,optional:!0,get:e=>{const t=e.get("Filter");if(t instanceof dp)return"Standard"===t.text?new Lf(e):new Ff(e);throw new Error("Wrong type for 'Filter'")}})],em.prototype,"Encrypt",void 0),wt([Ap({name:"Info",type:Vf,optional:!0,indirect:!0})],em.prototype,"Info",void 0),wt([Ap({name:"ID",type:Xp,optional:!0,get:e=>e.items})],em.prototype,"ID",void 0),wt([Ap({name:"Index",type:Xp,optional:!0,get:e=>{const t=e.items.map((e=>{if(e instanceof ap)return e.value;throw new Error("Unsupported type in Index filed item of the Cross-Reference stream")})),r=[];for(let e=0;e<t.length;e++)r.push({start:t[e++],size:t[e]});return r},set:e=>{const t=[];for(const r of e)t.push(new ap(r.start)),t.push(new ap(r.size));return new Xp(...t)}})],em.prototype,"Index",void 0),wt([Ap({name:"W",type:Xp,optional:!0,get:e=>e.items.map((e=>{if(e instanceof ap)return e.value;throw new Error("Unsupported type in W item of the Cross-Reference stream")})),set:e=>new Xp(...e.map((e=>new ap(e))))})],em.prototype,"W",void 0);class tm extends jf{constructor(){super(...arguments),this.objects=[]}onFromPDF(e){if(e.findIndex((e=>!zu.whiteSpaceChars.includes(e))),!zu.xrefChars.every((t=>t===e.readByte())))throw new Qu(e.position-1);for(;;){Qp.skip(e);const t=ap.fromPDF(e);e.read(1);const r=ap.fromPDF(e);Qp.skip(e);let s=r.value;const n=[];let i=t.value-1;for(;s--;){i++;const t=e.position,r=at.ToUtf8String(e.read(20)),s=/([0-9]{10}) ([0-9]{5}) ([fn])/.exec(r);if(!s)throw new Ju("Cross-reference entity doesn't match to required structure",t);if(!this.documentUpdate)throw new Error("PDF DocumentUpdate must be assigned to the CrossReferenceTable");const a=parseInt(s[1],10),o=parseInt(s[2],10),c=s[3];"n"===c&&0===a||n.push(new lf({documentUpdate:this.documentUpdate,id:i,generation:o,offset:a,type:c}))}if(this.objects.push(...n),Qp.skip(e),116===e.view[e.position]){if(!zu.trailerChars.every((t=>t===e.readByte())))throw new Qu(e.position-1);Qp.skip(e),super.onFromPDF(e);break}}}onWritePDF(e){e.writeLine(zu.xrefChars);const t=Zf.group(this.objects);for(const r of t){const t=r[0].id;e.writeString(`${t} ${r.length}\n`);for(const t of r){const r=t.offset.toString().padStart(10,"0"),s=t.generation.toString().padStart(5,"0");e.writeString(`${r} ${s} ${t.type}\r\n`)}}e.writeLine(zu.trailerChars),super.onWritePDF(e),e.writeLine()}toString(){const e=["xref"],t=Zf.group(this.objects);for(const r of t){const t=r[0].id;e.push(`${t} ${r.length}`);for(const t of r){const r=t.offset.toString().padStart(10,"0"),s=t.generation.toString().padStart(5,"0");e.push(`${r} ${s} ${t.type} % id:${t.id}`)}}return e.push("trailer"),e.push(super.toString()),e.join("\n")}addObject(e){this.objects.push(e)}}const rm=new Uint8Array([255,255,255,255]),sm=new Uint8Array([115,65,108,84]),nm={name:"MD5"},im={name:"RC4"},am={name:"SHA-256"},om={name:"SHA-384"},cm={name:"SHA-512"},lm={name:"AES-CBC"},hm={name:"AES-ECB"};class um{constructor(e){this.dictionary=e,this.crypto=um.getCrypto()}static getCrypto(){const e=nh();if(!e)throw new Error("Unable to create WebCrypto object");return e}}const pm=["AES-CBC","AES-GCM"];class dm extends um{constructor(){super(...arguments),this.name=dm.NAME}async encrypt(e){var t,r,s;const n=new Uint8Array(16);ih(n);const i=await this.getClientSideParameters(),o=null===(s=null===(r=null===(t=this.dictionary.documentUpdate)||void 0===t?void 0:t.document.options)||void 0===r?void 0:r.crypto)||void 0===s?void 0:s.encrypt;if(!o)throw new Error("Absent 'encrypt' parameter in 'options'");const c=await this.generateKeyCertificateBased(i.algorithm,o.seed,o.recipientsBuffer,!1),l=st.toArrayBuffer(e);return a(n,await this.crypto.encrypt({name:i.algorithm,length:256,iv:n},c,l))}async decrypt(e){const t=st.toUint8Array(e);if(4===this.dictionary.v&&"Identity"===this.dictionary.stmF&&"Identity"===this.dictionary.strF)return t;const r=await this.getClientSideParameters(),s=await this.getGlobalParameters(),n=t.slice(16,t.byteLength),i=t.slice(0,16);return this.crypto.decrypt({name:r.algorithm,length:256,iv:i},s.stmKey,n)}async getClientSideParameters(){var e,t;if(!this.clientSideParameters){const r=null===(t=null===(e=this.dictionary.documentUpdate)||void 0===e?void 0:e.document.options)||void 0===t?void 0:t.crypto;if(!r)throw new Error("Cannot find Crypto options for PublicKey encryption handler");this.clientSideParameters=r}return this.clientSideParameters}async getGlobalParameters(){if(!this.globalParameters){let e;const t=await this.getParametersByNamePublicKey(this.dictionary.stmF);if(!t)throw new Error("");const r=t;if(this.dictionary.stmF===this.dictionary.strF)e=t;else{const t=await this.getParametersByNamePublicKey(this.dictionary.strF);if(!t)throw new Error("");e=t}this.globalParameters={stmKey:r,strKey:e}}return this.globalParameters}async getParametersByNamePublicKey(e){let t=new ArrayBuffer(0),r=-1,s=-1;const n=await this.getClientSideParameters();if(!this.dictionary.cf)throw new Error("No parameter's dictionary for default filter for input type");if(!(this.dictionary.cf.get(e,Cf)instanceof Cf))throw new Error(`${e} is not Filter Dictionary`);const i=this.dictionary.recipients;if(!(i instanceof Xp))throw new Error("Incorrect 'Recipients' type");for(let e=0;e<i.items.length;e++){const r=i.items[e];if(!(r instanceof np))throw new Error("Item is not a string");t=a(t,r.toArrayBuffer())}let o,c;for(let e=0;e<i.items.length;e++){const t=Ee(new La({string:i.items[e]}).buffer);if(-1===t.offset)throw new Error(`Incorrect structure for item #${e} of "Recipients" array`);try{c=new bh({schema:t.result})}catch(t){throw new Error(`Incorrect structure for item #${e} of "Recipients" array`)}try{o=new Ou({schema:c.content})}catch(t){throw new Error(`Incorrect structure for item #${e} of "Recipients" array`)}if(1!==o.recipientInfos.length)throw new Error(`Incorrect value in "recipientInfos" for item #${e} of "Recipients" array`);if(1!==o.recipientInfos[0].variant)throw new Error(`Incorrect value in "recipientInfos" for item #${e} of "Recipients" array`);for(let t=0;t<n.certificates.length;t++)if(n.certificates[t].issuer.isEqual(o.recipientInfos[0].value.rid.issuer)&&n.certificates[t].serialNumber.isEqual(o.recipientInfos[0].value.rid.serialNumber)){r=e,s=t;break}if(-1!==r)break}if(-1===r)throw new Error("Can not find a recipient");const l=await o.decrypt(0,{recipientCertificate:n.certificates[s],recipientPrivateKey:n.keys[s]});return await this.generateKeyCertificateBased(n.algorithm,l.slice(0,20),t)}async generateKeyCertificateBased(e,t,r,s=!1){if(!pm.includes(e.toUpperCase()))throw new Error(`Unsupported algorithm: ${e}`);let n=a(t,r);s&&(n=a(n,rm));const i=await this.crypto.digest(am,n);return this.crypto.importKey("raw",i,{name:e,length:256},!0,["decrypt","encrypt"])}}dm.NAME="Adobe.PPKLite";const fm=new Uint8Array([40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122]);class mm extends um{constructor(){super(...arguments),this.name=mm.NAME}async encrypt(e,t){const r=st.toUint8Array(e);let s;const n=await this.getGlobalParameters(),i=new Uint8Array(16);ih(i);const o=new Int32Array([t.id]),c=new Int32Array([t.generation]);let l=a(n.stm.key,o.buffer.slice(0,3),c.buffer.slice(0,2));switch(n.stm.keyType){case"AESV2":{l=a(l,sm.buffer);const e=await this.getCutHashV2(l,n.stm.key.byteLength,this.crypto),t=await this.crypto.importKey("raw",e,lm,!1,["encrypt","decrypt"]),o=await this.crypto.encrypt({name:"AES-CBC",length:128,iv:i},t,r);s=a(i.buffer,o)}break;case"AESV3":{const e=await this.crypto.importKey("raw",n.stm.key,lm,!1,["encrypt","decrypt"]),t=await this.crypto.encrypt({name:"AES-CBC",length:256,iv:i},e,r);s=a(i.buffer,t)}break;default:{const e=await this.getCutHashV2(l,n.stm.key.byteLength,this.crypto);s=await this.crypto.encrypt(im,e,r)}}return s}async decrypt(e,t){const r=st.toUint8Array(e);if(4===this.dictionary.v&&"Identity"===this.dictionary.stmF&&"Identity"===this.dictionary.strF)return r;let s;const n=await this.getGlobalParameters(),i=r.slice(16,r.byteLength),o=r.slice(0,16),c=new Int32Array([t.id]),l=new Int32Array([t.generation]);let h=a(n.stm.key,c.buffer.slice(0,3),l.buffer.slice(0,2));switch(n.stm.keyType){case"AESV2":{h=a(h,sm);const e=await this.getCutHashV2(h,n.stm.key.byteLength,this.crypto),t=await this.crypto.importKey("raw",e,lm,!1,["decrypt"]);s=await this.crypto.decrypt({name:"AES-CBC",length:128,iv:o},t,i)}break;case"AESV3":{const e=await this.crypto.importKey("raw",n.stm.key,lm,!1,["encrypt","decrypt"]);s=await this.crypto.decrypt({name:"AES-CBC",length:256,iv:o},e,i)}break;default:{const e=await this.getCutHashV2(h,n.stm.key.byteLength,this.crypto);s=await this.crypto.decrypt(im,e,r)}}return s}async getGlobalParameters(){var e,t,r,s,n,i,a;if(!this.globalParameters){const o={stm:{key:new ArrayBuffer(0),keyType:""},str:{key:new ArrayBuffer(0),keyType:""}};let c=new ArrayBuffer(0);(null===(r=null===(t=null===(e=this.dictionary.documentUpdate)||void 0===e?void 0:e.document.options)||void 0===t?void 0:t.password)||void 0===r?void 0:r.user)&&(c=at.FromString(null===(i=null===(n=null===(s=this.dictionary.documentUpdate)||void 0===s?void 0:s.document.options)||void 0===n?void 0:n.password)||void 0===i?void 0:i.user));const l=null===(a=this.dictionary.documentUpdate)||void 0===a?void 0:a.id;if(!l)throw new Error("No ID element in document trailer");const h=l[0].toArrayBuffer();if(6===this.dictionary.r)throw new Error("Method not implemented");const u=this.dictionary.encryptMetadata||!0;switch(!0){case this.dictionary.v<4:{const e=await this.generateKeyPasswordBased(this.dictionary.o.toArrayBuffer(),h,this.dictionary.p,this.dictionary.r,this.dictionary.length,u,c);o.stm.key=e,o.str.key=e}break;case this.dictionary.stmF===this.dictionary.strF:{let e;const t=this.getParametersByName(this.dictionary.stmF);if(!t.keyType)throw new Error("Error getting necessary encryption parameters");let r=0;if(r=this.dictionary.length?this.dictionary.length:t.keyLength,5===this.dictionary.v)throw new Error("Metod not implemented");e=await this.generateKeyPasswordBased(this.dictionary.o.toArrayBuffer(),h,this.dictionary.p,this.dictionary.r,r,this.dictionary.encryptMetadata,c),o.stm.key=e,o.stm.keyType=t.keyType,o.str.key=e,o.str.keyType=t.keyType}break;default:{let e=0,t=0;"length"in this.dictionary&&(e=this.dictionary.length,t=this.dictionary.length);const r=this.getParametersByName(this.dictionary.stmF);if(!r.keyType)throw new Error("Error getting necessary encryption parameters for Stm");if(0===e&&(e=r.keyLength),5===this.dictionary.v)throw new Error("Method not implemented");o.stm.key=await this.generateKeyPasswordBased(this.dictionary.o.toArrayBuffer().slice(0,32),h,this.dictionary.p,this.dictionary.r,e,this.dictionary.encryptMetadata,c),o.stm.keyType=r.keyType;const s=this.getParametersByName(this.dictionary.strF);if(!s.keyType)throw new Error("Error getting necessary encryption parameters for Str");if(0===t&&(t=s.keyLength),5===this.dictionary.v)throw new Error("Method not implemented");o.str.key=await this.generateKeyPasswordBased(this.dictionary.o.toArrayBuffer().slice(0,32),h,this.dictionary.p,this.dictionary.r,t,this.dictionary.encryptMetadata,c),o.str.keyType=s.keyType}}this.globalParameters=o}return this.globalParameters}getParametersByName(e){const t={keyLength:0,keyType:""};if(!this.dictionary.cf||!this.dictionary.cf.has(e))return t;const r=this.dictionary.cf.get(e,Cf);if(!(r instanceof Cf))throw new Error(`${e} is not Filter Dictionary`);const s=r.cfm;switch(s){case"V2":{t.keyType=s;const e=r.length;if(!e)return t;t.keyLength=e<40?e<<3:e}break;case"AESV2":t.keyType=s,t.keyLength=128;break;case"AESV3":t.keyType=s,t.keyLength=256}return t}async generateKeyPasswordBased(e,t,r,s,n=40,i=!1,o){const c=st.toArrayBuffer(e).slice(0,32),l=new Uint32Array([r]).buffer;let h=a(this.mixedPassword(o),c,l,t);s>3&&!i&&(h=a(h,rm.buffer));let u=await this.crypto.digest(nm,h);if(s>=3)for(let e=0;e<50;e++)u=await this.crypto.digest(nm,u);return u.slice(0,n>>3)}mixedPassword(e){let t;if(e)if(e.byteLength>=32)t=e.slice(0,32);else{t=a(e,fm.subarray(0,32-e.byteLength))}else t=fm.buffer;return t}async algorithm5(e,t,r,s,n=40,i=!1,o=new ArrayBuffer(0)){const c=new ArrayBuffer(16);ih(new Uint8Array(c));const l=await this.generateKeyPasswordBased(e,t,r,s,n,i,o),h=await this.crypto.digest(nm,a(fm.buffer,t));let u=await this.crypto.encrypt(im,l,h);return u=await this.makeAdditionalEncryption(u),a(u,c)}async algorithm4(e,t,r,s,n=40,i=!1,a=new ArrayBuffer(0)){const o=await this.generateKeyPasswordBased(e,t,r,s,n,i,a);return this.crypto.encrypt(im,o,fm.buffer)}async internalCycle(e,t,r=!1,s=!1,n=new ArrayBuffer(0),i=new ArrayBuffer(0)){let o=new ArrayBuffer(0),c=a(n,e);s&&(c=a(c,i));for(let e=0;e<64;e++)o=a(o,c);const l=await this.crypto.importKey("raw",e.slice(0,16),lm,!1,["encrypt"]);let h=await this.crypto.encrypt({name:"AES-CBC",length:128,iv:e.slice(16,32)},l,o);h=h.slice(0,o.byteLength);const u=new Uint8Array(h);let p,d=0;for(let e=0;e<16;e++)d*=1,d%=3,d+=(u[e]>>>0)%3,d%=3;switch(d){case 0:p=await this.crypto.digest(am,h);break;case 1:p=await this.crypto.digest(om,h);break;case 2:p=await this.crypto.digest(cm,h);break;default:throw new Error("Something went wrong")}return r&&u[u.length-1]>t-32?this.internalCycle(p,t+1,!0):{hash:p,roundNumber:t,leastByte:u[u.length-1]}}async algorithm2B(e,t=!1,r=new ArrayBuffer(0),s=new ArrayBuffer(0)){const n=await this.crypto.digest(am,e);let i=await this.internalCycle(n,0,!1,t,r,s);for(let e=0;e<63;e++)i=await this.internalCycle(i.hash,i.roundNumber+1,!1,t,r,s);return i=await this.internalCycle(i.hash,i.roundNumber+1,!0,t,r,s),i.hash.slice(0,32)}async checkPassword(e,t,r,s,n,i=!1){const o=i?n.slice(0,48):void 0;if(l(await this.algorithm2B(r,i,t,o),n.slice(0,32)))e.keyType=i?2:1,e.key=await this.algorithm2B(s,i,t,o);else{let t=a(new ArrayBuffer(0),n.slice(32,40)),r=a(new ArrayBuffer(0),n.slice(40,48));o&&(t=a(t,o),r=a(r,o));l(await this.algorithm2B(t,i,new ArrayBuffer(0),o),n.slice(0,32))&&(e.keyType=i?2:1,e.key=await this.algorithm2B(r,i,new ArrayBuffer(0),o))}return e}async generateKeyPasswordBasedA(e,t,r,s,n=new ArrayBuffer(0)){let i={keyType:0,key:null};const o=a(n,t.slice(32,40)),c=a(n,e.slice(32,40),t.slice(0,48)),l=a(n,t.slice(40,48)),h=a(n,e.slice(40,48),t.slice(0,48));if(n.byteLength&&(n=n.slice(0,n.byteLength>127?127:n.byteLength)),i=await this.checkPassword(i,n,o,l,t),i||(i=await this.checkPassword(i,n,c,h,t,!0)),!i.key)throw new Error("No key found");const u=await this.crypto.importKey("raw",i.key,lm,!1,["encrypt","decrypt"]);return this.crypto.decrypt({name:"AES-CBC",length:256,iv:new ArrayBuffer(16),pad:!0},u,1===i.keyType?s:r)}async algorithm3(e,t,r,s=40){let n=new ArrayBuffer(s>>3);const i=this.mixedPassword(e.byteLength?e:t),a=this.mixedPassword(t),o=await this.crypto.digest(nm,i);if(r<3)return o;let c=o;for(let e=0;e<50;e++)c=await this.crypto.digest(nm,c);return n=await this.crypto.encrypt(im,c.slice(0,s>>3),a),r<3?n:this.makeAdditionalEncryption(n)}async makeAdditionalEncryption(e){let t=e;const r=new Uint8Array(t);for(let e=1;e<20;e++){const s=new ArrayBuffer(t.byteLength),n=new Uint8Array(s);for(let s=0;s<t.byteLength;s++)n[s]=r[s]^e;t=await this.crypto.encrypt(im,s,t)}return t}async algorithm8(e,t=new ArrayBuffer(0)){const r=new ArrayBuffer(16);ih(new Uint8Array(r));const s=await this.algorithm2B(a(t,r.slice(0,8)),!1,t),n=a(s,r),i=await this.algorithm2B(a(t,r.slice(8,16)),!1,t),o=await this.crypto.importKey("raw",i,lm,!1,["encrypt"]);return[n,(await this.crypto.encrypt({name:"AES-CBC",length:256,iv:new ArrayBuffer(16)},o,e)).slice(0,e.byteLength)]}async algorithm9(e,t,r=new ArrayBuffer(0)){const s=new ArrayBuffer(16);ih(new Uint8Array(s));const n=await this.algorithm2B(a(r,s.slice(0,8),e),!0,r,e.slice(0,48)),i=a(n,s),o=await this.algorithm2B(a(r,s.slice(8,16),e),!0,r,e.slice(0,48)),c=await this.crypto.importKey("raw",o,lm,!1,["encrypt"]);return[i,(await this.crypto.encrypt({name:"AES-CBC",length:256,iv:new ArrayBuffer(16)},c,t)).slice(0,t.byteLength)]}async algorithm10(e,t,r=!1){const s=new Uint8Array([255,255,255,255,255,255,255,255,r?84:70,97,100,98]);s.set(new Uint8Array(e));const n=new ArrayBuffer(4);ih(new Uint8Array(n));const i=await this.crypto.importKey("raw",t,hm,!1,["encrypt"]);return await this.crypto.encrypt({name:"AES-ECB",padding:!1,iv:new ArrayBuffer(16)},i,a(s.buffer,n))}async getCutHashV2(e,t,r){const s=t+5;return(await r.digest(nm,e)).slice(0,s>16?16:s)}}mm.NAME="Standard";class gm{static register(e){this.handlers.set(e.NAME,e)}static get(e){const t=this.handlers.get(e);return t||dm}}var ym,vm,wm;function bm(e,t=0){if(!e.length)return t;let r=0;for(const t of e)r=r<<8|t;return r}gm.handlers=new Map([[mm.NAME,mm]]);class Sm{constructor(e){this.view=Sm.DEFAULT_VIEW,this.xref=null,this.startXref=0,ym.set(this,void 0),this.previous=null,vm.set(this,void 0),this.document=e}get encryptHandler(){if(void 0===bt(this,ym,"f"))if(this.encrypt){const e=gm.get(this.encrypt.filter);St(this,ym,new e(this.encrypt),"f")}else St(this,ym,null,"f");return bt(this,ym,"f")}get items(){var e;return(null===(e=this.xref)||void 0===e?void 0:e.objects)||[]}get encrypt(){var e;return(null===(e=this.xref)||void 0===e?void 0:e.Encrypt)||null}get id(){var e;return(null===(e=this.xref)||void 0===e?void 0:e.ID)||null}get catalog(){var e;return(null===(e=this.xref)||void 0===e?void 0:e.Root)||null}async fromPDF(e,t){var r,s;const n=Xu.getReader(e,t);this.startXref=n.view.byteOffset+n.position;let i=0;if(this.document.version>=1.5&&120!==n.current){const e=new td;e.documentUpdate=this,e.fromPDF(n);const t=new em;this.xref=t,t.documentUpdate=this,t.fromPDF(e.value.view);const r=await t.decode(),s=new $u(new Uint8Array(r)),a=[...t.W],o=t.Index||[{start:0,size:t.Size}];let c=0;for(;!s.isEOF;){const e=bm(s.read(a[0]),1),t=bm(s.read(a[1])),r=bm(s.read(a[2])),n=em.getIdentifier(o,c);let i;switch(e){case 0:i=xd.free;break;case 1:i=xd.inUse;break;case 2:i=xd.compressed;break;default:throw new Ju("Unsupported type in PDF Cross-Reference stream")}const l=new lf({type:i,documentUpdate:this,id:n,offset:t,generation:r});this.xref.addObject(l),c++}i=n.position}else{const e=this.xref=new tm;e.documentUpdate=this,i=e.fromPDF(n)}const a=null!==(s=null===(r=this.xref)||void 0===r?void 0:r.Prev)&&void 0!==s?s:null;if(null!==a){const e=new Sm(this.document);await e.fromPDF(new Uint8Array(n.view.buffer),a),this.previous=e}const o=new $u(n.view.buffer);if(o.position=n.position+n.view.byteOffset,o.read("%%EOF"),this.view=o.view.subarray(0,o.position+5),!this.document.wrongStructure)if(this.previous&&this.previous.startXref>this.startXref)this.document.wrongStructure=!0;else for(const e of this.getObjects())e.offset>this.startXref&&(this.document.wrongStructure=!0);return i}async writePDF(e){if(this.view.length)return void e.write(this.view);if(!this.xref)throw new Error("XRef is empty");if(!this.xref.objects.length)return;const t=e.length;for(const t of this.xref.objects)t.type===xd.inUse&&(t.value instanceof Yp&&await t.value.encode(),t.offset=e.length,t.indirect.writePDF(e));const r=e.length;if(this.xref instanceof tm)this.xref.writePDF(e);else if(this.xref instanceof em){await this.xref.prepare();this.createPDFDocumentObject(this.xref).indirect.writePDF(e)}e.writeStringLine("startxref"),this.startXref=r,new ap(r).writePDF(e),e.writeLine(),e.writeString("%%EOF\n"),this.view=e.toUint8Array().subarray(t)}getObjects(){if(!bt(this,vm,"f")){St(this,vm,[],"f");const e=[],t=[];let r=this;for(;r;){for(const s of r.items){const r=`${s.id}.${s.generation}`;s.type===xd.free||e.includes(r)||t.includes(r)?t.push(r):(bt(this,vm,"f").push(s),e.push(r))}r=r.previous}}return bt(this,vm,"f")}getObject(e,t=65535){if(e instanceof op)return this.getObject(e.id,e.generation);for(const r of this.items)if(r.id===e){if(!t&&r.type===xd.compressed)return r;if(r.generation<=t)return r}const r=this.previous;if(r)return r.getObject(e,t);throw new Error(`IndirectObject '${e} ${t}' does not exist`)}getCompressedObjectNumbers(){const e=[];for(const t of this.items){if(t.type!==xd.compressed)continue;const r=t.offset;e.includes(r)||e.push(r)}if(this.previous){const t=this.previous.getCompressedObjectNumbers();for(const r of t)e.includes(r)||e.push(r)}return e}getCompressedObjects(){return this.getCompressedObjectNumbers().map((e=>this.getObject(e,0)))}async decompress(){const e=this.getCompressedObjects();for(const t of e){const e=t.value;if(!(e instanceof Yp))throw new TypeError("Unexpected type of Compressed objects");const r=t.value=new cf(e);await r.decode()}}createCrossReferenceStream(){const e=new em;if(e.documentUpdate=this,this.previous&&this.previous.xref){const t=this.previous.xref.Size;e.Size=t}else e.Size=0;return e}createCrossReferenceTable(){const e=new tm;return e.documentUpdate=this,e}getOrCreateXref(){return this.xref||(this.document.options&&this.document.options.xref===wm.Table?this.xref=this.createCrossReferenceTable():this.xref=this.createCrossReferenceStream(),this.xref.onCreate()),this.xref}createPDFDocumentObject(e){const t=this.getOrCreateXref();let r=t.Size;if(!r){const e=new lf({id:0,generation:65535,offset:0,type:xd.free,documentUpdate:this});r++,this.append(e)}const s=new td(r,0,e);return t.Size=r+1,lf.create(s)}delete(e){let t;t="number"==typeof e?this.getObject(e):e;const r=new lf({documentUpdate:this,generation:65535,id:t.id,offset:0,type:xd.free});this.getOrCreateXref().addObject(r)}getOrCreateCompressedObject(){const e=this.getOrCreateXref();for(const t of e.objects)if(t.type!==xd.free&&t.value instanceof cf)return t;const t=cf.create(this);return this.append(t)}append(e,t){var r;let s;const n=this.getOrCreateXref();if(e instanceof lf?s=e:(s=this.createPDFDocumentObject(e),this.document.version>=1.5&&!this.document.options.disableCompressedObjects&&void 0===t&&(null===(r=this.document.options)||void 0===r?void 0:r.xref)!==wm.Table&&(e instanceof Yp||(s.type=xd.compressed))),n.documentUpdate=this,s.documentUpdate=this,s.type!==xd.free&&(s.value.documentUpdate=this),s.type===xd.compressed||t){const e=this.getOrCreateCompressedObject();e.value.setValue(s.id),s.type=xd.compressed,s.offset=e.id,s.generation=e.value.n-1}return n.addObject(s),s}async toString(){const e=[];if(this.xref)for(const t of this.xref.objects)t.type!==xd.free&&t.value instanceof Yp&&await t.value.decode(),e.push(t.toString());return this.xref&&e.push(this.xref.toString()),e.push("%%EOF"),e.join("\n")}addCatalog(){const e=this.getOrCreateXref();let t;if(this.previous&&this.previous.catalog)t=this.previous.catalog;else{if(!e.Root){const t=wf.create(this);this.append(t),e.Root=t}t=e.Root}return t}}ym=new WeakMap,vm=new WeakMap,Sm.DEFAULT_VIEW=new Uint8Array,function(e){e[e.Stream=0]="Stream",e[e.Table=1]="Table"}(wm||(wm={}));const Am=new Uint8Array(at.FromUtf8String("%PDF-"));class km{constructor(){this.wrongStructure=!1,this.view=km.DEFAULT_VIEW,this.version=km.DEFAULT_VERSION,this.update=new Sm(this),this.options={}}static async fromPDF(e,t=0){const r=new km;return await r.fromPDF(e,t),r}async writePDF(e){const t=e.length;this.view.length?e.write(this.view):(e.write(Am),e.writeString(`${this.version.toFixed(1)}\n`));const r=[];let s=this.update;for(;s;)r.push(s),s=s.previous;r.reverse();for(const t of r)t.view.length||await t.writePDF(e);const n=e.length;e.write(new Uint8Array,(e=>{this.view=new Uint8Array(e.buffer).subarray(t,n)}))}async toPDF(){const e=new Yu;return await this.writePDF(e),e.toArrayBuffer()}async fromPDF(e,t=0){let r=Xu.getReader(e,t);if(r.findIndex((e=>!zu.whiteSpaceChars.includes(e))),r.position&&(r=Xu.getReader(e,r.position)),!Am.every((e=>e===r.readByte())))throw new Ju("PDF header is not found",r.position-1);const s=ap.fromPDF(r);if(this.version=s.value,r.end(),r.backward=!0,r.position=r.findIndex("%%EOF"),-1===r.position)throw new Ju("Cannot get %%EOF keyword");if(r.read(5),r.position=r.findIndex("startxref"),-1===r.position)throw new Error("Cannot find 'startxref' keyword");r.backward=!1,r.readByte(),Qp.skip(r);const n=ap.fromPDF(r);return r.position=n.value,this.update=new Sm(this),await this.update.fromPDF(r),this.view=r.view,await this.update.decompress(),r.end(),this.options.xref=this.update.xref instanceof tm?wm.Table:wm.Stream,r.position}getObject(e,t){return"object"==typeof e?this.getObject(e.id,e.generation):this.update.getObject(e,t)}delete(e){this.update.delete(e)}append(e,t){return this.update.append(e,t)}async addPage(e){const t=this.update.catalog?this.update.catalog:this.update.addCatalog();return(await t.Pages.addPageOld(e)).value}async createUpdate(){if(this.update.view.length||await this.toPDF(),!this.update.view.length)return this.update;const e=new Sm(this);return e.previous=this.update,this.update=e,this.update.addCatalog(),e}findIndex(e,t={}){const r=t.offset||0,s=t.reversed?-1:1;for(let t=r;;t+=s){const r=this.view[t];if(void 0===r)break;if(e(r,t,this.view))return t}return-1}async toString(){const e=[];e.push(`%PDF-${this.version.toFixed(1)}`);const t=[];let r=this.update;for(;r;)t.push(r),r=r.previous;t.reverse();for(const r of t){const t=await r.toString();e.push(t)}return e.join("\n")}createNull(){return lp.create(this.update)}createBoolean(e){const t=tp.create(this.update);return t.value=e,t}createNumber(e,t){const r=ap.create(this.update);return r.value=e,t&&(r.padding=t),r}createName(e){const t=dp.create(this.update);return t.text=e,t}createString(e){const t=yp.create(this.update);return t.text=e,t}createHexString(e){const t=ip.create(this.update);return e&&(t.text=at.ToHex(e)),t}createArray(...e){const t=Xp.create(this.update);return t.items.push(...e),t}createDictionary(...e){const t=gp.create(this.update);for(const r of e)t.set(r[0],r[1]);return t}createStream(e){const t=Yp.create(this.update);return e&&(t.stream=st.toUint8Array(e)),t}createRectangle(e,t,r,s){return tf.createWithData(this.update,e,t,r,s)}}km.DEFAULT_VERSION=1.5,km.DEFAULT_VIEW=new Uint8Array;function Cm(e,t,r){const s=new Uint8Array([7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21]),n=new Int32Array([-680876936,-389564586,606105819,-1044525330,-176418897,1200080426,-1473231341,-45705983,1770035416,-1958414417,-42063,-1990404162,1804603682,-40341101,-1502002290,1236535329,-165796510,-1069501632,643717713,-373897302,-701558691,38016083,-660478335,-405537848,568446438,-1019803690,-187363961,1163531501,-1444681467,-51403784,1735328473,-1926607734,-378558,-2022574463,1839030562,-35309556,-1530992060,1272893353,-155497632,-1094730640,681279174,-358537222,-722521979,76029189,-640364487,-421815835,530742520,-995338651,-198630844,1126891415,-1416354905,-57434055,1700485571,-1894986606,-1051523,-2054922799,1873313359,-30611744,-1560198380,1309151649,-145523070,-1120210379,718787259,-343485551]);let i=1732584193,a=-271733879,o=-1732584194,c=271733878;e instanceof ArrayBuffer&&(r=e.byteLength,e=new Uint8Array(e));const l=r+72&-64,h=new Uint8Array(l);let u,p;for(u=0;u<r;++u)h[u]=e[t++];h[u++]=128;const d=l-8;for(;u<d;)h[u++]=0;h[u++]=r<<3&255,h[u++]=r>>5&255,h[u++]=r>>13&255,h[u++]=r>>21&255,h[u++]=r>>>29&255,h[u++]=0,h[u++]=0,h[u++]=0;const f=new Int32Array(16);for(u=0;u<l;){for(p=0;p<16;++p,u+=4)f[p]=h[u]|h[u+1]<<8|h[u+2]<<16|h[u+3]<<24;let e,t,r=i,l=a,d=o,m=c;for(p=0;p<64;++p){switch(!0){case p<16:e=l&d|~l&m,t=p;break;case p<32:e=m&l|~m&d,t=5*p+1&15;break;case p<48:e=l^d^m,t=3*p+5&15;break;default:e=d^(l|~m),t=7*p&15}const i=m,a=r+e+n[p]+f[t]|0,o=s[p];m=d,d=l,l=l+(a<<o|a>>>32-o)|0,r=i}i=i+r|0,a=a+l|0,o=o+d|0,c=c+m|0}return Promise.resolve(new Uint8Array([255&i,i>>8&255,i>>16&255,i>>>24&255,255&a,a>>8&255,a>>16&255,a>>>24&255,255&o,o>>8&255,o>>16&255,o>>>24&255,255&c,c>>8&255,c>>16&255,c>>>24&255]).buffer)}function Im(e,t){e instanceof Uint8Array==!1&&(e=new Uint8Array(e)),t instanceof Uint8Array==!1&&(t=new Uint8Array(t));const r=new Uint8Array(256);let s,n=0;const i=new Uint8Array(t.length);for(let e=0;e<256;e++)r[e]=e;for(let t=0;t<256;t++)n=(n+r[t]+e[t%e.length])%256,s=r[t],r[t]=r[n],r[n]=s;let a=0;n=0;for(let e=0;e<t.length;e++)a=(a+1)%256,n=(n+r[a])%256,s=r[a],r[a]=r[n],r[n]=s,i[e]=t[e]^r[(r[a]+r[n])%256];return Promise.resolve(i.buffer)}class xm{static isPNG(e){const t=new $u(e);return xm.HEADER.every((e=>e===t.readByte()))}static fromView(e){const t=new $u(e);if(!xm.HEADER.every((e=>e===t.readByte())))throw new Error("Incorrect PNG header");const r=new Map;for(;!t.isEOF;){const e=t.readUint32(!0),s=t.readString(4),n=t.read(e);t.read(4);let i=r.get(s);i||(i=new Yu,r.set(s,i)),i.write(n)}const s=r.get("IHDR");if(!s)throw new TypeError("Invalid structure of PNG data. IHDR section not found.");const n=new $u(s.toUint8Array()),i=new xm;i.width=n.readUint32(!0),i.height=n.readUint32(!0),i.bitDepth=n.readByte(),i.colorType=n.readByte(),i.hasAlphaChannel=4===i.colorType||6===i.colorType,i.compressionMethod=n.readByte(),i.filterMethod=n.readByte(),i.interlaceMethod=n.readByte(),i.sections=new Map;for(const[e,t]of r)i.sections.set(e,t.toUint8Array());return i}}xm.HEADER=new Uint8Array([137,80,78,71,13,10,26,10]);class Em{constructor(){this.data=Em.DEFAULT_VIEW,this.bitsPerComponent=0,this.height=0,this.width=0,this.channels=0}static isJPEG(e){return 65496===new $u(e).readUint16()}static fromView(e){const t=new $u(e);if(65496!==t.readUint16())throw new Error("Cannot get SOI marker from JPEG.");for(;!t.isEOF;){const e=t.readUint16();if(65472<=e&&e<=65487)break;t.position+=t.readUint16()}if(t.isEOF)throw new Error("JPEG Frame marker not found.");t.position+=2;const r=new Em;return r.data=st.toUint8Array(e),r.bitsPerComponent=t.readUint8(),r.height=t.readUint16(),r.width=t.readUint16(),r.channels=t.readUint8(),r}}var Bm;Em.DEFAULT_VIEW=new Uint8Array;let Nm=Bm=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Bm.prototype)}};Nm=Bm=wt([dt({type:Ne.Sequence,itemType:Pe.ObjectIdentifier})],Nm);let Pm=class{constructor(e=new Date){this.value=e}};wt([ft({type:Pe.GeneralizedTime})],Pm.prototype,"value",void 0),Pm=wt([dt({type:Ne.Choice})],Pm);let Dm=class{constructor(e=null){this.value=e}};var Um;wt([ft({type:Pe.Null})],Dm.prototype,"value",void 0),Dm=wt([dt({type:Ne.Choice})],Dm);class Om{constructor(e={}){this.sigIdentifier=new Vr,Object.assign(this,e)}}wt([ft({type:Vr})],Om.prototype,"sigIdentifier",void 0),wt([ft({type:Vr,optional:!0})],Om.prototype,"certIdentifier",void 0);let Tm=Um=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Um.prototype)}};Tm=Um=wt([dt({type:Ne.Sequence,itemType:Vr})],Tm);class Rm{constructor(e={}){this.issuer=new Dt,this.locator=new Ft,Object.assign(this,e)}}wt([ft({type:Dt})],Rm.prototype,"issuer",void 0),wt([ft({type:Ft})],Rm.prototype,"locator",void 0);let _m=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Dt,context:1})],_m.prototype,"byName",void 0),wt([ft({type:class extends ct{},context:2})],_m.prototype,"byKey",void 0),_m=wt([dt({type:Ne.Choice})],_m);class Vm{constructor(e={}){this.hashAlgorithm=new Vr,this.issuerNameHash=new ct,this.issuerKeyHash=new ct,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Vr})],Vm.prototype,"hashAlgorithm",void 0),wt([ft({type:ct})],Vm.prototype,"issuerNameHash",void 0),wt([ft({type:ct})],Vm.prototype,"issuerKeyHash",void 0),wt([ft({type:Pe.Integer,converter:Re})],Vm.prototype,"serialNumber",void 0);class Fm{constructor(e={}){this.revocationTime=new Date,Object.assign(this,e)}}wt([ft({type:Pe.GeneralizedTime})],Fm.prototype,"revocationTime",void 0),wt([ft({type:pr,context:0,optional:!0})],Fm.prototype,"revocationReason",void 0);let Lm=class{constructor(e={}){Object.assign(this,e)}};wt([ft({type:Pe.Null,context:0,implicit:!0})],Lm.prototype,"good",void 0),wt([ft({type:Fm,context:1,implicit:!0})],Lm.prototype,"revoked",void 0),wt([ft({type:Pe.Null,context:2,implicit:!0})],Lm.prototype,"unknown",void 0),Lm=wt([dt({type:Ne.Choice})],Lm);class jm{constructor(e={}){this.certID=new Vm,this.certStatus=new Lm,this.thisUpdate=new Date,Object.assign(this,e)}}var Hm;wt([ft({type:Vm})],jm.prototype,"certID",void 0),wt([ft({type:Lm})],jm.prototype,"certStatus",void 0),wt([ft({type:Pe.GeneralizedTime})],jm.prototype,"thisUpdate",void 0),wt([ft({type:Pe.GeneralizedTime,context:0,optional:!0})],jm.prototype,"nextUpdate",void 0),wt([ft({type:Mr,context:1,repeated:"sequence",optional:!0})],jm.prototype,"singleExtensions",void 0),function(e){e[e.v1=0]="v1"}(Hm||(Hm={}));class Mm{constructor(e={}){this.version=Hm.v1,this.responderID=new _m,this.producedAt=new Date,this.responses=[],Object.assign(this,e)}}wt([ft({type:Pe.Integer,context:0,defaultValue:Hm.v1})],Mm.prototype,"version",void 0),wt([ft({type:_m})],Mm.prototype,"responderID",void 0),wt([ft({type:Pe.GeneralizedTime})],Mm.prototype,"producedAt",void 0),wt([ft({type:jm,repeated:"sequence"})],Mm.prototype,"responses",void 0),wt([ft({type:Mr,repeated:"sequence",context:1,optional:!0})],Mm.prototype,"responseExtensions",void 0);class Km{constructor(e={}){this.tbsResponseData=new Mm,this.signatureAlgorithm=new Vr,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Mm})],Km.prototype,"tbsResponseData",void 0),wt([ft({type:Vr})],Km.prototype,"signatureAlgorithm",void 0),wt([ft({type:Pe.BitString})],Km.prototype,"signature",void 0),wt([ft({type:Gr,repeated:"sequence",optional:!0,context:0})],Km.prototype,"certs",void 0);class qm{constructor(e={}){this.signatureAlgorithm=new Vr,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}wt([ft({type:Vr})],qm.prototype,"signatureAlgorithm",void 0),wt([ft({type:Pe.BitString})],qm.prototype,"signature",void 0),wt([ft({type:Gr,repeated:"sequence",optional:!0,context:0})],qm.prototype,"certs",void 0);class Wm{constructor(e={}){this.reqCert=new Vm,Object.assign(this,e)}}wt([ft({type:Vm})],Wm.prototype,"reqCert",void 0),wt([ft({type:Mr,repeated:"sequence",optional:!0})],Wm.prototype,"singleRequestExtensions",void 0);class Gm{constructor(e={}){this.version=Hm.v1,this.requestList=[],Object.assign(this,e)}}wt([ft({type:Pe.Integer,context:0,defaultValue:Hm.v1})],Gm.prototype,"version",void 0),wt([ft({type:Rt,context:1,optional:!0})],Gm.prototype,"requestorName",void 0),wt([ft({type:Wm,repeated:"sequence"})],Gm.prototype,"requestList",void 0),wt([ft({type:Mr,context:2,optional:!0,repeated:"sequence"})],Gm.prototype,"requestExtensions",void 0);class zm{constructor(e={}){this.tbsRequest=new Gm,Object.assign(this,e)}}var Jm,$m,Ym,Xm;wt([ft({type:Gm})],zm.prototype,"tbsRequest",void 0),wt([ft({type:qm,optional:!0,context:0})],zm.prototype,"optionalSignature",void 0),function(e){e[e.successful=0]="successful",e[e.malformedRequest=1]="malformedRequest",e[e.internalError=2]="internalError",e[e.tryLater=3]="tryLater",e[e.sigRequired=5]="sigRequired",e[e.unauthorized=6]="unauthorized"}(Jm||(Jm={}));class Qm{constructor(e={}){this.responseType="",this.response=new ct,Object.assign(this,e)}}wt([ft({type:Pe.ObjectIdentifier})],Qm.prototype,"responseType",void 0),wt([ft({type:ct})],Qm.prototype,"response",void 0);class Zm{constructor(e={}){this.responseStatus=Jm.successful,Object.assign(this,e)}}wt([ft({type:Pe.Enumerated})],Zm.prototype,"responseStatus",void 0),wt([ft({type:Qm,context:0,optional:!0})],Zm.prototype,"responseBytes",void 0);class eg{constructor(e={}){this.seconds=0,Object.assign(this,e)}}wt([ft({type:Pe.Integer,optional:!0})],eg.prototype,"seconds",void 0),wt([ft({type:Pe.Integer,context:0,implicit:!0,optional:!0})],eg.prototype,"millis",void 0),wt([ft({type:Pe.Integer,context:1,implicit:!0,optional:!0})],eg.prototype,"micros",void 0);class tg{constructor(e={}){this.hashAlgorithm=new Vr,this.hashedMessage=new ct,Object.assign(this,e)}}wt([ft({type:Vr})],tg.prototype,"hashAlgorithm",void 0),wt([ft({type:ct})],tg.prototype,"hashedMessage",void 0),function(e){e[e.badAlg=1]="badAlg",e[e.badRequest=2]="badRequest",e[e.badDataFormat=16]="badDataFormat",e[e.timeNotAvailable=8192]="timeNotAvailable",e[e.unacceptedPolicy=16384]="unacceptedPolicy",e[e.unacceptedExtension=32768]="unacceptedExtension",e[e.addInfoNotAvailable=65536]="addInfoNotAvailable",e[e.systemFailure=16777216]="systemFailure"}($m||($m={}));!function(e){e[e.granted=0]="granted",e[e.grantedWithMods=1]="grantedWithMods",e[e.rejection=2]="rejection",e[e.waiting=3]="waiting",e[e.revocationWarning=4]="revocationWarning",e[e.revocationNotification=5]="revocationNotification"}(Ym||(Ym={}));let rg=Xm=class extends yt{constructor(e){super(e),Object.setPrototypeOf(this,Xm.prototype)}};rg=Xm=wt([dt({type:Ne.Sequence,itemType:Pe.Utf8String})],rg);class sg{constructor(e={}){this.status=Ym.granted,Object.assign(this,e)}}var ng;wt([ft({type:Pe.Integer})],sg.prototype,"status",void 0),wt([ft({type:rg,optional:!0})],sg.prototype,"statusString",void 0),wt([ft({type:class extends ot{toJSON(){const e=this.toNumber(),t=[];return e&$m.addInfoNotAvailable&&t.push("addInfoNotAvailable"),e&$m.badAlg&&t.push("badAlg"),e&$m.badDataFormat&&t.push("badDataFormat"),e&$m.badRequest&&t.push("badRequest"),e&$m.systemFailure&&t.push("systemFailure"),e&$m.systemFailure&&t.push("systemFailure"),e&$m.timeNotAvailable&&t.push("timeNotAvailable"),e&$m.unacceptedExtension&&t.push("unacceptedExtension"),e&$m.unacceptedPolicy&&t.push("unacceptedPolicy"),t}toString(){return`[${this.toJSON().join(", ")}]`}},optional:!0})],sg.prototype,"failInfo",void 0),function(e){e[e.v1=1]="v1"}(ng||(ng={}));class ig{constructor(e={}){this.version=ng.v1,this.messageImprint=new tg,this.certReq=!1,Object.assign(this,e)}}wt([ft({type:Pe.Integer})],ig.prototype,"version",void 0),wt([ft({type:tg})],ig.prototype,"messageImprint",void 0),wt([ft({type:Pe.ObjectIdentifier,optional:!0})],ig.prototype,"reqPolicy",void 0),wt([ft({type:Pe.Integer,converter:Re,optional:!0})],ig.prototype,"nonce",void 0),wt([ft({type:Pe.Boolean,defaultValue:!1})],ig.prototype,"certReq",void 0),wt([ft({type:Kr,optional:!0,context:0,implicit:!0})],ig.prototype,"extensions",void 0);let ag=class extends En{};ag=wt([dt({type:Ne.Sequence})],ag);class og{constructor(e={}){this.status=new sg,Object.assign(this,e)}}var cg;wt([ft({type:sg})],og.prototype,"status",void 0),wt([ft({type:ag,optional:!0})],og.prototype,"timeStampToken",void 0),function(e){e[e.v1=1]="v1"}(cg||(cg={}));class lg{constructor(e={}){this.version=cg.v1,this.policy="",this.messageImprint=new tg,this.serialNumber=new ArrayBuffer(0),this.genTime=new Date,this.ordering=!1,Object.assign(this,e)}}
/*!
 * BSD 3-Clause License
 * 
 * Copyright (c) 2021, PeculiarVentures
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. Neither the name of the copyright holder nor the names of its
 *    contributors may be used to endorse or promote products derived from
 *    this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */
function hg(e,t=!0,r=!0,s=!0){const n=[],i=new DataView(new Uint8Array(e).buffer),a=t?2:4,o=!r;let c=0;s&&(c=t?2:4);for(let e=c;e<i.byteLength;e+=a)t?n.push(i.getUint16(e,o)):n.push(i.getUint32(e,o));return n}function ug(e,t=!0,r=!0,s=!0){const n=[];if(s)switch(!0){case t&&r:n.push(254),n.push(255);break;case t&&!r:n.push(255),n.push(254);break;case!t&&r:n.push(0),n.push(0),n.push(254),n.push(255);break;case!t&&!r:n.push(255),n.push(254),n.push(0),n.push(0)}for(const s of e)for(let e=0;e<s.length;e++){const i=new Uint8Array(new Uint32Array([s.codePointAt(e)||0]).buffer);t||r?(t||(n.push(i[3]),n.push(i[2])),r?(n.push(i[1]),n.push(i[0])):(n.push(i[0]),n.push(i[1]))):n.push(...i)}return n}function pg(e){e.getUint32();const t=e.getUint32();return new Date(1e3*(t-2082844800))}function dg(e,t){t.appendUint32(0),t.appendUint32(e.getTime()/1e3+2082844800)}function fg(e){return e.getInt16()/16384}function mg(e,t){t.appendInt16(16384*e)}function gg(e,t){return(e&t)===t}wt([ft({type:Pe.Integer})],lg.prototype,"version",void 0),wt([ft({type:Pe.ObjectIdentifier})],lg.prototype,"policy",void 0),wt([ft({type:tg})],lg.prototype,"messageImprint",void 0),wt([ft({type:Pe.Integer,converter:Re})],lg.prototype,"serialNumber",void 0),wt([ft({type:Pe.GeneralizedTime})],lg.prototype,"genTime",void 0),wt([ft({type:eg,optional:!0})],lg.prototype,"accuracy",void 0),wt([ft({type:Pe.Boolean,defaultValue:!1})],lg.prototype,"ordering",void 0),wt([ft({type:Pe.Integer,converter:Re,optional:!0})],lg.prototype,"nonce",void 0),wt([ft({type:Rt,context:0,optional:!0})],lg.prototype,"tsa",void 0),wt([ft({type:Kr,context:1,implicit:!0,optional:!0})],lg.prototype,"extensions",void 0);class yg{constructor(e={}){this._array=[1,0,0,0,1,0,0,0,1],this.setValues(e)}static makeTranslation(e,t){return new yg({e:e,f:t})}setValues(e={}){this.a=e.a||1,this.b=e.b||0,this.c=e.c||0,this.d=e.d||1,this.e=e.e||0,this.f=e.f||0,this.j=e.j||0,this.k=e.k||0,this.l=e.l||1}multiply(e){return new yg({a:this.a*e.a+this.b*e.c+this.j*e.e,b:this.a*e.b+this.b*e.d+this.j*e.f,j:this.a*e.j+this.b*e.k+this.j*e.l,c:this.c*e.a+this.d*e.c+this.k*e.e,d:this.c*e.b+this.d*e.d+this.k*e.f,k:this.c*e.j+this.d*e.k+this.k*e.l,e:this.e*e.a+this.f*e.c+this.l*e.e,f:this.e*e.b+this.f*e.d+this.l*e.f,l:this.e*e.j+this.f*e.k+this.l*e.l})}add(e){return new yg({a:this.a+e.a,b:this.b+e.b,c:this.c+e.c,d:this.d+e.d,e:this.e+e.e,f:this.f+e.f,j:this.j+e.j,k:this.k+e.k,l:this.l+e.l})}sub(e){return new yg({a:this.a-e.a,b:this.b-e.b,c:this.c-e.c,d:this.d-e.d,e:this.e-e.e,f:this.f-e.f,j:this.j-e.j,k:this.k-e.k,l:this.l-e.l})}get det(){return this.a*this.d*this.l-this.a*this.k*this.f-this.b*this.c*this.l+this.b*this.k*this.e+this.j*this.c*this.f-this.j*this.d*this.e}get a(){return this._array[0]}set a(e){this._array[0]=e}get b(){return this._array[1]}set b(e){this._array[1]=e}get c(){return this._array[3]}set c(e){this._array[3]=e}get d(){return this._array[4]}set d(e){this._array[4]=e}get e(){return this._array[6]}set e(e){this._array[6]=e}get f(){return this._array[7]}set f(e){this._array[7]=e}get j(){return this._array[2]}set j(e){this._array[2]=e}get k(){return this._array[5]}set k(e){this._array[5]=e}get l(){return this._array[8]}set l(e){this._array[8]=e}}class vg{static get className(){return"BaseClass"}toStream(e,...t){return!0}static fromStream(e,...t){return new vg}}class wg extends vg{static get tag(){return 0}}const bg=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"];class Sg extends vg{constructor(e={}){super(),this.data=e.data||[]}static fromStream(e,t=1){let r=0;if(1===t)r=e.getUint16();else r=e.getUint32();const s=e.getBlock(1)[0],n=[];for(let t=0;t<=r;t++){let t=null;switch(s){case 1:t=e.getBlock(1)[0];break;case 2:t=e.getUint16();break;case 3:t=e.getUint24();break;case 4:t=e.getUint32()}null!==t&&n.push(t)}const i=[];for(let t=0;t<n.length-1;t++){const r=e.stream.buffer.slice(e.start-1+n[t],e.start-1+n[t+1]);i.push(r)}return e.start=e.start-1+n[n.length-1],new Sg({data:i})}}class Ag extends Sg{constructor(e={}){super(e)}static fromStream(e,t=1){const r=Sg.fromStream(e,t).data.map((e=>String.fromCharCode(...new Uint8Array(e))));return new Ag({data:r})}}class kg extends vg{constructor(e={}){super(),this.format=e.format||0,"charset"in e&&(this.charset=e.charset)}static fromStream(e,t=0,r=new Ag){const s={charset:[".notdef"]};switch(s.format=e.getBlock(1)[0],s.format){case 0:for(let n=0;n<t-1;n++){const t=e.getUint16();s.charset.push(t<=390?bg[t]:r.data[t-391])}break;case 1:for(;s.charset.length<=t-1;){let t=e.getUint16();const n=e.getBlock(1)[0];for(let e=0;e<=n;e++,t++)s.charset.push(t<=390?bg[t]:r.data[t-391])}break;case 2:for(;s.charset.length<=t-1;){let t=e.getUint16();const n=e.getUint16();for(let e=0;e<=n;e++,t++)s.charset.push(t<=390?bg[t]:r.data[t-391])}}return new kg(s)}}class Cg extends vg{constructor(e={}){super(),this.format=e.format||0,this.encoding=e.encoding||{}}static fromStream(e){const t={encoding:{}};switch(t.format=e.getBlock(1)[0],t.format){case 0:{const r=e.getBlock(1)[0];for(let s=0;s<r;s++){const r=e.getBlock(1)[0];t.encoding[r]=s}}break;case 1:{const r=e.getBlock(1)[0];for(let s=0;s<r;s++){const r=e.getBlock(1)[0],s=e.getBlock(1)[0];for(let e=r,n=1;e<=r+s;e++,n++)t.encoding[e]=n}}}return new Cg(t)}}const Ig=["0","1","2","3","4","5","6","7","8","9",".","E","E-","","-"];class xg{constructor(e={}){this.entries=e.entries||[]}static fromBuffer(e){const t=new DataView(e),r=[];let s=[],n=0;for(;n<e.byteLength;){let e=null;const i=t.getUint8(n);switch(n++,!0){case i<=27:{let e=i;12===e&&(e=1200+t.getUint8(n),n++),r.push({key:e,values:s}),s=[]}break;case 28===i:{const r=t.getUint8(n);n++;const s=t.getUint8(n);n++,e=r<<8|s}break;case 29===i:{const r=t.getUint8(n);n++;const s=t.getUint8(n);n++;const i=t.getUint8(n);n++;const a=t.getUint8(n);n++,e=r<<24|s<<16|i<<8|a}break;case 30===i:{let r="";for(;;){const e=t.getUint8(n);n++;const s=e>>4;if(15===s)break;r+=Ig[s];const i=15&e;if(15===i)break;r+=Ig[i]}e=parseFloat(r)}break;case i>=32&&i<=246:e=i-139;break;case i>=247&&i<=250:{const r=t.getUint8(n);n++,e=256*(i-247)+r+108}break;case i>=251&&i<=254:{const r=t.getUint8(n);n++,e=256*-(i-251)-r-108}}null!==e&&s.push(e)}return new xg({entries:r})}}class Eg extends xg{constructor(e={}){super(e),"BlueValues"in e&&(this.BlueValues=e.BlueValues),"OtherBlues"in e&&(this.OtherBlues=e.OtherBlues),"FamilyBlues"in e&&(this.FamilyBlues=e.FamilyBlues),"FamilyOtherBlues"in e&&(this.FamilyOtherBlues=e.FamilyOtherBlues),this.BlueScale=e.BlueScale||.039625,this.BlueShift=e.BlueShift||7,this.BlueFuzz=e.BlueFuzz||1,"StdHW"in e&&(this.StdHW=e.StdHW),"StdVW"in e&&(this.StdVW=e.StdVW),"SteamSnapH"in e&&(this.SteamSnapH=e.SteamSnapH),"SteamSnapV"in e&&(this.SteamSnapV=e.SteamSnapV),this.ForceBold=e.ForceBold||!1,this.LanguageGroup=e.LanguageGroup||0,this.ExpansionFactor=e.ExpansionFactor||.06,this.initialRandomSeed=e.initialRandomSeed||0,"Subrs"in e&&(this.Subrs=e.Subrs),this.defaultWidthX=e.defaultWidthX||0,this.nominalWidthX=e.nominalWidthX||0}static fromBuffer(e){const t=xg.fromBuffer(e),r={entries:t.entries};for(const e of t.entries)switch(e.key){case 6:r.BlueValues=e.values;break;case 7:r.OtherBlues=e.values;break;case 8:r.FamilyBlues=e.values;break;case 9:r.FamilyOtherBlues=e.values;break;case 1209:r.BlueScale=e.values[0];break;case 1210:r.BlueShift=e.values[0];break;case 1211:r.BlueFuzz=e.values[0];break;case 10:r.StdHW=e.values[0];break;case 11:r.StdVW=e.values[0];break;case 1212:r.SteamSnapH=e.values;break;case 1213:r.SteamSnapV=e.values;break;case 1214:r.ForceBold=!!e.values[0];break;case 1217:r.LanguageGroup=e.values[0];break;case 1218:r.ExpansionFactor=e.values[0];break;case 1219:r.initialRandomSeed=e.values[0];break;case 19:r.Subrs=e.values[0];break;case 20:r.defaultWidthX=e.values[0];break;case 21:r.nominalWidthX=e.values[0]}return new Eg(r)}}class Bg extends xg{constructor(e={}){super(e),"version"in e&&(this.version=e.version),"Notice"in e&&(this.Notice=e.Notice),"Copyright"in e&&(this.Copyright=e.Copyright),"FullName"in e&&(this.FullName=e.FullName),"FamilyName"in e&&(this.FamilyName=e.FamilyName),"Weight"in e&&(this.Weight=e.Weight),this.isFixedPitch=e.isFixedPitch||!1,this.ItalicAngle=e.ItalicAngle||0,this.UnderlinePosition=e.UnderlinePosition||-100,this.UnderlineThickness=e.UnderlineThickness||50,this.PaintType=e.PaintType||0,this.CharstringType=e.CharstringType||2,this.FontMatrix=e.FontMatrix||[.001,0,0,.001,0,0],"UniqueID"in e&&(this.UniqueID=e.UniqueID),this.FontBBox=e.FontBBox||[0,0,0,0],this.StrokeWidth=e.StrokeWidth||0,"XUID"in e&&(this.XUID=e.XUID),this.charset=e.charset||0,this.Encoding=e.Encoding||0,"CharStrings"in e&&(this.CharStrings=e.CharStrings),"Private"in e&&(this.Private=e.Private),"SyntheticBase"in e&&(this.SyntheticBase=e.SyntheticBase),"PostScript"in e&&(this.PostScript=e.PostScript),"BaseFontName"in e&&(this.BaseFontName=e.BaseFontName),"BaseFontBlend"in e&&(this.BaseFontBlend=e.BaseFontBlend)}static fromBuffer(e,t=new Ag){const r=xg.fromBuffer(e),s={entries:r.entries};for(const e of r.entries)switch(e.key){case 0:s.version=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 1:s.Notice=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 1200:s.Copyright=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 2:s.FullName=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 3:s.FamilyName=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 4:s.Weight=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 1201:s.isFixedPitch=!!e.values[0];break;case 1202:s.ItalicAngle=e.values[0];break;case 1203:s.UnderlinePosition=e.values[0];break;case 1204:s.UnderlineThickness=e.values[0];break;case 1205:s.PaintType=e.values[0];break;case 1206:s.CharstringType=e.values[0];break;case 1207:s.FontMatrix=e.values;break;case 13:s.UniqueID=e.values[0];break;case 5:s.FontBBox=e.values;break;case 1208:s.StrokeWidth=e.values[0];break;case 14:s.XUID=e.values;break;case 15:s.charset=e.values[0];break;case 16:s.Encoding=e.values[0];break;case 17:s.CharStrings=e.values[0];break;case 18:s.Private={size:e.values[0],offset:e.values[1]};break;case 1220:s.SyntheticBase=e.values[0];break;case 1221:s.PostScript=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 1222:s.BaseFontName=e.values[0]<=390?bg[e.values[0]]:t.data[e.values[0]-391];break;case 1223:s.BaseFontBlend=e.values}return new Bg(s)}}class Ng extends wg{constructor(e={}){super(),this.dicts=e.dicts||[]}static get tag(){return 1128678944}static fromStream(e){const t=e.getBlock(4),r=(t[0],t[1],t[2]);t[3];e.getBlock(r-4),Sg.fromStream(e);const s=Sg.fromStream(e),n=Ag.fromStream(e);Sg.fromStream(e);const i=[];for(const t of s.data){const r=Bg.fromBuffer(t,n);if(r.Private){const t=e.stream.buffer.slice(r.Private.offset,r.Private.offset+r.Private.size);r.PrivateDICT=Eg.fromBuffer(t)}if("CharStrings"in r)switch(r.CharStringsINDEX=Sg.fromStream(new ja({stream:e.stream.slice(r.CharStrings)})),r.CharsetParsed=kg.fromStream(new ja({stream:e.stream.slice(r.charset)}),r.CharStringsINDEX.data.length,n),r.Encoding){case 0:case 1:break;case 2:r.EncodingParsed=Cg.fromStream(new ja({stream:e.stream.slice(r.Encoding)}))}i.push(r)}return new Ng({dicts:i})}}class Pg extends Sg{constructor(e={}){super(e)}static fromStream(e){const t=Sg.fromStream(e,2),r=Pg.decode(t.data);return new Pg({data:r})}static decode(e){const t=[];let r=[];for(const s of e){const e=new DataView(s);for(let s=0;s<e.byteLength;s++){let n=e.getUint8(s);switch(!0){case 1===n:t.push({operator:"hstem",operands:r}),r=[];break;case 3===n:t.push({operator:"vstem",operands:r}),r=[];break;case 4===n:t.push({operator:"vmoveto",operands:r}),r=[];break;case 5===n:t.push({operator:"rlineto",operands:r}),r=[];break;case 6===n:t.push({operator:"hlineto",operands:r}),r=[];break;case 7===n:t.push({operator:"vlineto",operands:r}),r=[];break;case 8===n:t.push({operator:"rrcurveto",operands:r}),r=[];break;case 10===n:t.push({operator:"callsubr",operands:r}),r=[];break;case 12===n:switch(s++,n=e.getUint8(s),!0){case n>=0&&n<=33:break;case 34===n:t.push({operator:"hflex",operands:r}),r=[];break;case 35===n:t.push({operator:"flex",operands:r}),r=[];break;case 36===n:t.push({operator:"hflex1",operands:r}),r=[];break;case 37===n:t.push({operator:"flex1",operands:r}),r=[]}break;case 15===n:t.push({operator:"vsindex",operands:r}),r=[];break;case 16===n:t.push({operator:"blend",operands:r}),r=[];break;case 18===n:t.push({operator:"hstemhm",operands:r}),r=[];break;case 19===n:t.push({operator:"hintmask",operands:r}),r=[];break;case 20===n:t.push({operator:"cntrmask",operands:r}),r=[];break;case 21===n:t.push({operator:"rmoveto",operands:r}),r=[];break;case 22===n:t.push({operator:"hmoveto",operands:r}),r=[];break;case 23===n:t.push({operator:"vstemhm",operands:r}),r=[];break;case 24===n:t.push({operator:"rcurveline",operands:r}),r=[];break;case 25===n:t.push({operator:"rlinecurve",operands:r}),r=[];break;case 26===n:t.push({operator:"vvcurveto",operands:r}),r=[];break;case 27===n:t.push({operator:"hhcurveto",operands:r}),r=[];break;case 28===n:{s++;const t=e.getUint8(s);r.push((n<<24|t<<16)>>16)}break;case 29===n:t.push({operator:"callgsubr",operands:r}),r=[];break;case 30===n:t.push({operator:"vhcurveto",operands:r}),r=[];break;case 31===n:t.push({operator:"hvcurveto",operands:r}),r=[];break;case n>=32&&n<=246:r.push(n-139);break;case n>=247&&n<=250:{s++;const t=e.getUint8(s);r.push(256*(n-247)+t+108)}break;case n>=251&&n<=254:{s++;const t=e.getUint8(s);r.push(-256*(n-251)-t-108)}break;case 255===n:s++,n=e.getInt32(s,!1),r.push(n/65536),s+=4}}}return t}}class Dg extends vg{constructor(e={}){super(),this.format=e.format||0,this.fds=e.fds||new Uint8Array}static fromStream(e,t=0){const r={};switch(r.fds=new Uint8Array,r.format=e.getBlock(1)[0],r.format){case 0:r.fds=e.getBlock(t);break;case 3:{const t=e.getUint16(),s=[];for(let r=0;r<t;r++){const t={first:e.getUint16(),fd:e.getBlock(1)[0]};s.push(t)}const n=e.getUint16();for(let e=0;e<s.length-1;e++)for(let t=s[e].first;t<s[e+1].first;t++)r.fds[t]=s[e].fd;for(let e=s[s.length-1].first;e<n;e++)r.fds[e]=s[s.length-1].fd}break;case 4:{const t=e.getUint32(),s=[];for(let r=0;r<t;r++){const t={first:e.getUint32(),fd:e.getUint16()};s.push(t)}const n=e.getUint32();for(let e=0;e<s.length-1;e++)for(let t=s[e].first;t<s[e+1].first;t++)r.fds[t]=s[e].fd;for(let e=s[s.length-1].first;e<n;e++)r.fds[e]=s[s.length-1].fd}}return new Dg(r)}}class Ug extends xg{constructor(e={}){super(e),"BlueValues"in e&&(this.BlueValues=e.BlueValues),"OtherBlues"in e&&(this.OtherBlues=e.OtherBlues),"FamilyBlues"in e&&(this.FamilyBlues=e.FamilyBlues),"FamilyOtherBlues"in e&&(this.FamilyOtherBlues=e.FamilyOtherBlues),this.BlueScale=e.BlueScale||.039625,this.BlueShift=e.BlueShift||7,this.BlueFuzz=e.BlueFuzz||1,"StdHW"in e&&(this.StdHW=e.StdHW),"StdVW"in e&&(this.StdVW=e.StdVW),"SteamSnapH"in e&&(this.SteamSnapH=e.SteamSnapH),"SteamSnapV"in e&&(this.SteamSnapV=e.SteamSnapV),this.LanguageGroup=e.LanguageGroup||0,this.ExpansionFactor=e.ExpansionFactor||.06,this.vsindex=e.vsindex||0,"blend"in e&&(this.blend=e.blend),"Subrs"in e&&(this.Subrs=e.Subrs),"SubrsINDEX"in e&&(this.SubrsINDEX=e.SubrsINDEX)}static fromBuffer(e){const t=xg.fromBuffer(e),r={entries:t.entries};for(const e of t.entries)if(0!==e.values.length)switch(e.key){case 6:r.BlueValues=e.values;break;case 7:r.OtherBlues=e.values;break;case 8:r.FamilyBlues=e.values;break;case 9:r.FamilyOtherBlues=e.values;break;case 1209:r.BlueScale=e.values[0];break;case 1210:r.BlueShift=e.values[0];break;case 1211:r.BlueFuzz=e.values[0];break;case 10:r.StdHW=e.values[0];break;case 11:r.StdVW=e.values[0];break;case 1212:r.SteamSnapH=e.values;break;case 1213:r.SteamSnapV=e.values;break;case 1217:r.LanguageGroup=e.values[0];break;case 1218:r.ExpansionFactor=e.values[0];break;case 19:r.Subrs=e.values[0];break;case 22:r.vsindex=e.values[0];break;case 23:r.blend=e.values[0]}return new Ug(r)}}class Og extends xg{constructor(e={}){super(e),this.FontMatrix=e.FontMatrix||[.001,0,0,.001,0,0],"CharStrings"in e&&(this.CharStrings=e.CharStrings),"FDArray"in e&&(this.FDArray=e.FDArray),"FDSelect"in e&&(this.FDSelect=e.FDSelect),"vstore"in e&&(this.vstore=e.vstore)}static fromBuffer(e){const t=xg.fromBuffer(e),r={entries:t.entries};for(const e of t.entries)switch(e.key){case 1207:r.FontMatrix=e.values;break;case 17:r.CharStrings=e.values[0];break;case 1236:r.FDArray=e.values[0];break;case 1237:r.FDSelect=e.values[0];break;case 24:r.vstore=e.values[0]}return new Og(r)}}class Tg extends vg{constructor(e={}){super(),this.format=e.format||1,this.itemVariationDataSubtables=e.itemVariationDataSubtables||[],this.variationRegionList=e.variationRegionList||{}}static fromStream(e){const t={};if(t.format=e.getUint16(),1===t.format){const r=e.getUint32(),s=[],n=e.getUint16();for(let t=0;t<n;t++){const t=e.getUint32();s.push(t)}t.itemVariationDataSubtables=[];for(const r of s){e.start=r;const s={itemCount:e.getUint16(),shortDeltaCount:e.getUint16(),regionIndexCount:e.getUint16(),regionIndexes:[],deltaSets:[]};for(let t=0;t<s.regionIndexCount;t++){const t=e.getUint16();s.regionIndexes.push(t)}for(let t=0;t<s.itemCount;t++){const t=[];for(let r=0;r<s.shortDeltaCount;r++){const r=e.getInt16();t.push(r)}for(let r=0;r<s.regionIndexCount-s.shortDeltaCount;r++){const r=e.getBlock(1)[0],s=Int8Array.from([r])[0];t.push(s)}s.deltaSets.push(t)}t.itemVariationDataSubtables.push(s)}e.start=r,t.variationRegionList={},t.variationRegionList.axisCount=e.getUint16(),t.variationRegionList.regionCount=e.getUint16(),t.variationRegionList.variationRegions=[];for(let r=0;r<t.variationRegionList.regionCount;r++){const r=[];for(let s=0;s<t.variationRegionList.axisCount;s++){const t={startCoord:fg(e),peakCoord:fg(e),endCoord:fg(e)};r.push(t)}t.variationRegionList.variationRegions.push(r)}}return new Tg(t)}}class Rg extends vg{constructor(e={}){super(),this.itemVariationStore=e.itemVariationStore||new Tg}static fromStream(e){const t={},r=e.getUint16();return t.itemVariationStore=Tg.fromStream(new ja({stream:e.stream.slice(e.start,e.start+r)})),new Rg(t)}}class _g extends wg{constructor(e={}){super(),e.FDSelect&&(this.FDSelect=e.FDSelect),e.topDICT&&(this.topDICT=e.topDICT),e.globalSubrINDEX&&(this.globalSubrINDEX=e.globalSubrINDEX),e.CharStringsINDEX&&(this.CharStringsINDEX=e.CharStringsINDEX),e.FDArrayINDEX&&(this.FDArrayINDEX=e.FDArrayINDEX),this.PrivateDICTs=e.PrivateDICTs||[],e.VariationStoreData&&(this.VariationStoreData=e.VariationStoreData)}static get tag(){return 1128678962}static fromStream(e){const t={},r=e.getBlock(3),s={majorVersion:r[0],minorVersion:r[1],headerSize:r[2],topDictLength:e.getUint16()};if(e.getBlock(s.headerSize-5),t.topDICT=Og.fromBuffer(e.stream.buffer.slice(e.start,e.start+s.topDictLength)),e.start=e.start+s.topDictLength,t.globalSubrINDEX=Sg.fromStream(e,s.majorVersion),t.topDICT.CharStrings&&(t.CharStringsINDEX=Pg.fromStream(new ja({stream:e.stream.slice(t.topDICT.CharStrings)}))),t.topDICT.FDArray){t.FDArrayINDEX=Sg.fromStream(new ja({stream:e.stream.slice(t.topDICT.FDArray)}),s.majorVersion),t.PrivateDICTs=[];for(const r of t.FDArrayINDEX.data){const s=xg.fromBuffer(r);for(const r of s.entries)if(18===r.key){const s=Ug.fromBuffer(e.stream.buffer.slice(r.values[1],r.values[1]+r.values[0]));s.Subrs&&(s.SubrsINDEX=Pg.fromStream(new ja({stream:e.stream.slice(r.values[1]+s.Subrs)}))),t.PrivateDICTs.push(s)}}}return t.topDICT.FDSelect&&t.CharStringsINDEX&&(t.FDSelect=Dg.fromStream(new ja({stream:e.stream.slice(t.topDICT.FDSelect)}),t.CharStringsINDEX.data.length)),t.topDICT.vstore&&(t.VariationStoreData=Rg.fromStream(new ja({stream:e.stream.slice(t.topDICT.vstore)}))),new _g(t)}}var Vg,Fg,Lg,jg,Hg,Mg,Kg,qg,Wg,Gg,zg,Jg,$g,Yg;!function(e){e[e.Unicode=0]="Unicode",e[e.Macintosh=1]="Macintosh",e[e.ISO=2]="ISO",e[e.Windows=3]="Windows",e[e.Custom=4]="Custom"}(Vg||(Vg={}));class Xg extends vg{constructor(e={}){super(),this.platformID=e.platformID||Vg.Unicode,this.platformSpecificID=e.platformSpecificID||0}static get className(){return"CMAPSubTable"}getGlyphMap(){return this._glyphMap||(this._glyphMap=this.onGetGlyphMap()),this._glyphMap}code(e){throw new Error("Method not implemented.")}gid(e){throw new Error("Method not implemented.")}}class Qg extends Xg{constructor(e={}){super(e),this.varSelectorRecords=e.varSelectorRecords||[]}onGetGlyphMap(){throw new Error("Method not implemented.")}get format(){return 14}static get className(){return"Format14"}static fromStream(e){e.getUint32();const t=e.getUint32(),r=[];for(let s=0;s<t;s++){const t={varSelector:e.getUint24(),defaultUVSOffset:e.getUint32(),nonDefaultUVSOffset:e.getUint32()};if(t.defaultUVSOffset){t.defaultUVSRecords=[];const r=new ja({stream:e.stream.slice(t.defaultUVSOffset)}),s=r.getUint32();for(let e=0;e<s;e++){const e={startUnicodeValue:r.getUint24(),additionalCount:r.getBlock(1)[0]};t.defaultUVSRecords.push(e)}}if(t.nonDefaultUVSOffset){t.nonDefaultUVSRecords=[];const r=new ja({stream:e.stream.slice(t.nonDefaultUVSOffset)}),s=r.getUint32();for(let e=0;e<s;e++){const e={unicodeValue:r.getUint24(),glyphID:r.getUint16()};t.nonDefaultUVSRecords.push(e)}}r.push(t)}return new Qg({varSelectorRecords:r})}}class Zg extends Xg{constructor(e={}){super(e),this.language=e.language||0,this.glyphIndexArray=e.glyphIndexArray||[]}onGetGlyphMap(){throw new Error("Method not implemented.")}get format(){return 0}static get className(){return"Format0"}toStream(e){return e.appendUint16(this.format),e.appendUint16(262),e.appendUint16(this.language),e.appendView(new Uint8Array(this.glyphIndexArray)),!0}static fromStream(e){const t=e.getUint16(),r=e.getUint16(),s=t-6,n=[];for(let t=0;t<s;t++){const r=e.getBlock(1)[0];t<256&&n.push(r)}return new Zg({language:r,glyphIndexArray:n})}static fromGlyphs(e,t){return new Zg({language:e})}}class ey extends Xg{constructor(e={}){super(e),this.language=e.language||0,this.groups=e.groups||[],this.codeToGID=e.codeToGID||new Map,this.gidToCode=e.gidToCode||new Map}onGetGlyphMap(){throw new Error("Method not implemented.")}get format(){return 12}static get className(){return"Format12"}static fromStream(e){const t=new Map,r=new Map;e.getUint16(),e.getUint32();const s=e.getUint32(),n=e.getUint32();for(let s=0;s<n;s++){const s=e.getUint32(),n=e.getUint32();let i=e.getUint32();for(let e=s;e<=n;e++,i++){const s=r.get(i)||[];s.push(e),r.set(i,s);const n=t.get(e)||[];n.push(i),t.set(e,n)}}return new ey({language:s,gidToCode:r,codeToGID:t})}gid(e){return this.codeToGID.get(e)||0}code(e){return this.gidToCode.get(e)||[]}}class ty extends Xg{constructor(e={}){super(e),this.language=e.language||0,this.segments=e.segments||[]}get format(){return 4}onGetGlyphMap(){const e=new Map;for(const t of this.segments)t.codeToGID.forEach(((t,r)=>{e.set(r,t)}));return e}static get className(){return"Format4"}toStream(e){const t=this.segments.length<<1,r=2*Math.pow(2,Math.floor(Math.log(this.segments.length)/Math.log(2))),s=[],n=[],i=[],a=[],o=[];for(const e of this.segments){let t=null,r=null,s=null,n=null,i=0;e.codeToGID=new Map([...e.codeToGID.entries()].sort(((e,t)=>e[0]-t[0])));for(const[a,o]of e.codeToGID){if(null===t&&(t=a),r=a,null===s)s=a;else{if(s+1!==a)throw new Error("Inconsistent information in CMAP segment");s=a}null===n||n+1!==o&&(i=1),n=o}const a={start:t,end:r,delta:0,format:i};0===i&&(a.delta=e.codeToGID.get(a.start)-a.start),o.push(a)}const c=new ja;for(let e=0;e<this.segments.length;e++)if(1===o[e].format){o[e].offset=c.start+t-(e<<1);for(const t of this.segments[e].codeToGID.values())c.appendUint16(t)}e.appendUint16(4),e.appendUint16(14+4*this.segments.length*2+c.length+2),e.appendUint16(this.language),e.appendUint16(t),e.appendUint16(r),e.appendUint16(Math.log(r>>1)/Math.log(2)),e.appendUint16(t-r);for(const e of o)s.push(e.start),n.push(e.end),i.push(e.delta),a.push(e.offset);for(const t of n)e.appendUint16(t);e.appendUint16(0);for(const t of s)e.appendUint16(t);for(const t of i)e.appendUint16(t);for(const t of a)e.appendUint16(t);return e.appendView(new Uint8Array(c.buffer)),!0}static fromStream(e){e.getUint16();const t=e.getUint16(),r=e.getUint16()>>1;e.getUint16(),e.getUint16(),e.getUint16();const s=[];for(let t=0;t<r;t++){const t=e.getUint16();s.push(t)}e.getUint16();const n=[];for(let t=0;t<r;t++){const t=e.getUint16();n.push(t)}const i=[];for(let t=0;t<r;t++){const t=e.getInt16();i.push(t)}const a=e.start,o=[];for(let t=0;t<r;t++){const t=e.getUint16();o.push(t)}const c=[];for(let t=0;t<r;t++){const r=new Map,l=new Map,h=n[t],u=s[t],p=a+2*t;let d=null;const f=o[t];f&&(d=new ja({stream:e.stream.slice(p+f,p+f+(u-h<<1)+2)}));for(let e=h;e<=u;e++){let s=0;if(d){s=d.getUint16()+i[t]&65535}else s=e+i[t]&65535;r.set(e,s),l.set(s,e)}c.push({codeToGID:r,gidToCode:l,delta:i[t],offset:o[t]})}return new ty({language:t,segments:c})}static fromGlyphs(e,t,r=3,s=1){const n=new Map,i=[];for(let e=2;e<t.length;e++)for(const r of t[e].unicodes)n.set(r,e);const a=Array.from(n).sort(((e,t)=>e[0]-t[0]));let o={codeToGID:new Map,gidToCode:new Map},c=a[0][0]-1;for(let e=0;e<a.length;e++)a[e][0]>c+1?(i.push(o),o={codeToGID:new Map([a[e]]),gidToCode:new Map([[a[e][1],a[e][0]]])}):(o.codeToGID.set(a[e][0],a[e][1]),o.gidToCode.set(a[e][1],a[e][0])),c=a[e][0];return i.push(o),i.push({codeToGID:new Map([[65535,0]]),gidToCode:new Map([[0,65535]])}),new ty({language:e,segments:i,platformID:r,platformSpecificID:s})}gid(e){for(const t of this.segments){const r=t.codeToGID.get(e);if(r)return r}return 0}code(e){const t=[];for(const r of this.segments){const s=r.gidToCode.get(e);void 0!==s&&t.push(s)}return t}}class ry extends Xg{constructor(e={}){super(e),this.language=e.language||0,this.firstCode=e.firstCode||0,this.glyphIndexArray=e.glyphIndexArray||[]}onGetGlyphMap(){throw new Error("Method not implemented.")}get format(){return 6}static get className(){return"Format6"}toStream(e){e.appendUint16(6),e.appendUint16(10+2*this.glyphIndexArray.length),e.appendUint16(this.language),e.appendUint16(this.firstCode),e.appendUint16(this.glyphIndexArray.length);for(const t of this.glyphIndexArray)e.appendUint16(t);return!0}static fromStream(e){e.getUint16();const t=e.getUint16(),r=e.getUint16(),s=e.getUint16(),n=[];for(let t=0;t<s;t++){const t=e.getUint16();n.push(t)}return new ry({language:t,firstCode:r,glyphIndexArray:n})}static fromGlyphs(e,t,r=32,s=3,n=1){const i=[];for(let e=0;e<t.length;e++)i.push(e);return new ry({language:e,firstCode:r,glyphIndexArray:i,platformID:s,platformSpecificID:n})}gid(e){let t=0;for(let r=0;r<this.glyphIndexArray.length;r++)if(this.firstCode+r===e){t=this.glyphIndexArray[r];break}return t}code(e){switch(!0){case e>this.glyphIndexArray.length-1&&e<0:return[];case 0===e||1===e:return[65535]}return[this.firstCode+e-2]}}class sy extends wg{constructor(e={}){super(),this.version=e.version||0,this.subTables=e.subTables||[]}static get className(){return"CMAP"}static get tag(){return 1668112752}toStream(e){e.appendUint16(this.version),e.appendUint16(this.subTables.length);const t=new ja,r=new ja;for(const e of this.subTables){if(!e)continue;const s=4+8*this.subTables.length+r.length,n=new ja;if(!0!==e.toStream(n))throw new Error(`Error while processing ${e.constructor.className}`);t.appendUint16(e.platformID),t.appendUint16(e.platformSpecificID),t.appendUint32(s),r.appendView(new Uint8Array(n.buffer))}return e.appendView(new Uint8Array(t.buffer)),e.appendView(new Uint8Array(r.buffer)),!0}getSubTable(e,t){for(const r of this.subTables)if(void 0!==e&&void 0!==t&&r.platformID===e&&r.platformSpecificID===t||0===r.platformID||3===r.platformID&&(1===r.platformSpecificID||10===r.platformSpecificID))return r;return null}static fromStream(e){const t=e.getUint16(),r=e.getUint16(),s=[];for(let t=0;t<r;t++){const r=e.getUint16(),n=e.getUint16(),i=e.getUint32(),a=new ja({stream:e.stream.slice(i)}),o=a.getUint16();let c=null;switch(o){case 0:c=Zg.fromStream(a);break;case 4:c=ty.fromStream(a);break;case 6:c=ry.fromStream(a);break;case 12:c=ey.fromStream(a);break;case 14:c=Qg.fromStream(a);break;default:console.log(`Unknown CMAP subtable format - ${o}`)}if(!c)break;c.platformID=r,c.platformSpecificID=n,s[t]=c}return new sy({version:t,subTables:s})}gid(e,t,r){const s=this.getSubTable(t,r);return s?s.gid(e):0}code(e,t,r){const s=this.getSubTable(t,r);return s?s.code(e):[]}}class ny extends vg{constructor(e={}){super()}static fromStream(e){const t={};switch(t.coverageFormat=e.getUint16(),t.coverageFormat){case 1:t.glyphCount=e.getUint16(),t.glyphArray=[];for(let r=0;r<t.glyphCount;r++){const r=e.getUint16();t.glyphArray.push(r)}break;case 2:t.rangeCount=e.getUint16(),t.rangeRecords=[];for(let r=0;r<t.rangeCount;r++){const r={startGlyphID:e.getUint16(),endGlyphID:e.getUint16(),startCoverageIndex:e.getUint16()};t.rangeRecords.push(r)}break;default:return new ny}return new ny(t)}}class iy extends vg{constructor(e={}){super(),this.coverageTable=e.coverageTable||new ny,this.attachPoints=e.attachPoints||[]}static fromStream(e){const t={attachPoints:[]},r=e.getUint16();r&&(t.coverageTable=ny.fromStream(new ja({stream:e.stream.slice(r)})));const s=e.getUint16();for(let r=0;r<s;r++){const r=e.getUint16(),s=new ja({stream:e.stream.slice(r)}),n={pointIndices:[],pointCount:s.getUint16()};for(let e=0;e<n.pointCount;e++){const e=s.getUint16();n.pointIndices.push(e)}t.attachPoints.push(n)}return new iy(t)}}class ay extends vg{constructor(e={}){super(),this.glyphToClass=e.glyphToClass||new Map,this.classToGlyph=e.classToGlyph||new Map}static fromStream(e){const t={};switch(t.glyphToClass=new Map,t.classToGlyph=new Map,t.classFormat=e.getUint16(),t.classFormat){case 1:{let r=e.getUint16();const s=e.getUint16();for(let n=0;n<s;n++,r++){const s=e.getUint16();t.glyphToClass.set(r,s);let n=t.classToGlyph.get(s);void 0===n&&(n=[]),n.push(r),t.classToGlyph.set(s,n)}}break;case 2:{const r=e.getUint16();for(let s=0;s<r;s++){const r=e.getUint16(),s=e.getUint16(),n=e.getUint16();for(let e=r;e<=s;e++){t.glyphToClass.set(e,n);let r=t.classToGlyph.get(n);r||(r=[]),r.push(e),t.classToGlyph.set(n,r)}}}break;default:return new ay({})}return new ay(t)}}class oy extends vg{constructor(e={}){super()}static fromStream(e){const t={};t.coverageOffset=e.getUint16(),t.ligGlyphCount=e.getUint16(),t.ligGlyphOffsets=[];for(let r=0;r<t.ligGlyphCount;r++){const r=e.getUint16();t.ligGlyphOffsets.push(r)}return new oy(t)}}class cy extends wg{constructor(e={}){super()}static get tag(){return 1195656518}static fromStream(e){const t={};t.majorVersion=e.getUint16(),t.minorVersion=e.getUint16();const r=e.getUint16();r&&(t.glyphClassDef=ay.fromStream(new ja({stream:e.stream.slice(r)})));const s=e.getUint16();s&&(t.attachList=iy.fromStream(new ja({stream:e.stream.slice(s)})));const n=e.getUint16();switch(n&&(t.ligCaretList=oy.fromStream(new ja({stream:e.stream.slice(n)}))),t.markAttachClassDefOffset=e.getUint16(),!0){case 1===t.majorVersion&&0===t.minorVersion:break;case 1===t.majorVersion&&2===t.minorVersion:t.markGlyphSetsDefOffset=e.getUint16();break;case 1===t.majorVersion&&3===t.minorVersion:t.markGlyphSetsDefOffset=e.getUint16(),t.itemVarStoreOffset=e.getUint16();break;default:return new cy({})}return new cy(t)}}!function(e){e[e.ARG_1_AND_2_ARE_WORDS=1]="ARG_1_AND_2_ARE_WORDS",e[e.ARGS_ARE_XY_VALUES=2]="ARGS_ARE_XY_VALUES",e[e.ROUND_XY_TO_GRID=4]="ROUND_XY_TO_GRID",e[e.WE_HAVE_A_SCALE=8]="WE_HAVE_A_SCALE",e[e.MORE_COMPONENTS=32]="MORE_COMPONENTS",e[e.WE_HAVE_AN_X_AND_Y_SCALE=64]="WE_HAVE_AN_X_AND_Y_SCALE",e[e.WE_HAVE_A_TWO_BY_TWO=128]="WE_HAVE_A_TWO_BY_TWO",e[e.WE_HAVE_INSTRUCTIONS=256]="WE_HAVE_INSTRUCTIONS",e[e.USE_MY_METRICS=512]="USE_MY_METRICS",e[e.OVERLAP_COMPOUND=1024]="OVERLAP_COMPOUND",e[e.SCALED_COMPONENT_OFFSET=2048]="SCALED_COMPONENT_OFFSET",e[e.UNSCALED_COMPONENT_OFFSET=4096]="UNSCALED_COMPONENT_OFFSET"}(Fg||(Fg={}));class ly extends vg{constructor(e={}){var t,r,s,n,i;super(),e.stream?(this.stream=e.stream,this.decode()):this.stream=new ja,null!==(t=this.numberOfContours)&&void 0!==t||(this.numberOfContours=e.numberOfContours||0),null!==(r=this.xMin)&&void 0!==r||(this.xMin=e.xMin||0),null!==(s=this.yMin)&&void 0!==s||(this.yMin=e.yMin||0),null!==(n=this.xMax)&&void 0!==n||(this.xMax=e.xMax||0),null!==(i=this.yMax)&&void 0!==i||(this.yMax=e.yMax||0)}static get className(){return"Glyph"}decode(){this.numberOfContours=this.stream.getInt16(),this.xMin=this.stream.getInt16(),this.yMin=this.stream.getInt16(),this.xMax=this.stream.getInt16(),this.yMax=this.stream.getInt16()}encode(e){e.appendInt16(this.numberOfContours),e.appendInt16(this.xMin),e.appendInt16(this.yMin),e.appendInt16(this.xMax),e.appendInt16(this.yMax)}}class hy extends ly{constructor(e={}){var t,r;super(e),null!==(t=this.components)&&void 0!==t||(this.components=e.components||[]),null!==(r=this.instructions)&&void 0!==r||(this.instructions=e.instructions||[])}static get className(){return"CompoundGlyph"}decode(){if(super.decode(),0===this.numberOfContours||this.numberOfContours>0)throw new Error(`Incorrect numberOfContours for CompoundGlyph class: ${this.numberOfContours}`);let e=0;this.instructions=[],this.components=[];do{const t=new yg;let r=null;e=this.stream.getUint16();const s=this.stream.getUint16();switch(!0){case gg(e,Fg.ARG_1_AND_2_ARE_WORDS)&&gg(e,Fg.ARGS_ARE_XY_VALUES):t.e=this.stream.getInt16(),t.f=this.stream.getInt16();break;case!gg(e,Fg.ARG_1_AND_2_ARE_WORDS)&&gg(e,Fg.ARGS_ARE_XY_VALUES):t.e=this.stream.getBlock(1)[0],t.f=this.stream.getBlock(1)[0];break;case gg(e,Fg.ARG_1_AND_2_ARE_WORDS)&&!gg(e,Fg.ARGS_ARE_XY_VALUES):r={matchingPoint1:this.stream.getInt16(),matchingPoint2:this.stream.getInt16()};break;case!gg(e,Fg.ARG_1_AND_2_ARE_WORDS)&&!gg(e,Fg.ARGS_ARE_XY_VALUES):r={matchingPoint1:this.stream.getBlock(1)[0],matchingPoint2:this.stream.getBlock(1)[0]}}switch(!0){case gg(e,Fg.WE_HAVE_A_SCALE):t.a=fg(this.stream),t.d=t.a;break;case gg(e,Fg.WE_HAVE_AN_X_AND_Y_SCALE):t.a=fg(this.stream),t.d=fg(this.stream);break;case gg(e,Fg.WE_HAVE_A_TWO_BY_TWO):t.a=fg(this.stream),t.b=fg(this.stream),t.c=fg(this.stream),t.d=fg(this.stream)}const n={glyphIndex:s,flags:e,matrix:t,...r||{}};this.components.push(n)}while(gg(e,Fg.MORE_COMPONENTS));if(gg(e,Fg.WE_HAVE_INSTRUCTIONS)){const e=this.stream.getUint16();for(let t=0;t<e;t++){const e=this.stream.getBlock(1)[0];this.instructions.push(e)}}}encode(e){super.encode(e);try{if(!this.components)throw new Error("Property 'components' is empty");if(!this.instructions)throw new Error("Property 'instructions' is empty");for(let t=0;t<this.components.length;t++){const r=this.components[t];let s=r.flags;switch("matchingPoint1"in r||"matchingPoint1"in r?(s&=~Fg.ARGS_ARE_XY_VALUES,r.matchingPoint1>255||r.matchingPoint1<0||r.matchingPoint2>255||r.matchingPoint2<0?s|=Fg.ARG_1_AND_2_ARE_WORDS:s&=~Fg.ARG_1_AND_2_ARE_WORDS):(s|=Fg.ARGS_ARE_XY_VALUES,r.matrix.e>255||r.matrix.e<0||r.matrix.f>255||r.matrix.f<0?s|=Fg.ARG_1_AND_2_ARE_WORDS:s&=~Fg.ARG_1_AND_2_ARE_WORDS),r.matrix.b||r.matrix.c?s|=Fg.WE_HAVE_A_TWO_BY_TWO:1===r.matrix.a&&1===r.matrix.d||(r.matrix.a!==r.matrix.d?s|=Fg.WE_HAVE_AN_X_AND_Y_SCALE:s|=Fg.WE_HAVE_A_SCALE),t<this.components.length-1&&(s|=Fg.MORE_COMPONENTS),e.appendUint16(s),e.appendUint16(r.glyphIndex),!0){case gg(s,Fg.ARG_1_AND_2_ARE_WORDS)&&gg(s,Fg.ARGS_ARE_XY_VALUES):e.appendInt16(r.matrix.e),e.appendInt16(r.matrix.f);break;case!gg(s,Fg.ARG_1_AND_2_ARE_WORDS)&&gg(s,Fg.ARGS_ARE_XY_VALUES):e.appendView(new Uint8Array([r.matrix.e])),e.appendView(new Uint8Array([r.matrix.f]));break;case gg(s,Fg.ARG_1_AND_2_ARE_WORDS)&&!gg(s,Fg.ARGS_ARE_XY_VALUES):e.appendInt16(r.matchingPoint1),e.appendInt16(r.matchingPoint2);break;case!gg(s,Fg.ARG_1_AND_2_ARE_WORDS)&&!gg(s,Fg.ARGS_ARE_XY_VALUES):e.appendView(new Uint8Array([r.matchingPoint1])),e.appendView(new Uint8Array([r.matchingPoint2]))}switch(!0){case gg(s,Fg.WE_HAVE_A_SCALE):mg(r.matrix.a,e);break;case gg(s,Fg.WE_HAVE_AN_X_AND_Y_SCALE):mg(r.matrix.a,e),mg(r.matrix.d,e);break;case gg(s,Fg.WE_HAVE_A_TWO_BY_TWO):mg(r.matrix.a,e),mg(r.matrix.b,e),mg(r.matrix.c,e),mg(r.matrix.d,e)}}e.appendUint16(this.instructions.length),this.instructions.length&&e.appendView(new Uint8Array(this.instructions))}catch(e){throw e.message=`Failed to execute 'encode' on 'CompoundGlyph. ${e.message}`,e}}}class uy extends ly{constructor(e={}){super()}static get className(){return"EmptyGlyph"}decode(){if(super.decode(),0!==this.numberOfContours)throw new Error(`Incorrect numberOfContours for EmptyGlyph class: ${this.numberOfContours}`)}encode(e){}}!function(e){e[e.ON_CURVE_POINT=1]="ON_CURVE_POINT",e[e.X_SHORT_VECTOR=2]="X_SHORT_VECTOR",e[e.Y_SHORT_VECTOR=4]="Y_SHORT_VECTOR",e[e.REPEAT_FLAG=8]="REPEAT_FLAG",e[e.X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR=16]="X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR",e[e.Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR=32]="Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR",e[e.OVERLAP_SIMPLE=64]="OVERLAP_SIMPLE"}(Lg||(Lg={}));class py extends ly{constructor(e={}){var t,r,s,n,i;super(e),null!==(t=this.endPtsOfContours)&&void 0!==t||(this.endPtsOfContours=e.endPtsOfContours||[]),null!==(r=this.instructions)&&void 0!==r||(this.instructions=e.instructions||[]),null!==(s=this.flags)&&void 0!==s||(this.flags=e.flags||[]),null!==(n=this.xCoordinates)&&void 0!==n||(this.xCoordinates=e.xCoordinates||[]),null!==(i=this.yCoordinates)&&void 0!==i||(this.yCoordinates=e.yCoordinates||[])}static get className(){return"SimpleGlyph"}decode(){if(super.decode(),0===this.numberOfContours||this.numberOfContours<0)throw new Error(`Incorrect numberOfContours for SimpleGlyph class: ${this.numberOfContours}`);this.endPtsOfContours=[],this.instructions=[],this.flags=[],this.xCoordinates=[],this.yCoordinates=[];for(let e=0;e<this.numberOfContours;e++){const e=this.stream.getUint16();this.endPtsOfContours.push(e)}const e=this.stream.getUint16();for(let t=0;t<e;t++){const e=this.stream.getBlock(1);this.instructions.push(e[0])}const t=this.endPtsOfContours[this.endPtsOfContours.length-1]+1;for(let e=0;e<t;e++){const t=this.stream.getBlock(1);if(this.flags.push(t[0]),t[0]&Lg.REPEAT_FLAG){const r=this.stream.getBlock(1);for(let s=0;s<r[0];s++)this.flags.push(t[0]),e+=1}}this.flags[0]|=Lg.OVERLAP_SIMPLE;for(let e=0;e<this.endPtsOfContours.length-1;e++)this.flags[this.endPtsOfContours[e]+1]|=Lg.OVERLAP_SIMPLE;let r=0;for(const e of this.flags){let t=0;(e&Lg.X_SHORT_VECTOR)===Lg.X_SHORT_VECTOR?(t=this.stream.getBlock(1)[0],0==(e&Lg.X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR)&&(t=-t),t+=r):t=(e&Lg.X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR)===Lg.X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR?r:r+this.stream.getInt16(),this.xCoordinates.push(t),r=t}r=0;for(const e of this.flags){let t=0;(e&Lg.Y_SHORT_VECTOR)===Lg.Y_SHORT_VECTOR?(t=this.stream.getBlock(1)[0],0==(e&Lg.Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR)&&(t=-t),t+=r):t=(e&Lg.Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR)===Lg.Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR?r:r+this.stream.getInt16(),this.yCoordinates.push(t),r=t}}encode(e){super.encode(e);try{const t=e.length;if(!this.endPtsOfContours)throw new Error("'endPtsOfContours' field is empty");const r=this.endPtsOfContours[this.endPtsOfContours.length-1]+1;if(!this.flags||this.flags.length!==r)throw new Error("Inconsistency between length of 'flags' and 'endPtsOfContours' values");if(!this.xCoordinates||this.xCoordinates.length!==r)throw new Error("Inconsistency between length of 'xCoordinates' and 'endPtsOfContours' values");if(!this.yCoordinates||this.yCoordinates.length!==r)throw new Error("Inconsistency between length of 'yCoordinates' and 'endPtsOfContours' values");for(const t of this.endPtsOfContours)e.appendUint16(t);if(!this.instructions)throw new Error("'instructions' field is empty");e.appendUint16(this.instructions.length),this.instructions.length&&e.appendView(new Uint8Array(this.instructions));const s=[];for(let e=0;e<this.flags.length;){let t=this.flags[e];if(gg(t,Lg.REPEAT_FLAG)){let r=0;for(e++;e<this.flags.length&&this.flags[e]===t;e++,r++);r?(s.push(t),s.push(r)):(t&=~Lg.REPEAT_FLAG,s.push(t))}else s.push(t),e++}e.appendView(new Uint8Array(s));let n=0;for(let t=0;t<this.xCoordinates.length;t++){const r=this.flags[t];let s=this.xCoordinates[t];const i=s;(r&Lg.X_SHORT_VECTOR)===Lg.X_SHORT_VECTOR?(0==(r&Lg.X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR)&&(s=-s,n=-n),s-=n,e.appendView(new Uint8Array([s]))):(r&Lg.X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR)===Lg.X_IS_SAME_OR_POSITIVE_X_SHORT_VECTOR?s=n:(s-=n,e.appendInt16(s)),n=i}n=0;for(let t=0;t<this.yCoordinates.length;t++){const r=this.flags[t];let s=this.yCoordinates[t];const i=s;(r&Lg.Y_SHORT_VECTOR)===Lg.Y_SHORT_VECTOR?(0==(r&Lg.Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR)&&(s=-s,n=-n),s-=n,e.appendView(new Uint8Array([s]))):(r&Lg.Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR)===Lg.Y_IS_SAME_OR_POSITIVE_Y_SHORT_VECTOR?s=n:(s-=n,e.appendInt16(s)),n=i}(e.length-t)%2&&e.appendView(new Uint8Array([0]))}catch(e){throw e.message=`Failed to execute 'encode' on 'SimpleGlyph'. ${e.message}`,e}}}class dy extends wg{constructor(e={}){super(),this.glyphs=e.glyphs||[]}static get className(){return"GLYF"}static get tag(){return 1735162214}toStream(e){this.loca=[0];for(const t of this.glyphs){if(0===t.numberOfContours){this.loca.push(this.loca[this.loca.length-1]);continue}const r=e.length;t.encode(e);const s=4-e.length%4;if(s){const t=new ArrayBuffer(s);e.appendView(new Uint8Array(t))}this.loca.push(e.length-r+this.loca[this.loca.length-1])}return!0}static fromStream(e=new ja,t,r){if(t!==r.offsets.length-1)throw new Error(`Inconsistent values: numGlyphs (${t}) !== (loca.offsets.length - 1) (${r.offsets.length-1})`);const s=[];for(let t=1;t<r.offsets.length;t++)r.offsets[t-1]>=e.length?s.push(new ja):s.push(new ja({stream:e.stream.slice(r.offsets[t-1],r.offsets[t])}));return new dy({glyphs:Array.from(s,(e=>dy.new(e)))})}static new(e){const t=e.getInt16();switch(e.resetPosition(),!0){case 0===t:return new uy({stream:e});case t>0:return new py({stream:e});case t<0:return new hy({stream:e})}return null}}function fy(){const e=new py({numberOfContours:2,instructions:[],xMin:284,yMin:0,xMax:1308,yMax:1280,endPtsOfContours:[3,7],flags:[97,17,33,17,101,33,17,33],xCoordinates:[284,284,1308,1308,316,1276,1276,316],yCoordinates:[0,1280,1280,0,32,32,1248,1248]});return e.hAdvanceWidth=1593,e.leftSideBearing=284,e.unicodes=[65535],e}function my(){const e=new py({numberOfContours:0,instructions:[],xMin:0,yMin:0,xMax:0,yMax:0,endPtsOfContours:[],flags:[],xCoordinates:[],yCoordinates:[]});return e.hAdvanceWidth=0,e.leftSideBearing=0,e.unicodes=[65535],e}class gy extends vg{constructor(e={}){super(),this.map=e.map||new Map}static get format(){throw new Error("Incorrectly initialized format class")}}class yy extends gy{constructor(e={}){super(e),this.nPairs=e.nPairs||0,this.searchRange=e.searchRange||0,this.entrySelector=e.entrySelector||0,this.rangeShift=e.rangeShift||0,this.values=e.values||[]}static get format(){return 0}toStream(e){const t=this.map.size;e.appendUint16(t);const r=Math.floor(Math.log2(t)),s=Math.pow(2,r);e.appendUint16(s<<4),e.appendUint16(r),e.appendUint16(t-s<<4);for(const[t,r]of this.map.entries()){const s=/(\d+)-(\d+)/g.exec(t);if(!s||3!==s.length)throw new Error("Incorrectly formatted map for KERN - format 0");e.appendUint16(+s[1]),e.appendUint16(+s[2]),e.appendUint16(r)}return!0}static fromStream(e){const t={};t.nPairs=e.getUint16(),t.searchRange=e.getUint16(),t.entrySelector=e.getUint16(),t.rangeShift=e.getUint16(),t.map=new Map,t.values=[];for(let r=0;r<t.nPairs;r++){const r={left:e.getUint16(),right:e.getUint16(),value:e.getInt16()};t.values.push(r),t.map.set(`${r.left}-${r.right}`,r.value)}return new yy(t)}}class vy{constructor(e={}){this.array=e.array||[]}get rows(){return this.array.length}get columns(){return this.array.length?this.array[0].length:0}row(e){return e<=this.array.length?this.array[e]:[]}column(e){const t=[];if(this.array.length)for(const r of this.array)e<=r.length&&t.push(r[e]);return t}deleteRow(e){this.array.splice(e,1)}deleteColumn(e){for(const t of this.array)t.splice(e,1)}}class wy extends gy{constructor(e={}){super(e),this.rowWidth=e.rowWidth||0,this.leftOffsetTable=e.leftOffsetTable||0,this.rightOffsetTable=e.rightOffsetTable||0,this.array=e.array||0,this.leftTable=e.leftTable,this.rightTable=e.rightTable}static get format(){return 2}toStream(e,t){const r=new Map,s=new Map;let n=null,i=null,a=null,o=null,c=0;for(const[e,t]of this.map.entries()){const l=/(\d+)-(\d+)/g.exec(e);if(!l||3!==l.length)throw new Error("Incorrectly formatted map for KERN - format 0");const h=parseInt(l[1],10),u=parseInt(l[2],10);n=null===n?h:Math.min(n,h),i=null===i?h:Math.max(i,h),a=null===a?u:Math.min(a,u),o=null===o?h:Math.max(o,u);let p=r.get(h);p||(p=[]),p.push({right:u,value:t}),!1===s.has(u)&&(s.set(u,c),c++),r.set(h,p)}n=n||0,i=i||0,a=a||0,o=o||0;const l=[];for(const e of r.keys())l.push([e]);const h=[];for(const e of s.keys())h.push([e]);const u=[];for(const e of r.values()){const t=new Array(s.size);t.fill(0);for(const r of e)t[s.get(r.right)]=r.value;u.push(t)}const p=new vy({array:u});let d=!1;do{d=!1;for(let e=0;e<p.rows;e++){const t=l[e];for(let r=e+1;r<p.rows;)p.row(e).join(",")===p.row(r).join(",")?(p.deleteRow(r),t.push(...l[r]),l.splice(r,1),d=!0):r++;l[e]=t}for(let e=0;e<p.columns;e++){const t=h[e];for(let r=e+1;r<p.columns;)p.column(e).join(",")===p.column(r).join(",")?(p.deleteColumn(r),t.push(...h[r]),h.splice(r,1),d=!0):r++;h[e]=t}}while(d);const f=p.columns+1,m=(p.rows+1)*f*2,g=new ArrayBuffer(m),y=new DataView(g),v=f+1;for(let e=0;e<p.rows;e++){const t=p.row(e);for(let r=0;r<t.length;r++)y.setInt16(2*(v+r+e*f),t[r])}const w=2*(i-n+1)+4,b=t+8;e.appendUint16(2*f),e.appendUint16(b+m),e.appendUint16(b+m+w),e.appendUint16(b),e.appendView(new Uint8Array(g)),e.appendUint16(n),e.appendUint16(i-n+1);const S=[];for(let e=n;e<=i;e++)S.push([e,b]);const A=new Map(S);for(let e=0;e<l.length;e++){const t=l[e];for(const r of t)A.set(r,2*(e+1)*f+b)}for(const t of A.values())e.appendUint16(t);e.appendUint16(a),e.appendUint16(o-a+1);const k=[];for(let e=a;e<=o;e++)k.push([e,0]);const C=new Map(k);for(let e=0;e<h.length;e++){const t=h[e];for(const r of t)C.set(r,2*(e+1))}for(const t of C.values())e.appendUint16(t);return!0}static fromStream(e,t,r){const s={},n=e.start-t,i=new ja({stream:e.stream.slice(n,n+r)}),a=new DataView(i.stream.buffer);s.rowWidth=a.getUint16(t),s.leftOffsetTable=a.getUint16(t+2),s.rightOffsetTable=a.getUint16(t+4),s.array=a.getUint16(t+6),s.leftTable={firstGlyph:a.getUint16(s.leftOffsetTable),nGlyphs:a.getUint16(s.leftOffsetTable+2),offsets:[]};let o=s.leftOffsetTable+4;for(let e=0;e<s.leftTable.nGlyphs;e++){const t=a.getUint16(o+2*e);s.leftTable.offsets.push(t)}s.rightTable={firstGlyph:a.getUint16(s.rightOffsetTable),nGlyphs:a.getUint16(s.rightOffsetTable+2),offsets:[]},o=s.rightOffsetTable+4;for(let e=0;e<s.rightTable.nGlyphs;e++){const t=a.getUint16(o+2*e);s.rightTable.offsets.push(t)}s.map=new Map;for(let e=0;e<s.leftTable.nGlyphs;e++)for(let t=0;t<s.rightTable.nGlyphs;t++){const r=a.getInt16(s.leftTable.offsets[e]+s.rightTable.offsets[t]);r&&s.map.set(`${e+s.leftTable.firstGlyph}-${t+s.rightTable.firstGlyph}`,r)}return new wy(s)}}class by extends wg{constructor(e={}){super(),this.version=e.version||0,this.tables=e.tables||[]}static get tag(){return 1801810542}toStream(e){switch(this.version){case 0:e.appendUint16(this.version),e.appendUint16(this.tables.length);for(const t of this.tables){const r=new ja;t.value.toStream(r,6),e.appendUint16(t.version),e.appendUint16(r.length+6);let s=0;"horizontal"in t.coverage&&t.coverage.horizontal&&(s|=1),"minimum"in t.coverage&&t.coverage.minimum&&(s|=2),"crossStream"in t.coverage&&t.coverage.crossStream&&(s|=4),"override"in t.coverage&&t.coverage.override&&(s|=8),s|=t.coverage.format<<8,e.appendUint16(s),e.append(r.stream)}break;case 65536:e.appendUint32(this.version),e.appendUint32(this.tables.length);for(const t of this.tables){const r=new ja;t.value.toStream(r,8),e.appendUint32(r.length+8);let s=0;"kernVertical"in t.coverage&&t.coverage.kernVertical&&(s|=32768),"kernCrossStream"in t.coverage&&t.coverage.kernCrossStream&&(s|=16384),"kernVariation"in t.coverage&&t.coverage.kernVariation&&(s|=8192),s|=t.coverage.format,e.appendUint16(s),e.appendUint16(t.tupleIndex),e.append(r.stream)}}return!0}static fromStream(e){const t={};switch(t.version=e.getUint16(),t.tables=[],t.version){case 0:{const r=e.getUint16();for(let s=0;s<r;s++){const r={version:e.getUint16(),length:e.getUint16()},s=e.getUint16();switch(r.coverage={horizontal:1&s,minimum:(2&s)>>1,crossStream:(4&s)>>2,override:(8&s)>>3,format:(65280&s)>>8},r.coverage.format){case 0:r.value=yy.fromStream(e);break;case 2:r.value=wy.fromStream(e,6,r.length)}t.tables.push(r)}}break;case 1:{e.resetPosition(),t.version=e.getUint32();const r=e.getUint32();for(let s=0;s<r;s++){const r={};r.length=e.getUint32();const s=e.getUint16();switch(r.tupleIndex=e.getUint16(),r.coverage={kernVertical:32768&s,kernCrossStream:16384&s,kernVariation:8192&s,format:255&s},r.coverage.format){case 0:r.value=yy.fromStream(e);break;case 2:r.value=wy.fromStream(e,8,r.length)}t.tables.push(r)}}}return new by(t)}find(e,t,r=0){if(this.tables.length<r+1)return 0;const s=this.tables[r].value.map.get(`${e}-${t}`);return void 0===s?0:s}findForArray(e,t=0){if(this.tables.length<t+1)return Array.from(e,(()=>0));const r=[];for(let s=0;s<e.length-1;s++){const n=e[s],i=e[s+1];r.push(this.find(n,i,t))}return r}}class Sy extends wg{constructor(e={}){super(),this.values=e.values||[]}static get tag(){return 1668707360}toStream(e){for(const t of this.values)e.appendInt16(t);return!0}static fromStream(e){const t={values:[]};for(;e.length;){const r=e.getInt16();t.values.push(r)}return new Sy(t)}}class Ay extends wg{constructor(e={}){super(),this.version=e.version||1,this.numSignatures=e.numSignatures||0,this.flags=e.flags||0,this.signatureRecords=e.signatureRecords||[]}static get tag(){return 1146308935}static fromStream(e){const t=e.getUint32(),r=e.getUint16(),s=e.getUint16(),n=[];for(let t=0;t<r;t++){const t={format:e.getUint32(),length:e.getUint32(),offset:e.getUint32()},r=new ja({stream:e.stream.slice(t.offset,t.offset+t.length)});t.signatureBlock={},t.signatureBlock.reserved1=r.getUint16(),t.signatureBlock.reserved2=r.getUint16(),t.signatureBlock.signatureLength=r.getUint32(),t.signatureBlock.signature=r.getBlock(t.signatureBlock.signatureLength);const s=Ee(new Uint8Array(t.signatureBlock.signature).buffer);if(-1!==s.offset)try{const e=new bh({schema:s.result});t.signatureBlock.signatureParsed=new Gu({schema:e.content})}catch(e){}n.push(t)}return new Ay({version:t,numSignatures:r,flags:s,signatureRecords:n})}}class ky extends wg{constructor(e={}){super(),this.values=e.values||new Uint8Array}static get tag(){return 1718642541}static fromStream(e){const t={};return t.values=e.getBlock(e.length),new ky(t)}}!function(e){e[e.GASP_GRIDFIT=1]="GASP_GRIDFIT",e[e.GASP_DOGRAY=2]="GASP_DOGRAY",e[e.GASP_SYMMETRIC_GRIDFIT=4]="GASP_SYMMETRIC_GRIDFIT",e[e.GASP_SYMMETRIC_SMOOTHING=8]="GASP_SYMMETRIC_SMOOTHING"}(jg||(jg={}));class Cy extends wg{constructor(e={}){super(),this.version=e.version||1,this.gaspRanges=e.gaspRanges||[]}static get tag(){return 1734439792}toStream(e){e.appendUint16(this.version),e.appendUint16(this.gaspRanges.length);for(const t of this.gaspRanges)e.appendUint16(t.rangeMaxPPEM),e.appendUint16(t.rangeGaspBehavior);return!0}static fromStream(e){const t=e.getUint16(),r=e.getUint16(),s=[];for(let t=0;t<r;t++){const t={rangeMaxPPEM:e.getUint16(),rangeGaspBehavior:e.getUint16()};s.push(t)}return new Cy({version:t,gaspRanges:s})}}class Iy extends wg{constructor(e={}){super(),this.version=e.version||0,this.records=e.records||[]}static get tag(){return 1751412088}toStream(e){try{if(0!==this.version)throw new Error(`Incorrect version for 'hdmx' table: ${this.version}`);e.appendUint16(this.version),e.appendUint16(this.records.length);const t=this.records[0].widths.length+2;let r=[];t%4&&(r=new Array(4-t%4)),this.records.length?e.appendInt32(this.records[0].widths.length+2+r.length):e.appendInt32(0);for(const t of this.records)e.appendView(new Uint8Array([t.pixelSize,t.maxWidth,...t.widths])),e.appendView(new Uint8Array(r));return!0}catch(e){throw e.message=`Failed to execute 'toStream' on 'HDMX'. ${e.message}`,e}}static fromStream(e,t){try{const r={};r.version=e.getInt16();const s=e.getInt16(),n=e.getInt32(),i=t+2;let a=0;if(i%4&&(a=4-i%4),n!==i+a)throw new Error(`Incorrect sizeDeviceRecord: ${n}`);if(e.length!==s*n)throw new Error("Not enough space for (numRecords * sizeDeviceRecord)");if(0!==r.version)throw new Error(`Incorrect version for 'hdmx' table: ${r.version}`);r.records=[];for(let n=0;n<s;n++){const s={pixelSize:e.getBlock(1)[0],maxWidth:e.getBlock(1)[0],widths:e.getBlock(t)};e.getBlock(a),r.records.push(s)}return new Iy(r)}catch(e){throw e.message=`Failed to execute 'fromStream' on 'HDMX'. ${e.message}`,e}}}!function(e){e[e.fullyMixed=0]="fullyMixed",e[e.leftToRight=1]="leftToRight",e[e.leftToRightNeutrals=2]="leftToRightNeutrals",e[e.rightToLeft=-1]="rightToLeft",e[e.rightToLeftNeutrals=-2]="rightToLeftNeutrals"}(Hg||(Hg={})),function(e){e[e.bold=1]="bold",e[e.italic=2]="italic",e[e.underline=4]="underline",e[e.outline=8]="outline",e[e.shadow=16]="shadow",e[e.condensed=32]="condensed",e[e.extended=64]="extended"}(Mg||(Mg={})),function(e){e[e.bit0=1]="bit0",e[e.bit1=2]="bit1",e[e.bit2=4]="bit2",e[e.bit3=8]="bit3",e[e.bit4=16]="bit4",e[e.bit5=32]="bit5",e[e.bit11=2048]="bit11",e[e.bit12=4096]="bit12",e[e.bit13=8192]="bit13",e[e.bit14=16384]="bit14"}(Kg||(Kg={}));class xy extends wg{constructor(e={}){super(),this.version=e.version||65536,this.fontRevision=e.fontRevision||65536,this.checkSumAdjustment=e.checkSumAdjustment||0,this.magicNumber=e.magicNumber||1594834165,this.flags=e.flags||0,this.unitsPerEm=e.unitsPerEm||2048,this.created=e.created||new Date,this.modified=e.modified||new Date,this.xMin=e.xMin||0,this.yMin=e.yMin||0,this.xMax=e.xMax||0,this.yMax=e.yMax||0,this.macStyle=e.macStyle||0,this.lowestRecPPEM=e.lowestRecPPEM||9,this.fontDirectionHint=e.fontDirectionHint||2,this.indexToLocFormat=e.indexToLocFormat||0,this.glyphDataFormat=e.glyphDataFormat||0}static get tag(){return 1751474532}toStream(e){return e.appendUint32(this.version),e.appendUint32(this.fontRevision),e.appendUint32(0),e.appendUint32(this.magicNumber),e.appendUint16(this.flags),e.appendUint16(this.unitsPerEm),dg(this.created,e),dg(this.modified,e),e.appendInt16(this.xMin),e.appendInt16(this.yMin),e.appendInt16(this.xMax),e.appendInt16(this.yMax),e.appendUint16(this.macStyle),e.appendUint16(this.lowestRecPPEM),e.appendUint16(this.fontDirectionHint),e.appendUint16(this.indexToLocFormat),e.appendUint16(this.glyphDataFormat),!0}static fromStream(e){const t={};return t.version=e.getUint32(),t.fontRevision=e.getUint32(),t.checkSumAdjustment=e.getUint32(),t.magicNumber=e.getUint32(),t.flags=e.getUint16(),t.unitsPerEm=e.getUint16(),t.created=pg(e),t.modified=pg(e),t.xMin=e.getInt16(),t.yMin=e.getInt16(),t.xMax=e.getInt16(),t.yMax=e.getInt16(),t.macStyle=e.getUint16(),t.lowestRecPPEM=e.getUint16(),t.fontDirectionHint=e.getInt16(),t.indexToLocFormat=e.getInt16(),t.glyphDataFormat=e.getInt16(),new xy(t)}}class Ey extends wg{constructor(e={}){super(),this.version=e.version||65536,this.ascent=e.ascent||0,this.descent=e.descent||0,this.lineGap=e.lineGap||0,this.advanceWidthMax=e.advanceWidthMax||0,this.minLeftSideBearing=e.minLeftSideBearing||0,this.minRightSideBearing=e.minRightSideBearing||0,this.xMaxExtent=e.xMaxExtent||0,this.caretSlopeRise=e.caretSlopeRise||0,this.caretSlopeRun=e.caretSlopeRun||0,this.caretOffset=e.caretOffset||0,this.reserved1=e.reserved1||0,this.reserved2=e.reserved2||0,this.reserved3=e.reserved3||0,this.reserved4=e.reserved4||0,this.metricDataFormat=e.metricDataFormat||0,this.numOfLongHorMetrics=e.numOfLongHorMetrics||0}static get tag(){return 1751672161}toStream(e){return e.appendUint32(this.version),e.appendInt16(this.ascent),e.appendInt16(this.descent),e.appendInt16(this.lineGap),e.appendUint16(this.advanceWidthMax),e.appendInt16(this.minLeftSideBearing),e.appendInt16(this.minRightSideBearing),e.appendInt16(this.xMaxExtent),e.appendInt16(this.caretSlopeRise),e.appendInt16(this.caretSlopeRun),e.appendInt16(this.caretOffset),e.appendInt16(this.reserved1),e.appendInt16(this.reserved2),e.appendInt16(this.reserved3),e.appendInt16(this.reserved4),e.appendInt16(this.metricDataFormat),e.appendUint16(this.numOfLongHorMetrics),!0}static fromStream(e){const t={};return t.version=e.getUint32(),t.ascent=e.getInt16(),t.descent=e.getInt16(),t.lineGap=e.getInt16(),t.advanceWidthMax=e.getUint16(),t.minLeftSideBearing=e.getInt16(),t.minRightSideBearing=e.getInt16(),t.xMaxExtent=e.getInt16(),t.caretSlopeRise=e.getInt16(),t.caretSlopeRun=e.getInt16(),t.caretOffset=e.getInt16(),t.reserved1=e.getInt16(),t.reserved2=e.getInt16(),t.reserved3=e.getInt16(),t.reserved4=e.getInt16(),t.metricDataFormat=e.getInt16(),t.numOfLongHorMetrics=e.getUint16(),new Ey(t)}}class By extends wg{constructor(e={}){super(),this.hMetrics=e.hMetrics||[],this.leftSideBearings=e.leftSideBearings||[]}static get tag(){return 1752003704}toStream(e){for(const t of this.hMetrics)e.appendUint16(t.advanceWidth),e.appendInt16(t.leftSideBearing);for(const t of this.leftSideBearings)e.appendInt16(t);return!0}static fromStream(e,t,r){const s={hMetrics:[],leftSideBearings:[]};for(let t=0;t<r;t++){const t={advanceWidth:e.getUint16(),leftSideBearing:e.getInt16()};s.hMetrics.push(t)}for(let n=0;n<t-r;n++){const t=e.getInt16();s.leftSideBearings.push(t)}return new By(s)}}!function(e){e[e.short=0]="short",e[e.long=1]="long"}(qg||(qg={}));class Ny extends wg{constructor(e={}){super(),this.offsets=e.offsets||[],this.indexToLocFormat=e.indexToLocFormat||0}static get tag(){return 1819239265}toStream(e){switch(this.indexToLocFormat){case 0:for(const t of this.offsets)e.appendUint16(t>>1);break;case 1:for(const t of this.offsets)e.appendUint32(t);break;default:throw new Error(`Incorrect 'indexToLocFormat' value: ${this.indexToLocFormat}`)}return!0}static fromStream(e,t,r){const s=[];switch(t){case 0:for(let t=0;t<r+1;t++){const t=e.getUint16();s.push(t<<1)}break;case 1:for(let t=0;t<r+1;t++){const t=e.getUint32();s.push(t)}break;default:throw new Error(`Incorrect value for indexToLocFormat: ${t}`)}return new Ny({indexToLocFormat:t,offsets:s})}}class Py extends wg{constructor(e={}){super(),this.version=e.version||20480,this.numGlyphs=e.numGlyphs||0,65536===this.version&&(this.maxPoints=e.maxPoints||0,this.maxContours=e.maxContours||0,this.maxComponentPoints=e.maxComponentPoints||0,this.maxComponentContours=e.maxComponentContours||0,this.maxZones=e.maxZones||2,this.maxTwilightPoints=e.maxTwilightPoints||100,this.maxStorage=e.maxStorage||256,this.maxFunctionDefs=e.maxFunctionDefs||256,this.maxInstructionDefs=e.maxInstructionDefs||256,this.maxStackElements=e.maxStackElements||3e3,this.maxSizeOfInstructions=e.maxSizeOfInstructions||0,this.maxComponentElements=e.maxComponentElements||0,this.maxComponentDepth=e.maxComponentDepth||1),e.glyphs&&this.fromGlyphs(e.glyphs)}static get tag(){return 1835104368}fromGlyphs(e){if(this.numGlyphs=e.length,20480===this.version)return;const t=new Map;function r(s,n){const i={componentContours:0,componentPoints:0,sizeOfInstructions:s.instructions.length,componentDepth:n};for(const a of s.components){t.set(a.glyphIndex,1);const s=e[a.glyphIndex];switch(!0){case s.constructor.className===py.className:{const e=s;i.componentContours+=e.numberOfContours,i.componentPoints+=e.xCoordinates.length,i.sizeOfInstructions+=e.instructions.length,i.componentDepth=Math.max(n+1,i.componentDepth)}break;case s.constructor.className===hy.className:{const e=r(s,i.componentDepth+1);i.componentContours+=e.componentContours,i.componentPoints+=e.componentPoints,i.sizeOfInstructions+=e.sizeOfInstructions,i.componentDepth=e.componentDepth}}}return i}for(const t of e){const e=t.constructor.className;switch(!0){case e===py.className:{const e=t;this.maxPoints=Math.max(this.maxPoints,e.xCoordinates.length),this.maxContours=Math.max(this.maxContours,e.numberOfContours),this.maxSizeOfInstructions=Math.max(this.maxSizeOfInstructions,e.instructions.length)}break;case e===hy.className:{const e=r(t,1);this.maxComponentContours=Math.max(this.maxComponentContours,e.componentContours),this.maxComponentPoints=Math.max(this.maxComponentPoints,e.componentPoints),this.maxComponentDepth=Math.max(this.maxComponentDepth,e.componentDepth),this.maxSizeOfInstructions=Math.max(this.maxSizeOfInstructions,e.sizeOfInstructions)}}}this.maxComponentElements=t.size}toStream(e){switch(e.appendUint32(this.version),e.appendUint16(this.numGlyphs),this.version){case 65536:e.appendUint16(this.maxPoints||0),e.appendUint16(this.maxContours||0),e.appendUint16(this.maxComponentPoints||0),e.appendUint16(this.maxComponentContours||0),e.appendUint16(this.maxZones||0),e.appendUint16(this.maxTwilightPoints||0),e.appendUint16(this.maxStorage||0),e.appendUint16(this.maxFunctionDefs||0),e.appendUint16(this.maxInstructionDefs||0),e.appendUint16(this.maxStackElements||0),e.appendUint16(this.maxSizeOfInstructions||0),e.appendUint16(this.maxComponentElements||0),e.appendUint16(this.maxComponentDepth||0);break;case 20480:break;default:throw new Error(`Incorrect version for MAXP - ${this.version}`)}return!0}static fromStream(e){const t=e.getUint32(),r=e.getUint16();switch(t){case 65536:{const s=e.getUint16(),n=e.getUint16(),i=e.getUint16(),a=e.getUint16(),o=e.getUint16(),c=e.getUint16(),l=e.getUint16(),h=e.getUint16(),u=e.getUint16(),p=e.getUint16(),d=e.getUint16(),f=e.getUint16(),m=e.getUint16();return new Py({version:t,numGlyphs:r,maxPoints:s,maxContours:n,maxComponentPoints:i,maxComponentContours:a,maxZones:o,maxTwilightPoints:c,maxStorage:l,maxFunctionDefs:h,maxInstructionDefs:u,maxStackElements:p,maxSizeOfInstructions:d,maxComponentElements:f,maxComponentDepth:m})}case 20480:return new Py({version:t,numGlyphs:r});default:throw new Error(`Incorrect version for MAXP - ${t}`)}}}!function(e){e[e.copyright=0]="copyright",e[e.fontFamilyName=1]="fontFamilyName",e[e.fontSubFamilyName=2]="fontSubFamilyName",e[e.uniqueFontID=3]="uniqueFontID",e[e.fullFontName=4]="fullFontName",e[e.version=5]="version",e[e.postScriptFontName=6]="postScriptFontName",e[e.trademark=7]="trademark",e[e.manufacturerName=8]="manufacturerName",e[e.designer=9]="designer",e[e.description=10]="description",e[e.urlVendor=11]="urlVendor",e[e.urlDesigner=12]="urlDesigner",e[e.licenseDescription=13]="licenseDescription",e[e.licenseInfoURL=14]="licenseInfoURL",e[e.typographicFamilyName=16]="typographicFamilyName",e[e.typographicSubfamilyName=17]="typographicSubfamilyName",e[e.compatibleFull=18]="compatibleFull",e[e.sampleText=19]="sampleText",e[e.postScriptCID=20]="postScriptCID",e[e.wwsFamilyName=21]="wwsFamilyName",e[e.wwsSubfamilyName=22]="wwsSubfamilyName",e[e.lightBackgroundPalette=23]="lightBackgroundPalette",e[e.darkBackgroundPalette=24]="darkBackgroundPalette",e[e.postScriptNamePrefix=25]="postScriptNamePrefix"}(Wg||(Wg={}));class Dy extends wg{constructor(e={}){super(),this.format=e.format||0,this.count=e.count||0,this.stringOffset=e.stringOffset||0,this.nameRecords=e.nameRecords||[]}static get tag(){return 1851878757}toStream(e){e.appendUint16(this.format),e.appendUint16(this.nameRecords.length),e.appendUint16(6+12*this.nameRecords.length);let t=0,r=[];for(const s of this.nameRecords)e.appendUint16(s.platformID),e.appendUint16(s.platformSpecificID||0),e.appendUint16(s.languageID||0),e.appendUint16(s.nameID),e.appendUint16(s.value.length),e.appendUint16(t),r=r.concat(s.value),t+=s.value.length;return e.appendView(new Uint8Array(r)),!0}static fromStream(e){const t=e.getUint16(),r=e.getUint16(),s=e.getUint16(),n=[];for(let t=0;t<r;t++){const t=e.getUint16(),r=e.getUint16(),i=e.getUint16(),a=e.getUint16(),o=e.getUint16(),c=e.getUint16(),l=e.stream.buffer.slice(s+c,s+c+o),h=Array.from(new Uint8Array(l));n.push({platformID:t,platformSpecificID:r,languageID:i,nameID:a,length:o,offset:c,value:h})}return new Dy({format:t,count:r,stringOffset:s,nameRecords:n})}getNameRecord(e,t={}){for(const r of this.nameRecords)if(!(e!==r.nameID||void 0!==t.platformID&&r.platformID!==t.platformID||void 0!==t.platformSpecificID&&r.platformSpecificID!==t.platformSpecificID||void 0!==t.languageID&&r.languageID!==t.languageID))return r;return null}getName(e,t={}){const r=this.getNameRecord(e,t);if(r){let e="ascii";return 0!==r.platformID&&(3!==r.platformID||1!==r.platformSpecificID&&10!==r.platformSpecificID)||(e="utf16be"),at.ToUtf8String(new Uint8Array(r.value),e)}return null}}!function(e){e[e.thin=100]="thin",e[e.extraLight=200]="extraLight",e[e.light=300]="light",e[e.normal=400]="normal",e[e.medium=500]="medium",e[e.semiBold=600]="semiBold",e[e.bold=700]="bold",e[e.extrabold=800]="extrabold",e[e.black=900]="black"}(Gg||(Gg={})),function(e){e[e.ultraCondensed=1]="ultraCondensed",e[e.extraCondensed=2]="extraCondensed",e[e.condensed=3]="condensed",e[e.semiCondensed=4]="semiCondensed",e[e.normal=5]="normal",e[e.semiExpanded=6]="semiExpanded",e[e.expanded=7]="expanded",e[e.extraExpanded=8]="extraExpanded",e[e.ultraExpanded=9]="ultraExpanded"}(zg||(zg={})),function(e){e[e.installableEmbedding=1]="installableEmbedding",e[e.restrictedLicenseEmbedding=2]="restrictedLicenseEmbedding",e[e.previewPrintEmbedding=4]="previewPrintEmbedding",e[e.editableEmbedding=8]="editableEmbedding",e[e.noSubsetting=256]="noSubsetting",e[e.bitmapEmbeddingOnly=512]="bitmapEmbeddingOnly"}(Jg||(Jg={})),function(e){e[e.none=0]="none",e[e.oldstyleSerifs=1]="oldstyleSerifs",e[e.transitionalSerifs=2]="transitionalSerifs",e[e.modernSerifs=3]="modernSerifs",e[e.clarendonSerifs=4]="clarendonSerifs",e[e.slabSerifs=5]="slabSerifs",e[e.freeformSerifs=7]="freeformSerifs",e[e.sansSerif=8]="sansSerif",e[e.ornamentals=9]="ornamentals",e[e.scripts=10]="scripts",e[e.symbolic=12]="symbolic"}($g||($g={})),function(e){e[e.italic=1]="italic",e[e.underscore=2]="underscore",e[e.negative=4]="negative",e[e.outlined=8]="outlined",e[e.strikeout=16]="strikeout",e[e.bold=32]="bold",e[e.regular=64]="regular",e[e.useTypoMetrics=128]="useTypoMetrics",e[e.wws=256]="wws",e[e.oblique=512]="oblique"}(Yg||(Yg={}));class Uy extends wg{constructor(e={}){super(),this.version=e.version||0,this.xAvgCharWidth=e.xAvgCharWidth||0,this.usWeightClass=e.usWeightClass||0,this.usWidthClass=e.usWidthClass||0,this.fsType=e.fsType||0,this.ySubscriptXSize=e.ySubscriptXSize||0,this.ySubscriptYSize=e.ySubscriptYSize||0,this.ySubscriptXOffset=e.ySubscriptXOffset||0,this.ySubscriptYOffset=e.ySubscriptYOffset||0,this.ySuperscriptXSize=e.ySuperscriptXSize||0,this.ySuperscriptYSize=e.ySuperscriptYSize||0,this.ySuperscriptXOffset=e.ySuperscriptXOffset||0,this.ySuperscriptYOffset=e.ySuperscriptYOffset||0,this.yStrikeoutSize=e.yStrikeoutSize||0,this.yStrikeoutPosition=e.yStrikeoutPosition||0,this.sFamilyClass=e.sFamilyClass||0,this.panose=e.panose||new Uint8Array,this.ulUnicodeRange1=e.ulUnicodeRange1||0,this.ulUnicodeRange2=e.ulUnicodeRange2||0,this.ulUnicodeRange3=e.ulUnicodeRange3||0,this.ulUnicodeRange4=e.ulUnicodeRange4||0,this.achVendID=e.achVendID||0,this.fsSelection=e.fsSelection||0,this.usFirstCharIndex=e.usFirstCharIndex||0,this.usLastCharIndex=e.usLastCharIndex||0,this.sTypoAscender=e.sTypoAscender||0,this.sTypoDescender=e.sTypoDescender||0,this.sTypoLineGap=e.sTypoLineGap||0,this.usWinAscent=e.usWinAscent||0,this.usWinDescent=e.usWinDescent||0,this.version>=1&&(this.ulCodePageRange1=e.ulCodePageRange1||0,this.ulCodePageRange2=e.ulCodePageRange2||0),this.version>=2&&(this.sxHeight=e.sxHeight||0,this.sCapHeight=e.sCapHeight||0,this.usDefaultChar=e.usDefaultChar||0,this.usBreakChar=e.usBreakChar||0,this.usMaxContext=e.usMaxContext||0),this.version>=5&&(this.usLowerOpticalPointSize=e.usLowerOpticalPointSize||0,this.usUpperOpticalPointSize=e.usUpperOpticalPointSize||0)}static get tag(){return 1330851634}toStream(e){return e.appendUint16(this.version),e.appendInt16(this.xAvgCharWidth),e.appendUint16(this.usWeightClass),e.appendUint16(this.usWidthClass),e.appendUint16(this.fsType),e.appendInt16(this.ySubscriptXSize),e.appendInt16(this.ySubscriptYSize),e.appendInt16(this.ySubscriptXOffset),e.appendInt16(this.ySubscriptYOffset),e.appendInt16(this.ySuperscriptXSize),e.appendInt16(this.ySuperscriptYSize),e.appendInt16(this.ySuperscriptXOffset),e.appendInt16(this.ySuperscriptYOffset),e.appendInt16(this.yStrikeoutSize),e.appendInt16(this.yStrikeoutPosition),e.appendInt16(this.sFamilyClass),e.appendView(this.panose),e.appendUint32(this.ulUnicodeRange1),e.appendUint32(this.ulUnicodeRange2),e.appendUint32(this.ulUnicodeRange3),e.appendUint32(this.ulUnicodeRange4),e.appendUint32(this.achVendID),e.appendUint16(this.fsSelection),e.appendUint16(this.usFirstCharIndex),e.appendUint16(this.usLastCharIndex),e.appendInt16(this.sTypoAscender),e.appendInt16(this.sTypoDescender),e.appendInt16(this.sTypoLineGap),e.appendUint16(this.usWinAscent),e.appendUint16(this.usWinDescent),this.version>=1&&(e.appendUint32(this.ulCodePageRange1),e.appendUint32(this.ulCodePageRange2)),this.version>=2&&(e.appendInt16(this.sxHeight),e.appendInt16(this.sCapHeight),e.appendUint16(this.usDefaultChar),e.appendUint16(this.usBreakChar),e.appendUint16(this.usMaxContext)),this.version>=5&&(e.appendUint16(this.usLowerOpticalPointSize),e.appendUint16(this.usUpperOpticalPointSize)),!0}static fromStream(e){const t={};return t.version=e.getUint16(),t.xAvgCharWidth=e.getInt16(),t.usWeightClass=e.getUint16(),t.usWidthClass=e.getUint16(),t.fsType=e.getUint16(),t.ySubscriptXSize=e.getInt16(),t.ySubscriptYSize=e.getInt16(),t.ySubscriptXOffset=e.getInt16(),t.ySubscriptYOffset=e.getInt16(),t.ySuperscriptXSize=e.getInt16(),t.ySuperscriptYSize=e.getInt16(),t.ySuperscriptXOffset=e.getInt16(),t.ySuperscriptYOffset=e.getInt16(),t.yStrikeoutSize=e.getInt16(),t.yStrikeoutPosition=e.getInt16(),t.sFamilyClass=e.getInt16(),t.panose=e.getBlock(10),t.ulUnicodeRange1=e.getUint32(),t.ulUnicodeRange2=e.getUint32(),t.ulUnicodeRange3=e.getUint32(),t.ulUnicodeRange4=e.getUint32(),t.achVendID=e.getUint32(),t.fsSelection=e.getUint16(),t.usFirstCharIndex=e.getUint16(),t.usLastCharIndex=e.getUint16(),t.sTypoAscender=e.getInt16(),t.sTypoDescender=e.getInt16(),t.sTypoLineGap=e.getInt16(),t.usWinAscent=e.getUint16(),t.usWinDescent=e.getUint16(),t.version>=1&&(t.ulCodePageRange1=e.getUint32(),t.ulCodePageRange2=e.getUint32()),t.version>=2&&(t.sxHeight=e.getInt16(),t.sCapHeight=e.getInt16(),t.usDefaultChar=e.getUint16(),t.usBreakChar=e.getUint16(),t.usMaxContext=e.getUint16()),t.version>=5&&(t.usLowerOpticalPointSize=e.getUint16(),t.usUpperOpticalPointSize=e.getUint16()),new Uy(t)}}const Oy=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];class Ty extends wg{constructor(e={}){super(),this.version=e.version||65536,this.italicAngle=e.italicAngle||0,this.underlinePosition=e.underlinePosition||0,this.underlineThickness=e.underlineThickness||0,this.isFixedPitch=e.isFixedPitch||0,this.minMemType42=e.minMemType42||0,this.maxMemType42=e.maxMemType42||0,this.minMemType1=e.minMemType1||0,this.maxMemType1=e.maxMemType1||0,131072===this.version&&(this.glyphNameIndex=e.glyphNameIndex||[],this.names=e.names||[],this.mappedNames=e.mappedNames||[])}static get tag(){return 1886352244}toStream(e){if(e.appendUint32(this.version),function(e,t){t.appendInt32(65536*e)}(this.italicAngle,e),e.appendInt16(this.underlinePosition),e.appendInt16(this.underlineThickness),e.appendUint32(this.isFixedPitch),e.appendUint32(this.minMemType42),e.appendUint32(this.maxMemType42),e.appendUint32(this.minMemType1),e.appendUint32(this.maxMemType1),131072===this.version&&(e.appendUint16(this.glyphNameIndex.length),this.glyphNameIndex.length)){for(const t of this.glyphNameIndex)e.appendUint16(t);for(const t of this.names)e.appendView(new Uint8Array([t.length])),e.appendView(new Uint8Array(t))}return!0}static fromStream(e){const t={};if(t.version=e.getUint32(),t.italicAngle=function(e){return e.getInt32()/65536}(e),t.underlinePosition=e.getInt16(),t.underlineThickness=e.getInt16(),t.isFixedPitch=e.getUint32(),t.minMemType42=e.getUint32(),t.maxMemType42=e.getUint32(),t.minMemType1=e.getUint32(),t.maxMemType1=e.getUint32(),131072===t.version){t.numberOfGlyphs=e.getUint16(),t.glyphNameIndex=[];for(let r=0;r<t.numberOfGlyphs;r++){const r=e.getUint16();t.glyphNameIndex.push(r)}t.names=[],t.mappedNames=[];for(let r=0;r<t.numberOfGlyphs;r++){const s=e.getBlock(1)[0],n=e.getBlock(s);t.names.push(n),t.glyphNameIndex[r]<Oy.length?t.mappedNames.push(Oy[t.glyphNameIndex[r]]):t.mappedNames.push(String.fromCodePoint(...t.names[t.glyphNameIndex[r]-Oy.length]))}}return new Ty(t)}}class Ry extends wg{constructor(e={}){super(),this.values=e.values||new Uint8Array}static get tag(){return 1886545264}toStream(e){return e.appendView(new Uint8Array(this.values)),!0}static fromStream(e){const t={};return t.values=e.getBlock(e.length),new Ry(t)}}var _y,Vy,Fy=Object.freeze({__proto__:null,CFF:Ng,CFFCharset:kg,CFFEncoding:Cg,CFFPrivateDICT:Eg,CFFTopDICT:Bg,DICT:xg,INDEX:Sg,StandardStrings:bg,StringIndex:Ag,CFF2:_g,CFF2CharstringINDEX:Pg,CFF2FDSelect:Dg,CFF2PrivateDICT:Ug,CFF2TopDICT:Og,ItemVariationStore:Tg,VariationStoreData:Rg,CMAP:sy,get CMAPPlatformIDs(){return Vg},CMAPSubTable:Xg,Format0:Zg,Format12:ey,Format14:Qg,Format4:ty,Format6:ry,AttachListTable:iy,ClassDefTable:ay,CoverageTable:ny,GDEF:cy,LigCaretListTable:oy,CompoundGlyph:hy,get CompoundGlyphFlags(){return Fg},EmptyGlyph:uy,GLYF:dy,Glyph:ly,SimpleGlyph:py,get SimpleGlyphFlags(){return Lg},missingGlyph:fy,nullGlyph:my,KERNFormat:gy,KERNFormat0:yy,KERNFormat2:wy,KERN:by,TwoD:vy,CVT:Sy,DSIG:Ay,FPGM:ky,get RangeGaspBehaviorFlags(){return jg},GASP:Cy,HDMX:Iy,get HEADFontDirectionHint(){return Hg},get HEADMacStyleFlags(){return Mg},get HEADFlags(){return Kg},HEAD:xy,HHEA:Ey,HMTX:By,get LOCAFormat(){return qg},LOCA:Ny,MAXP:Py,get NameIDs(){return Wg},NAME:Dy,get OS2Weight(){return Gg},get OS2Width(){return zg},get OS2TypeFlags(){return Jg},get OS2Family(){return $g},get OS2SelectionFlags(){return Yg},OS2:Uy,POST:Ty,PREP:Ry});function Ly(e){const t=new Uint8Array(e),r=new ArrayBuffer(e.byteLength+(4-e.byteLength%4));new Uint8Array(r).set(t,0);const s=new DataView(r),n=new Uint32Array([0]);for(let e=0;e<s.byteLength;e+=4)n[0]+=s.getUint32(e);return n[0]}!function(e){e[e.true=1953658213]="true",e[e.x00010000=65536]="x00010000",e[e.typ1=1954115633]="typ1",e[e.OTTO=1330926671]="OTTO"}(_y||(_y={}));class jy extends vg{constructor(e={}){super(),this.scalerType=e.scalerType||_y.OTTO,this.searchRange=e.searchRange||0,this.entrySelector=e.entrySelector||0,this.rangeShift=e.rangeShift||0,this.tables=e.tables||new Map,this.warnings=e.warnings||[]}findUnicodeGlyphsMap(){const e=this.tables.get(sy.tag).subTables.find((e=>0===e.platformID||3===e.platformID&&(1===e.platformSpecificID||10===e.platformSpecificID)));return e?e.getGlyphMap():null}findUnicodeGlyph(e){const t=this.findUnicodeGlyphsMap();if(!t)return null;let r;if("string"==typeof e){if(1!==e.length)throw new Error("Letter must be one");r=e.charCodeAt(0)}else r=e;const s=t.get(r);if(!s)return null;return this.glyphs.find((e=>e.index===s))||null}toStream(e,t=0){let r=new Map;const s=new ja,n=e=>{const t=new ja;if(!0!==e.toStream(t))throw new Error(`Error while processing ${e.constructor.className}`);switch(e.constructor.tag){case dy.tag:{const t=e;let r=0;for(const e of t.loca)if(e>65535||e%2){r=1;break}let s=this.tables.get(Ny.tag);s||(s=new Ny),s.offsets=t.loca,s.indexToLocFormat=r,this.tables.set(Ny.tag,s),n(s);let i=this.tables.get(Py.tag);void 0===i&&(i=new Py),i.numGlyphs=t.glyphs.length,this.tables.set(Py.tag,i),n(i)}break;case Ny.tag:{const t=e;let r=this.tables.get(Py.tag);r||(r=new Py),r.numGlyphs=t.offsets.length-1,this.tables.set(Py.tag,r),n(r);let s=this.tables.get(xy.tag);void 0===s&&(s=new xy),s.indexToLocFormat=t.indexToLocFormat,this.tables.set(xy.tag,s),n(s)}}r.set(e.constructor.tag,t)};for(const e of this.tables.values())n(e);let i=12+16*this.tables.size+t;const a=Math.floor(Math.log2(this.tables.size)),o=Math.pow(2,a);s.appendUint32(this.scalerType),s.appendUint16(this.tables.size),s.appendUint16(o<<4),s.appendUint16(a),s.appendUint16(this.tables.size-o<<4),r=new Map([...r.entries()].sort(((e,t)=>e[0]-t[0])));for(const[e,t]of r.entries()){s.appendUint32(e),s.appendUint32(Ly(t.buffer)),s.appendUint32(i),s.appendUint32(t.length);const r=t.length%4;i+=r?t.length+(4-r):t.length}let c=null;for(const[e,t]of r.entries()){e===xy.tag&&(c=s.start),s.appendView(new Uint8Array(t.buffer));const r=t.length%4;r&&s.appendView(new Uint8Array(new ArrayBuffer(4-r)))}if(null===c)throw new Error("Missing mandatory table HEAD");const l=s.buffer;return s.start=c+8,s.appendUint32(2981146554-Ly(l)),s.length=l.byteLength,e.appendView(new Uint8Array(s.buffer)),!0}static fromStream(e){const t=[];let r=0;const s=new Map,n=e.getUint32(),i=e.getUint16(),a=e.getUint16(),o=e.getUint16(),c=e.getUint16();for(let n=0;n<i;n++){const n=e.getUint32(),i=e.getUint32(),a=e.getUint32(),o=e.getUint32(),c=new ja({stream:e.stream.slice(a,a+o)});Ly(c.buffer)!==i&&(n===xy.tag?r=i:t.push(`Invalid checkSum for ${n}`)),s.set(n,c)}const l=new Map;function h(e){const n=s.get(e);if(void 0===n)throw new Error(`No stream for tag ${e}`);switch(e){case sy.tag:{let e=l.get(sy.tag);return e||(e=sy.fromStream(n),l.set(sy.tag,e)),e||null}case xy.tag:{let e=l.get(xy.tag);if(!e){const s=new DataView(n.buffer);s.setUint32(8,0),Ly(s.buffer)!==r&&t.push(`Invalid checkSum for ${xy.tag} (HEAD)`),e=xy.fromStream(n),l.set(xy.tag,e)}return e||null}case Ey.tag:{let e=l.get(Ey.tag);return e||(e=Ey.fromStream(n),l.set(Ey.tag,e)),e||null}case By.tag:{let e=l.get(By.tag);if(!e){const t=h(Ey.tag);if(!t)throw new Error("Something went wrong while parsing 'hhea' table");const r=h(Py.tag);if(!r)throw new Error("Something went wrong while parsing 'maxp' table");e=By.fromStream(n,r.numGlyphs,t.numOfLongHorMetrics),l.set(By.tag,e)}return e||null}case Py.tag:{let e=l.get(Py.tag);return e||(e=Py.fromStream(n),l.set(Py.tag,e)),e||null}case Ny.tag:{let e=l.get(Ny.tag);if(!e){const t=h(Py.tag);if(!t)throw new Error("Something went wrong while parsing 'maxp' table");const r=h(xy.tag);if(!r)throw new Error("Something went wrong while parsing 'head' table");e=Ny.fromStream(n,r.indexToLocFormat,t.numGlyphs),l.set(Ny.tag,e)}return e||null}case dy.tag:{let e=l.get(dy.tag);if(!e){const t=h(Py.tag);if(!t)throw new Error("Something went wrong while parsing 'maxp' table");const r=h(Ny.tag);if(!r)throw new Error("Something went wrong while parsing 'loca' table");e=dy.fromStream(n,t.numGlyphs,r),l.set(dy.tag,e)}return e||null}case Dy.tag:{let e=l.get(Dy.tag);return e||(e=Dy.fromStream(n),l.set(Dy.tag,e)),e||null}case Ty.tag:{let e=l.get(Ty.tag);return e||(e=Ty.fromStream(n),l.set(Ty.tag,e)),e||null}case Uy.tag:{let e=l.get(Uy.tag);return e||(e=Uy.fromStream(n),l.set(Uy.tag,e)),e||null}case Sy.tag:{let e=l.get(Sy.tag);return e||(e=Sy.fromStream(n),l.set(Sy.tag,e)),e||null}case ky.tag:{let e=l.get(ky.tag);return e||(e=ky.fromStream(n),l.set(ky.tag,e)),e||null}case Iy.tag:{let e=l.get(Iy.tag);if(!e){const t=h(Py.tag);if(!t)throw new Error("Something went wrong while parsing 'maxp' table");e=Iy.fromStream(n,t.numGlyphs),l.set(Iy.tag,e)}return e||null}case Ry.tag:{let e=l.get(Ry.tag);return e||(e=Ry.fromStream(n),l.set(Ry.tag,e)),e||null}case Ay.tag:{let e=l.get(Ay.tag);return e||(e=Ay.fromStream(n),l.set(Ay.tag,e)),e||null}case Cy.tag:{let e=l.get(Cy.tag);return e||(e=Cy.fromStream(n),l.set(Cy.tag,e)),e||null}case by.tag:{let e=l.get(by.tag);return e||(e=by.fromStream(n),l.set(by.tag,e)),e||null}case Ng.tag:{let e=l.get(Ng.tag);return e||(e=Ng.fromStream(n),l.set(Ng.tag,e)),e||null}case _g.tag:{let e=l.get(_g.tag);return e||(e=_g.fromStream(n),l.set(_g.tag,e)),e||null}case cy.tag:{let e=l.get(cy.tag);return e||(e=cy.fromStream(n),l.set(cy.tag,e)),e||null}}return null}for(const e of s.keys())h(e);return new jy({scalerType:n,searchRange:a,entrySelector:o,rangeShift:c,warnings:t,tables:l})}get numGlyphs(){const e=this.tables.get(Py.tag);if(!e)throw new Error("No MAXP table in the font");return e.numGlyphs}get glyphs(){if(this._glyphs)return this._glyphs;const e=this.tables.get(dy.tag)||void 0;if(!e)throw new Error("No GLYF table in the font");this._glyphs=e.glyphs.slice();const t=this.tables.get(By.tag)||void 0;if(!t)throw new Error("No HMTX table in the font");let r=0;for(let e=0;e<this._glyphs.length;e++)this._glyphs[e].index=e,e>=t.hMetrics.length?(this._glyphs[e].hAdvanceWidth=r,this._glyphs[e].leftSideBearing=t.leftSideBearings[0]):(r=t.hMetrics[e].advanceWidth,this._glyphs[e].hAdvanceWidth=r,this._glyphs[e].leftSideBearing=t.hMetrics[e].leftSideBearing);const s=this.tables.get(sy.tag);if(s)for(let e=0;e<this._glyphs.length;e++)this._glyphs[e].unicodes=s.code(e).slice();return this._glyphs}get unitsPerEm(){const e=this.tables.get(xy.tag);if(!e)throw new Error("No HEAD table in the font");return e.unitsPerEm}get bbox(){const e=this.glyphs,t=this.unitsPerEm,r=[],s=[],n=[],i=[];for(const t of e)r.push(t.xMin),s.push(t.yMin),n.push(t.xMax),i.push(t.yMax);return[Math.min.apply(null,r)/t,Math.min.apply(null,s)/t,Math.max.apply(null,n)/t,Math.max.apply(null,i)/t]}get italicAngle(){const e=this.tables.get(Ty.tag);if(!e)throw new Error("No POST table in the font");return e.italicAngle}set fontFamily(e){if(null!==e){const t=ug(e,!0,!0,!1),r=this.tables.get(Dy.tag);if(void 0===r)return;for(const e of r.nameRecords)if(1===e.nameID&&0===e.platformID)return void(e.value=t);r.nameRecords.push({nameID:1,platformID:0,value:t})}}get fontFamily(){const e=this.tables.get(Dy.tag);if(!e)return null;for(const t of e.nameRecords)if(1===t.nameID&&0===t.platformID)return String.fromCodePoint(...hg(t.value,!0,!0,!1));return null}set postScriptName(e){if(null!==e){const t=ug(e,!0,!0,!1),r=this.tables.get(Dy.tag);if(!r)return;for(const e of r.nameRecords)if(6===e.nameID&&0===e.platformID)return void(e.value=t);r.nameRecords.push({nameID:6,platformID:0,platformSpecificID:0,languageID:0,value:t})}}get postScriptName(){const e=this.tables.get(Dy.tag);if(!e)return null;for(const t of e.nameRecords)if(6===t.nameID&&0===t.platformID)return String.fromCodePoint(...hg(t.value,!0,!0,!1));return null}subset(e={}){if(!("glyphIndexes"in e))throw new Error("Missing mandatory parameter glyphIndexes");if(!("fontValues"in e))throw new Error("Missing mandatory parameter fontValues");if(!e.cmaps)throw new Error("Missing mandatory parameter cmaps");if(!("cmapLanguage"in e))throw new Error("Missing mandatory parameter cmapLanguage");let t=new Map;e.tables&&(t=e.tables),e.fontValues.missingGlyph||(e.fontValues.missingGlyph=fy()),e.fontValues.nullGlyph||(e.fontValues.nullGlyph=my());const r=this.tables.get(dy.tag);if(!r)throw new Error("Initialize main font object first");const s=[e.fontValues.missingGlyph,e.fontValues.nullGlyph];for(const t of e.glyphIndexes){const e=r.glyphs[t];if(!e)throw new Error(`Incorrect glyph index: ${t}`);switch(e.constructor.className){case py.className:case uy.className:s.push(e);break;case hy.className:{const t=e;for(let e=0;e<t.components.length;e++){const n=t.components[e],i=r.glyphs[n.glyphIndex];if(void 0===i)throw new Error(`Incorrect componentGlyph index: ${n.glyphIndex}`);s.push(i),n.glyphIndex=s.length-1}s.push(e)}break;default:throw new Error(`Incorrect glyph's class name: ${e.constructor.className}`)}}t.set(By.tag,new By({hMetrics:Array.from(s,(e=>({advanceWidth:e.hAdvanceWidth,leftSideBearing:e.leftSideBearing})))}));t.get(Py.tag)||t.set(Py.tag,new Py({version:65536,glyphs:s}));const n=[],i=[],a=[],o=[],c=[],l=[],h=[];for(const e of s)n.push(e.xMin),i.push(e.xMax),a.push(e.yMin),o.push(e.yMax),h.push(e.hAdvanceWidth),c.push(e.leftSideBearing),l.push(e.hAdvanceWidth-(e.leftSideBearing+e.xMax-e.xMin));if(t.set(Ey.tag,new Ey({ascent:e.fontValues.ascent,descent:e.fontValues.descent,lineGap:e.fontValues.lineGap,advanceWidthMax:Math.max.apply(null,h),minLeftSideBearing:Math.min.apply(null,c),minRightSideBearing:Math.min.apply(null,l),xMaxExtent:Math.max.apply(null,c)+(Math.max.apply(null,i)-Math.min.apply(null,n)),numOfLongHorMetrics:s.length})),t.set(xy.tag,new xy({flags:3,unitsPerEm:e.fontValues.unitsPerEm,xMin:Math.min.apply(null,n),xMax:Math.max.apply(null,i),yMin:Math.min.apply(null,a),yMax:Math.max.apply(null,o)})),t.set(dy.tag,new dy({glyphs:s})),e.cmaps!==[]){const r=[];for(const t of e.cmaps)switch(t.format){case 0:r.push(Zg.fromGlyphs(t.language,s));break;case 4:r.push(ty.fromGlyphs(t.language,s,t.platformID,t.platformSpecificID));break;case 6:r.push(ry.fromGlyphs(t.language,s,t.firstCode,t.platformID,t.platformSpecificID));break;default:throw new Error(`Unknown CMAP table format: ${t}`)}t.set(sy.tag,new sy({subTables:r}))}return new jy({scalerType:_y.true,tables:t})}static TTF(e={}){if(!e.glyphs)throw new Error("Missing mandatory parameter glyphs");if(!e.fontValues)throw new Error("Missing mandatory parameter fontValues");if("cmapFormat"in e==!1)throw new Error("Missing mandatory parameter cmapFormat");if("cmapLanguage"in e==!1)throw new Error("Missing mandatory parameter cmapLanguage");let t=new Map;e.tables&&(t=e.tables),e.fontValues.missingGlyph||(e.fontValues.missingGlyph=fy()),e.fontValues.nullGlyph||(e.fontValues.nullGlyph=my()),e.glyphs=[e.fontValues.missingGlyph,e.fontValues.nullGlyph,...e.glyphs],t.set(By.tag,new By({hMetrics:Array.from(e.glyphs,(e=>({advanceWidth:e.hAdvanceWidth,leftSideBearing:e.leftSideBearing})))}));t.get(Py.tag)||t.set(Py.tag,new Py({version:65536,glyphs:e.glyphs}));const r=[],s=[],n=[],i=[],a=[],o=[],c=[];for(const t of e.glyphs)r.push(t.xMin),s.push(t.xMax),n.push(t.yMin),i.push(t.yMax),c.push(t.hAdvanceWidth),a.push(t.leftSideBearing),o.push(t.hAdvanceWidth-(t.leftSideBearing+t.xMax-t.xMin));if(t.set(Ey.tag,new Ey({ascent:e.fontValues.ascent,descent:e.fontValues.descent,lineGap:e.fontValues.lineGap,advanceWidthMax:Math.max.apply(null,c),minLeftSideBearing:Math.min.apply(null,a),minRightSideBearing:Math.min.apply(null,o),xMaxExtent:Math.max.apply(null,a)+(Math.max.apply(null,s)-Math.min.apply(null,r)),numOfLongHorMetrics:e.glyphs.length})),t.set(xy.tag,new xy({flags:11,fontRevision:456130,unitsPerEm:e.fontValues.unitsPerEm,xMin:Math.min.apply(null,r),xMax:Math.max.apply(null,s),yMin:Math.min.apply(null,n),yMax:Math.max.apply(null,i)})),t.set(dy.tag,new dy({glyphs:e.glyphs})),-1!==e.cmapFormat){let r=null;switch(e.cmapFormat){case 0:r=Zg.fromGlyphs(e.cmapLanguage,e.glyphs);break;case 4:r=ty.fromGlyphs(e.cmapLanguage,e.glyphs);break;case 6:r=ry.fromGlyphs(e.cmapLanguage,e.glyphs);break;default:throw new Error(`Unknown CMAP table format: ${e.cmapFormat}`)}t.set(sy.tag,new sy({subTables:[r]}))}return new jy({scalerType:_y.true,tables:t})}stringToGIDs(e,t=3,r=1,s=null){const n=[],i=this.numGlyphs;if(null===s)switch(s="00",!0){case i>255:s="0000";break;case i>65535:s="000000";break;case i>16777215:s="00000000";break;case i>4294967295:s="0000000000"}const a=this.tables.get(sy.tag);if(void 0===a)throw new Error("No CMAP table in the font");for(const i of e)for(let e=0;e<i.length;e++){const o=a.gid(i.codePointAt(e),t,r)||0;n.push(`${s}${o.toString(16).toLocaleUpperCase()}`.slice(-1*s.length))}return n}stringToGIDsArray(e,t=3,r=1){const s=new Map,n=this.tables.get(sy.tag);if(!n)throw new Error("No CMAP table in the font");for(const t of e)for(let e=0;e<t.length;e++)s.set(n.gid(t.codePointAt(e))||0,1);return Array.from(s.keys())}}!function(e){e.Courier="Courier",e.CourierBold="Courier-Bold",e.CourierBoldOblique="Courier-BoldOblique",e.CourierOblique="Courier-Oblique",e.Helvetica="Helvetica",e.HelveticaBold="Helvetica-Bold",e.HelveticaBoldOblique="Helvetica-BoldOblique",e.HelveticaOblique="Helvetica-Oblique",e.Symbol="Symbol",e.TimesBold="Times-Bold",e.TimesBoldItalic="Times-BoldItalic",e.TimesItalic="Times-Italic",e.TimesRoman="Times-Roman",e.ZapfDingbats="ZapfDingbats"}(Vy||(Vy={}));const Hy=new Map;Hy.set(Vy.Courier,"H4sIAAAAAAACA03WdXBXRxQF4PxeaBIgKVA3WiS4vRAkuAR3gjuUhBAIBALBpU3doS60xd0tELzUW+ru7u6llPadMz1nOrMze7+9e//ambs3LC6/NExNTswsKCrMyylMTszKyS3KH1f4v5P/grBiEJw8HgRJxUFwqjTaS8JyQSwOK4gtCeOjIK24fEZYKYjFEJdlMimIVQ4rBLEgCMqcSEsIYlFNSpgcxOJ5EFVVgcpIVaEzpGpQglQdSpRSoSSpBlRWqgmVk2pB5aXaULJUB0qR6kJnSvWgClJ9qKLUAKokNYTOkhpBZ0shdI6UBp0rNYbOk9Kh86Um0AVSU+hCqRl0kdQculjKgC6RWkCVpZbQpVIr6DKpNVRFagNVldpC1aR2UHWpPZQqdYBqSB2hmlImVEvqBNWWOkN1pC5QXakrVE/qBtWXukMNpB5QQ6kn1EjqBYVSbyhN6gM1lvpC6VI/qInUH2oqZUHNpAFQc2kglCENglpIg6GW0hColTQUai0Ng9pIw6G20gionTQSai+NgjpIo6GO0hgoUxoLdZLGQZ2ly6Eu0nioq5QNdZNyoO7SBKiHlAv1lCZCvaQ8qLc0CeojTYb6SvlQP2kK1F+aCmVJBdAAaRo0UJoODZIKocHSDGiINBMaKhVBw6RZ0HBpNjRCmgONlOZCo6R50GhpPjRGWgCNlRZC46RFYUr0GFTUKeOWg+PNFWC2uRLMMVeBE8zVYK65BpxorgXzzHXgJHM9ONncAOabG8Ep5iZwqrkZLDC3gNPMreB0cxtYGATx6eR2cEaUzSZ3gDN9eSdYZO4CZ5m7wdkRl5F7wDnO7gXnmiXgPHMfON/cDy4wS8GF5gFwkXkQXGweCqNvJe4K+zB9pX2ELraP0lfZx+ir7Ufoa+zj9LX2o/R19mP09fbj9A32E/SN9pP0TfZT9M320/Qt9jP0rfaz9G32CXqJ/Ry91H6evt1+gb7DfpG+036Jvst+mb7bfoW+x36Vvtd+jb7Pfp2+336DfsB+k15mv0U/aL9NP2S/Qz9sv0svt9+jV9jv0yvtD+hV9of0avsjeo39Mb3W/oReZ39Kr7c/ozfYn9Mb7S/oTfaX9Gb7K3qL/TW91f6G3mZ/S2+3v6N32N/TO+0f6F32j/Ru+yd6j/0zvdf+hS6xf6X32b/R+91TfqdLnf+DPmD/SR+0T9KH7L/ow/Yp+oj9N33UPk0fs/+JBupokE6IBtrTSf8Clfw2B5ULAAA="),Hy.set(Vy.CourierBold,"H4sIAAAAAAACA1XWdXCVRxQF8LwvaQjkpUDdaINLCLwQJDgkuLtrSYBAIBAIDm1Td28ppS3u7hIkFarU3d2dKqW03znTc2Y6szO7v733/rUzd2+sJHlxLC1aLqewuCg/ryiakF1YkBuN/sfU/ykdilUKgpNlQZC0JAhOHQv3E7EKQSQOKwhKY/HhIaMkOStWOYhEcC7PYFIQqRKrGETCnITjGYlBJKxJiUWDSDwvwqpUKEGqCp0hVYMSpepQOakGlCTVhMpLtaAKUm0oWaoDRaW6UIpUDzpTSoMqSvWhSlI6VFlqAJ0lNYTOlmLQOVIGdK7UCDpPyoTOlxpDF0hNoAulptBFUjPoYikLukRqDlWRWkCXSi2hy6RWUKrUGqoqtYGqSW2h6lI7qIbUHqopZUO1pByottQBqiN1hOpKnaB6UmcoTeoC1Ze6QulSN6iB1B1qKPWAYlJPKEPqBTWSekOZUh+osdQXaiL1g5pK/aFm0gAoSxoINZcGQS2kwVBLaQjUShoKtZaGQW2k4VBbaQTUThoJtZdGQdnSaChHGgN1kMZCHaXLoU7SOKizlAt1kfKgrtJ4qJs0AeouTYR6SPlQT2kS1EuaDPWWCqA+0hSorzQV6icVQv2ladAAaTo0UCqCBkkzoMHSTGiIVAwNlWZBw6TZ0HBpDjRCmguNlOZBo6T50GhpATRGWgiNlRbFUsLHoMJOGbcMHGcuB3PNFWCeuRIcb64CJ5irwYnmGjDfXAtOMteBk831YIG5AZxibgSnmpvAQnMzOM3cAk43t4JFQRCfSW4DZ4TRXHI7ONPJO8Bicyc4y9wFzg65lNwNznF0DzjX3AvOM/eB88394ALzALjQPAguMkvBK8xDsfBbibvSPkxfZR+hS+yj9NV2GX2N/Sh9rf0YfZ39OH29/QR9g32MvtF+kr7Jfoq+2X6avsV+hr7Vfpa+zX6Ovt0+Tt9hP0/fab9A32W/SN9tv0TfY79M32u/Qt9nv0rfb79GL7Zfpx+w36CX2G/SD9pv0Uvtt+mH7Hfoh+136Ufs9+hl9vv0cvsDeoX9Ib3S/oheZX9Mr7Y/odfYn9Jr7c/odfbn9Hr7C3qD/SW90f6K3mR/TW+2v6G32N/SW+3v6G329/R2+wd6h/0jvdP+id5l/0zvtk/Qe+xf6L32r/Q++zd6v3vK7/QBx/+gD9p/0qX2SfqQ/Rd92D5FH7H/po/ap+ky+59woA4H6cRwoD2d9C9nsoPwnAsAAA=="),Hy.set(Vy.CourierBoldOblique,"H4sIAAAAAAACA1XWd3CVRRQF8Pc2kATyIiCIioKh18D3CCW0AAm9hd47CRAIhARCBzVWUIq9AErvPXRCR8CCvWDF3sECNqT4nTs5Z8aZndn5nXv3r53ZvV5eTL6XHIpKycrNyUjPCYWSszLT4lJHZmZk56aHyhTGcf9LSxem8UgLQ6+kc1eSnIs+59zVU/5+ySvuggEs5wq8KFc0cONyIBDOi0n0Srlg0C+Ei1lDtAuW90q4oN9X5Gw40gX9c7FeyAUjLIhwwTioCFURKkpVgiKpylAUVQWKpqpCxahqUHGqOhRD1YBCVE0olqoF3UTVhkpQdaCSVDxUiqoL3UzVg0pTHlSGCkO3UPWhslQCdCvVALqNagjdTjWCylGNoTuoROhOqglUnmoKVaCaQXdRzaE4qgVUkUqCKlEtocpUK6gK1RqqSiVD1agUqDrVBqpBtYVqUu2gWlR7qDbVAapDdYTiqU5QXaozVI/qAnlUVyhMdYPqU6lQAtUdakD1gBpSPaFGVC+oMdUbSqT6QE2ovlBTqh/UjOoPNacGQC2ogVASNQhqSQ2GWlFDoNbUUCiZGgalUMOhNtQIqC01EmpHjYLaU2lQByod6kiNhjpRY6DO1FioC5UBdaXGQd2o8VAqlQl1pyZAPaiJUE8qC+pFTYJ6U9lQHyoH6ktNhvpRU6D+VC40gJoKDaSmQYOo6dBgagY0hJoJDaVmQcOo2dBwag40gprrxfqXYfJfysBycJS4AkwTV4Lp4ipwtLgaHCOuAceKa8EMcR04TlwPjhc3gJniRnCCuAmcKG4Gs8Qt4CRxK5gtbgNznItIMG4HJ/vVNOMOcIqad4K5Yj44VdwFTvO51LgbnK7qHnCGuBecKe4DZ4n7wdniAXCOeBCcKxaAd4uHPP9bCdwjHzbfKx8x58lHzffJx8z3y8fND8gnzA/KJ80PyS+ZH5ZPmefJp83z5TPmR+SXzY/Kr5gXyK+aF8qvmRfJZ82L5dfNj8lvmB+X3zQ/Ib9lflJ+2/yU/I75afld8zPye+Zn5ffNz8kfmJ+Xz5mXyB+al8ofmZfJH5tfkD8xvyh/al4uf2ZeIZ83r5Q/N6+SvzCvlr80r5G/Mq+Vvzavk78xr5e/NW+QvzNvlL83b5J/MG+WfzRvkX8yb5V/Nm+TL5i3yxfNO+RfzDvlX8358m/mXfLv5t3yJfMe+bJ5r/yHeZ/8p3m/3pS/zAdU/9t8UP7HXCBfMR+S/zUflq+aj8jXzEfl6+Zj8g1/qPaH6Uh/oL0e/R+6DNOUtwsAAA=="),Hy.set(Vy.CourierOblique,"H4sIAAAAAAACA13WZXCWRxQF4O/dQBLIlwarlxJcA+9HAgSX4BYkuEMCBAIhgeDQkrpAqRsOwd0ChCB1o+7u7qWFUgp9zx3O+dGZndl5zt39tTN3r18YV+SnhGPScgvys7PywzHp43Oy8wqywgmXksT/B0mXAr+Cc+cynIstde58SbAX++WdF8Jy3nI/xpUNXTwdCkUK41L9is7zgkKknB2IdV5VP8F5zrkypyLRzgvuxfth50VZEOW8RKgMVR0qS9WAoqmaUAxVC4qlakPlqDpQeaouFEfVg8JUfSieagBdRjWEEqhGUAUqCapINYYqUU2gypQPVaEi0OVUU+gKKhm6kkqBrqKaQVdTzaFrqBbQtVQqdB3VEqpKtYKup1pD1ag2UCLVFqpOtYNqUO2hmlQHqBbVEapNdYLqUGlQXaozVI/qAtWnukINqG5QQ6o71IjqASVRPaHGVC+oCdUb8qk+UITqCzWl0qFkqh+UQvWHmlEDoObUQKgFlQGlUoOgltRgqBU1BGpNDYXaUMOgttRwqB01AmpPjYQ6UKOgjtRoqBM1BkqjxkKdqXFQF2o81JWaAHWjMqHuVBbUg5oI9aQmQb2oyVBvKhvqQ02B+lJToXQqB+pHTYP6U9OhAVQuNJCaAWVQedAgKh8aTM2EhlCzoKFUATSMmg0Np+ZAI6i50EhqHjSKmg+NphZAY6iF0FhqETSOWuzHB49hCjplaA04QVwLZorrwCxxPThR3ABOEovAyeJGMFvcBE4RN4NTxS1gjrgVnCZuA6eL28FccQc4Q9wJ5om7wHznopKNu8GZQTXTuAecpcN7wQJxHzhb3A/OCbjCeACcq+pBcJ5YDM4XD4ELxMPgQvEIuEgsAReLR8EbxFI/+FZCN8rHzEvk4+ZC+YT5Jvmk+Wb5CfMt8pPmW+WnzLfJT5tvl58x3yE/a75Tfs58l/y8+W75BfNS+UXzMvkl8z3yKfNy+WXzvfIr5vvkV833y6+ZH5BfNz8ov2F+SH7T/LD8lvkR+W3zo/I75sfkd82Py++ZV8jvm1fKH5hXyR+aV8sfmdfIH5vXyp+Y18mfmtfLn5k3yJ+bi+QvzBvlL82b5K/Mm+WvzVvkb8xb5W/N2+TvzNvl78075B/MO+Ufzbvkn8y75Z/Ne+RfzHvlX8375N/M++XfzQfkP8wH5dPmYvlP8yH5L/Nh9ZQz5iOqnzWXyH+bj8rnzKXyP+Zj8nnzcflf8wn5gvmkfDEYqoNhOjoYaC/E/gcqk9e/qQsAAA=="),Hy.set(Vy.Helvetica,"H4sIAAAAAAACA03Wd1zVVRgGcO5BGQKpZTtyi+DgIg7cW1FxoeIeBIgoLpZbi4YtS9uWlXsg7j1QadneZXuZTdtlWmad5+nzPnX/uJ/7ve8573nP+t0bLI1aHkyIjkzNyS/JKcrLyowOT8/JLc7PLPj/d/99DNZw7myOc1HLnDsf51zEuWC0c1UrnKuS6FxgaTDUBUKSSqNSgjVdIIDPkf7NBSJcIDZY3QWcf7VNCnOBai4Q47sGQvmF71UHqmKqC1X1OgHVg8L8GIVQfSjc1ACKcC48FmoIRfqKMqBGUDVf12IoDoryOcugxlC0KR6KcS6UWRKgi/wI5VATqLpV1hSqYf2aQTUt1hy62JQIXWJ1BqFapiToUlML6DJTMnS5qSV0hakVdKWpNXSVqQ10tSkFusbUFoq1ytpB15raQ7Vtth2gOqaOUF1TJ6ie5ewM1fdnoDbUBWpgK98VamjqBjXyOg51h+JMPaDG1rInFO9HOAn1ghKcC2OdvaEm1i8Vampz6AM18/1CoL5Qc8vZD0q0qtOgoM/J/esPJVnOAVALG28glGxZBkEtLTYYamX90qHW1nII1MbmMBRKsZbDoLbWMgNq58/uEmg41N5iI6AOppFQR8s5Cupkcx8NdTaNgbqYxkJd/bmuhMZB3WwlxkPd7SRPgHpYLBPqaboO6mWrmwX1tlg2lGrKgfrY6BOhvhbLhfqZJkFp/m5yXfKg/qbJ0AAbbwo00GL50CDbv6nQYMs5DUo3TYeGmGZAQ00zoWE29wIow8YrhIbbHIqgEdavGBppLUugUba3s6DRFpsNjTHNgcaa5kLj/Ai8VfOg8V61oPnQBIstgDLt/i0MxvjNYGX+SRmyEsziJMBVYDYrBVeDOeIacKK4FswV14GTWAO4HsxTdAM4WQNtBKf4aZ8iN4H5PnqGLAOnqu9mcBpnAJaD05VqCzhDqbaCMxXdBhb405tMbgcLfapscgdYpMY7wWJxF1gi7gZn+b4ryD3gbM80ci84Rwu7D5yrvvvBeeIBcL7nafIguEDzPQQu9Ofz3/keBheJFUH/sxJyvXyEvoEXGz5Kl/Law8foG+VK+ib5Cfpm+Un6FvkperH8NH2rf2iH0M/Qt/EIw8fp29X+WfoO+Tn6Tvl5eon8An2XVvJF+m75JXqp/DK9TH6Fvkf1vErfK79G38fHMPw6fb/8Bv2A/Cb9oPwW/ZD8Nr1cx/ME/bDi79CPaPx36RXye/Sj8vv0Y/IH9ONanw/plfJH9Crt/8f0ap2mT+g18qf0Wvkzep18kl4vf05vkE/RG/l3Cf6C3sQHE/wlXab2X9Gb5a/pcvkbeov8Lb1V+3ma3iZ/R2+Xv6d3yD/QO5XvR3qX/BO9W/6Z3iP/Qu+Vf6X3yb/R++Uz9AE9U36nD2o/ztKH1P4cfVj+g66Q/6SPyOfpo1rfv+hjil+gKxX/GzfTnz7/F+hC/D8h9PQ0nQsAAA=="),Hy.set(Vy.HelveticaBold,"H4sIAAAAAAACA13Wd1iWVRgGcL4DIgg42ovCiajoizhAxYEL98Y9CHCiqCBuK9rD9s4KtyLurTgbVmZ7Z9PMhu3Shlnnvrue+4/+4eL3Pec8zznPOe/7fUFpTFmQEhudlV9Qkl88KTcnNiKzsCAvtro+SPifk+GgpnNnjzsXs8i5c4nORXcLYp2rcti5iEznXGUQ7kJhKaUxaUEtFwrh/2j/x4WiXCg+qOFCfoxLT4l0oWouFOenhsL5gZ+VAEV4lUO1oSrOhR+F6kCRvkYRVBeqaqoHRTlXNR6qD0X7FR2BGkDVnAudghKhGKvQEIo1JUFxvh6zNIKq+woVUGOohq2zCVTT5iVDtSzWFLrA1Ay60NYZQBeZUqCLTc2hS0yp0KWmFtBlppbQ5aZW0BWm1tCVpjToKlM6FG+rbgNdbWoLXWO7bQclmDKg2qb2UB2vE1AHqK7v/DGoI1TPOt8Jqm/KhBqYOkOJpi5QQ69sqCuUZBVwuUKNnItkP7tDjW1eFtTEet0DSrbd9oSa2sheUDPL2RsKfE7uvQ+UYiP7Qs2tXj8o1VbWH2phsQFQS5s3EGplIwdBra3eYCjNRg6B0m1kNtTGd3AxNBRqa7FhUDvTcCjDco6A2tv5jYQ6WCdGQR0tNhrqZOc3Bsq0Lo2FOtvIcVAXi+VAXa3etVA3i+VC3S2WB2VZLB/qYTnHQz1t5ASol2ki1NtWPQnqY5oM9bWcU6B+FiuA+tvzPhUaYDmnQQNNhdAg03RosGkGNMSe95lQttUrgobaHoqhYTZvFjTcRpZAI+xOzIZGWmwONMo0FxrtFQbNg8ZY9fnQWF8vA1oAjbPYQijHzm9REOcPg53wb8qwMjCXCwWXgnmsCC4D88Xl4HhxBThBXAlO5BrAVeAkRVeDk1VoDTjFX82T5FqwwEfPkOXgVM1dB07jDsAKsFCp1oPTlWoDOEPRjeBM34tUchNY5FPlkZvBYg3eAs4St4Il4jZwtp+7hNwOztEid4Bz1did4DzN3QXOF3eDCzxPk3vAhUq1F/TfjpH/7bcSvE7cF/ivlbDr5f30Dbxe8AG6lK8L+CB9o3yIvkk+TN8sP0PfIj9L3yo/R9/mXFQY/Tx9u+JH6Dv42oFfoO+UX6Tvkl+iF8tH6bvVyZfpe+Rj9L3yK/R98qv0/VrPa/QD8uv0g3zk4Dfoh+Q36Yflt+hH5LfpR+V36Md0Pd+lH1f8PfoJ1X+fXiJ/QD8pf0g/JR+nn1Z/PqLL5I/ppTr/T+hluk2f0svlz+gV8uf0SvkEvUr+gl4tn6TX8PUJf0mvVfwUXS5/Ra+Tv6Yr5G/o9fK39Aad52l6o/wdvUn+nt4s/0BvUT9+pLfKP9Hb5J/p7fIv9A75V3qn/Bu9Sz5D79Y75Sy9R/Hf6b3yH3Sl/Ce9T/6L3i+fow+oP3/TBxU/Tx9S/B88mf72+Z9A55P+Be1tbgOkCwAA"),Hy.set(Vy.HelveticaBoldOblique,"H4sIAAAAAAACA1XWd3jNVxgH8Ps7kSU3RZUu0ZgRhN8VI0GMWDEjRuwRyUW4RGTY2qZ0615Ua6+IPYLE7NBWde9lVbVFdSgdRM/3277v8/SfPM/nvOec95z3nN+5cYsiytwUb3iKP1Doz8/OzPB6k3MCWdGp4wLZuQV+b00NRP+vvYa2x6H9v2a3qjFXK4zxlhpzLcaY8Amu15jgI8ZUSjPGlLuhJthz47LH4yuKSHCrGccxjscXbv8YJ8w4UW4V49h+JtEXYpzKxom0w50gNgQZJxqqZFUM1YGCjQk6BtWFQmyePKgeFCqqD4UZExoFNYDC7aqOQg2hysY456AYKEIyNIK8olgo0ubjLI2hm2yGEqgJVEXW2RSqKuPioGoSawbdLGoOVZd1utAtIh9UQ9QCqimKh24VtYRuE7WCbhe1hu4QtYHuFCVAtUSJUJSsui1UW9QOukt22x6KFiVBdUQdoLpWZ6COUD1b+eNQJ6i+VL4z1ECUDDUUdYFiRF2hRlbpUDcoVjJ0hxobE8J69oCayLgUqKnUuicUJ7vtBTWTnr2h5jJnH8i1c3LvfSGf9OwHtZB8qVC8rKw/1FJiaVArGTcAai09B0JtJN8gKEF6DoYSpWc61NZWcBE0BGonsaFQe9EwKEnmHA51kPMbAXWUSoyEOklsFNRZzm80lCxVGgN1kZ5joa4Sy4C6Sb5xUHeJZUI9JJYFpUjMD/WUOcdDvaQnngunt2gi1EdWnQ31FU2C+smck6FUiQWg/vK9T4HSZM6p0ABRDjRQNA0aJMqFBsv3Ph1Kl3x50BDZQz40VMYVQMOkZyE0XO7EDGiExGZCI0WzoFFWHmg2NFqyz4HG2HxJ0FxorMTmQRlyfvPdSHsYrIR9KT3LwUwuFFwBZjEjuBL0K1eB45WrwQnKNeBErgFcC2ZrdB04SROtByfbq3mW3AAGbPQKWQxO0bEbwancAVgC5uhUm8BpOtVmMFejW8Dpthbx5FYwz06VRW4D87XzdrBAuQMsVO4EZ9ixS8ld4Exd5G5wlha2FJytY/eAc5R7wbmWF8h94Dydqgycb+/Ev/stB+9W7nftz4rnHvUB+l5eL/ggXcTnAj5E36c+TC9QH6EXql+h71e/Sj+gfo1+0JgwD/06/ZDGj9IP89mB36AfUb9JP6p+i16kPkY/ppV8m35cfZx+Qv0O/aT6XfopXc979NPq9+ln+MnBH9DPqj+kn1N/RD+v/ph+Qf0JvViv56f0Eo1/Rr+o+T+nl6q/oF9Sf0m/rP6KXqb1+Zperv6GXqHnf4JeqbfpJL1KfYperT5Nr1Gfodeqv6XXqc/S6/l8wt/RGzR+ji5Wf09vVP9Al6h/pDepz9Ob9Twv0FvUF+mt6p/obepL9Hatx8/0DvUv9E71r/Qu9W/0bvVlulT9O71HfYXeq2/KVXqfxv+gy9R/0uXqv+j96r/pA+pr9EGtz3X6kMYr6MMav4Ev094++y9QRew/R/qZmL8LAAA="),Hy.set(Vy.HelveticaOblique,"H4sIAAAAAAACA2XWd1yVVRgH8PseZMklJa00I3EiKvJecQDujYrixD0QroriQIbbkoZlWaaWI8u9ENxbUWnZUNtpWzObts1Rpp3fz57nn+4f9/P5vs85z3nOeu91C8NK3CRvaLI/u8Cfl5WR7g1OHZWdlZPv90bos6j/P4r975Fb0Zhr843xLjLmRrQxodVcrzGBpcaUizPGWegGm0DPrcsej68wLMGNMI5jHI8v1H4ZJ8Q4kW4F4xj7SfQFGae8ccJtdyeADwKMEwWVE9WAAq3OQDWhIDtOLlQLChbVhkKMCY6E6kChtqo0qC5U3tY2D4qGwmzOIqge5BXFQOHGBDBLfegOO0Ix1ACqIJU1hCpKv1goQmKNoDtFcVAlqdOFKot80F2ixtDdonjoHlETqIqoKVRV1Ay6V9QcqiZKgO4TJUKRUlkSdL+oBVRdZtsSihK1gmqIWkM1JWcbqJYxIdWhtlBtWfl2UB1Re6iu1QmoAxQt6gjVk5adoBg7wgWoM1TfmCDW2QVqIP2SoYYyh65QrO3ngbpBjSRndyhOqk6BXJuT+9cD8knOnlBjGS8VipcsvaAmEusNNZV+faBm0rIv1Fzm0A9KkJb9oURpmQYl2bO7ABoAtZDYQKilaBDUSnIOhlrL3IdAbURDobaiYVA7e67LoOFQe1mJEVAHOckjoY4SS4c6iUZBnWV1M6AuEsuEkkV+qKuMPhrqJrExUHfRWCjF3k2uSxbUQzQO6injjYdSJZYN9ZL9mwD1lpwToT6iSVBf0WSonygH6i9znwKlyXi50ACZQx40UPrlQ4OkZQE0WPZ2KjREYtOgoaLp0DDRDGi4HYG3aiY0wqoyNAsaKbHZULrcvzluuN0MVmbflJ7VYAYnAa4BM1kpuBb0K9eBo5XrwTHKDeBY1gBuBLM0ugkcpwNtBsfbaV8kt4DZNnqFLAInaN+t4ETOACwGJ2mqEnCyptoG5mh0OzjFnt54cgeYa1NlkjvBPG28C8xX7gYLlHvAqbbvSnIvOM0yhdwHTteF3Q/O0L4HwJnKg+Asy0vkIXC2zvcwOMeez9vzPQI+oCx17c+K50H1UXouLzZ8jC7ktYeP0w+py+iH1S/Rj6hfph9Vv0LPU79KP2Zf2h76NfpxHmH4BD1f279OP6F+g35S/Sa9QP0W/ZSu5En6afUpeqH6NP2M+m16kdbzDr1Y/S69hK9h+D36WfX79HPqD+il6g/pZeqP6OV6PM/QKzR+ln5ex/+YXqn+hH5B/Sn9ovozepWuz+f0avUX9Brd/y/ptXqaztHr1Ofp9eqv6A3qC/RG9df0JvVFejP/LsHf0Fv4YoK/pYu0/Xf0VvX3dLH6B7pE/SO9TffzEr1d/RO9Q/0zvVP9C71L8/1K71b/Ru9R/07vVf9B71Nfpver/6QPqK/QB/WdcpU+pPtxjT6s7a/TR9R/0aXqv+mj6hv0MV3ff+jjGr9Jl2n8Fm6mPX32L9DNmH8BjyAiG7ELAAA="),Hy.set(Vy.Symbol,"H4sIAAAAAAACA0XX+VdVVRgG4Hv3kUG7qNCgqeg9l0AR03NBnHJogDKzCcsGNSfQBkzFrJzScGqyHEEBcQQFESccQJwlqp9MK/+AltloZaZmaX3vS/tjLdfyPO/eZ0/n7H0uXn6g2HMDkSNmTZkwNTcQlZUzeWbu+DwN/v/fa2vMrUpjoo8bc7PEmMhSr5Xx+/DP+Jd7jlyE8wOZXqzx+3HdkoXRxh/vtTF+Y4zvRjjS+OWeGC9g/A6SsNwVhFqIKiEXijCmBcsSoEjpi2WJUJSoP5QERdv7ukEtrZKhVtJKNpQC3Wb76wEFrHpCMSK22QtqbXv3oDZWYaitVSoUa5UGxVn1hm63SofusOoD3WnVF7rLqh/Uzqo/1N6ObAB0t9V9UAc7v4FQR6tBUCerwVC8Mc4yaAjU2a7SKKiL1RgoaHsfC7ly33loDhSS51wEzYUSbNk8L8b47xGlheUp+naDicJqMBgCkzgaYWgc2NWYiBqyM9jNlvr2gMlaORvsrswBU4QloFMP9pCLKyw14L3acizYU96VArIN2Ms25RwHPZl5mKUpYFgqJ7K0Aky1TfmqwDQdRgewN9dJ6F8JpmvpULCP8AKbWg32lU3DysEksJ/O9xrY304h8QtwgLQ5kpUzvNbypGVUWeEI4/iu/4vigdpTHDhI2zoPDtbS8eAQ4TnQXQXeb0wUh+UuBx9Qcg4PauUV4EMyaI7D5RwydGWjwUy7WKFk8GFld/ARqTwPTAiCQ5Uu+KiwkavDjoYJ2ZHDYTxmh+FwzMOF35JrwMeVBeAT2lQh+KTwErkWfIqvNrgOfForF4FZdlROMThCViOeLAGf0crrwWeFyWQpOFJLN4DP6auzEXxeBjmD3AS+IKwnt4Av6hS2gqOkqcVkGThamupIloNjtKNt4EtSOprcDo6V0gDJnTNO3++94Hi5GEbuAyfY98ypAScqD4DZuuwHwRxhCnkInCQruZmsBSdrR3Xgy8rD4Ct67xHwVbm4TB4FX9PKx8Bc5Qlwig7jFPi6XCwkT4JTlafBaXoWNIDTtd9PwTxtuRGcoY/7M/AN5efgTH4P8AI34AP2pmzCG2F8XGplI6YieouriahOojTc9LY8jUjclMSjaZZyIjhbOQmco+QZOFf3Uzy2+TyeJ9zmF1D8jp1pKAacr/trjdQ2vgXqQvpd3feZdL62vpBeqF5KL1Ln04vVS+gl6kX0Uj0bztHv6dFxhn5ffZb+QOt/SX+oh8lX9EfSfgbbL6OXaX8t6Y/t/aGu9CfqbvRynX+QXiG+SPemV+rBH+HJh9i3ik9bfh4kVGOJ/2Sl1baSm85Ka2TN41hpEypdYlig4RaEvzEs1HArwr8YrtWwHOHf7GOdTsxHF+mDcuhi+x0JtaNL7EbzmhZivTqaLtUd37SwG2z7zjf0Rt0/X9ObdMfspzfreKI46C066GIM+ieGWzVcj/AXhmUaliK8yrBcw40Ir7OPbfoytGel7TxpUGkbKv3OsELD7QgvM6zUsALhHwx3aFiJ8ArDKg13IPyH4U4NqxDeZFit4U6EtzjEXbJMV7ksZ1lpN5cNlc6g0ncM9/CzjXAXwosM9+qMSxD+zHCfhpsR/sqwRsMNCK8x3K9hGcIb8tPY+A40f+N/YHCwOfiewSFZ0i5NwY+cQC1r4LtfQdepq+nDYp79boiut8edG0sfsR8StxN9VN/LgfQxu0HdpvdGfvNH8GsRrKJP2PPS6ccBnqQ5wPkMTjUH0xicbg6mM2hoDvLYZqOMaTb7HI6Vlx5L8JfGf5iJKaSfDAAA"),Hy.set(Vy.TimesBold,"H4sIAAAAAAACA03Wd1RVRxAG8HeHIsLDkt6IWBBR0YtYQKzYuyJibxEQFETEXiOJpqgxxXSTWAAVC/aKojGJ6b33xPTeizEm+305Myf/vHN/b3Zn5u7du+/5pVHr/LhgWGZ+YU5JMDS9qCA7GEnE/u86Edd+PZEL5SJ10kTO14hEjvODImF5IiFVIlLth4gXSCqNSvHri+fhurb7EC9CvBi/rnhujASSwsWLFC/aTfVC+IWbFQuFOlVCDaEwkdBiqBEU7sSRjaFaqiZQhEgEFQfVFglnlqZQpMuZCsVDUVqhGRRUJUDRmrM5VMdpLdQCqqt9toTq6bxEqL7GWkEXab3W0MWa04cuUSVBl6raQJepkqHLVW2hK1TtoCtV7aGrVB2gq1Up0DWqVChGu+4IXatKgxro3XaCYlWdoYaqLlAjzdkVaixSi8+oG9TE7YUzUHcozikLSoeaaqwHFK/qCTXTkb2gBFfhLNQbau6eJtezD9RC1Rdq6fZdDNQPStTO+kOtdOQAqLVWGAj5rus10CAoSXsZDLXReUOgZO1lKNRWY8OgdjovA2rvRpZAw6EOWi8TStGRI6BUVRbUUffuSChNY6OgTqrRUGfNOQbqos9vLNRVdx1eSK+bxsZD3V1nFdAEKF1XaSLUQ0dOgnpqbDLUS+/oOqi3W2uu2RSoj8ayob4ay4H6ac5cqL/mnAoN0Hl50EDtOh8apPOmQYN15HRoiI4sgIbqG14IDdORM6AMrVcEDdfYTChTVQyN0K5nQVm6l0qgkdrLbGiUzpsDjdYKc6Ex+ozmQWM1Nh8ap1oAjdd6C6EJTvHQImiiiHcaWgxN0tgSaLLLkgAt9aPdw+Bp407KwAZwChsFN4LZrAhuAnOMm8FcYxk41VgO5rEHsALMt+gWcJoV2gpOd7d9jtwGFrhoLlkJFtrc7eAMniDgDrDIUu0EZ1qqXWCxRavAWW4tksndYIlLlU3uAWdb3b3gHOM+cK6l2g/Oc3PXkwfA+Y4Z5EFwgS3sIXChzT0MLrLMR8DFjmXkUXCJ3e8xcKnbn/+xGlxmPO67n5XA9eYT9HKbXUOXckvBJ+kbzKfoG82P0ivMp+mV5sfom8yP0zfzyIGfoG+x+Bn6Vh408JP0KvNT9Grz0/Qa8zP0bXyV4Gfptebn6NvNz9N3mF+g77R+XqTvMr9Er+MxDL9M321+hb7H/Cp9r/k1+j7z6/T9tj3foB+w+Jv0g1b/LXq9+W36IfM79MPmd+lHzO/RG/ijAr9Pb+TxAn9Ab7L98CG92fwRXWb+mC43n6UrzJ/QW8yf0lutn8/obTyY4M/pSvMX9Hbzl/QO81f0TvPX9C4e1vA3dJX5W3q3+Tt6j/l7eq/1+wO9z9bnR3q/xX+iD5h/pg+af6EPmX+lD5t/o4/YmfI7fdTif9DHrP6fdLX5HH3c/Bd9wnyerrF8f9MnLX6BPmXxf/Bm4nRwf7MD/wJjRXkFmAsAAA=="),Hy.set(Vy.TimesBoldItalic,"H4sIAAAAAAACA03Wd1iXVRQH8Pe9yBB+JJRaVhS4UdH3Jw5wixP3QFScxFAURAT3ptIW2bZhJU5E3LhxV2Z7mznKzPaynZl2v1+fc57+4Xk+99xzzn3vvVzwisMqvERfYEpOXlahLywpPzczOrkoPTcnwxfJsej/D0VwKA5D10e8CGOulhrju2jMleXGhMZ7PmMC04wJqDTGVHnBJtC5dslx/MVhCV6kcV3jOv7q9odxQ4wb5dUwrp1nHH+QcUONG27T3QAOBBg3Gqpma0VBMVCgMdUKoLpQkBVn1oOCRfWhEGOCyqEGUHWrRKghFGo7UI2gMCvObAz5RLFQuNRsAt1gtQxqCtWQdTaDIiQvDoqUWHPoRunXArpJanpQTZEfqiVqCdUWYVvdm0WtoFtEraE6ojbQraK20G2iBOh2USIUJatuB90hag/dKV/bAYoWdYRiRJ2gulKzM1TP7nUZ1AWqb+9DKtQVaiBKghqKukGNrI5D3aHGEusBxYp6Qk1kZi+oqZxtb6iZ3JdkKE5W1gdqLlX6Qi1s7ALUD/KMCWZef8gvHQZALUUDoXjJGwS1kthgqLV0GAK1sTMLoaFQW8lLgRIkbxiUKHmpUDtZy3CovcRGQB2kykiooygN6iTnNwrqLLduNNRFYmOgrnJ+Y6Ek2aVxUDeZOR7qLrF0qIfoLqin3esSKAPqJbFMqLfEsqBkqZkN9ZGZE6C+sksToX6y6hyov2gSNEDyJkMDJZYLDZJbkAcNlppToCGSlw8NFU2FUkQF0DC5PdOgVFEhNFz6FUEjpMN0aKR87QwoTU5sJjRKOsyCRsvM2dAY6TAHGms7nIDmQuOMcY9B86DxEpsPpcv5LfDC7WHwtbEvpbMSzGBRsBTMZH9wFZilXA1mK9eAE5RrwYlcA7gOzNHoenASTxUsAyfbz75MbgBzbTSGLAfzNHcjOMXyFFkB5mupTeBULbUZLNDoFnCa/cB4citYaEtlktvAIjs5m9wOTlfuAGdoqUpwps1dQe4EZ+kid4GzdWN3g3M0dw84VyvvBecp94HztdR+cIG9n9dZBS5UHvDsnxVnkfogvVizD9HFvFLwYfpu9RH6HvVR+l71MXqJ+iV6qfpl+j775JTQr9D3a/w4/YD6VfpB9Qn6IfVrdIn6dfphvZNv0MvUb9KPqN+iH1W/TT/G5xJ+h35c/S79hPo9+kn1+/RT6g/o5eoP6afVH9HP8BcMPkk/q/GP6efUp+gV6k/o59Wn6RfUZ+gX+XDDZ+mV6nN0qZ7/p/Qq9Wf0avV5eo36c3qt+gK9Tv0FvV59kS7T9X1Jb+AzBX9Fl6u/pjeqv6Er1N/Sm6zP09/Rm/l4wt/TW9Q/0FvVP9LbbH4s/RO9Xdf7M72Dzy98ia7U+C/0TvWv9C71b/Ru9e/0HvUf9F59U/6k92n8L3q/9v+brlJfpg+o/6EPqq/Qh3S//qUPa/2r9BGNXzMmxMHrYP/Vdv4Dl4kV7bALAAA="),Hy.set(Vy.TimesItalic,"H4sIAAAAAAACA1XWd1iXVRQH8Pe9yJIfqTkaRuEeiLw/EQX3VtwDcaFCDEXBBU4cRakty2znyD1wo+LelqvS9k7NynaZszLtfr885zxP/MHzfDj3nnvu+V0OeIVhS7woX2BSdm5mni8oMT8tJzvd5yMj/6foUnnljbk925jwRGNuFRsTes7zGRMYb0zAAmPc+V6wCXTuXHYcf2FYvFfBuK5xHX+o/WbcEONGeOWMa+yX4w8yblnjhtvtbgB/EGDcSKiMVRFUDQq0mVOg6lCQMWW4sgYULKoJhRgTxH21oFCrBKg2VNbWVgLVgcLkhLqQT1QPCpec9aG77N2yoCionNTZACov+6KhChJrCN1txdNjoIqS04MqifxQZVEjqIooFrpH1Bi6VxQH3SdqAt0vagpVFcVDD4gSoAipuhn0oKg59JDctgUUKWoJVRO1gqpLztZQDWOC+Rm1gWra2EWoLVRL1A6qbbMkQ+2hOlbHoQ5QXVnZEaon6gTVl5WdoShRF6iB3CERirbvZR7UFWoo53WDYmzOPKg75Ml76QH5ZWVPqJGc0AuKlVp6Q40l1geKk1hfqIn0pR/UVM5LguJlX38oQfYlQ82klgFQc4kNhFpIlkFQS9FgqJW9bQQ0BGotry4FaiOxoVBbq1RoGNRO6hwOtZcOpkIdJJYGdRQ9DHWS7qZDnSWWAXWRWCaUKLVkQV1l5Qiom2gk1F1WZkM9RKOgnpJzNNRLYjlQb+lnLtRHco6B+orGQv1E46Ak0Xiov3RpApQsyoMGyHn50EDZNxEaJJVNggbL65kMDZHYFChFNBUaKidMg4ZZxUIF0HB7HjUdSpXYDCjNnp4EzfTC7YfBaWMnpbMUTGdScBmYwUrB5WCmcgWYpVwJjlCuAkeyBnA1mK3RNeAovhRwLTjaPttK5Dowx0bjyCIwV/euB8dwgoAbwLGaaiM4TlNtAsdrdDM4gb0At4B5NnMGuRXMt4tLMxeDE5XbwEmaajs42e5dRO4Ap1jGkCXgVG3sTnCa7t0FFmjm3eB0ywJyDzhD77sXnGlvVMp94Czlfs/+WXEeUR+gH9XdB+lCDgH4EP2Y+jD9uPoIPVt9lJ6jPkbPVb9JP2GHdumbeYt+kk8YPk4/petP0E+rT9LPqE/R89Sn6We1dW/Tz6nfoeer36WfV5+hF/DXGz5Lv6D1vUe/qPH36ZfUH9Avqz+kX1F/RL+q/ph+TZ/nJ/TrGv+UXqj+jF6k/pxerP6CXqL+kn6Dgxv+il6q/fqaXqaf/zl6ufo8vUJ9gV6p/oZepb5Ir1Z/S69Rf0ev1X5+T6/jmIIv0UXqH+j16h/pDeqf6I3qn+lNHJ7wL/Rm9a/0FvVv9Fb173Sx1vsHvU19md6u/pPeob5Cl6iv0jvV1+hd6uv0bp0pN+g9Gr9J71X/Re9T/03vV/9DH1Dfog9qf/6lD2n8Nn1Y43eMCXEwHey/2s5/rhWRJaILAAA="),Hy.set(Vy.TimesRoman,"H4sIAAAAAAACAz3Wd1zWVRQG8Pd3kSEjtWxH4VYU/SGi4B44cSLiRkmGKENAXDgKS1uW2ZSswC3uvQct27tsL9t7T7PO89Q5/MGHL+fcc88d3Be/MmK1HxsZnJ5fmFMWGZqWk1dekFUaGUHHpBUXZhX9jzjCb+jc+VrnoqqcO7fKufB2fqRzwanOBdU45630g5wXiK+MSPIbOc/Dz/Xlm/PCnBftN3Cek69AfIjzwp0XJUO9IP5CRsVA9US1UBMoWKqmQE2hEOfqMbMZFKpqDoU5F8JxLaD6omSoJRQufZVAraAInaE1FKlqA0VpzVjoAtFSqC3UQPvEgr2GOi4OaqSx9tCFIs7eAbpIa/pQY1U8dLGqI3SJKgG6VNUJukyVCF2u6gxdoeoCXalKgq5SJUPR2llX6GpVN+gaXW13KEbVA2qi6gk1lVNZAfWCmjkXmgn1hprLXTgN9YFaiDKgvlBLVT+olWamQK1lhrNQf6iNqAwaAMVq5kCorWoQ1E7PYTAUJ51FQ0Og9pqZCnXQGYZCvnTNzGFQvGYOhzqqRkAJ2stIqJPGRkGJuqI0qLNmjoa66HzpUJKOGwMlqzKgrtIL93Ms1E1j46DuqvFQD605Aeqpa58I9dLTnAT11thkqI/sSx2UCfXVOzEF6qeZU6EUPdssqL9mXgsN0Ng0aKDGsqFBGsuBBmvNXGiIZuZBqarp0FDtOh8appoBDdfMmdAIjRVAI/UvvBAapZlFUJqqGBqtmgWlq0qgMdpnKZSht6cMGqvzzYbG6bhyaLxqDjRBz2guNFFj86BJqvnQZN2lBVCm6AxUAU2RV6oKWghN1dgiKEuqpEOL/Sg5DL428lIGqsFpXARYA2ZzRnAtmGNcB+Ya14N5xg3gdPYAbgTzLboJnGETbQZnyhE0JreABRJNJGvBQhu7FSziCwJuA4ut1HZwlpXaAZZYdCdYKnuRQO4Cy6RUNrkbnC3JueQesNy4F5xjpfaBc2XsGnI/OE8qV5MHwPm2sQfBBTb2EFhhlQ+DC4UV5BFwka33KLhYVvQfj4FLjMd9+VgJXGc+QV/PiwGfpCt5peBT9FJzHX2D+RH6RvOj9DLzY/Ry8+P0TXz+4Cfom/mQwafpW/jQwE/St5qfom8zP02vMD9D325b9yx9h/k5eqX5efpO8wv0Kuv3Rfou80v03eaX6XvMr9D3ml+l7zO/Rt9vfp1ebdfzDF1l8TfoB8xv0mvMb9EPmt+mHzK/Qz9sfpeu5kcF/B5dY7fnfXqt3YcP6HXmD+n15o/oDeaz9Ebzx/Qm8yf0ZjvvT+ktFv+MrjV/Tm81f0FvM39Jbzd/Re/g4wl/Te80f0PvMn9L7zZ/R++x/fie3mv+gd5n/pHeb/6JPmD+mT5o/oU+ZP6VPmxvym/0EYv/Th81/0EfM/9JHzf/RZ8wn6NPmv+mT5nP03Xmf5wLC+B1kH+zA/8CI6LPsZ0LAAA="),Hy.set(Vy.ZapfDingbats,"H4sIAAAAAAACA13X11cVVxQGcO4gcDEgiNgbqDCx36ti770XYoxiiSBF7A27ImBv2GMXe8PeFU2M0cSYFR998CH/QB7ykIeslSxXvu876+6sFR5Y97f3OXvOzJxzZiZUnvB3qGdCYk7uksK0ocWLivJyVyxPiMsuKCpZkLvs//EkMqJRk4eEkrxAlOfFvfe8Tx89L7YiVJsBxgL7QtH4ES5PqAzV9QIB/o5XMugFmrOjh79e4VgvgD6JDERHAmiXFkr0ArVQ+l0Y//0AGQPeFj0y1rLRZBz4QaxFBj0v5iWZWYeMx+gmKhtL1gazxTjyM3CyGCQT0HeLGE8movJNlWpK1gErxBZkkufVylfjBDIZpdwwEsm6aDxa1DBSwFViElnPsslkKlgp1iXr2wmmkA1QubZYj2wIvhZTyUZgY7E+2RhsKDYgm2CQ+8WGZFOc4DyxEdkMjZuKjcnmYKrYhGwBpog6/ZZgUGxGpnle9J9iczIdB3KVdXFagWPFlmRr8LSo+9sGw9ghppMZqOyuRisyExwvtiZ9Yxvyc7uDGWRbcKqYSbYDc0SfbA9u0y2LITuAR5RtS3a0udGO7AQ+FduTna1xBzIEXhM7kuFIZb8T2QW8JHYmu+IO5okhshvO112rMJkFvhW7kN3BT2JXsoedYDeyJzhFzCJ7obGbKt3J3shmiT3IPmCG2JPsa317kf3shvYm+6PUFbEPOQB0J9iXHAiWiP3IQeBJsT85GKUcB5BDQLdwBpJD7cIOIocZB5PD7bhDyBFgqTiUHAm6GTuMHAVq0fnDydE2VUaQY0A3zUaSY9H4vjiKHGerezQ5HhwpjiEnRLIZ78mJ4D/KjiMnRdZRRhWZbatsAvmFcSI52S7sJPJLYzY5BZOhtUrdJb8y1pBTI9M74w05DRyuvlPIHKyyMmU/kNOxv7oFO5WcgY2zhziNnInGbubkkLNAHcifTn5tnEHOxrVyC2cmmWucFUr2Anlo3DIcp+Xmz2VkTiSCFecXs0s+ju5W8TyywDifG38hmBXGbuwv8LxQkKEiCy1EKJ6hudgYUhhKw8T2FzFUbCFMbn8xS8/Dsd2dW0LONy5lB9QP/Kayy1A2laGFFlqOUH2OfxEOXs3xr0N0BSOLI5ENiJSw8BJchI8qnEsuxUjcZpJHLjPOIVE5zo0in1yBvm6tFZAltpcWkiuNReSqyLLNVKnVqPxKVOM1KLVHVKm1oCfOJtdFJkwbcb1RY95g1Jg3GnWgUmN+CI+zqE3mArnMXCiXm4vkCvNcebO5WN5ie/VKeat5lbzNvFrebl4j7zCvlXea18m7zOvl3eYN8h7zRnmvuVSuNG+S95nL5P3mcvmAuUI+aN4sHzJvkQ+bt8pHzNvkb8zb5aPmHfIx8075uHmXfMK8Wz5p3iOfMu+VT5sr5TPmfXKVeb981nxAPmc+KJ/HnPflQ/IF5LXhprv2Fz0vmC67/CWsVD1T0g/LlzGV3SZ7VL6Ceu4d6ph81fLH5WvIu13phHwddm8ZJ+VqeKF8Sr5hPi3fxPiq5TPyLdvkq+TbcJV8Vr5j4zkn3zWfl+/BbpFfkO/DS+WL8gN4uXxJfojzdw+ky/Ij5JPlK/JjHN+92V6Vn5ivyU/hP+Tr8jNztVxjD8sb8nPzTfkF2rtXi1vyt+Y78ne2Ld2VX2J8rv89+Xvk28v35Vfw7/ID+QfLP5Rfo797Pj2S38A18mP5R8s/kX+y16an8lu7P8/kn+1+18jvYG2U/nP5F5sfL/Ah4UX9qi+JGC866q9SBd7/F8BGGYzitwq+WY78C/+AGgf/DAAA");let My=class{constructor(e={}){this.index=0,this.advanceWidth=0,this.unicode=[],Object.assign(this,e)}};wt([ft({type:Pe.Integer})],My.prototype,"index",void 0),wt([ft({type:Pe.Integer})],My.prototype,"advanceWidth",void 0),wt([ft({type:Pe.Integer,repeated:"set"})],My.prototype,"unicode",void 0),My=wt([dt({type:Ne.Sequence})],My);let Ky=class{constructor(){this.xMin=0,this.xMax=0,this.yMin=0,this.yMax=0}};wt([ft({type:Pe.Integer})],Ky.prototype,"xMin",void 0),wt([ft({type:Pe.Integer})],Ky.prototype,"xMax",void 0),wt([ft({type:Pe.Integer})],Ky.prototype,"yMin",void 0),wt([ft({type:Pe.Integer})],Ky.prototype,"yMax",void 0),Ky=wt([dt({type:Ne.Sequence})],Ky);let qy=class{constructor(){this.fontFamily="",this.fontSubfamily="",this.fullName="",this.postScriptName=""}};wt([ft({type:Pe.Utf8String})],qy.prototype,"fontFamily",void 0),wt([ft({type:Pe.Utf8String})],qy.prototype,"fontSubfamily",void 0),wt([ft({type:Pe.Utf8String})],qy.prototype,"fullName",void 0),wt([ft({type:Pe.Utf8String})],qy.prototype,"postScriptName",void 0),qy=wt([dt({type:Ne.Sequence})],qy);let Wy=class{constructor(){this.sCapHeight=0,this.sxHeight=0,this.usWeightClass=0}};wt([ft({type:Pe.Integer})],Wy.prototype,"sCapHeight",void 0),wt([ft({type:Pe.Integer})],Wy.prototype,"sxHeight",void 0),wt([ft({type:Pe.Integer})],Wy.prototype,"usWeightClass",void 0),Wy=wt([dt({type:Ne.Sequence})],Wy);let Gy=class{constructor(){this.italicAngle=0}};var zy;wt([ft({type:Pe.Integer})],Gy.prototype,"italicAngle",void 0),Gy=wt([dt({type:Ne.Sequence})],Gy);let Jy=zy=class{constructor(){this.name=new qy,this.head=new Ky,this.os2=new Wy,this.post=new Gy,this.glyphs=[],this.unitsPerEm=0,this.ascent=0,this.descent=0}findGlyph(e){for(const t of this.glyphs)if(t.unicode.includes(e))return t;return null}getGlyphs(e){const t=[];let r="";for(const s of e)if(!r.includes(s)){r+=s;const e=s.charCodeAt(0),n=this.findGlyph(e);n&&!t.includes(n)&&t.push(n)}return t.sort(zy.sortByIndex),t}static sortByIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0}};wt([ft({type:qy})],Jy.prototype,"name",void 0),wt([ft({type:Ky})],Jy.prototype,"head",void 0),wt([ft({type:Wy})],Jy.prototype,"os2",void 0),wt([ft({type:Gy})],Jy.prototype,"post",void 0),wt([ft({type:My,repeated:"set"})],Jy.prototype,"glyphs",void 0),wt([ft({type:Pe.Integer})],Jy.prototype,"unitsPerEm",void 0),wt([ft({type:Pe.Integer})],Jy.prototype,"ascent",void 0),wt([ft({type:Pe.Integer})],Jy.prototype,"descent",void 0),Jy=zy=wt([dt({type:Ne.Sequence})],Jy);class $y{static create(e){return st.isBufferSource(e)?this.createFile(e):this.createDefault(e)}static createDefault(e){let t=this.cache.get(e);if(t)return t;const r=Hy.get(e);if(!r)throw new Error(`Cannot get default font '${Vy}. ZIP cached value doesn't exist'`);return t=vt.parse(Vl(new Uint8Array(at.FromBase64(r))),Jy),this.cache.set(e,t),t}static createFile(e){const t=st.toArrayBuffer(e),r=jy.fromStream(new ja({stream:new La({buffer:t})})),s=new Jy,n=r.tables.get(Fy.NAME.tag);n&&(s.name.fontFamily=n.getName(Fy.NameIDs.fontFamilyName)||"",s.name.fontSubfamily=n.getName(Fy.NameIDs.fontSubFamilyName)||"",s.name.fullName=n.getName(Fy.NameIDs.fullFontName)||"",s.name.postScriptName=n.getName(Fy.NameIDs.postScriptFontName)||"");const i=r.tables.get(Fy.HEAD.tag);s.head.xMin=i.xMin,s.head.xMax=i.xMax,s.head.yMin=i.yMin,s.head.yMax=i.yMax,s.unitsPerEm=r.unitsPerEm;const a=r.tables.get(Fy.OS2.tag);s.os2.sCapHeight=a.sCapHeight||0,s.os2.sxHeight=a.sxHeight||0,s.os2.usWeightClass=a.usWeightClass||0;const o=r.tables.get(Fy.POST.tag);o&&(s.post.italicAngle=o.italicAngle);const c=r.tables.get(Fy.HHEA.tag);s.ascent=c.ascent,s.descent=c.descent;for(let e=0;e<r.glyphs.length;e++){const t=r.glyphs[e],n=new My({index:e,advanceWidth:t.hAdvanceWidth||0,unicode:t.unicodes||[]});s.glyphs.push(n)}return s}static getIndexes(e,t){const r=[0,0];for(const s of t){const t=e.findUnicodeGlyph(s);t&&t.index&&(t.unicodes||(t.unicodes=[]),t.unicodes.push(s.charCodeAt(0)),r.includes(t.index)||r.push(t.index))}return r}static subsetFont(e,t){const r=st.toArrayBuffer(e),s=jy.fromStream(new ja({stream:new La({buffer:r})})),n=this.getIndexes(s,t),i=s.glyphs,a=[],o=[];for(const e of n){const t=i[e];a.push(t.yMax),o.push(t.yMin)}const c=s.tables.get(Fy.POST.tag);c.glyphNameIndex=[],c.names=[];const l=s.tables.get(Fy.HHEA.tag),h=s.tables.get(Fy.HEAD.tag),u=s.subset({tables:new Map([[Fy.OS2.tag,s.tables.get(Fy.OS2.tag)],[Fy.POST.tag,c]]),glyphIndexes:n,fontValues:{unitsPerEm:h.unitsPerEm,ascent:l.ascent,descent:l.descent,lineGap:l.lineGap},cmaps:[{format:4,language:0,platformID:3,platformSpecificID:1}],cmapLanguage:0}),p=new ja;return u.toStream(p),p.buffer}}$y.cache=new Map;const Yy=globalThis.TextDecoder,Xy=globalThis.TextEncoder,Qy=new Yy("utf-8");const Zy=new Xy;class ev{constructor(e=8192,t={}){let r=!1;"number"==typeof e?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);const s=t.offset?t.offset>>>0:0,n=e.byteLength-s;let i=s;(ArrayBuffer.isView(e)||e instanceof ev)&&(e.byteLength!==e.buffer.byteLength&&(i=e.byteOffset+s),e=e.buffer),this.lastWrittenByte=r?n:0,this.buffer=e,this.length=n,this.byteLength=n,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,n),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const t=2*(this.offset+e),r=new Uint8Array(t);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){const t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=this.readByte();return t}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let r=0;r<e;r++)t+=this.readChar();return t}readUtf8(e=1){return t=this.readBytes(e),Qy.decode(t);var t}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(function(e){return Zy.encode(e)}(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}const tv=[137,80,78,71,13,10,26,10],rv=[];for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;rv[e]=t}function sv(e,t){return(4294967295^function(e,t,r){let s=e;for(let e=0;e<r;e++)s=rv[255&(s^t[e])]^s>>>8;return s}(4294967295,e,t))>>>0}var nv,iv,av,ov;!function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(nv||(nv={})),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"}(iv||(iv={})),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"}(av||(av={})),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"}(ov||(ov={}));const cv=new Uint8Array(0),lv=new Uint16Array([255]),hv=255===new Uint8Array(lv.buffer)[0];class uv extends ev{constructor(e,t={}){super(e);const{checkCrc:r=!1}=t;this._checkCrc=r,this._inflator=new Rl,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=iv.UNKNOWN,this._filterMethod=av.UNKNOWN,this._interlaceMethod=ov.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<tv.length;e++)if(this.readUint8()!==tv[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${tv[e]}.`)}decodeChunk(){const e=this.readUint32(),t=this.readChars(4),r=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-r!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);if(this._checkCrc){const r=this.readUint32(),s=e+4,n=sv(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(n!==r)throw new Error(`CRC mismatch for chunk ${t}. Expected ${r}, found ${n}`)}else this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw new Error(`invalid bit depth: ${e}`);return e}(this.readUint8());const t=this.readUint8();let r;switch(this._colorType=t,t){case nv.GREYSCALE:r=1;break;case nv.TRUECOLOUR:r=3;break;case nv.INDEXED_COLOUR:r=1;break;case nv.GREYSCALE_ALPHA:r=2;break;case nv.TRUECOLOUR_ALPHA:r=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=r,this._compressionMethod=this.readUint8(),this._compressionMethod!==iv.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!=0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const r=[];this._palette=r;for(let e=0;e<t;e++)r.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){if(3===this._colorType){if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255)}}decodeiCCP(e){let t,r="";for(;"\0"!==(t=this.readChar());)r+=t;const s=this.readUint8();if(s!==iv.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const n=this.readBytes(e-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:_l(n)}}decodetEXt(e){let t,r="";for(;"\0"!==(t=this.readChar());)r+=t;this._png.text[r]=this.readChars(e-r.length-1)}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),r=this.readByte();this._png.resolution={x:e,y:t,unit:r}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._inflator.result;if(this._filterMethod!==av.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod!==ov.NO_INTERLACE)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this.decodeInterlaceNull(e)}decodeInterlaceNull(e){const t=this._png.height,r=this._png.channels*this._png.depth/8,s=this._png.width*r,n=new Uint8Array(this._png.height*s);let i,a,o=cv,c=0;for(let l=0;l<t;l++){switch(i=e.subarray(c+1,c+1+s),a=n.subarray(l*s,(l+1)*s),e[c]){case 0:pv(i,a,s);break;case 1:dv(i,a,s,r);break;case 2:fv(i,a,o,s);break;case 3:mv(i,a,o,s,r);break;case 4:gv(i,a,o,s,r);break;default:throw new Error(`Unsupported filter: ${e[c]}`)}o=a,c+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),16===this._png.depth){const e=new Uint16Array(n.buffer);if(hv)for(let t=0;t<e.length;t++)e[t]=(255&(l=e[t]))<<8|l>>8&255;this._png.data=e}else this._png.data=n;var l}}function pv(e,t,r){for(let s=0;s<r;s++)t[s]=e[s]}function dv(e,t,r,s){let n=0;for(;n<s;n++)t[n]=e[n];for(;n<r;n++)t[n]=e[n]+t[n-s]&255}function fv(e,t,r,s){let n=0;if(0===r.length)for(;n<s;n++)t[n]=e[n];else for(;n<s;n++)t[n]=e[n]+r[n]&255}function mv(e,t,r,s,n){let i=0;if(0===r.length){for(;i<n;i++)t[i]=e[i];for(;i<s;i++)t[i]=e[i]+(t[i-n]>>1)&255}else{for(;i<n;i++)t[i]=e[i]+(r[i]>>1)&255;for(;i<s;i++)t[i]=e[i]+(t[i-n]+r[i]>>1)&255}}function gv(e,t,r,s,n){let i=0;if(0===r.length){for(;i<n;i++)t[i]=e[i];for(;i<s;i++)t[i]=e[i]+t[i-n]&255}else{for(;i<n;i++)t[i]=e[i]+r[i]&255;for(;i<s;i++)t[i]=e[i]+yv(t[i-n],r[i],r[i-n])&255}}function yv(e,t,r){const s=e+t-r,n=Math.abs(s-e),i=Math.abs(s-t),a=Math.abs(s-r);return n<=i&&n<=a?e:i<=a?t:r}const vv={level:3};class wv extends ev{constructor(e,t={}){super(),this._colorType=nv.UNKNOWN,this._zlibOptions=Object.assign({},vv,t.zlib),this._png=this._checkData(e),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(tv)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(iv.DEFLATE),this.writeByte(av.ADAPTIVE),this.writeByte(ov.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(e){this.writeUint32(e.length),this.writeChars("IDAT"),this.writeBytes(e),this.writeCrc(e.length+4)}encodeData(){const{width:e,height:t,channels:r,depth:s,data:n}=this._png,i=r*e,a=(new ev).setBigEndian();let o=0;for(let e=0;e<t;e++)if(a.writeByte(0),8===s)o=Sv(n,a,i,o);else{if(16!==s)throw new Error("unreachable");o=Av(n,a,i,o)}const c=a.toArray(),l=Tl(c,this._zlibOptions);this.encodeIDAT(l)}_checkData(e){const{colorType:t,channels:r,depth:s}=function(e){const{channels:t=4,depth:r=8}=e;if(4!==t&&3!==t&&2!==t&&1!==t)throw new RangeError(`unsupported number of channels: ${t}`);if(8!==r&&16!==r)throw new RangeError(`unsupported bit depth: ${r}`);const s={channels:t,depth:r,colorType:nv.UNKNOWN};switch(t){case 4:s.colorType=nv.TRUECOLOUR_ALPHA;break;case 3:s.colorType=nv.TRUECOLOUR;break;case 1:s.colorType=nv.GREYSCALE;break;case 2:s.colorType=nv.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return s}(e),n={width:bv(e.width,"width"),height:bv(e.height,"height"),channels:r,data:e.data,depth:s,text:{}};this._colorType=t;const i=n.width*n.height*r;if(n.data.length!==i)throw new RangeError(`wrong data size. Found ${n.data.length}, expected ${i}`);return n}writeCrc(e){this.writeUint32(sv(new Uint8Array(this.buffer,this.byteOffset+this.offset-e,e),e))}}function bv(e,t){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${t} must be a positive integer`)}function Sv(e,t,r,s){for(let n=0;n<r;n++)t.writeByte(e[s++]);return s}function Av(e,t,r,s){for(let n=0;n<r;n++)t.writeUint16(e[s++]);return s}var kv,Cv,Iv,xv,Ev,Bv;function Nv(e,t){return new wv(e,t).encode()}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"}(kv||(kv={}));class Pv{static fromBER(e){const t=new this;return t.fromBER(e),t}static fromSchema(e){const t=new this;return t.fromSchema(e),t}fromBER(e){const t=Ee(st.toArrayBuffer(e));if(-1===t.offset)throw new Error(`Invalid ASN.1 data. ${t.result.error}`);this.fromSchema(t.result)}fromSchema(e){this.asn=this.onFromSchema(e)}toSchema(){return this.asn.toSchema()}toBER(){return this.toSchema().toBER()}toString(e="hex"){return at.ToString(this.toBER(),e)}}class Dv extends Pv{onFromSchema(e){return new $h({schema:e})}}class Uv{static x509ToCert(e){return Dv.fromBER(e.rawData).asn}static certTox509(e){const t=new Dv;t.asn=e;const r=t.toBER();return new la(r)}static findExtension(e,t){if(e.extensions)for(const r of e.extensions)if(r.extnID===t)return r;return null}}Uv.AUTHORITY_KEY_IDENTIFIER="2.5.29.35",Uv.SUBJECT_KEY_IDENTIFIER="2.5.29.14";class Ov extends Pv{onFromSchema(e){return e instanceof ou?(this.asn=e,e):new ou({schema:e})}get issuer(){const e=this.asn.issuer.toSchema().toBER();return new oa(e).toString()}async verify(e){try{return this.asn.verify({issuerCertificate:Uv.x509ToCert(e)})}catch(e){return!1}}}class Tv{static register(e){this.converters.push(e)}static prepareAlgorithm(e){return"string"==typeof e?{name:e}:"hash"in e&&"string"==typeof e.hash?{name:e.name,hash:{name:e.hash}}:e}static toBER(e){const t=this.prepareAlgorithm(e);for(let e=this.converters.length;e>0;e--){const r=this.converters[e-1].toBER(t);if(r)return r}throw new Error("Cannot encode Algorithm to BER format. Unsupported algorithm.")}static fromBER(e){const t=st.toArrayBuffer(e);for(let e=this.converters.length;e>0;e--){const r=this.converters[e-1].fromBER(t);if(r)return r}throw new Error("Cannot decode BER format to Algorithm. Unsupported algorithm identifier.")}}Tv.converters=[];class Rv extends Pv{constructor(){super(),Cv.set(this,void 0),this.certificateHandler=new Vv}toOCSPResponse(){const e=new Mu;e.responseStatus.valueBlock.valueDec=0;const t=e.responseBytes=new Hu;return t.responseType="1.3.6.1.5.5.7.48.1.1",t.response=new j({valueHex:this.toBER()}),e.toSchema().toBER(!1)}static fromOCSPResponse(e){const t=st.isBufferSource(e)?new Mu({schema:Ee(st.toArrayBuffer(e)).result}):e;if("1.3.6.1.5.5.7.48.1.1"===t.responseBytes.responseType){const e=Ee(t.responseBytes.response.valueBlock.valueHex),r=new Fu({schema:e.result});return Rv.fromSchema(r)}throw new Error("Incorrect OCSP response")}get certificates(){if(!bt(this,Cv,"f")){St(this,Cv,[],"f");for(const e of this.asn.certs)bt(this,Cv,"f").push(Uv.certTox509(e))}return bt(this,Cv,"f")}onFromSchema(e){return e instanceof Fu?(this.asn=e,e):new Fu({schema:e})}get signatureAlgorithm(){const e=this.asn.signatureAlgorithm.toSchema().toBER();return Tv.fromBER(e)}get signatureValue(){return this.asn.signature.valueBlock.valueHex}async verify(e){const t=await e.publicKey.export(this.signatureAlgorithm,["verify"]);return await sh().subtle.verify(this.signatureAlgorithm,t,this.signatureValue,this.asn.tbsResponseData.tbs)}}Cv=new WeakMap;class _v extends Pv{static async create(e,t,r){const s=new Tu;await s.createForCertificate(Uv.x509ToCert(t),{hashAlgorithm:"string"==typeof e?e:e.name,issuerCertificate:Uv.x509ToCert(r)});const n=new _v;return n.fromSchema(s),n}get hashAlgorithm(){const e=this.asn.hashAlgorithm.toSchema().toBER();return Tv.fromBER(e)}get issuerNameHash(){return this.asn.issuerNameHash.valueBlock.valueHex}get issuerKeyHash(){return this.asn.issuerKeyHash.valueBlock.valueHex}get serialNumber(){return at.ToHex(this.asn.serialNumber.valueBlock.valueHex)}onFromSchema(e){return e instanceof Tu?e:new Tu({schema:e})}equal(e){return this.asn.isEqual(e.asn)}}_v.DEFAULT_VIEW=new Uint8Array(0);class Vv{constructor(){this.parent=null,this.certificates=new Fa,this.crls=[],this.ocsps=[]}static async getSKI(e){const t=e.getExtension(pa);if(t)return at.FromHex(t.keyId);const r=nh();return e.publicKey.getKeyIdentifier(r)}static async isIssuerCertificate(e,t){if(e.issuer!==t.subject)return!1;const r=Uv.findExtension(Uv.x509ToCert(e),Uv.AUTHORITY_KEY_IDENTIFIER);if(r){const e=await Vv.getSKI(t);if("keyIdentifier"in r.parsedValue){if(!l(r.parsedValue.keyIdentifier.valueBlock.valueHex,e))return!1}else if("authorityCertIssuer"in r.parsedValue&&"authorityCertSerialNumber"in r.parsedValue){const e=Uv.x509ToCert(t),{authorityCertIssuer:s,authorityCertSerialNumber:n}=r.parsedValue;if(!e.subject.isEqual(s)||!e.serialNumber.isEqual(n))return!1}}try{return await e.verify({publicKey:t,signatureOnly:!0})}catch(e){return!1}}async findCertificate(e,t){if(this.parent){const r=await this.parent.findCertificate(e,t);if(r)return r}for(const r of this.certificates){if(await this.matchCertificate(r,e,t))return r}return null}async matchCertificate(e,t,r){if(t&&r){t=st.toArrayBuffer(t),r=st.toArrayBuffer(r);const s=Uv.x509ToCert(e);if(l(s.serialNumber.valueBlock.valueHex,t)&&l(s.issuer.valueBeforeDecode,r))return!0}else{t=st.toArrayBuffer(t);if(l(await Vv.getSKI(e),t))return!0}return!1}async findIssuer(e){if(this.parent){const t=await this.parent.findIssuer(e);if(t)return t}let t=null;if(await e.isSelfSigned())t=e;else for(const r of this.certificates){if(await Vv.isIssuerCertificate(e,r)){t=r;break}}return t}async isTrusted(e){if(this.parent){const t=await this.parent.isTrusted(e);if(t)return t}return{target:this,result:!1}}async findRevocation(e,t){let r;switch(e){case"crl":r=await this.findCRL(t);break;case"ocsp":r=await this.findOCSP(t);break;default:throw new Error("Unknown type of the revocation item")}return r&&r.result||!this.parent?r:this.parent.findRevocation(e,t)}async findCRL(e){for(const t of this.crls){const r=await this.findIssuer(e);if(r&&r.subject===t.issuer){if(await t.verify(r))return{result:t,target:this}}}return{result:null,target:this}}async fetchCRL(e){let t="";if(e instanceof la){const t=e.getExtension("2.5.29.31");if(t){const e=vt.parse(t.value,or);for(const t of e)if(t.distributionPoint&&t.distributionPoint.fullName)for(const e of t.distributionPoint.fullName)if(e.uniformResourceIdentifier&&e.uniformResourceIdentifier.startsWith("http")){const t=await this.fetchCRL(e.uniformResourceIdentifier);if(t.result)return t}}return{result:null,target:this}}t=e;try{const e=await this.requestCRL(t);return{result:Ov.fromBER(e),target:this}}catch(e){return{result:null,target:this,error:e instanceof Error?e:new Error("Unknown error on CRL fetching")}}return{result:null,target:this}}async requestCRL(e){if(!globalThis.fetch)throw new Error("`globalThis.fetch` is undefined.");const t=await fetch(e);if(200===t.status)return t.arrayBuffer();throw new Error(`Error on CRL requesting (HTTP status: ${t.status}).`)}async fetchRevocation(e,t){if(this.parent){const r=await this.parent.fetchRevocation(e,t);if(r&&r.result)return r}switch(e){case"crl":return this.fetchCRL(t);case"ocsp":return this.fetchOCSP(t);default:throw new Error("Unknown type of the revocation item")}}async findOCSP(e){for(const t of this.ocsps){const r=await this.findIssuer(e);if(r)for(const s of t.asn.tbsResponseData.responses){const n=new _v;n.fromSchema(s.certID);if((await _v.create(n.hashAlgorithm,e,r)).equal(n))return{result:t,target:this}}}return{target:this,result:null}}async fetchOCSP(e){const t=e.getExtension("1.3.6.1.5.5.7.1.1");if(t){const r=vt.parse(t.value,Ft);for(const t of r)if("1.3.6.1.5.5.7.48.1"===t.accessMethod&&t.accessLocation.uniformResourceIdentifier)try{const r=await this.findIssuer(e);if(r){const s=await this.createOCSPRequest(e,r,"SHA-1"),n=await this.requestOCSP(t.accessLocation.uniformResourceIdentifier,s),i=vt.parse(n,Zm);return i.responseStatus!==Jm.successful?{result:null,target:this,error:new Error(`Bad OCSP response status '${Jm[i.responseStatus]||i.responseStatus}'.`)}:{result:Rv.fromBER(i.responseBytes.response),target:this}}}catch(e){return{result:null,target:this,error:e instanceof Error?e:new Error("Unknown error on OCSP fetching")}}}return{result:null,target:this,error:new Error("Not implemented")}}async createOCSPRequest(e,t,r="SHA-256"){const s=await _v.create(r,e,t),n=sh().crypto.getRandomValues(new Uint8Array(20)),i=new zm({tbsRequest:new Gm({requestList:[new Wm({reqCert:vt.parse(s.toBER(),Vm),singleRequestExtensions:[new Mr({extnID:"1.3.6.1.5.5.7.48.1.2",extnValue:new ct(n)})]})]})});return vt.serialize(i)}async requestOCSP(e,t){if(!globalThis.fetch)throw new Error("`globalThis.fetch` is undefined.");const r=await fetch(e,{method:"POST",headers:{"content-type":"application/ocsp-request"},body:st.toArrayBuffer(t)});if(200===r.status){return await r.arrayBuffer()}throw new Error(`Error on CRL requesting (HTTP status: ${r.status}).`)}}class Fv extends Pv{get type(){return this.asn.type}get values(){return this.asn.values.map((e=>e.toBER?e.toBER():e.toSchema().toBER()))}constructor(e,t){super(),this.asn=new ql,e&&t&&(this.asn.type=e,this.asn.values=t.map((e=>{const t=Ee(st.toArrayBuffer(e));if(-1===t.offset)throw new Error("Wrong ASN.1 encoded Attribute value");this.asn.values.push(t.result)})))}onFromSchema(e){return new ql({schema:e})}}class Lv{static register(e,t){this.items.set(e,t)}static get(e){const t=this.items.get(e);return t||Fv}}Lv.items=new Map;class jv extends Fv{constructor(e=new Date){super(),this.asn.type=jv.DEFAULT_IDENTIFIER,this.asn.values.push(new me({valueDate:e}))}}jv.DEFAULT_IDENTIFIER="1.2.840.113549.1.9.5",Lv.register(jv.DEFAULT_IDENTIFIER,jv);class Hv extends Fv{constructor(e=new ArrayBuffer(0)){super(),this.asn.type=Hv.DEFAULT_IDENTIFIER,this.asn.values.push(new j({valueHex:st.toArrayBuffer(e)}))}get digest(){const e=this.asn.values[0];if(e){return vt.parse(e,ct).buffer}return new ArrayBuffer(0)}}Hv.DEFAULT_IDENTIFIER="1.2.840.113549.1.9.4",Lv.register(Hv.DEFAULT_IDENTIFIER,Hv);class Mv extends Fv{constructor(e=""){super(),this.asn.type=Mv.DEFAULT_IDENTIFIER,this.asn.values.push(new J({value:e}))}}Mv.DEFAULT_IDENTIFIER="1.2.840.113549.1.9.3",Lv.register(Mv.DEFAULT_IDENTIFIER,Mv);class Kv extends Pv{constructor(){super(),this.asn=new bh}get contentType(){return this.asn.contentType}get content(){return this.asn.content.toBER()}onFromSchema(e){return new bh({schema:e})}}Kv.CONTENT_TYPE_DATA="1.2.840.113549.1.7.1",Kv.CONTENT_TYPE_SIGNED_DATA="1.2.840.113549.1.7.2",Kv.CONTENT_TYPE_TIME_STAMP_TOKEN="1.2.840.113549.1.9.16.1.4",function(e){e[e.signerNotFound=1]="signerNotFound",e[e.emptyCertificates=2]="emptyCertificates",e[e.signerCertificateNotFound=3]="signerCertificateNotFound",e[e.dataNotFound=4]="dataNotFound",e[e.signerCertificateInvalid=5]="signerCertificateInvalid",e[e.unsupportedAlgorithm=7]="unsupportedAlgorithm",e[e.detachedDataRequired=8]="detachedDataRequired",e[e.badContentType=9]="badContentType",e[e.badMessageDigest=10]="badMessageDigest",e[e.success=14]="success",e[e.unknown=15]="unknown"}(Iv||(Iv={})),function(e){e.data="1.2.840.113549.1.7.1",e.signedData="1.2.840.113549.1.7.2",e.envelopedData="1.2.840.113549.1.7.3",e.signedAndEnvelopedData="1.2.840.113549.1.7.4"}(xv||(xv={})),function(e){e.contentType="1.2.840.113549.1.9.3",e.signingTime="1.2.840.113549.1.9.4",e.messageDigest="1.2.840.113549.1.9.5"}(Ev||(Ev={}));class qv extends Pv{constructor(){super(),this.parent=null,this.signedAttributes=[],this.unsignedAttributes=[],this.asn=new qu({version:1})}onFromSchema(e){const t=e instanceof qu?e:new qu({schema:e});return t.signedAttrs&&(this.signedAttributes=this.readAttributes(t.signedAttrs.attributes)),t.unsignedAttrs&&(this.unsignedAttributes=this.readAttributes(t.unsignedAttrs.attributes)),t}readAttributes(e){const t=[];if(e)for(const r of e){const e=new(Lv.get(r.type));e.fromBER(r.toSchema().toBER()),t.push(e)}return t}get digestAlgorithm(){const e=this.asn.digestAlgorithm.toSchema().toBER();return Tv.fromBER(e)}get signatureAlgorithm(){const e=this.asn.signatureAlgorithm.toSchema().toBER();return Tv.fromBER(e)}get signatureValue(){return this.asn.signature.valueBlock.valueHex}async verify(e,t=new Date){const r=this.getParent();return(await r.verify(e,t,this)).signers[0]}getParent(){if(!this.parent)throw new Error("CMSSignerInfo is not assigned to CMSSignedData");return this.parent}async getCertificate(){const e=this.getParent();let t=null;if(t=this.asn.sid instanceof du?await e.certificateHandler.findCertificate(this.asn.sid.serialNumber.valueBlock.valueHex,this.asn.sid.issuer.toSchema().toBER()):await e.certificateHandler.findCertificate(this.asn.sid.valueBlock.valueHex),!t)throw new Error("Unable to find signer certificate");return t}toSchema(){if(this.unsignedAttributes.length){const e=[];for(const t of this.unsignedAttributes)e.push(t.asn);this.asn.unsignedAttrs=new Ku({type:1,attributes:e})}return super.toSchema()}}class Wv extends Vv{constructor(e){super(),this.cms=e}async findCertificate(e,t){const r=[...this.certificates,...this.cms.certificates];for(const s of r){if(await this.matchCertificate(s,e,t))return s}return null}}let Gv=Bv=class{constructor(){this.type=Bv.TYPE,this.value=Bv.VALUE}};Gv.TYPE="",Gv.VALUE=new ArrayBuffer(0),wt([ft({type:Pe.ObjectIdentifier})],Gv.prototype,"type",void 0),wt([ft({type:Pe.OctetString})],Gv.prototype,"value",void 0),Gv=Bv=wt([dt({type:Ne.Sequence})],Gv);let zv=class{};wt([ft({type:Pe.Any,implicit:!1,repeated:"sequence",context:0,optional:!0})],zv.prototype,"crl",void 0),wt([ft({type:Pe.Any,implicit:!1,repeated:"sequence",context:1,optional:!0})],zv.prototype,"ocsp",void 0),wt([ft({type:Zm,implicit:!1,repeated:"sequence",context:2,optional:!0})],zv.prototype,"otherRevInfo",void 0),zv=wt([dt({type:Ne.Sequence})],zv);class Jv extends Kv{constructor(){super(),this.certificateHandler=new Wv(this),this.signers=[],this.certificates=new Fa,this.crls=[],this.signedData=new Gu({version:1,encapContentInfo:new Lu({eContentType:Kv.CONTENT_TYPE_DATA})}),this.asn.contentType=Jv.CONTENT_TYPE}onFromSchema(e){const t=super.onFromSchema(e);if(t.contentType!==Jv.CONTENT_TYPE)throw new TypeError("Content type doesn't match to Signed data");if(this.signedData=new Gu({schema:t.content}),this.signedData.signerInfos)for(const e of this.signedData.signerInfos){const t=qv.fromSchema(e.toSchema());t.parent=this,this.signers.push(t)}if(this.signedData.certificates){const e=new Fa;for(const t of this.signedData.certificates)if(t instanceof $h){const r=Uv.certTox509(t);e.push(r)}this.certificateHandler.certificates=e,this.certificates=e}if(this.signedData.crls)for(const e of this.signedData.crls)"thisUpdate"in e?(this.certificateHandler.crls.push(e),this.crls.push({type:"crl",value:e})):"1.3.6.1.5.5.7.48.1.1"===e.otherRevInfoFormat&&(this.certificateHandler.ocsps.push(Rv.fromSchema(e.otherRevInfo)),this.crls.push({type:"ocsp",value:e}));for(const e of this.signers)for(const t of e.signedAttributes)if("1.2.840.113583.1.1.8"===t.type){const e=t.values[0];if(e){const t=vt.parse(e,zv);if(t.crl)for(const e of t.crl)this.certificateHandler.crls.push(Ov.fromBER(e));if(t.ocsp)for(const e of t.ocsp)this.certificateHandler.ocsps.push(Rv.fromOCSPResponse(e))}}return t}toSchema(){if(this.certificates.length){const e=this.signedData.certificates=[];for(const t of this.certificates)e.push(Uv.x509ToCert(t))}if(this.crls.length){const e=this.signedData.crls=[];for(const t of this.crls)("crl"===t.type||"ocsp"===t.type)&&e.push(t.value)}for(const e of this.signers)e.toBER();return this.asn.content=this.signedData.toSchema(),super.toSchema()}async verify(e,t=new Date,r){const s={date:t,signatureVerified:!0,signers:[]};if(r){const n={signer:this.getSignerIndex(r),checkChain:!1,checkDate:t,extendedMode:!0};e?n.data=st.toArrayBuffer(e):this.content&&(n.data=this.signedData.encapContentInfo.eContent.valueBlock.valueHex);let i=null;const a=this.signedData.certificates;try{const e=await r.getCertificate();this.signedData.certificates=[Uv.x509ToCert(e)]}catch(e){const s=e instanceof Error?e.message:`${e}`;i={date:t,code:Iv.signerCertificateNotFound,message:s,signatureVerified:!1,signatureAlgorithm:{...r.signatureAlgorithm,hash:r.digestAlgorithm}}}if(this.signedData.certificates=a,!i)try{i=await this.signedData.verify(n)}catch(e){if("string"==typeof e)throw new Error(`Failed on PKI SignedData 'verify' method execution. ${e}`);if(e instanceof Error)throw e;i=e}if(!i)throw new Error("PKI SignedData signature verification result is empty");i.signerCertificate&&(i.signerCertificate=Uv.certTox509(i.signerCertificate)),i.signatureAlgorithm={...r.signatureAlgorithm,hash:r.digestAlgorithm},s.signers.push(i)}else for(const r of this.signers){const n=await r.verify(e,t);n.signatureVerified||(s.signatureVerified=!1),s.signers.push(n)}return s}async sign(e,t,r=new ArrayBuffer(0)){const s=this.getSignerIndex(t);await this.signedData.sign(e,s,t.digestAlgorithm.name,st.toArrayBuffer(r)),t.fromSchema(this.signedData.signerInfos[s])}getSignerIndex(e){const t=this.signers.indexOf(e);if(-1===t)throw new Error("Signer is not assigned to the current CMSSignedData");return t}createSigner(e,t={}){if(st.isBufferSource(e)){const r=new la(e);return this.createSigner(r,t)}const r=new qv,s=Uv.x509ToCert(e);if(r.asn.sid=new du({issuer:s.issuer,serialNumber:s.serialNumber}),t.signedAttributes){const e=[];for(const r of t.signedAttributes)e.push(r.asn);r.asn.signedAttrs=new Ku({type:0,attributes:e})}if(t.unsignedAttributes){const e=[];for(const r of t.unsignedAttributes)e.push(r.asn);r.asn.unsignedAttrs=new Ku({type:1,attributes:e})}const n=Ee(Tv.toBER(t.digestAlgorithm||Jv.DIGEST_ALGORITHM));return r.asn.digestAlgorithm=new Ll({schema:n.result}),r.parent=this,this.signers.push(r),this.signedData.signerInfos.push(r.asn),r}}Jv.CONTENT_TYPE=Kv.CONTENT_TYPE_SIGNED_DATA,Jv.DIGEST_ALGORITHM="SHA-1",Jv.SIGNATURE_ALGORITHM={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};class $v extends Jv{constructor(){super(...arguments),this.info=new lg}onFromSchema(e){const t=super.onFromSchema(e),r=this.signedData.encapContentInfo.eContent.valueBlock.valueHex;return this.info=vt.parse(r,lg),t}async verify(e,t=new Date,r){return{...await super.verify(e,t,r),info:this.info}}}var Yv;class Xv extends Fv{constructor(e){super(),Yv.set(this,void 0),this.asn.type=Xv.DEFAULT_IDENTIFIER,e&&(this.token=e)}get token(){return bt(this,Yv,"f")||St(this,Yv,$v.fromSchema(this.asn.values[0]),"f"),bt(this,Yv,"f")}set token(e){St(this,Yv,e,"f");const t=e.asn.toSchema();this.asn.values.length?this.asn.values[0]=t:this.asn.values.push(t)}}Yv=new WeakMap,Xv.DEFAULT_IDENTIFIER="1.2.840.113549.1.9.16.2.14",Lv.register(Xv.DEFAULT_IDENTIFIER,Xv);let Qv=class{constructor(){this.issuer=new Rt,this.serialNumber=new ArrayBuffer(0)}};wt([ft({type:Rt})],Qv.prototype,"issuer",void 0),wt([ft({type:Pe.Integer,converter:Re})],Qv.prototype,"serialNumber",void 0),Qv=wt([dt({type:Ne.Sequence})],Qv);let Zv=class{constructor(){this.hashAlgorithm=new Vr,this.certHash=new ArrayBuffer(0)}};wt([ft({type:Vr})],Zv.prototype,"hashAlgorithm",void 0),wt([ft({type:Pe.OctetString})],Zv.prototype,"certHash",void 0),wt([ft({type:Qv,optional:!0})],Zv.prototype,"issuerSerial",void 0),Zv=wt([dt({type:Ne.Sequence})],Zv);let ew=class{constructor(){this.certs=[],this.policies=[]}};wt([ft({type:Zv,repeated:"sequence"})],ew.prototype,"certs",void 0),wt([ft({type:Qt,repeated:"sequence",optional:!0})],ew.prototype,"policies",void 0),ew=wt([dt({type:Ne.Sequence})],ew);class tw extends Fv{constructor(e){super(),this.asn.type=tw.DEFAULT_IDENTIFIER,e&&(this.value=e)}static async create(e,t){const r=new Zv;r.certHash=await sh().subtle.digest(e,t.rawData),r.hashAlgorithm=vt.parse(Tv.toBER(e),Vr);const s=new ew;return s.certs.push(r),new tw(s)}set value(e){const t=gt.toASN(e);this.asn.values.length?this.asn.values[0]=t:this.asn.values.push(t)}get value(){if(this.asn.values.length)return vt.parse(this.asn.values[0].toBER(),ew);throw new Error("Attribute value is empty.")}}tw.DEFAULT_IDENTIFIER="1.2.840.113549.1.9.16.2.47 ",Lv.register(tw.DEFAULT_IDENTIFIER,tw);const rw="1.2.840.113549.1.1",sw=`${rw}.1`,nw=`${rw}.5`,iw=`${rw}.11`,aw=`${rw}.12`,ow=`${rw}.13`,cw=at.FromHex("300d06092a864886f70d0101010500"),lw=at.FromHex("300d06092a864886f70d0101050500"),hw=at.FromHex("300d06092a864886f70d01010b0500"),uw=at.FromHex("300d06092a864886f70d01010c0500"),pw=at.FromHex("300d06092a864886f70d01010d0500"),dw={name:"RSA",toBER(e){if("RSASSA-PKCS1-V1_5"===e.name.toUpperCase()){if(!("hash"in e))return cw;switch(e.hash.name){case"SHA-1":return lw;case"SHA-256":return hw;case"SHA-384":return uw;case"SHA-512":return pw}}return null},fromBER(e){const t=Ee(e);switch(new Ll({schema:t.result}).algorithmId){case sw:return{name:"RSASSA-PKCS1-v1_5"};case nw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case iw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case aw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case ow:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}}return null}};Tv.register(dw);const fw="1.2.840.10045.4",mw=`${fw}.1`,gw=`${fw}.3.2`,yw=`${fw}.3.3`,vw=`${fw}.3.4`,ww=at.FromHex("300b06072a8648ce3d04010500"),bw=at.FromHex("300c06082a8648ce3d0403020500"),Sw=at.FromHex("300c06082a8648ce3d0403030500"),Aw=at.FromHex("300c06082a8648ce3d0403040500"),kw={name:"EC",toBER(e){if("ECDSA"===e.name.toUpperCase())if("hash"in e)switch(e.hash.name){case"SHA-1":return ww;case"SHA-256":return bw;case"SHA-384":return Sw;case"SHA-512":return Aw}return null},fromBER(e){const t=Ee(e);switch(new Ll({schema:t.result}).algorithmId){case mw:return{name:"ECDSA",hash:{name:"SHA-1"}};case gw:return{name:"ECDSA",hash:{name:"SHA-256"}};case yw:return{name:"ECDSA",hash:{name:"SHA-384"}};case vw:return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.101.112":return{name:"EdDSA",namedCurve:"Ed25519"};case"1.3.101.113":return{name:"EdDSA",namedCurve:"Ed448"}}return null}};Tv.register(kw);const Cw=at.FromHex("300906052b0e03021a0500"),Iw=at.FromHex("300d06096086480165030402010500"),xw=at.FromHex("300d06096086480165030402020500"),Ew=at.FromHex("300d06096086480165030402030500"),Bw={name:"SHA",toBER(e){switch(e.name.toUpperCase()){case"SHA-1":return Cw;case"SHA-256":return Iw;case"SHA-384":return xw;case"SHA-512":return Ew}return null},fromBER(e){const t=Ee(e);switch(new Ll({schema:t.result}).algorithmId){case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"}}return null}};Tv.register(Bw);const Nw=at.FromHex("300B060960864801650304020B"),Pw=at.FromHex("300B060960864801650304020C"),Dw={name:"SHAKE",toBER(e){switch(e.name.toUpperCase()){case"SHAKE128":return Nw;case"SHAKE256":return Pw}return null},fromBER(e){const t=Ee(e);switch(new Ll({schema:t.result}).algorithmId){case"2.16.840.1.101.3.4.2.11":return{name:"shake128"};case"2.16.840.1.101.3.4.2.12":return{name:"shake256"}}return null}};var Uw,Ow,Tw,Rw,_w,Vw,Fw;Tv.register(Dw),function(e){e[e.good=0]="good",e[e.revoked=1]="revoked",e[e.unknown=2]="unknown"}(Uw||(Uw={})),function(e){e[e.unknown=-1]="unknown",e[e.success=0]="success",e[e.badKeyCertSign=3]="badKeyCertSign",e[e.badKeyCertSign2=4]="badKeyCertSign2",e[e.badCrlSign=5]="badCrlSign",e[e.badCriticalExtension=6]="badCriticalExtension",e[e.multipleEnds=7]="multipleEnds",e[e.badDate=8]="badDate",e[e.shortPath=9]="shortPath",e[e.badNameChaining=10]="badNameChaining",e[e.revocationNotFound=11]="revocationNotFound",e[e.revokedOCSP=12]="revokedOCSP",e[e.badCrlCa=13]="badCrlCa",e[e.badCA=14]="badCA",e[e.policyName=21]="policyName",e[e.policyNameConstraint=41]="policyNameConstraint",e[e.policyNameConstraint2=42]="policyNameConstraint2",e[e.policyNameConstraint3=43]="policyNameConstraint3",e[e.badPath=60]="badPath",e[e.untrusted=97]="untrusted"}(Ow||(Ow={}));class Lw{constructor(){this.certificateHandler=new Vv}async buildChainNoCheck(e){const t=new Fa;let r=e,s=null;for(;r&&(t.push(r),s=await this.certificateHandler.isTrusted(r),r.subject!==r.issuer&&!s.result);)r=await this.certificateHandler.findIssuer(r);return t}async build(e,t={}){t=Object.assign({revocationMode:"no"},t);const r=await this.buildChainNoCheck(e),s=await this.certificateHandler.isTrusted(r[r.length-1]);if(!s.result)return{chain:r,result:!1,resultMessage:"Parent certificates are not included in trusted list",resultCode:Ow.badPath};const n=t.checkDate||null;if(!n)return{chain:r,result:!0,resultCode:Ow.success,resultMessage:"Certificate chain without expiration date validation"};for(const e of r)if(e.notBefore.getTime()>n.getTime()||e.notAfter.getTime()<n.getTime())return{resultMessage:"The certificate is either not yet valid or expired",chain:r,result:!1,resultCode:Ow.badDate};const i=[];if("no"!==t.revocationMode){const e=["ocsp","crl"];t.preferCRL&&e.reverse();for(const s of r){if(s===r[r.length-1])break;let n;for(const r of e){if(n&&n.result)break;"offline"===t.revocationMode?n=await this.certificateHandler.findRevocation(r,s):"online"===t.revocationMode&&(n=await this.certificateHandler.fetchRevocation(r,s))}n&&n.result&&i.push(n.result)}}const a={checkDate:n,certs:[],trustedCerts:[],crls:[],ocsps:[]};for(const e of i)e instanceof Ov?a.crls.push(e.asn):e instanceof Rv&&a.ocsps.push(e.asn);for(const e of r)a.certs.push(Uv.x509ToCert(e));a.certs.reverse(),a.trustedCerts.push(Uv.x509ToCert(r[r.length-1]));const o=new Vu(a),c=await o.verify();return c.chain=r,c.trustListSource=s.source,c}}class jw{constructor(e,t){this.target=e,this.document=t}get id(){return this.target.getIndirect().id}}class Hw{constructor(e){this.document=e,this.DEFAULT_WIDTH=18,this.DEFAULT_HEIGHT=18,this.DEFAULT_BORDER_COLOR=0,this.DEFAULT_BORDER_WIDTH=1,this.DEFAULT_FORE_COLOR=0,this.DEFAULT_BACKGROUND_COLOR=1}getParameters(e){var t,r,s,n;const i=od.toPoint(e.left||0),a=od.toPoint(e.width||this.DEFAULT_WIDTH),o=od.toPoint(e.height||this.DEFAULT_HEIGHT);return{left:i,top:i|a|o?od.toPoint(e.top||0):0,width:a,height:o,borderColor:null!==(t=e.borderColor)&&void 0!==t?t:this.DEFAULT_BORDER_COLOR,borderWidth:od.toPoint(null!==(r=e.borderWidth)&&void 0!==r?r:this.DEFAULT_BORDER_WIDTH),backgroundColor:null!==(s=e.backgroundColor)&&void 0!==s?s:this.DEFAULT_BACKGROUND_COLOR,foreColor:null!==(n=e.foreColor)&&void 0!==n?n:this.DEFAULT_FORE_COLOR}}setStyle(e,t){const r=e.MK.get();if(r.BG=hd.toPDFArray(t.backgroundColor),t.borderWidth){const s=e.BS.get();s.S=Dd.solid,s.W=t.borderWidth,r.BC=hd.toPDFArray(t.borderColor)}this.setFontStyle(e,t)}setFontStyle(e,t){const r=new _d;r.setColor(t.foreColor),e.set("DA",this.document.target.createString(r.toString()))}}!function(e){e.xObject="XObject",e.font="Font",e.colorSpace="ColorSpace",e.extGState="ExtGState"}(Tw||(Tw={}));class Mw extends jw{constructor(){super(...arguments),this.items=[]}setResource(e){for(const t of this.items){if(t.target.equal(e.target))return t;t.name===e.name&&(e.name=Md.generate())}let t;return this.target.has(e.type)?t=this.target.get(e.type,gp):(t=this.document.target.createDictionary(),this.target.set(e.type,t)),t.set(e.name,e.target.makeIndirect()),this.items.push(e),e}get(e){const t=this.find(e);if(!t)throw new Error(`Resource '${e}' not found`);return t}createNamePrefix(e){return`${e}${this.getMaxNameIndex(e)+1}`}getMaxNameIndex(e){let t=-1;for(const[,r]of this.target.items)if(r instanceof gp)for(const[s]of r.items){const r=new RegExp(`${e}([0-9]+)`).exec(s);if(r){const e=parseInt(r[1]);e>t&&(t=e)}}return t}find(e){this.loadItems();for(const t of this.items)if(t.name===e)return t;return null}set(e,t=Md.generate()){this.loadItems();let r=null;if(e instanceof gp&&e.has("Type")){const s=e.get("Type",dp).text;"XObject"===s?r={name:t,target:e,type:Tw.xObject}:"Font"===s?r={name:t,target:e,type:Tw.font}:"ExtGState"===s&&(r={name:t,target:e,type:Tw.extGState})}if(!r)throw new TypeError("Cannot add the resource to the page. Unsupported type of the resource.");return this.setResource(r)}loadItemsFromMap(e,t){for(const[r]of e.items){const s=e.get(r);if(!s)throw new Error("Empty filed in PDF dictionary.");this.items.push({type:t,name:r,target:s})}}loadItems(){if(!this.items.length){const e=this.target.XObject,t=this.target.font,r=this.target.colorSpace;e&&this.loadItemsFromMap(e,Tw.xObject),t&&this.loadItemsFromMap(t,Tw.font),r&&this.loadItemsFromMap(r,Tw.colorSpace)}}}class Kw extends jw{constructor(e){if(super(e.fontDictionary,e.document),e.fontInfo)this.fontInfo=e.fontInfo;else if(e.fontDictionary instanceof Kf){if(!Object.values(Vy).includes(e.fontDictionary.BaseFont))throw new Error(`Cannot create fontInfo by ${e.fontDictionary.BaseFont}`);this.fontInfo=$y.createDefault(e.fontDictionary.BaseFont)}else{if(!(e.fontDictionary instanceof Mf))throw new Error("Not implemented condition");{const t=e.fontDictionary.DescendantFonts.get(0,$f),r=t.FontDescriptor.fontFile||t.FontDescriptor.fontFile2||t.FontDescriptor.fontFile3;if(!r)throw new Error(`Not found fontfile for '${e.name}'`);this.fontInfo=$y.create(r.decodeSync())}}this.name=e.name}static toFontDictionary(e){if(e instanceof xf)return e;if("Font"!==e.get("Type",dp).text)throw new Error("Incorrect PDF Dictionary type.");switch(e.get("Subtype",dp).text){case Mf.SUBTYPE:return e.to(Mf,!0);case Kf.SUBTYPE:return e.to(Kf,!0);default:throw new Error("Incorrect PDF Dictionary type.")}}addText(e){if(this.target instanceof Kf){if(yp.getMaxUnicode(e)>255&&this.target.BaseFont!==Vy.Symbol&&this.target.BaseFont!==Vy.ZapfDingbats)throw new Error("Unsupported unicodes for this default font")}}static addFont(e,t=Kw.DEFAULT_FONT){let r;return r=st.isBufferSource(t)?this.addComposite(t,e):this.addDefault(t,e),r}static findFont(e,t){const r=t.target.update.items.find((t=>{if(t.type!==xd.free&&t.value instanceof gp&&t.value.has("Type")){const r=t.value.get("Type");if(r&&r instanceof dp&&"Font"===r.text){const r=this.findFieldByName(t.value,"BaseFont");let s;if(t.value.has("FontDescriptor")&&(s=t.value.get("FontDescriptor")),r===e)return t.value;if(s){const r=t.value.get("FontDescriptor");if(this.findFieldByName(r,"FontName")===e)return t.value}}}}));return r?r.value:null}static findFieldByName(e,t){if(e.has(t)){const r=e.get(t);if(r&&r instanceof dp)return r.text}return null}static addDefault(e,t){let r,s=this.findFont(e,t);if(s||(s=Kf.create(t.target.update),s instanceof Kf&&(s.BaseFont=e),t.target.append(s)),!(s instanceof Kf))throw new Error("Default font is not of type 'Type1'");return r=$y.createDefault(e),new Kw({fontDictionary:s,document:t,fontInfo:r,name:e})}measureTextWidth(e,t){let r=0;const s=1e3/this.fontInfo.unitsPerEm;for(const t of e){const e=this.fontInfo.findGlyph(t.charCodeAt(0));r+=e?e.advanceWidth:0}return r*=s,r*t/1e3}measureTextHeight(e,t=!0){const r=1e3/this.fontInfo.unitsPerEm;return(this.fontInfo.ascent-(t?this.fontInfo.descent:0))/1e3*e*r}static addComposite(e,t){let r,s=null;st.isBufferSource(e)?(r=$y.create(e),s=t.target.createStream(e)):r=$y.createDefault(e);const n=Md.generate();r.name.fontFamily||(r.name.fontFamily=n),r.name.fullName||(r.name.fullName=n),r.name.postScriptName||(r.name.postScriptName=n);const i=this.createFont0(r,t),a=this.createCIDFont(r,i,t),o=Md.generate(),c=this.drawCMaps({cidSystemInfo:{registry:"PeculiarVentures",ordering:"UCS"},name:o,glyphs:r.glyphs}),l=t.target.createStream(c);l.set("CMapName",t.target.createName(o)),i.ToUnicode=l.makeIndirect();const h=this.createFontDescriptor(r,t,s);return a.FontDescriptor=h.makeIndirect(),i.DescendantFonts=t.target.createArray(a.makeIndirect()),new Kw({fontDictionary:i,document:t,fontInfo:r,name:i.BaseFont})}static createFont0(e,t){const r=Mf.create(t.target.update);return r.BaseFont=`PDFHLP+${e.name.postScriptName}`,r}static createCIDFont(e,t,r){const s=$f.create(r.target.update),n=this.getWidthArrayByString(e,r);s.W.set(n),s.BaseFont=t.BaseFont;const i=Jf.create(r.target.update);return i.Registry="Adobe",i.Ordering="Identity",i.Supplement=0,s.CIDSystemInfo=i,s.CIDToGIDMap=r.target.createName("Identity"),s}static createFontDescriptor(e,t,r){const s=1e3/e.unitsPerEm,n=If.create(t.target.update);return r&&(n.fontFile2=r.makeIndirect()),n.fontName=e.name.fullName,n.fontFamily=e.name.fontFamily,n.fontBBox=tf.createWithData(t.target.update,e.head.xMin*s,e.head.yMin*s,e.head.xMax*s,e.head.yMax*s),n.italicAngle=e.post.italicAngle,n.ascent=e.head.yMax*s,n.descent=e.head.yMin*s,n.capHeight=e.os2.sCapHeight*s,n.xHeight=e.os2.sxHeight*s,n.fontWeight=e.os2.usWeightClass,n.stemV=50+Math.pow(e.os2.usWeightClass/65,2),n.flags|=Rd.nonsymbolic,n.flags|=Rd.serif,n}static getWidthArrayByString(e,t){const r=[],s=1e3/e.unitsPerEm;r.push(t.target.createNumber(0));const n=t.target.createArray();r.push(n);for(const r of e.glyphs)n.push(t.target.createNumber(r.advanceWidth*s));return t.target.createArray(...r)}static drawCMaps(e){const t=new Yu;t.writeStringLine("/CIDInit /ProcSet findresource begin"),t.writeStringLine("1 dict begin"),t.writeStringLine("begincmap"),t.writeStringLine(`/CIDSystemInfo <</Registry (${e.cidSystemInfo.registry}) /Ordering (${e.cidSystemInfo.ordering}) /Supplement 0>> def`),t.writeStringLine(`/CMapName /${e.name} def`),t.writeStringLine("/CMapType 2 def"),t.writeStringLine("1 begincodespacerange"),t.writeStringLine("<0000> <FFFF>"),t.writeStringLine("endcodespacerange"),t.writeStringLine(`${e.glyphs.length} beginbfchar`);for(const r of e.glyphs)if(r.unicode.length){const e=r.index.toString(16).toUpperCase().padStart(4,"0"),s=r.unicode[0].toString(16).toUpperCase().padStart(4,"0");t.writeStringLine(`<${e}> <${s}>`)}return t.writeStringLine("endbfchar"),t.writeStringLine("endcmap"),t.writeStringLine("CMapName currentdict"),t.writeStringLine("CMap defineresource pop"),t.writeStringLine("end"),t.writeStringLine("end"),t.toArrayBuffer()}}Kw.DEFAULT_FONT=Vy.Helvetica,Kw.DEFAULT_SIZE=12,function(e){e.left="left",e.center="center",e.right="right",e.justify="justify"}(Rw||(Rw={}));class qw{constructor(e=0,t=0,r=0,s=0){this.left=e,this.top=t,this.width=r,this.height=s}}class Ww extends qw{constructor(e,t={ascent:0,descent:0,height:0},r=""){super(),this.original=e,this.text=r,this.ascent=0,this.descent=0,this.space=0,this.ascent=t.ascent,this.descent=t.descent,this.height=t.height}push(e,t){this.text+=e,this.width+=t," "===e?this.space+=t:this.space=0}}class Gw extends qw{constructor(){super(...arguments),this.items=[],this.ascent=0,this.descent=0,this.fontSize=0,this.space=0,this.leading=0}push(e){return e.text&&(e.left=this.width,e.ascent>this.ascent&&(this.ascent=e.ascent),e.descent<this.descent&&(this.descent=e.descent),this.width+=e.width,this.space=e.space,e.height>this.height&&(this.height=e.height),e.original.style.size>this.fontSize&&(this.fontSize=e.original.style.size),this.items.push(e)),e}}class zw extends qw{constructor(){super(...arguments),this.rows=[],this.leading=1}last(){return this.rows.length?this.rows[this.rows.length-1]:null}push(e){const t=this.last();let r=e.ascent;return t&&(r-=t.descent),r*=this.leading,e.top=this.height+r,e.leading=r,this.height+=e.height,this.rows.push(e),e}prepare(e=Rw.left){for(const t of this.rows){switch(e){case Rw.right:t.left=this.width-t.width+t.space;break;case Rw.center:t.left=(this.width-t.width+t.space)/2;case Rw.left:}for(const e of t.items)e.top=t.ascent-e.ascent}}}class Jw{static getDefaultStyle(e){return{size:12,color:0,strikeThrough:!1,underline:!1,...e}}static getGlyphWidth(e,t,r){const s=t.fontInfo.findGlyph(e);return(s?s.advanceWidth:0)*r.size/t.fontInfo.unitsPerEm}static getFontMetrics(e,t){const r=t.size/e.fontInfo.unitsPerEm,s=e.fontInfo.ascent*r,n=e.fontInfo.descent*r;return{ascent:s,descent:n,height:s-n}}static calculate(e){const t=od.toPoint(e.width),r=new zw;r.width=t,r.leading=e.leading||1;let s=new Gw;for(const n of e.blocks){const e=this.getDefaultStyle(n.style),i=Object.assign(n,{style:e}),a=this.getFontMetrics(n.font,e);let o=new Ww(i,a),c={text:"",width:0};for(const l of n.text){if(l===Jw.NEW_LINE_CHAR){c.text,o.push(c.text,c.width),c={text:"",width:0},s.push(o),o=new Ww(i,a),r.push(s),s=new Gw;continue}const h=this.getGlyphWidth(l.charCodeAt(0),n.font,e);t<s.width+o.width+c.width+h&&l!==Jw.SPACE_CHAR&&(c.width+h>t&&(o.push(c.text,c.width),c={text:"",width:0}),s.push(o),o=new Ww(i,a),r.push(s),s=new Gw),l===Jw.SPACE_CHAR?(c.text&&(o.push(c.text,c.width),c={text:"",width:0}),o.push(l,h)):l===Jw.MINUS_CHAR?(o.push(c.text,c.width),o.push(l,h),c={text:"",width:0}):(c.text+=l,c.width+=h)}(o.text||c.text)&&(o.push(c.text,c.width),s.push(o))}return s.items.length&&r.push(s),r.prepare(e.align),r}}Jw.NEW_LINE_CHAR="\n",Jw.SPACE_CHAR=" ",Jw.MINUS_CHAR="-",function(e){e[e.all=0]="all",e[e.stroke=1]="stroke",e[e.fill=2]="fill"}(Fw||(Fw={}));class $w extends jw{graphics(){return new Xw(this.content.graphics(),this)}text(e=!1){return new Qw(this.content.text(e),this)}clear(){return this.content.clear(),this}}class Yw{constructor(e,t){this.content=e,this.parent=t}getY(e,t=!1){return t?od.toPoint(e):this.parent.height+this.parent.bottom-od.toPoint(e)}getX(e,t=!1){return t?od.toPoint(e):this.parent.left+od.toPoint(e)}}class Xw extends Yw{modify(){this.parent.target.modify()}text(e=!1){return this.modify(),new Qw(this.content.text(e),this.parent)}graphics(){return this.modify(),new Xw(this.content.graphics(),this.parent)}state(e){this.modify();const t=this.parent.resources.set(e);return this.content.graphicsState(t.name),this}opacity(e,t=Fw.all){this.modify();const r=Sf.create(this.parent.document.target.update);t!==Fw.all&&t!==Fw.fill||(r.ca=e),t!==Fw.all&&t!==Fw.stroke||(r.CA=e);const s=this.parent.resources.set(r);return this.content.graphicsState(s.name),this}strokeColor(e){return this.modify(),this.content.setColor(e,!0),this}fillColor(e){return this.modify(),this.content.setColor(e,!1),this}fill(){return this.modify(),this.content.fill(),this}stroke(e){return this.modify(),this.content.stroke(e),this}clip(){return this.modify(),this.content.clip(),this}rotate(e){return this.modify(),this.content.rotate(e),this}scale(e,t){return this.modify(),this.content.scale(e,t),this}translate(e,t,r=!1){return e=this.getX(e,r),t=this.getY(t,r),this.modify(),this.content.translate(e,t),this}transform(e){return this.modify(),this.content.transform(e),this}lineWidth(e){return this.modify(),this.content.setLineWidth(e),this}drawObject(e){this.modify();const t=this.parent.resources.set(e.target);return this.content.drawXObject(t.name),this}drawImage(e,t,r){t=od.toPoint(t||e.width),r=od.toPoint(r||e.height);const s=Zw.create(this.parent.document,t,r);return e.target.ColorSpace instanceof Xp&&this.parent.resources.target.set("ColorSpace",this.parent.document.target.createDictionary([this.parent.resources.createNamePrefix("CS"),e.target.ColorSpace])),this.modify(),s.graphics().translate(0,r).scale(t,r).drawObject(e),this.drawObject(s)}rect(...e){var t,r;let s,n,i,a;if(2===e.length||3===e.length){const r=null!==(t=e[2])&&void 0!==t&&t;i=od.toPoint(e[0]),a=od.toPoint(e[1]),s=0,n=this.getY(0,r)-(r?0:a)}else{if(4!==e.length&&5!==e.length)throw new Error("Incorrect number of arguments");{const t=null!==(r=e[4])&&void 0!==r&&r;i=od.toPoint(e[2]),a=od.toPoint(e[3]),s=this.getX(e[0],t),n=this.getY(e[1],t)-(t?0:a)}}return this.modify(),this.content.drawRectangle(s,n,i,a),this}circle(e,t,r,s=!1){return e=this.getX(e,s),t=this.getY(t,s),this.modify(),this.content.drawCircle(e,t,r),this}pathTo(e,t,r=!1){return e=this.getX(e,r),t=this.getY(t,r),this.modify(),this.content.moveTo(e,t),this}pathLine(e,t,r=!1){return e=this.getX(e,r),t=this.getY(t,r),this.modify(),this.content.lineTo(e,t),this}pathEnd(){return this.content.pathEnd(),this}line(e,t,r,s,n=!1){return this.pathTo(e,t,n).pathLine(r,s,n)}drawText(e,t=0,r=0){if(!(e instanceof zw))return this.drawText(Jw.calculate(e),t,r);if(t=this.getX(t),r=this.getY(r),e.rows.length){const s=e.rows[0],n=this.text().move(t+s.left,r-s.ascent,!0);let i=null,a=null,o=0;for(const t of e.rows){i&&(o!==t.leading&&(o=t.leading,n.leading(t.leading)),n.nextLine().move(t.left-i.left,0,!0)),i=t;for(const e of t.items)a&&a.original===e.original||n.color(e.original.style.color).font(e.original.font,e.original.style.size),n.show(e.text),e.original.link,a=e}}return this}}class Qw extends Yw{constructor(){super(...arguments),_w.set(this,void 0),Vw.set(this,void 0)}graphics(){return new Xw(this.content.graphics(),this.parent)}font(e,t){St(this,_w,e,"f"),St(this,Vw,od.toPoint(t),"f");const r=this.parent.resources.set(bt(this,_w,"f").target);return this.content.textFont(r.name,bt(this,Vw,"f")),this}get lastFont(){if(!bt(this,_w,"f")){const e=St(this,_w,Kw.addFont(this.parent.document),"f");this.font(e,this.lastFontSize)}return bt(this,_w,"f")}get lastFontSize(){return bt(this,Vw,"f")||St(this,Vw,Kw.DEFAULT_SIZE,"f"),bt(this,Vw,"f")}show(e){const t=this.lastFont;if("Type0"===t.target.subtype){let r="";for(const s of e){const e=t.fontInfo.findGlyph(s.charCodeAt(0));r+=(e?e.index:0).toString(16).padStart(4,"0")}this.content.textShow(at.FromHex(r))}else{yp.getMaxUnicode(e)>255?this.content.textShow(at.FromString(e)):this.content.textShow(e)}return this}move(e,t,r=!1){if(e=this.getX(e,r),t=this.getY(t,r),!r){const e=this.lastFontSize,r=this.lastFont;t-=r.fontInfo.ascent/r.fontInfo.unitsPerEm*e}return this.content.textMove(e,t),this}leading(e){return this.content.textLeading(e),this}nextLine(){return this.content.textNextLine(),this}color(e){return this.content.setColor(e),this}}_w=new WeakMap,Vw=new WeakMap;class Zw extends $w{static create(e,t=0,r=0){const s=Rf.create(e.target.update).makeIndirect();return s.bBox.llX=0,s.bBox.llY=0,s.bBox.urX=od.toPoint(t),s.bBox.urY=-od.toPoint(r),new Zw(s,e)}get content(){return this.target.content}get resources(){return new Mw(this.target.Resources.get(),this.document)}get width(){const e=this.target.bBox;return Math.abs(e.urX-e.llX)}set width(e){this.target.bBox.urX=od.toPoint(e)}get height(){const e=this.target.bBox;return Math.abs(e.urY-e.llY)}set height(e){this.target.bBox.urY<0?this.target.bBox.urY-=od.toPoint(e)-this.height:this.target.bBox.urY+=od.toPoint(e)-this.height}get left(){const{llX:e,urX:t}=this.target.bBox;return Math.min(e,t)}get bottom(){const{llY:e,urY:t}=this.target.bBox;return Math.min(e,t)}}class eb extends Hw{constructor(){super(...arguments),this.ON_STATE_NAME="Yes",this.OFF_STATE_NAME="Off"}drawBox(e,t){const r=t.borderWidth/2,s=r,n=r,i=t.width-t.borderWidth,a=t.height-t.borderWidth,o=e.graphics();o.fillColor(t.backgroundColor).rect(s,n,i,a).fill(),t.borderWidth&&o.strokeColor(t.borderColor).lineWidth(t.borderWidth).rect(s,n,i,a).stroke()}getParameters(e){return{...super.getParameters(e),enabled:e.enabled||!1,value:e.value||this.ON_STATE_NAME}}drawCheck(e,t){const r=t.width-t.height>0?t.height-2*t.borderWidth:t.width-2*t.borderWidth,s=(t.width-r)/2,n=(t.height-r)/2;e.graphics().strokeColor(t.foreColor).lineWidth(t.borderWidth).pathTo(s+r/4,n+r/2).pathLine(s+r/2,n+.8*r).pathLine(s+r/1.3,n+.13*r).stroke()}createWidget(e){const t=this.document.target.update,r=zf.create(t);return this.fillField(r,e),this.fillWidget(r,e),t.catalog.AcroForm.get().addField(r),r}fillField(e,t){e.ft="Btn",e.t=this.document.target.createString(Md.generate());const r=t.enabled?t.value:this.OFF_STATE_NAME;e.V=this.document.target.createName(r)}fillWidget(e,t){const r=t.left,s=t.top-t.height;e.as=this.OFF_STATE_NAME,e.rect.llX=r,e.rect.llY=s,e.rect.urX=r+t.width,e.rect.urY=s+t.height,this.setStyle(e,t);const n=this.createOnState(t),i=this.createOffState(t);e.AP.get().N=this.document.target.createDictionary([t.value,n.target.makeIndirect()],[this.OFF_STATE_NAME,i.target.makeIndirect()])}create(e){const t=this.getParameters(e);return this.createWidget(t)}createOnState(e){const t=Zw.create(this.document,e.width,e.height);return this.drawOn(t,e),t}createOffState(e){const t=Zw.create(this.document,e.width,e.height);return this.drawOff(t,e),t}drawOff(e,t){this.drawBox(e,t)}drawOn(e,t){this.drawBox(e,t),this.drawCheck(e,t)}setFontStyle(e,t){const r=e.MK.get(),s=new _d;s.setColor(t.foreColor),r.set("PV_FC",this.document.target.createString(s.toString()))}}class tb extends jw{get width(){return this.target.Width}set width(e){this.target.Width=od.toPoint(e)}get height(){return this.target.Height}set height(e){this.target.Height=od.toPoint(e)}static create(e,t){try{if(Em.isJPEG(e))return this.createJPEG(e,t);if(xm.isPNG(e))return this.createPNG(e,t);throw new Error("Unknown type of the image.")}catch(e){throw e.message=`Cannot create PDF Image. ${e.message}`,e}}static createPNG(e,t){const r=(s=st.toUint8Array(e),new uv(s,n).decode());var s,n;const i=r.data,a=_f.create(t.target.update);if(a.Width=od.toPoint(r.width),a.Height=od.toPoint(r.height),a.BitsPerComponent=r.depth,3===r.channels){a.ColorSpace=t.target.createName("DeviceRGB");const e=new Uint8Array(i.length);let r=0,s=0;for(;r<i.length;)e[s++]=i[r++],e[s++]=i[r++],e[s++]=i[r++];a.stream=e}else if(4===r.channels){a.ColorSpace=t.target.createName("DeviceRGB");const e=i.length/4,s=new Uint8Array(3*e),n=new Uint8Array(e);let o=0,c=0,l=0;for(;o<i.length;)s[c++]=i[o++],s[c++]=i[o++],s[c++]=i[o++],n[l++]=i[o++];a.stream=s;const h=a.SMask=_f.create(t.target.update).makeIndirect();h.Width=r.width,h.Height=r.height,h.ColorSpace=t.target.createName("DeviceGray"),h.BitsPerComponent=r.depth,h.stream=n}else{if(1!==r.channels)throw new Error("Unsupported PNG type");{if(!r.palette)throw new Error("Cannot get Palette from the indexed PNG image.");a.stream=st.toUint8Array(r.data);const e=new Uint8Array(768);let s=0;for(const t of r.palette)e.set(t,s),s+=t.length;const n=t.target.createArray(t.target.createName("Indexed"),t.target.createName("DeviceRGB"),t.target.createNumber(255),t.target.createStream(e).makeIndirect()).makeIndirect();a.ColorSpace=n}}return new this(a,t)}static createJPEG(e,t){const r=Em.fromView(e);let s;switch(r.channels){case 1:s="DeviceGray";break;case 3:s="DeviceRGB";break;case 4:s="DeviceCMYK";break;default:throw new Error("Unsupported color type")}const n=_f.create(t.target.update);return n.Width=r.width,n.Height=r.height,n.ColorSpace=t.target.createName(s),n.BitsPerComponent=r.bitsPerComponent,n.addFilter(Vp.NAME),n.stream=r.data,new this(n,t)}async export(){const e=this.target.filter,t=await this.target.decode();if(e instanceof dp&&e.text===Vp.NAME||e instanceof Xp&&e.items.some(((t,r)=>e.get(r,dp).text===Vp.NAME)))return{type:"jpeg",data:t};{const e=this.target.ColorSpace;if(e instanceof Xp){const r=e.get(0),s=[];if(!(r instanceof dp&&"Indexed"===r.text))throw new Error("Unsupported type ColorSpace");{const t=e.get(1);if(!(t instanceof dp&&"DeviceRGB"===t.text))throw new Error("Unsupported base name in ColorSpace");const r=e.get(2);if(!(r instanceof ap&&255===r.value))throw new Error("Unsupported hival value in ColorSpace");const n=e.get(3);if(!(n instanceof Yp))throw n instanceof ip?new Error("Unsupported ByteString of lookup in ColorSpace"):new Error("Unsupported type of lookup in ColorSpace");{const e=await n.decode(),t=new Uint8Array(e);for(let e=0;e<t.byteLength;e++)s.push([t[e++],t[e++],t[e]])}}const n=function(e,t,r){const s=e.length*(8/t),n=new Uint8Array(3*s);let i=0,a=0;const o=new Uint8Array(s);let c=255;switch(t){case 1:c=128;break;case 2:c=192;break;case 4:c=240;break;case 8:c=255;break;default:throw new Error("Incorrect depth value")}for(const r of e){let e=c,s=8;for(;e;)s-=t,o[a++]=(r&e)>>s,e>>=t}for(const e of o){const t=r[e];if(!t)throw new Error("Incorrect index of palette color");n.set(t,i),i+=3}return n}(new Uint8Array(t),this.target.BitsPerComponent||1,s);return{type:"png",data:Nv({data:n,height:this.target.Height,width:this.target.Width,channels:3,depth:8}).buffer}}if(e instanceof dp){let r=1;switch(e.text){case"DeviceGray":r=1;break;case"DeviceRGB":r=3;break;case"DeviceCMYK":r=4;break;default:throw new Error("Unsupported ColorSpace name")}let s=new Uint8Array(t);if(this.target.SMask){r++;const n=await this.target.SMask.decode(),i=new Uint8Array(n),a=new Uint8Array(t.byteLength+n.byteLength);let o=0,c=0;for(let t=0;t<s.length;t++)a[c++]=s[t],"DeviceRGB"===e.text&&(a[c++]=s[++t],a[c++]=s[++t]),a[c++]=i[o++];s=a}return{type:"png",data:Nv({data:s,height:this.target.Height,width:this.target.Width,channels:r,depth:this.target.BitsPerComponent}).buffer}}throw new Error("ColorSpace is empty")}}}function rb(e,t=!1,r=!1){return(s,n)=>{Object.defineProperty(s,n,{get:function(){let r=0;if(t){r=fb.getField(this.target).ff}else r=this.target.f;return!((r&e)!==e)},set:function(s){this[n]!==s&&(s?t?fb.getField(this.target).ff|=e:this.target.f|=e:t?fb.getField(this.target).ff^=e:this.target.f^=e,r&&this.paint())}})}}function sb(e,t=!1){return rb(e,!0,t)}function nb(e,t=!1){return rb(e,!1,t)}class ib extends jw{get name(){return fb.getField(this.target).t.text}get left(){return this.target.rect.urX}set left(e){const t=od.toPoint(e),r=this.width;this.target.rect.modify(),this.target.rect.llX=t,this.target.rect.urX=t+r}get top(){if(this.target.p){return this.target.p.to(uf).mediaBox.urY-this.target.rect.urY}return this.target.rect.urY}set top(e){let t=od.toPoint(e);const r=this.width;t=this.target.p?this.target.p.to(uf).mediaBox.urY-t:t,this.target.rect.modify(),this.target.rect.llY=t-r,this.target.rect.urY=t}get width(){return this.target.rect.urX-this.target.rect.llX}set width(e){const t=od.toPoint(e);this.width!==t&&(this.target.rect.urX=this.target.rect.llX+t,this.onWidthChanged())}onWidthChanged(){}get height(){return this.target.rect.urY-this.target.rect.llY}set height(e){const t=od.toPoint(e);this.height!==t&&(this.target.rect.llY+=this.height-t,this.target.rect.urY=this.target.rect.llY+t,this.onHeightChanged())}onHeightChanged(){}get borderWidth(){var e;if(this.target.BS.has()){return null!==(e=this.target.BS.get().W)&&void 0!==e?e:1}return 1}set borderWidth(e){const t=od.toPoint(e);this.borderWidth!==t&&(this.target.BS.get().W=t,this.onBorderWidthChanged())}onBorderWidthChanged(){}get borderColor(){if(this.target.MK.has()){const e=this.target.MK.get();if(e.BC)return hd.fromPDFArray(e.BC)}return 0}set borderColor(e){const t=hd.toPDFArray(e);this.target.MK.get().BC=t,this.onBorderColorChanged()}onBorderColorChanged(){}get backgroundColor(){if(this.target.MK.has()){const e=this.target.MK.get();if(e.BG)return hd.fromPDFArray(e.BG)}return 1}set backgroundColor(e){const t=hd.toPDFArray(e);this.target.MK.get().BG=t,this.onBorderColorChanged()}onBackgroundColorChanged(){}get foreColor(){try{let e=null;if(this.target.has("DA")?e=this.target.get("DA",np):this.target.MK.has()&&this.target.MK.get().has("PV_FC")&&(e=this.target.MK.get().get("PV_FC",np)),e){const t=_d.fromString(e.text).operators.find((e=>e instanceof ld&&ib.COLOR_OPERATORS.includes(e.name)));if(t instanceof ld)return hd.fromPDFNumberArray(t.parameters)}}catch(e){}return 0}set foreColor(e){const t=(new _d).setColor(e);this.target.MK.get().set("PV_FC",this.document.target.createString(t.toString())),this.onForeColorChanged()}onForeColorChanged(){}delete(){const e=this.target.p;if(e&&e.annots){const t=e.annots.indexOf(this.target);-1!==t&&e.annots.splice(t,1)}}paint(){}}ib.COLOR_OPERATORS=["g","rg","k"],wt([nb(Bd.hidden)],ib.prototype,"hidden",void 0),wt([nb(Bd.invisible)],ib.prototype,"invisible",void 0),wt([nb(Bd.locked)],ib.prototype,"locked",void 0),wt([nb(Bd.lockedContents)],ib.prototype,"lockedContents",void 0),wt([nb(Bd.noRotate)],ib.prototype,"noRotate",void 0),wt([nb(Bd.noView)],ib.prototype,"noView",void 0),wt([nb(Bd.noZoom)],ib.prototype,"noZoom",void 0),wt([nb(Bd.print)],ib.prototype,"print",void 0),wt([nb(Bd.readOnly)],ib.prototype,"readOnlyAnnot",void 0),wt([nb(Bd.toggleNoView)],ib.prototype,"toggleNoView",void 0),wt([sb(fd.required)],ib.prototype,"required",void 0),wt([sb(fd.readOnly)],ib.prototype,"readOnly",void 0),wt([sb(fd.noExport)],ib.prototype,"noExport",void 0);class ab extends ib{get checked(){return"Off"!==this.target.as}set checked(e){if(this.checked!==e){const t=e?this.getYesStateName():"Off";this.target.modify(),this.target.items.has("V")&&this.target.items.set("V",this.document.target.createString(t)),this.target.as=t}}get value(){return this.getYesStateName()}onWidthChanged(){this.paint()}onHeightChanged(){this.paint()}onBorderWidthChanged(){this.paint()}onBorderColorChanged(){this.paint()}onBackgroundColorChanged(){this.paint()}onForeColorChanged(){this.paint()}getHandler(){return this.document.checkBoxHandler}paint(){const e=this.target.AP.get(!0);if(e.N instanceof gp)for(const[t]of e.N.items){const r=e.N.get(t);if(r instanceof Yp){const e=r.to(Rf,!0),s=new Zw(e,this.document);s.width=this.width,s.height=this.height;const n={left:this.left,top:this.top,height:this.height,width:this.width,foreColor:this.foreColor,backgroundColor:this.backgroundColor,borderColor:this.borderColor,borderWidth:this.borderWidth},i=this.getHandler();s.clear(),"Off"===t?i.drawOff(s,n):i.drawOn(s,n)}}}getYesStateName(){const e=this.target.AP.get(!0);if(e.N instanceof gp){for(const[t]of e.N.items)if("Off"!==t)return t;throw new Error("Cannot get Yes state")}throw new Error("Unsupported type of N field")}}class ob extends ab{get checked(){return super.checked}set checked(e){if(e!==this.checked){const t=this.findGroup(),r=e?this.getYesStateName():"Off";if(this.target.as=r,t&&t.selected&&t.selected!==r){t.get(t.selected).checked=!1}t&&(t.target.V=e?this.document.target.createName(r):null)}}getHandler(){return this.document.radioButtonHandler}get groupName(){const e=this.findGroup();return e?e.name:null}set groupName(e){if(e){this.document.radioButtonHandler.getOrCreateGroup(e).attach(this)}}findGroup(){const e=this.target.Parent;return e?new lb(e,this.document):null}}class cb extends jw{[Symbol.iterator](){let e=0;const t=this,r=this.target.Kids.has()?this.target.Kids.get():[];return{next:()=>e<r.length?{done:!1,value:t.get(e++)}:{done:!0,value:null}}}delete(){var e;const t=null===(e=this.document.target.update.catalog)||void 0===e?void 0:e.AcroForm;if(t&&t.has()){const e=t.get().Fields,r=e.indexOf(this.target);-1!==r&&e.splice(r,1)}for(const e of this)e.delete()}get(e){if(this.target.Kids.has()){const t=this.target.Kids.get(),r=fb.create(t.get(e,Gf,!0),this.document);if(r instanceof ib)return r;throw new Error("Cannot load form component from PDF Widget.")}throw new RangeError("PDF Array is empty")}attach(e){if(e.groupName===this.name)return;if(e.groupName&&e.groupName!==this.name){const t=e.findGroup();t&&t.detach(e)}this.target.Kids.get().push(e.target.makeIndirect()),e.target.Parent=this.target;const t=this.document.target.update.catalog.AcroForm.get().Fields;-1===t.indexOf(this.target)&&t.push(this.target.makeIndirect())}indexOf(e){if(e.groupName===this.name){const t=this.target.Kids.get();for(let r=0;r<t.length;r++){const s=t.get(r);if(e.target.equal(s))return r}}return-1}detach(e){const t=this.indexOf(e);if(t>-1){const r=this.get(t);return this.onDetach(r),this.target.Kids.get().splice(t,1),e.target.Parent=null,this.length||this.delete(),!0}return!1}onDetach(e){}get length(){return this.target.Kids.has()?this.target.Kids.get().length:0}get name(){return this.target.t.text}set name(e){this.target.t.text=e}}class lb extends cb{get(e){if(this.length){if("number"==typeof e)return super.get(e);for(const t of this)if(e===t.value)return t;throw new Error("Cannot load RadioButton component from PDF Widget.")}throw new RangeError("PDF Array is empty")}onDetach(e){e.checked=!1}get selected(){return this.target.V instanceof dp?this.target.V.text:null}}class hb extends ib{get text(){return this.target.has("V")?this.target.get("V",np).text:""}set text(e){this.text!==e&&(this.target.set("V",this.document.target.createString(e)),this.paint())}get maxLen(){return this.target.has("MaxLen")?this.target.get("MaxLen",ap).value:0}set maxLen(e){this.maxLen!==e&&(this.target.set("MaxLen",this.document.target.createNumber(e)),this.text.length>e&&(this.text=this.text.substr(0,e)))}get font(){if(this.target.has("DA")){const e=this.target.get("DA",np).text,t=_d.fromString(e);for(const e of t.operators)if(e instanceof ld&&"Tf"===e.name){const t=e.parameters[0].text,r=this.target.AP.get().N;if(r instanceof gp){const e=new Zw(r.to(Rf),this.document).resources.get(t);if(!(e.target instanceof gp))throw new TypeError;const s=Kw.toFontDictionary(e.target);return new Kw({document:this.document,fontDictionary:s,name:t})}break}}let e="";const t=this.document.addFont(),r=this.target.AP.get().N;if(r instanceof gp){e=new Zw(r.to(Rf),this.document).resources.set(t.target).name}return new Kw({document:this.document,fontDictionary:t.target,name:e})}set font(e){if(!this.target.has("DA")||this.font.name!==e.name){let t="";const r=this.target.AP.get().N;if(r instanceof gp){t=new Zw(r.to(Rf),this.document).resources.set(e.target).name}const s=new Kw({document:this.document,fontDictionary:e.target,name:t});this.setDA(s,this.fontSize,this.textColor)}}get fontSize(){if(this.target.has("DA")){const e=this.target.get("DA",np).text,t=_d.fromString(e);for(const e of t.operators)if(e instanceof ld&&"Tf"===e.name){return e.parameters[1].value}}return Kw.DEFAULT_SIZE}set fontSize(e){this.target.has("DA")&&this.fontSize===e||this.setDA(this.font,e,this.textColor)}get textColor(){if(this.target.has("DA")){const e=this.target.get("DA",np).text,t=_d.fromString(e);for(const e of t.operators)if(e instanceof ld&&ib.COLOR_OPERATORS.includes(e.name)){return hd.fromPDFNumberArray(e.parameters)}}return 0}set textColor(e){this.target.has("DA")&&this.textColor===e||this.setDA(this.font,this.fontSize,e)}setDA(e,t,r){const s=new _d;s.setColor(r),s.setFontAndSize({font:e.name,size:od.toPoint(t)}),this.target.set("DA",this.document.target.createString(s.toString(!0))),this.paint()}onWidthChanged(){this.paint()}onHeightChanged(){this.paint()}paint(){const e=this.target.AP.get(!0);if(e.N instanceof Yp){const t=e.N.to(Rf,!0),r=new Zw(t,this.document);r.width=this.width,r.height=this.height;const s={font:this.font,fontSize:this.fontSize,color:this.textColor,multiline:this.multiline,text:this.text,maxLen:this.maxLen,width:this.width,height:this.height},n=this.document.textEditorHandler;r.clear(),n.drawText(r,s)}}}wt([sb(Ad.multiline,!0)],hb.prototype,"multiline",void 0),wt([sb(Ad.doNotScroll)],hb.prototype,"doNotScroll",void 0),wt([sb(Ad.doNotSpellCheck)],hb.prototype,"doNotSpellCheck",void 0);class ub extends ib{get groupName(){const e=this.findGroup();return e?e.name:null}set groupName(e){if(e){this.document.signatureBoxHandler.getOrCreateGroup(e).attach(this)}}findGroup(){const e=this.target.Parent;return e?new pb(e,this.document):this.target.has("FT")?new pb(this.target.to(Yd),this.document):null}getGroup(){const e=this.findGroup();if(!e)throw Error("Cannot sign document. SignatureBox is not assigned to the Signature field.");return e}draw(e){const t=this.getAppearance();t.target.modify();const r=t.clear().graphics(),s=this.width/e.width,n=this.height/e.height,i=Math.min(s,n);return s<n?r.translate(0,(this.height-e.height*i)/2):r.translate((this.width-e.width*i)/2,0),r.scale(i,i).drawObject(e),this}async sign(e){return this.getGroup().sign(e)}async verify(e){return this.getGroup().verify(e)}getAppearance(){const e=this.target.AP.get().N,t=e instanceof Yp?e.to(Rf,!0):Rf.create(this.target.documentUpdate).makeIndirect();return new Zw(t,this.document)}onWidthChanged(){this.onSizeChange()}onHeightChanged(){this.onSizeChange()}onSizeChange(){const e=this.getAppearance();e.width=this.width,e.height=-this.height}}class pb extends cb{get isSigned(){return!!this.target.V}async sign(e){const t=this.target.documentUpdate;if(!t)throw new Error("Document update is empty");const r=t.document,s=t.catalog.AcroForm.get(),n=$d.create(t),i=n.ByteRange.get(),a=r.createNumber(0,10),o=r.createNumber(0,10),c=r.createNumber(0,10),l=r.createNumber(0,10);i.push(a),i.push(o),i.push(c),i.push(l),n.Contents.text=at.ToHex(new Uint8Array(e.containerSize||pb.CONTAINER_SIZE));const h=e.dictionaryUpdate||pb.dictionaryUpdate;await h.call(this,n),this.target.V=n.makeIndirect(!1);let u=null;for(const t of this)if(t.width&&t.height){if(!u){if(!e.createImage)throw new Error("Signature box requires visual content.");u=e.createImage.call(this)}t.draw(u)}s.SigFlags|=Ud.signaturesExist,s.SigFlags|=Ud.appendOnly,await r.toPDF(),o.value=n.Contents.view.byteOffset,o.view.set(new Uint8Array(at.FromBinary(o.toString()))),c.value=n.Contents.view.byteOffset+n.Contents.view.length,c.view.set(new Uint8Array(at.FromBinary(c.toString()))),l.value=r.view.length-1-c.value,l.view.set(new Uint8Array(at.FromBinary(l.toString())));const p=[r.view.subarray(a.value,a.value+o.value),r.view.subarray(c.value,c.value+l.value)],d=new Uint8Array(p.map((e=>e.length)).reduce(((e,t)=>e+t)));let f=0;for(const e of p)d.set(e,f),f+=e.length;const m=await e.containerCreate.call(this,d);if(m.byteLength>n.Contents.text.length/2)throw new Error(`Received Contents value is greater than allocated buffer. Allocated buffer must be ${m.byteLength}.`);return n.Contents.text=at.ToHex(m).padEnd(n.Contents.text.length,"0"),n.Contents.view.set(new Uint8Array(at.FromBinary(n.Contents.toString()))),await this.document.save(),this}getContent(){const e=this.getSignatureValue();if(!e.ByteRange.has())throw new Error("Required field ByteRange is missed in Signature dictionary");const t=e.ByteRange.get().items.map((e=>e.value)),r=[],s=this.target.documentUpdate.document.view;for(let e=0;e<t.length;e++){const n=t[e++],i=t[e];r.push(new Uint8Array(s.buffer,n,i))}const n=new Uint8Array(r.map((e=>e.length)).reduce(((e,t)=>e+t)));let i=0;for(const e of r)n.set(e,i),i+=e.length;return n}async thumbprint(e=this.document.crypto){const t=this.getSignatureValue(),r=await(e||sh()).subtle.digest("SHA-1",t.Contents.data);return at.ToHex(r).toUpperCase()}getSignatureValue(){if(!this.target.V)throw new Error("The current signature field is not signed yet.");return this.target.V}async verify(e){const t=new Date;e||(e=t),await fb.getField(this.target).t.decode();const r={verificationResult:!1,signedData:null,hasSHA1:!1,name:this.name,reason:null,location:null,signingTime:null,checkDate:e,signatureType:"signature",signerCertificate:null,states:[]};try{const s=this.getSignatureValue(),n=r.signedData=this.getSignedData(s),i=this.getSigner(n),a=this.getContent();let o="ETSI.RFC3161"===s.subFilter?"timestamp":"signature";if("signature"===o){const e=s.reference;if(e)for(const t of e)if(t.transformMethod){o="certified";break}}const c=await this.getTimeStamp(n),l=await this.getSigningTime(n instanceof $v?n:c);r.name=this.name,r.reason=s.Reason.has()?await s.Reason.get().decode():null,r.location=s.Location.has()?await s.Location.get().decode():null,r.signingTime=l,r.signatureType=o;const h=this.verifyFormatting(s);r.states.push(h);const u=await i.verify(a,e),p=await this.verifyModification(u);r.states.push(p);const d=await this.isLTV(n);if("timestamp"!==o){const e=await this.verifySigningTime(n,s,t);r.states.push(e)}if(u.signerCertificate){r.signerCertificate=u.signerCertificate;const t=new Lw;let s;switch(t.certificateHandler.parent=n.certificateHandler,d?(s=await t.build(u.signerCertificate,{checkDate:l||e,revocationMode:"offline"}),s.resultCode===Ow.revocationNotFound?(r.states.push(this.makeLtvState(!1,s.resultMessage)),s=await t.build(u.signerCertificate,{checkDate:e,revocationMode:"online"})):r.states.push(this.makeLtvState(!0))):(r.states.push(this.makeLtvState(!1,"PDF document doesn't have revocation items")),s=await t.build(u.signerCertificate,{checkDate:e,revocationMode:"online"})),s.result){case!0:r.states.push({type:"valid",text:"The signer's identity has been verified",code:"identity_verification",data:{state:"verified",...s}});break;case!1:r.verificationResult=!1,r.reason="The signer's identity has not been verified",r.states.push({type:"invalid",text:r.reason,code:"identity_verification",data:{state:"not_verified",...s}});break;default:r.verificationResult=!1,r.reason="Signer's identity has not yet been verified",r.states.push({type:"info",text:r.reason,code:"identity_verification",data:{state:"not_verified",...s}})}r.verificationResult=!!u.signatureVerified}}catch(e){if(e instanceof Object?("signerCertificate"in e&&(r.signerCertificate=e.signerCertificate),"message"in e&&(r.message=e.message,"Validation of signer's certificate failed: No valid certificate paths found"===r.message&&(r.message="The signer's certificate was issued by a untrusted certificate authority",r.states.push({type:"invalid",text:"The signer's certificate was issued by a untrusted certificate authority",code:"untrusted_cert_authority",data:{certificate:r.signerCertificate,certChain:r.certificatePath}}))),"type"in e&&r.states.push(e)):(r.states.push({type:"invalid",text:`Document is corrupted and can not be read ${e}`,code:"document_corrupted",data:{error:e}}),r.message=e),r.message&&r.states.push({type:"invalid",text:r.message,code:"error",data:{error:r.message,stack:e.stack}}),e instanceof Object==!1)return r;if("signatureVerified"in e)switch(e.signatureVerified){case!0:r.states.push({type:"valid",text:"The document has not been modified since it was signed",code:"document_modification",data:{state:"not_modified"}});break;case!1:r.states.push({type:"invalid",text:"The document has been modified since it was signed",code:"document_modification",data:{state:"modified"}});break;default:r.states.push({type:"invalid",text:"The integrity of the document is unknown",code:"document_modification",data:{state:"error"}})}if("signerCertificateVerified"in e)switch(e.signerCertificateVerified){case!0:r.states.push({type:"valid",text:"The signer's identity has been verified",code:"identity_verification",data:{state:"verified"}});break;case!1:r.states.push({type:"invalid",text:"The signer's identity has not been verified",code:"identity_verification",data:{state:"not_verified"}});break;default:r.states.push({type:"invalid",text:"Status of the signer's identity validation is unknown",code:"identity_verification",data:{state:"error"}})}}return r}async getAllLtvRevocations(e){const t=[];if(e.crls)for(const r of e.crls)"crl"===r.type?t.push(Ov.fromSchema(r.value)):"ocsp"===r.type&&t.push(Rv.fromSchema(r.value));for(const r of e.signers){for(const e of r.signedAttributes)if("1.2.840.113583.1.1.8"===e.type){const r=e.values[0];if(r){const e=vt.parse(r,zv);if(e.crl)for(const r of e.crl)t.push(Ov.fromBER(r));if(e.ocsp)for(const r of e.ocsp)t.push(Rv.fromOCSPResponse(r))}}const e=await this.thumbprint(),s=this.document.dss.findVri(e);if(s&&s.CRL.has()){const e=s.CRL.get();for(const r of e)if(r instanceof Yp){const e=r.decodeSync();t.push(Ov.fromBER(e))}}if(s&&s.OCSP.has()){const e=s.OCSP.get();for(const r of e)if(r instanceof Yp){const e=r.decodeSync();t.push(Rv.fromOCSPResponse(e))}}}return t}makeLtvState(e,t){return e?{type:"info",text:"Signature is LTV enabled",code:"ltv",data:{state:e}}:{type:"info",text:"Signature is not LTV enabled",code:"ltv",data:{state:e,reason:t}}}async verifySigningTime(e,t,r){const s=await this.getTimeStamp(e),n=this.getSigner(e);if(s){s.certificateHandler.parent=e.certificateHandler;const t=await s.verify(n.asn.signature.valueBlock.valueHex,r),i={type:"valid",text:"The signature includes an embedded timestamp",code:"signing_time",data:{type:"embedded",date:s.info.genTime,signature:t,info:t.info}},a=t.signers[0];if(a&&a.signerCertificate&&(i.data.signer=a.signerCertificate),t.signatureVerified&&a&&a.signerCertificate){const e=new Lw;e.certificateHandler.parent=s.certificateHandler,i.data.signer=a.signerCertificate,i.data.chain=await e.build(a.signerCertificate,{checkDate:r,revocationMode:"online"})}return t.signatureVerified&&i.data.chain&&i.data.chain.resultCode===Ow.badDate?i.text+=" but it is expired":t.signatureVerified&&i.data.chain&&i.data.chain.result||(i.type="invalid",i.text+=" but it is invalid"),i}if(t.signingTime){return{type:"info",text:"Signing time is from the clock on the signer's computer",code:"signing_time",data:{type:"local",date:t.signingTime.getDate()}}}return{type:"info",text:"Signing time is not available",code:"signing_time",data:{type:"empty"}}}getSignedData(e){const t=("ETSI.RFC3161"===e.subFilter?$v:Jv).fromBER(e.Contents.data);return t.certificateHandler.parent=this.document.certificateHandler,t}getSigner(e){if(1!==e.signers.length)throw new Error("Cannot get SignerInfo from SignedData. Incorrect amount of signers, must be one.");return e.signers[0]}async getTimeStamp(e){const t=e.signers[0].unsignedAttributes.find((e=>e instanceof Xv));if(t)return t.token;{const e=await this.thumbprint(),t=this.document.dss.findVri(e);if(t&&t.TS){const e=await t.TS.decode();return $v.fromBER(e)}}return null}async getSigningTime(e){return e?e.info.genTime:this.target.V&&this.target.V.signingTime?this.target.V.signingTime.getDate():null}verifyFormatting(e){try{if(this.document.target.wrongStructure)return{type:"warn",code:"formatting",text:"Document structure doesn't match PDF specification.",data:{}};const t=e.ByteRange.get(!0),r=e.Contents.view;if(!e.documentUpdate)throw new Error("Cannot get the document update object.");const s=e.documentUpdate.view,n=0===t.get(0,ap).value,i=t.get(1,ap).value===r.byteOffset,a=t.get(2,ap).value,o=a===r.byteOffset+r.length,c=s.byteOffset+s.length-(r.byteOffset+r.length),l=t.get(3,ap).value;let h=!1;if(l===c)h=!0;else if(l>c){const t=e.documentUpdate.document.view.slice(a+c,a+l),r=new $u(t);h=r.read((e=>!zu.whiteSpaceChars.includes(e))).length===t.length}if(!(n&&i&&o&&h))throw new Error("The range of bytes points to an incorrect data.")}catch(e){return{type:"invalid",code:"formatting",text:"There are errors in formatting",data:{error:e instanceof Error?e:new Error("Unknown error")}}}return{type:"valid",code:"formatting",text:"There are not errors in formatting",data:{}}}async verifyModification(e){switch(e.signatureVerified){case!0:return{type:"valid",text:"The document has not been modified since it was signed",code:"document_modification",data:{state:"not_modified"}};case!1:return{type:"invalid",text:"The document has been modified since it was signed",code:"document_modification",data:{state:"modified"}};default:{let t="There are errors in formatting or information contained in this signature";return e.message&&(t=e.message),{type:"invalid",text:t,code:"document_modification",data:{state:"error"}}}}}async isLTV(e){const t=await this.thumbprint(),r=this.document.dss.findVri(t);if(r){if(r.CRL.has()&&r.CRL.get().length||r.OCSP.has()&&r.OCSP.get().length)return!0}else if(this.document.dss.crls.length||this.document.dss.ocsps.length)return!0;if(e.crls.length)return!0;for(const t of e.signers)for(const e of t.signedAttributes)if("1.2.840.113583.1.1.8"===e.type){const t=e.values[0];if(t){const e=vt.parse(t,zv);if(e.crl&&e.crl.length||e.ocsp&&e.ocsp.length)return!0}}return!1}}pb.CONTAINER_SIZE=2048,pb.SUB_FILTER="ETSI.CAdES.detached",pb.dictionaryUpdate=async function(e){e.subFilter=pb.SUB_FILTER};class db extends ib{get image(){if(this._image)return this._image;if(this.target.AP.has()){const e=this.target.AP.get().N;if(e instanceof gp){const t=e.to(Rf);if(t.Resources.has()){const e=t.Resources.get();if(e.XObject&&e.XObject.items.size){const t=[...e.XObject.items.keys()][0],r=e.XObject.get(t);if(r instanceof gp&&r.has("Subtype")&&"Image"===r.get("Subtype",dp).text)return new tb(r.to(_f),this.document)}}}}return null}set image(e){if(this._image===e)return;const t=this.document.target.update,r=Rf.create(t);if(e){r.bBox.urX=e.width,r.bBox.urY=e.height;const t=new Mw(r.Resources.get(),this.document).set(e.target),s=new _d;s.graphicsBegin().concatMatrix(e.width,0,0,e.height,0,0).drawXObject(t.name).graphicsEnd(),r.stream=s.toUint8Array(),this.target.MK.get().I=r.makeIndirect(),this.target.AP.get().N=r}else this.target.MK.get().delete("I"),this.target.AP.get().N=r.makeIndirect();this._image=e}}class fb{static getField(e){return e.Parent?new Kd(e.Parent):new Kd(e)}static createFromWidget(e,t){const r=this.getField(e);if("Tx"===r.ft)return new hb(e,t);if("Btn"===r.ft){if(r.ff&md.radio)return new ob(e,t);if(r.ff&md.pushbutton&&e.A.has()){const r=e.A.get();if("JavaScript"===r.s&&r.has("JS")&&r.get("JS",np).text.includes("buttonImportIcon"))return new db(e,t)}return new ab(e,t)}return"Sig"===r.ft?new ub(e,t):new ib(e,t)}static createFromField(e,t){if(e.has("Subtype")){if(e.get("Subtype",dp).text===Gf.SUBTYPE)return this.createFromWidget(e.to(Gf),t)}else if(e.Kids.has())if("Btn"===e.ft){if(e.ff&md.radio)return new lb(e.to(qd),t)}else if("Sig"===e.ft)return new pb(e.to(Yd),t);throw new TypeError("Unsupported type of interactive form object")}static create(e,t){if(e.has("FT"))return this.createFromField(new Kd(e),t);if(e.has("Subtype"))return this.createFromWidget(new Gf(e),t);throw new TypeError("Cannot create PDF Form Component. Wrong type of PDF Dictionary")}}class mb extends Hw{constructor(){super(...arguments),this.DEFAULT_WIDTH=0,this.DEFAULT_HEIGHT=0}createGroup(e){const t=Yd.create(this.document.target.update);return t.t=this.document.target.createString(e),this.document.target.update.catalog.AcroForm.get().Fields.push(t.makeIndirect()),new pb(t,this.document)}getOrCreateGroup(e){let t=this.document.getComponentByName(e);if(t||(t=this.createGroup(e)),!(t instanceof pb))throw new TypeError(`Component group already exists '${e}'. It doesn't match to SignatureBoxGroup type.`);return t}create(e){const t=this.document.target.update,r=this.getParameters(e),s=r.left,n=r.top-r.height,i=e.groupName||Md.generate(),a=this.getOrCreateGroup(i),o=Gf.create(t);o.f=Bd.print,o.rect.llX=s,o.rect.llY=n,o.rect.urX=s+r.width,o.rect.urY=n+r.height,a.target.Kids.get().push(o.makeIndirect()),o.Parent=a.target.makeIndirect();const c=Rf.create(t);return c.bBox.urX=r.width,c.bBox.urY=-r.height,o.AP.get().N=c.makeIndirect(),o}}var gb,yb,vb,wb,bb,Sb,Ab,kb,Cb;!function(e){e[e.base=0]="base",e[e.ascent=1]="ascent",e[e.descent=2]="descent"}(vb||(vb={}));class Ib extends $w{constructor(){super(...arguments),gb.set(this,void 0),yb.set(this,void 0)}get content(){return bt(this,yb,"f")||St(this,yb,this.getContentStream(),"f"),bt(this,yb,"f").content}get resources(){return bt(this,gb,"f")||St(this,gb,new Mw(this.target.resources,this.document),"f"),bt(this,gb,"f")}get width(){return this.target.mediaBox.get(2,ap).value}get height(){return this.target.mediaBox.get(3,ap).value}get left(){return this.target.mediaBox.llX}get bottom(){return this.target.mediaBox.llY}addCheckBox(e={}){e.top=this.height-od.toPoint(e.top||0);const t=this.document.checkBoxHandler.create(e);this.target.addAnnot(t);const r=new ab(t,this.document);return r.print=!0,e.enabled&&(r.checked=!0),r}addRadioButton(e){e.top=this.height-od.toPoint(e.top||0);const t=e.group||Md.generate(),r=this.document.radioButtonHandler.getOrCreateGroup(t),s=this.document.radioButtonHandler.create(e);this.target.addAnnot(s);const n=new ob(s,this.document);return n.print=!0,r.attach(n),e.enabled&&(n.checked=!0),n}addTextEditor(e){e.top=this.height-od.toPoint(e.top||0);const t=this.document.textEditorHandler.create(e);this.target.addAnnot(t);const r=new hb(t,this.document);return r.print=!0,r}getContentStream(){let e=null,t=this.target.contents;if(t instanceof Yp)e=new jd(t);else if(t||(t=this.target.contents=this.document.target.createArray()),t.length){const r=t.get(t.length-1);if(!(r instanceof Yp))throw new TypeError("Wrong type of PDF object in Page Contents.");e=new jd(r),t.items[t.length-1]=e}else e=jd.create(this.document.target.update),t.push(e);if(e.documentUpdate!==this.document.target.update)if(e=jd.create(this.document.target.update),t instanceof Yp){const r=this.document.target.createArray();this.target.contents=r,r.push(t),r.push(e)}else t.push(e);return e}addInputImageBox(e){e.top=this.height-od.toPoint(e.top||0);const t=this.document.inputImageHandler.create(e);this.target.addAnnot(t);const r=new db(t,this.document);return r.image=e.image||null,r}addSignatureBox(e={}){e.top=this.height-od.toPoint(e.top||0);const t=this.document.signatureBoxHandler.create(e);return this.target.addAnnot(t),new ub(t,this.document)}addWatermark(e){return this.target.addAnnot(e.target),e}}gb=new WeakMap,yb=new WeakMap,function(e){e[e.portrait=0]="portrait",e[e.landscape=1]="landscape"}(wb||(wb={}));class xb extends jw{get length(){return this.target.count}get(e){const t=this.target.kids.get(e,uf);return new Ib(t,this.document)}create({orientation:e=wb.portrait,width:t="210mm",height:r="297mm"}={}){const s=uf.create(this.target.documentUpdate);return s.mediaBox=e===wb.portrait?s.createMediaBox(t,r):s.createMediaBox(r,t),this.target.addPage(s),new Ib(s,this.document)}indexOf(e){return this.target.indexOf(e.target)}insertBefore(e,t=this.last()){this.target.insertBefore(e.target,null==t?void 0:t.target)}remove(e){this.target.remove("number"==typeof e?e:e.target)}first(){return this.length?this.get(0):null}last(){return this.length?this.get(this.length-1):null}}class Eb extends eb{constructor(){super(...arguments),this.POINT_SIZE=.5}getParameters(e){return{...super.getParameters(e),value:e.value,group:e.group||Md.generate()}}createGroup(e){const t=qd.create(this.document.target.update);return t.ft="Btn",t.ff=md.radio,t.t=this.document.target.createString(e),this.document.target.update.catalog.AcroForm.get().Fields.push(t.makeIndirect()),new lb(t,this.document)}getOrCreateGroup(e){let t=this.document.getComponentByName(e);if(t||(t=this.createGroup(e)),!(t instanceof lb))throw new TypeError(`Cannot set RadioBaton to the group '${e}'. Group is not a RadioButtonGroup component.`);return t}createWidget(e){const t=this.document.target.update,r=Gf.create(t);return this.fillWidget(r,e),r}fillField(e,t){t.enabled&&(e.V=this.document.target.createName(t.value))}drawCheck(e,t){const r=((t.width-t.height>0?t.height:t.width)-2*t.borderWidth)*this.POINT_SIZE;e.graphics().fillColor(t.foreColor).circle(t.width/2,t.height/2,r/2).fill()}drawBox(e,t){const r=t.width-t.height>0?t.height:t.width;e.graphics().fillColor(t.backgroundColor).circle(t.width/2,t.height/2,r/2).fill().strokeColor(t.borderColor).lineWidth(t.borderWidth).circle(t.width/2,t.height/2,(r-t.borderWidth)/2).stroke(!0)}create(e){return super.create(e)}}class Bb{constructor(e){this.document=e}getSingleLineText(e){return e.replace(/\n/g," ")}drawText(e,t){var r;null!==(r=t.fontSize)&&void 0!==r||(t.fontSize=Kw.DEFAULT_SIZE);const s=t.font.fontInfo,n=t.fontSize/s.unitsPerEm,i=s.ascent*n,a=s.descent*n,o=Bb.PADDING,c=o,l=t.multiline?o:(e.height-i+a)/2+o,h=e.text(!0).graphics().rect(o,o,e.width-2*o,e.height-2*o).clip().pathEnd().text();if(t.multiline)h.graphics().drawText({width:t.width,blocks:[{text:t.text,font:t.font,style:{color:t.color,size:t.fontSize}}]},c,l);else{h.color(t.color||Bb.COLOR).font(t.font,t.fontSize).move(c,l);const e=this.getSingleLineText(t.text);h.show(e)}}create(e){var t,r,s;let n=e.text;e.maxLen&&e.maxLen>0&&(n=n.substr(0,e.maxLen));const i=this.document.target.update,a=od.toPoint(e.width),o=od.toPoint(e.height),c=od.toPoint(null!==(t=e.left)&&void 0!==t?t:0),l=od.toPoint(null!==(r=e.top)&&void 0!==r?r:o)-o;e.font||(e.font=Kw.addFont(this.document)),e.font.addText(n),null!==(s=e.fontSize)&&void 0!==s||(e.fontSize=Kw.DEFAULT_SIZE),e.color||(e.color=0);const h=zf.create(i);h.ft="Tx",e.multiline&&(h.ff=Ad.multiline),h.set("MaxLen",new ap(e.maxLen||Bb.MAX_LEN)),h.t=this.document.target.createString(Md.generate()),h.V=this.document.target.createString(n),h.rect.llX=c,h.rect.llY=l,h.rect.urX=c+a,h.rect.urY=l+o;const u=Zw.create(this.document,a,-o),p=u.resources.set(e.font.target),d=(new _d).setFontAndSize({font:p.name,size:e.fontSize});d.setColor(e.color),h.set("DA",this.document.target.createString(d.toString(!0))),this.drawText(u,{font:e.font,fontSize:e.fontSize,text:n,height:e.height,width:e.width,color:e.color,multiline:e.multiline,maxLen:e.maxLen}),h.AP.get().N=u.target.makeIndirect();return i.catalog.AcroForm.get().addField(h),h}}Bb.PADDING=1,Bb.COLOR=0,Bb.MAX_LEN=0;class Nb{constructor(e){this.document=e}create(e){var t,r;const s=this.document.target.update,n=od.toPoint(e.width||0),i=od.toPoint(e.height||0),a=od.toPoint(null!==(t=e.left)&&void 0!==t?t:0),o=od.toPoint(null!==(r=e.top)&&void 0!==r?r:i)-i,c=zf.create(s);c.ft="Btn",c.ff=md.pushbutton,c.t=this.document.target.createString(Md.generate()),c.rect.llX=a,c.rect.llY=o,c.rect.urX=a+n,c.rect.urY=o+i;const l=c.MK.get();l.tp=Pd.noCaption,e.alt&&(l.ca=this.document.target.createString(e.alt));const h=c.A.get();h.s="JavaScript",h.set("JS",this.document.target.createString("event.target.buttonImportIcon();"));return s.catalog.AcroForm.get().addField(c),c}}class Pb extends jw{static create(e,t){var r,s;e.top=od.toPoint(e.pageHeight)-od.toPoint(e.top||this.DEFAULT_0);const n=Xf.create(t.target.update),i=od.toPoint(null!==(r=e.left)&&void 0!==r?r:0),a=od.toPoint(null!==(s=e.top)&&void 0!==s?s:e.appearance.height)-e.appearance.height;if(n.AP.get().N=e.appearance.target.makeIndirect(),e.v||e.h||e.matrix){const r=Yf.create(t.target.update);e.v&&(r.V=e.v),e.h&&(r.H=e.h),e.matrix&&r.Matrix.set(e.matrix),n.FixedPrint=r.makeIndirect()}return n.rect=tf.create(t.target.update),n.rect.llX=i,n.rect.llY=a,n.rect.urX=i+e.appearance.width,n.rect.urY=a+e.appearance.height,e.flags&&(n.f=e.flags),new this(n,t)}}Pb.DEFAULT_0=0;class Db extends jw{constructor(e,t){if(super(e,t),bb.set(this,[]),Sb.set(this,[]),Ab.set(this,[]),e.Certs.has()){const t=bt(this,bb,"f");for(const r of e.Certs.get())if(r instanceof Yp){const e=new la(r.decodeSync());t.push(e)}}if(e.CRLs.has()){const t=bt(this,Sb,"f");for(const r of e.CRLs.get())if(r instanceof Yp)try{const e=Ov.fromBER(r.decodeSync());t.push(e)}catch(e){}}if(e.OCSPs.has()){const t=bt(this,Ab,"f");for(const r of e.OCSPs.get())if(r instanceof Yp)try{const e=r.decodeSync(),s=Rv.fromOCSPResponse(e);t.push(s)}catch(e){}}}get certs(){return bt(this,bb,"f")}get crls(){return bt(this,Sb,"f")}get ocsps(){return bt(this,Ab,"f")}static get(e){const t=e.target.update.catalog;if(t&&t.DSS)return new Db(t.DSS,e);const r=Wd.create(e.target.update);return new Db(r,e)}addToCatalog(){const e=this.document.target.update.catalog;if(e&&!e.DSS){if(this.document.version!==Cb.v2_0){const t=e.Extensions.get();if(!t.ADBE.has()){const e=t.ADBE.get();e.BaseVersion="1.7",e.ExtensionLevel=5}}e.DSS=this.target.makeIndirect()}}add(e,t){if(this.addToCatalog(),st.isBufferSource(e))try{const r=new la(e);this.pushCert(r,t)}catch(r){try{const r=Ov.fromBER(e);this.pushCrl(r,t)}catch(r){try{const r=Rv.fromBER(e);this.pushOcsp(r,t)}catch(e){throw new Error("Unsupported type")}}}else e instanceof la?this.pushCert(e,t):e instanceof Ov?this.pushCrl(e,t):e instanceof Rv&&this.pushOcsp(e,t)}addTimeStamp(e,t){if(t=t.toUpperCase(),st.isBufferSource(e))return this.addTimeStamp($v.fromBER(e),t);this.addToCatalog();let r=this.findVri(t);r||(r=ef.create(this.document.target),this.target.VRI.get().set(t,r)),r.TS=this.document.target.createStream(e.toBER())}findVri(e){if(this.document.dss.target.VRI.has()){const t=this.document.dss.target.VRI.get();if(t.has(e))return t.get(e,ef)}return null}createPDFStream(e){const t=Yp.create(this.document.target.update);return t.stream=st.toUint8Array(e),t}pushCert(e,t){let r=null;const s=this.target.Certs.get();for(const t of s)if(t instanceof Yp&&st.isEqual(t.decodeSync(),e.rawData)){r=t;break}if(r||(r=this.createPDFStream(e.rawData).makeIndirect(),s.push(r),bt(this,bb,"f").push(e)),t){t=t.toUpperCase();const e=this.target.VRI.get(),s=e.has(t)?e.get(t,ef,!0):ef.create(this.document.target.update);s.Cert.get().push(r),e.set(t,s)}return r}pushCrl(e,t){let r=null;const s=this.target.CRLs.get();for(const t of s)if(t instanceof Yp&&st.isEqual(t.decodeSync(),e.toBER())){r=t;break}if(r||(r=this.createPDFStream(e.toBER()).makeIndirect(),s.push(r),bt(this,Sb,"f").push(e)),t){t=t.toUpperCase();const e=this.target.VRI.get(),s=e.has(t)?e.get(t,ef,!0):ef.create(this.document.target.update);s.CRL.get().push(r),e.set(t,s)}return r}pushOcsp(e,t){let r=null;const s=this.target.OCSPs.get(),n=e.toOCSPResponse();for(const e of s)if(e instanceof Yp&&st.isEqual(e.decodeSync(),n)){r=e;break}if(r||(r=this.createPDFStream(n).makeIndirect(),s.push(r),bt(this,Ab,"f").push(e)),t){t=t.toUpperCase();const e=this.target.VRI.get(),s=e.has(t)?e.get(t,ef,!0):ef.create(this.document.target.update);s.OCSP.get().push(r),e.set(t,s)}return r}}bb=new WeakMap,Sb=new WeakMap,Ab=new WeakMap;class Ub extends Vv{constructor(e){super(),this.document=e}async load(){await this.loadCertificates(),await this.loadCRLs(),await this.loadOCSPs()}findDSS(){const e=this.document.target.update;return e.catalog&&e.catalog.DSS?e.catalog.DSS:null}async loadCertificates(){this.certificates=new Fa,await this.loadCertificatesFromDSS()}async loadCertificatesFromDSS(){const e=this.findDSS();if(e&&e.Certs.has())for(const t of e.Certs.get())if(t instanceof Yp){const e=await t.decode();this.certificates.push(new la(e))}}loadCertificatesFromSignatures(){const e=this.document.target.update.catalog;if(e&&e.AcroForm.has()){const t=e.AcroForm.get();if(t.SigFlags)for(const e of t.Fields)if(e instanceof gp&&e.has("FT")){if(e.get("FT",dp).text===Yd.FIELD_TYPE&&e.has("V")){const t=e.get("V",$d);if(t.Contents.text){const e=Jv.fromBER(t.Contents.data);this.certificates.push(...e.certificates)}}}}}async loadCRLs(){this.crls=[...this.document.dss.crls]}async loadOCSPs(){this.ocsps=[...this.document.dss.ocsps]}}!function(e){e[e.v1_1=1.1]="v1_1",e[e.v1_2=1.2]="v1_2",e[e.v1_3=1.3]="v1_3",e[e.v1_4=1.4]="v1_4",e[e.v1_5=1.5]="v1_5",e[e.v1_6=1.6]="v1_6",e[e.v1_7=1.7]="v1_7",e[e.v2_0=2]="v2_0"}(Cb||(Cb={}));class Ob{constructor(e){if(this.target=e,kb.set(this,void 0),this.fonts=[],!e.update.catalog)throw new Error("PDF document doesn't have Catalog object");this.version=e.version,this.pages=new xb(e.update.catalog.Pages,this),this.checkBoxHandler=new eb(this),this.textEditorHandler=new Bb(this),this.radioButtonHandler=new Eb(this),this.signatureBoxHandler=new mb(this),this.inputImageHandler=new Nb(this),this.certificateHandler=new Ub(this),this.crypto=sh()}static async create({version:e=Cb.v2_0,useXrefTable:t=!1,disableAscii85Encoding:r=!1,disableCompressedStreams:s=!1,disableCompressedObjects:n=!1}={}){const i=new km;return i.version=e,i.options.xref=t?wm.Table:wm.Stream,i.options.disableAscii85Encoding=r,i.options.disableCompressedStreams=s,i.options.disableCompressedObjects=n,e<Cb.v1_5&&(i.options.xref=wm.Table),i.update.addCatalog(),new Ob(i)}static async load(e){"string"==typeof e&&(e=at.FromBinary(e));const t=await km.fromPDF(e);await t.createUpdate();const r=new Ob(t);return await r.certificateHandler.load(),r}get dss(){return bt(this,kb,"f")||St(this,kb,Db.get(this),"f"),bt(this,kb,"f")}addFont(e){return Kw.addFont(this,e)}async save(){const e=await this.target.toPDF();return await this.target.createUpdate(),e}createImage(e){return tb.create(e,this)}createWatermark(e){return Pb.create(e,this)}getComponents(){var e;const t=[],r=null===(e=this.target.update.catalog)||void 0===e?void 0:e.AcroForm;if(r&&r.has()){const e=r.get().Fields;for(const r of e)if(r instanceof gp){const e=r.to(Kd);try{const r=fb.create(e,this);t.push(r)}catch(e){}}}return t}filterComponents(...e){const t=this.getComponents(),r=[];for(const s of t)for(const t of e)s instanceof t&&r.push(s);return r}getComponentByName(e,t){var r;const s=null===(r=this.target.update.catalog)||void 0===r?void 0:r.AcroForm;let n=null;if(s&&s.has()){const t=s.get().Fields;for(const r of t)if(r instanceof gp){const t=r.to(Kd);try{const r=fb.create(t,this);if(r.name===e){n=r;break}}catch(e){}}}if(t&&!(n instanceof t))throw new TypeError("Cannot get PDF Component from the Document. Component doesn't require to the requested type.");return n}getComponentById(e,t,r){let s=null;try{const r=this.target.update.getObject(e,t).value;r instanceof gp&&(s=fb.create(r,this))}catch(e){}if(r&&!(s instanceof r))throw new TypeError("Cannot get PDF Component from the Document. Component doesn't require to the requested type.");return s}createForm(e,t){return Zw.create(this,e,t)}get isSigned(){var e;const t=null===(e=this.target.update.catalog)||void 0===e?void 0:e.AcroForm;return!!(t&&t.has()&&t.get().SigFlags)}getSignatures(){return this.filterComponents(pb,ub)}async sign(e){let t=null;if(e.groupName&&(t=this.getComponentByName(e.groupName,pb)),!t){t=this.pages.get(0).addSignatureBox({groupName:e.groupName}).findGroup()}if(!t)throw new Error("Cannot get Signature filed for signing.");return t.sign(e)}async verify(){const e={err:null,items:[]};for(const t of this.getSignatures()){const r=await t.verify();e.items.push(r)}return e}}function Tb(e){return(t,r)=>{Object.defineProperty(t,r,{get:function(){return!!(this.target.flags&e)},set:function(t){t?this.target.flags|=e:this.target.flags^=e}})}}kb=new WeakMap;class Rb extends jw{}wt([Tb(Rd.fixedPitch)],Rb.prototype,"fixedPitch",void 0),wt([Tb(Rd.serif)],Rb.prototype,"serif",void 0),wt([Tb(Rd.symbolic)],Rb.prototype,"symbolic",void 0),wt([Tb(Rd.script)],Rb.prototype,"script",void 0),wt([Tb(Rd.nonsymbolic)],Rb.prototype,"nonsymbolic",void 0),wt([Tb(Rd.italic)],Rb.prototype,"italic",void 0),wt([Tb(Rd.allCap)],Rb.prototype,"allCap",void 0),wt([Tb(Rd.smallCap)],Rb.prototype,"smallCap",void 0),wt([Tb(Rd.forceBold)],Rb.prototype,"forceBold",void 0);function _b(e,t){return Tv.register({name:t,fromBER:r=>{try{if(vt.parse(r,Vr).algorithm===e)return{name:t}}catch{}return null},toBER:r=>{if(r.name===t){const t=new Vr({algorithm:e});return vt.serialize(t)}return null}})}function Vb(e,t){return Tv.register({name:`ECDSA+${t}`,fromBER:r=>{try{if(vt.parse(r,Vr).algorithm===e)return{name:"ECDSA",hash:{name:t}}}catch{}return null},toBER:r=>{if("hash"in r&&r.hash.name===t){const t=new Vr({algorithm:e});return vt.serialize(t)}return null}})}_b("2.16.840.1.101.3.4.2.11","SHAKE128"),_b("2.16.840.1.101.3.4.2.12","SHAKE256"),_b("2.16.840.1.101.3.4.2.8","SHA3-256"),_b("2.16.840.1.101.3.4.2.8","SHA3-256"),_b("2.16.840.1.101.3.4.2.9","SHA3-384"),_b("2.16.840.1.101.3.4.2.10","SHA3-512"),Vb("2.16.840.1.101.3.4.3.10","SHA3-256"),Vb("2.16.840.1.101.3.4.3.11","SHA3-384"),Vb("2.16.840.1.101.3.4.3.12","SHA3-512"),ea.set(crypto),rh("PDF crypto",crypto,new class extends eh{constructor(e={}){super(e)}getOIDByAlgorithm(e){switch(e.name.toLowerCase()){case"SHA3-256".toLowerCase():return"2.16.840.1.101.3.4.2.8";case"SHA3-384".toLowerCase():return"2.16.840.1.101.3.4.2.9";case"SHA3-512".toLowerCase():return"2.16.840.1.101.3.4.2.10";case"shake128":return"2.16.840.1.101.3.4.2.11";case"shake256":return"2.16.840.1.101.3.4.2.12";case"ecdsa":if("namedCurve"in e)switch(e.namedCurve.toLowerCase()){case"brainpoolP256r1":return"1.3.36.3.3.2.8.1.1.7";case"brainpoolP384r1":return"1.3.36.3.3.2.8.1.1.11";case"brainpoolP512r1":return"1.3.36.3.3.2.8.1.1.13"}return super.getOIDByAlgorithm(e);case"eddsa":if("namedCurve"in e)switch(e.namedCurve.toLowerCase()){case"ed25519":return"1.3.101.112";case"ed448":return"1.3.101.113"}return super.getOIDByAlgorithm(e)}return super.getOIDByAlgorithm(e)}getSignatureParameters(e,t="SHA-1"){const r=new Ll,s=this.getAlgorithmParameters(e.algorithm.name,"sign");switch(s.algorithm={...s.algorithm,hash:{name:t}},e.algorithm.name.toUpperCase()){case"ECDSA":switch(t.toUpperCase()){case"SHA3-256":r.algorithmId="2.16.840.1.101.3.4.3.10";break;case"SHA3-384":r.algorithmId="2.16.840.1.101.3.4.3.11";break;case"SHA3-512":r.algorithmId="2.16.840.1.101.3.4.3.12";break;default:return super.getSignatureParameters(e,t)}break;case"EDDSA":r.algorithmId=this.getOIDByAlgorithm(e.algorithm);break;default:return super.getSignatureParameters(e,t)}return{signatureAlgorithm:r,parameters:s}}getAlgorithmByOID(e){const t=super.getAlgorithmByOID(e);if(!t||!t.name)switch(e){case"1.3.36.3.3.2.8.1.1.7":return{name:"ECDSA",namedCurve:"brainpoolP256r1"};case"1.3.36.3.3.2.8.1.1.11":return{name:"ECDSA",namedCurve:"brainpoolP384r1"};case"1.3.36.3.3.2.8.1.1.13":return{name:"ECDSA",namedCurve:"brainpoolP512r1"};case"1.3.101.112":return{name:"EdDSA",namedCurve:"Ed25519"};case"1.3.101.113":return{name:"EdDSA",namedCurve:"Ed448"};case"2.16.840.1.101.3.4.2.11":return{name:"shake128"};case"2.16.840.1.101.3.4.2.12":return{name:"shake256"};case"2.16.840.1.101.3.4.2.8":return{name:"SHA3-256"};case"2.16.840.1.101.3.4.2.9":return{name:"SHA3-384"};case"2.16.840.1.101.3.4.2.10":return{name:"SHA3-512"};case"2.16.840.1.101.3.4.3.10":return{name:"ECDSA",hash:"SHA3-256"};case"2.16.840.1.101.3.4.3.11":return{name:"ECDSA",hash:"SHA3-384"};case"2.16.840.1.101.3.4.3.12":return{name:"ECDSA",hash:"SHA3-512"}}return t}async getPublicKey(e,t,r){null===r&&(r=this.fillPublicKeyParameters(e,t));const s=e.toSchema().toBER(!1),n=new Uint8Array(s);try{switch(r.algorithm.algorithm.name.toLowerCase()){case"ecdsa":{const t={name:"ECDSA",namedCurve:"P-256"};switch(e.algorithm.algorithmParams.valueBlock.toString()){case"1.2.840.10045.3.1.7":t.namedCurve="P-256";break;case"1.3.36.3.3.2.8.1.1.7":t.namedCurve="brainpoolP256r1";break;case"1.3.36.3.3.2.8.1.1.11":t.namedCurve="brainpoolP384r1";break;case"1.3.132.0.34":t.namedCurve="P-384";break;case"1.3.36.3.3.2.8.1.1.13":t.namedCurve="brainpoolP512r1";break;case"1.3.132.0.35":t.namedCurve="P-521"}return this.subtle.importKey("spki",n,t,!0,["verify"])}case"eddsa":{const t=this.getAlgorithmByOID(e.algorithm.algorithmId);return this.subtle.importKey("spki",n,t,!0,["verify"])}}}catch(e){}return super.getPublicKey(e,t,r)}getAlgorithmParameters(e,t){const r=super.getAlgorithmParameters(e,t)||{};if(!r.algorithm.name&&"eddsa"===e.toLowerCase())switch(r.algorithm={name:"EdDSA"},t.toLowerCase()){case"importkey":case"verify":r.usages=["verify"];break;case"sign":r.usages=["sign"]}return r}async digest(e,t){if(e instanceof Object){if("md5"===e.name.toLowerCase())return Cm(t,0,t.length)}else if("md5"===e.toLowerCase())return Cm(t,0,t.length);return super.digest(e,t)}async generateKey(...e){if("rc4"===e[0].name.toLowerCase()){const t=new Uint8Array(e[0].length);return ih(t),Promise.resolve(t.buffer)}return super.generateKey(...e)}async encrypt(...e){return"rc4"===e[0].name.toLowerCase()?Im(e[1],e[2]):super.encrypt(...e)}decrypt(...e){switch(e[0].name.toLowerCase()){case"rc4":return Im(e[1],e[2]);case"aes-cbc":if("pad"in e[0])return async function(e,t,r,s){const n=s.byteLength,i=new Uint8Array(s),a=16-n%16,o=s.slice(n-16,n),c=new ArrayBuffer(a),l=new Uint8Array(c);for(let e=0;e<a;e++)l[e]=a;const h=await e.encrypt({name:t.name,length:t.length,iv:o},r,c),u=new Uint8Array(h),p=new ArrayBuffer(n+a),d=new Uint8Array(p);d.set(i,0);for(let e=0;e<a;e++)d[n+e]=u[e];return e.decrypt(t,r,p)}(this.subtle,e[0],e[1],e[2])}return super.decrypt(...e)}}({crypto:crypto,subtle:crypto.subtle}));const Fb=document.getElementById("pdf_file"),Lb=document.getElementById("verify"),jb=document.getElementById("report");Lb.addEventListener("click",(()=>{(async()=>{if(Fb.files&&Fb.files[0]){const e=new FileReader,t=await new Promise(((t,r)=>{e.readAsArrayBuffer(Fb.files[0]),e.onerror=t=>{r(e.error)},e.onload=r=>{t(e.result)}}));await async function(e){const t=await Ob.load(e);t.certificateHandler.parent=new Hb;const r=await t.verify();console.log(r),void(jb.innerHTML=""),r.err&&Kb("error",r.err.message);if(r.items.length){const e=r.items[0];if(Mb("Common"),Kb("Check date:",e.checkDate?.toString()||"none"),e.location&&Kb("Location:",e.location),e.reason&&Kb("Reason:",e.reason),Kb("Signature type:",e.signatureType),e.signerCertificate&&(Kb("Signer:",e.signerCertificate.subject),Kb("Issuer:",e.signerCertificate.issuer)),e.signedData){const t=e.signedData.signers[0];Mb("Algorithms"),Kb("Digest mechanism:",t.digestAlgorithm.name),Kb("Signature mechanism:",`${t.signatureAlgorithm.name}${"hash"in t.signatureAlgorithm?` with ${t.signatureAlgorithm.hash.name}`:""}`),e.signerCertificate&&"namedCurve"in e.signerCertificate.publicKey.algorithm&&Kb("Named curve:",e.signerCertificate.publicKey.algorithm.namedCurve)}Mb("States");for(const t of e.states)Kb(t.code,t.data.resultMessage?`${t.text}. ${t.data.resultMessage}`:t.text)}else Kb("info","Signature not found")}(t)}else alert("PDF file is not selected")})().catch((e=>console.error(e)))}));class Hb extends Vv{async isTrusted(e){return{target:this,result:await e.isSelfSigned()}}}function Mb(e){const t=document.createElement("tr");t.classList.add("group");const r=document.createElement("td");r.setAttribute("colspan","2"),r.textContent=e,t.append(r),jb.append(t)}function Kb(e,t){const r=document.createElement("tr"),s=document.createElement("td");s.textContent=e;const n=document.createElement("td");n.textContent=t,r.append(s),r.append(n),jb.append(r)}
