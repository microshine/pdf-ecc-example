function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function asyncGeneratorStep(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){asyncGeneratorStep(i,n,a,o,u,"next",e)}function u(e){asyncGeneratorStep(i,n,a,o,u,"throw",e)}o(void 0)}))}}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)},_wrapNativeSuper(e)}function _construct(e,t,r){return _construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(a,r.prototype),a},_construct.apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=_superPropBase(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var liner=function(e,t,r){"use strict";var n;function a(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var i=a(t),o=a(r),u={};"undefined"!=typeof self&&(u=self),e.nativeCrypto=u.msCrypto||u.crypto||{},e.nativeSubtle=null;try{e.nativeSubtle=(null===e.nativeCrypto||void 0===e.nativeCrypto?void 0:e.nativeCrypto.subtle)||(null===e.nativeCrypto||void 0===e.nativeCrypto?void 0:e.nativeCrypto.webkitSubtle)||null}catch(e){console.warn("Cannot get subtle from crypto",e)}var s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){var t=this.toUint8Array(e);return t.byteOffset||t.length?t.buffer.slice(t.byteOffset,t.byteOffset+t.length):t.buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if("undefined"!=typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e))return new t(e.buffer,e.byteOffset,e.byteLength);if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var n=e.toUint8Array(t),a=e.toUint8Array(r);if(n.length!==a.byteLength)return!1;for(var i=0;i<n.length;i++)if(n[i]!==a[i])return!1;return!0}}]),e}(),c=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fromString",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}},{key:"toString",value:function(e){for(var t=s.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return decodeURIComponent(escape(r))}}]),e}(),l=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=s.toArrayBuffer(e),n=new DataView(r),a="",i=0;i<r.byteLength;i+=2){var o=n.getUint16(i,t);a+=String.fromCharCode(o)}return a}},{key:"fromString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ArrayBuffer(2*e.length),n=new DataView(r),a=0;a<e.length;a++)n.setUint16(2*a,e.charCodeAt(a),t);return r}}]),e}(),h=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isHex",value:function(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}},{key:"isBase64",value:function(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{key:"isBase64Url",value:function(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=s.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return l.toString(r,!0);case"utf16":case"utf16be":return l.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return l.fromString(e,!0);case"utf16":case"utf16be":return l.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=s.toUint8Array(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.FromBinary(t);case"utf8":return c.fromString(t);case"utf16":case"utf16be":return l.fromString(t);case"utf16le":case"usc2":return l.fromString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"ToUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.ToBinary(t);case"utf8":return c.toString(t);case"utf16":case"utf16be":return l.toString(t);case"utf16le":case"usc2":return l.toString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=s.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return r}},{key:"ToHex",value:function(e){for(var t=s.toUint8Array(e),r=[],n=t.length,a=0;a<n;a++){var i=t[a].toString(16).padStart(2,"0");r.push(i)}return r.join("")}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var n=new Uint8Array(r.length/2),a=0;a<r.length;a+=2){var i=r.slice(a,a+2);n[a/2]=parseInt(i,16)}return n.buffer}},{key:"ToUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.toString(e,t)}},{key:"FromUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.fromString(e,t)}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}]),e}();function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),a=new Uint8Array(n),i=0;return t.map((function(e){return new Uint8Array(e)})).forEach((function(e){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;a[i++]=n}}catch(e){r.e(e)}finally{r.f()}})),a.buffer}function v(e,t,r){return e instanceof Object==!1?r:t in e?e[t]:r}function p(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",o=_createForOfIteratorHelper(new Uint8Array(e,r,n));try{for(o.s();!(t=o.n()).done;){var u=t.value,s=u.toString(16).toUpperCase();1===s.length&&(i+="0"),i+=s,a&&(i+=" ")}}catch(e){o.e(e)}finally{o.f()}return i.trim()}function y(e,t,r,n){return t instanceof ArrayBuffer==!1?(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1):0===t.byteLength?(e.error="Wrong parameter: inputBuffer has zero length",!1):r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1)}function g(e,t){var r=0;if(1===e.length)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function d(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=r,a=e,i=0,o=Math.pow(2,t),u=1;u<8;u++){if(e<o){var s=void 0;if(n<0)s=new ArrayBuffer(u),i=u;else{if(n<u)return new ArrayBuffer(0);s=new ArrayBuffer(n),i=n}for(var c=new Uint8Array(s),l=u-1;l>=0;l--){var h=Math.pow(2,l*t);c[i-l-1]=Math.floor(a/h),a-=c[i-l-1]*h}return s}o*=Math.pow(2,t)}return new ArrayBuffer(0)}function m(){for(var e=0,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(var i=0,o=n;i<o.length;i++){var u=o[i];e+=u.byteLength}for(var s=new ArrayBuffer(e),c=new Uint8Array(s),l=0,h=n;l<h.length;l++){var f=h[l];c.set(new Uint8Array(f),t),t+=f.byteLength}return s}function k(){for(var e=0,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(var i=0,o=n;i<o.length;i++){var u=o[i];e+=u.length}for(var s=new ArrayBuffer(e),c=new Uint8Array(s),l=0,h=n;l<h.length;l++){var f=h[l];c.set(f,t),t+=f.length}return c}function w(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),a=new Uint8Array(n),i=0;i<this.valueHex.byteLength;i++)a[i]=0;a[0]=128&e[0];for(var o=g(a,8),u=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(u),c=0;c<this.valueHex.byteLength;c++)s[c]=e[c];return s[0]&=127,g(s,8)-o}function b(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}function _(e,t){var r=e.toString(10);if(t<r.length)return"";for(var n=t-r.length,a=new Array(n),i=0;i<n;i++)a[i]="0";return a.join("").concat(r)}function C(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}h.DEFAULT_UTF8_ENCODING="utf8";var S=[new Uint8Array([1])],A="0123456789",B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.blockLength=v(t,"blockLength",0),this.error=v(t,"error",""),this.warnings=v(t,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in t?t.valueBeforeDecode.slice(0):new ArrayBuffer(0)}return _createClass(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:p(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),x=function(e){return function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).isHexOnly=v(n,"isHexOnly",!1),e.valueHex="valueHex"in n?n.valueHex.slice(0):new ArrayBuffer(0),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){return!1===y(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=p(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),r}(e)},E=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),e=t.call(this),"idBlock"in n?(e.isHexOnly=v(n.idBlock,"isHexOnly",!1),e.valueHex=v(n.idBlock,"valueHex",new ArrayBuffer(0)),e.tagClass=v(n.idBlock,"tagClass",-1),e.tagNumber=v(n.idBlock,"tagNumber",-1),e.isConstructed=v(n.idBlock,"isConstructed",!1)):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return _createClass(r,[{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){if(e=new ArrayBuffer(1),t=new Uint8Array(e),!r){var a=this.tagNumber;n|=a&=31,t[0]=n}return e}if(!1===this.isHexOnly){var i=d(this.tagNumber,7),o=new Uint8Array(i),u=i.byteLength;if(e=new ArrayBuffer(u+1),(t=new Uint8Array(e))[0]=31|n,!r){for(var s=0;s<u-1;s++)t[s+1]=128|o[s];t[u]=o[u-1]}return e}if(e=new ArrayBuffer(this.valueHex.byteLength+1),(t=new Uint8Array(e))[0]=31|n,!1===r){for(var c=new Uint8Array(this.valueHex),l=0;l<c.length-1;l++)t[l+1]=128|c[l];t[this.valueHex.byteLength]=c[c.length-1]}return e}},{key:"fromBER",value:function(e,t,r){if(!1===y(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var a=31&n[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{var i=1;this.valueHex=new ArrayBuffer(255);for(var o=255,u=new Uint8Array(this.valueHex);128&n[i];){if(u[i-1]=127&n[i],++i>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(i===o){o+=255;for(var s=new ArrayBuffer(o),c=new Uint8Array(s),l=0;l<u.length;l++)c[l]=u[l];this.valueHex=new ArrayBuffer(o),u=new Uint8Array(this.valueHex)}}this.blockLength=i+1,u[i-1]=127&n[i];for(var h=new ArrayBuffer(i),f=new Uint8Array(h),v=0;v<i;v++)f[v]=u[v];this.valueHex=new ArrayBuffer(i),(u=new Uint8Array(this.valueHex)).set(f),this.blockLength<=9?this.tagNumber=g(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),r}(x(B)),R=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),e=t.call(this),"lenBlock"in n?(e.isIndefiniteForm=v(n.lenBlock,"isIndefiniteForm",!1),e.longFormUsed=v(n.lenBlock,"longFormUsed",!1),e.length=v(n.lenBlock,"length",0)):(e.isIndefiniteForm=!1,e.longFormUsed=!1,e.length=0),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(!1===y(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var a=127&n[0];if(a>8)return this.error="Too big integer",-1;if(a+1>n.length)return this.error="End of input reached before message was fully decoded",-1;for(var i=new Uint8Array(a),o=0;o<a;o++)i[o]=n[o+1];return 0===i[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=g(i,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(!0===this.longFormUsed){var n=d(this.length,8);if(n.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(e=new ArrayBuffer(n.byteLength+1),!0===r)return e;var a=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var i=0;i<n.byteLength;i++)t[i+1]=a[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),r}(B),K=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),t.call(this,e)}return _createClass(r,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}},{key:"toBER",value:function(){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),r}(B),O=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K;return _classCallCheck(this,r),e=t.call(this,n),"name"in n&&(e.name=n.name),"optional"in n&&(e.optional=n.optional),"primitiveSchema"in n&&(e.primitiveSchema=n.primitiveSchema),e.idBlock=new E(n),e.lenBlock=new R(n),e.valueBlock=new a(n),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.idBlock.toBER(t),n=this.valueBlock.toBER(!0);this.lenBlock.length=n.byteLength;var a=this.lenBlock.toBER(t);if(e=m(r,a),e=m(e,!1===t?this.valueBlock.toBER(t):new ArrayBuffer(this.lenBlock.length)),!0===this.lenBlock.isIndefiniteForm){var i=new ArrayBuffer(2);if(!1===t){var o=new Uint8Array(i);o[0]=0,o[1]=0}e=m(e,i)}return e}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),"name"in this&&(e.name=this.name),"optional"in this&&(e.optional=this.optional),"primitiveSchema"in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(p(this.valueBlock.valueHex))}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),r}(B),N=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).valueHex="valueHex"in n?n.valueHex.slice(0):new ArrayBuffer(0),e.isHexOnly=v(n,"isHexOnly",!0),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(!1===y(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueHex=p(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),r}(K),U=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,N)).idBlock.isConstructed=!1,e}return _createClass(r,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),r}(O),P=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).value=v(n,"value",[]),e.isIndefiniteForm=v(n,"isIndefiniteForm",!1),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=t,a=r;if(!1===y(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var i,o,u=t;i=this.isIndefiniteForm,o=r,(!0===i?1:o)>0;){var s=Ke(e,u,r);if(-1===s.offset)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(u=s.offset,this.blockLength+=s.result.blockLength,r-=s.result.blockLength,this.value.push(s.result),!0===this.isIndefiniteForm&&s.result.constructor.blockName()===H.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===H.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+a),u}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);t=m(t,n)}return t}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var t=0;t<this.value.length;t++)e.value.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),r}(K),L=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,P)).idBlock.isConstructed=!0,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toString",value:function(){var e,t=[],r=_createForOfIteratorHelper(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString().split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var a=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.blockName();return t.length?"".concat(a," :\n").concat(t.join("\n")):"".concat(a," :")}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),r}(O),I=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),t.call(this,e)}return _createClass(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){return new ArrayBuffer(0)}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),r}(K),H=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,I)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return _createClass(r,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),r}(O),T=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,r),(e=t.call(this,n)).value=v(n,"value",!1),e.isHexOnly=v(n,"isHexOnly",!1),"valueHex"in n)e.valueHex=n.valueHex.slice(0);else if(e.valueHex=new ArrayBuffer(1),!0===e.value){var a=new Uint8Array(e.valueHex);a[0]=255}return e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(!1===y(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return 0!==w.call(this)?this.value=!0:this.value=!1,this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=p(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),r}(K),D=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,T)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return _createClass(r,[{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"BOOLEAN"}}]),r}(O),j=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return _createClass(r,null,[{key:"blockName",value:function(){return"SEQUENCE"}}]),r}(L),F=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return _createClass(r,null,[{key:"blockName",value:function(){return"SET"}}]),r}(L),J=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,B)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(2);if(!0===e)return t;var r=new Uint8Array(t);return r[0]=5,r[1]=0,t}},{key:"toString",value:function(){return"".concat(this.constructor.blockName())}}],[{key:"blockName",value:function(){return"NULL"}}]),r}(O),M=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).isConstructed=v(n,"isConstructed",!1),e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){var a=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(a=P.prototype.fromBER.call(this,e,t,n)))return a;for(var i=0;i<this.value.length;i++){var o=this.value[i].constructor.blockName();if(o===H.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==V.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=_get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n),this.blockLength=n;return a}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return P.prototype.toBER.call(this,e);var t=new ArrayBuffer(this.valueHex.byteLength);return!0===e||0===this.valueHex.byteLength?t:t=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=p(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),r}(x(P)),V=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,M)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var a=e.slice(t,t+n);try{var i=Oe(a);-1!==i.offset&&i.offset===n&&(this.valueBlock.value=[i.result])}catch(e){}}return _get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}},{key:"toString",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?L.prototype.toString.call(this):"".concat(this.constructor.blockName()," : ").concat(p(this.valueBlock.valueHex))}}],[{key:"blockName",value:function(){return"OCTET STRING"}}]),r}(O),z=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).unusedBits=v(n,"unusedBits",0),e.isConstructed=v(n,"isConstructed",!1),e.blockLength=e.valueHex.byteLength,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=P.prototype.fromBER.call(this,e,t,r)))return n;for(var a=0;a<this.value.length;a++){var i=this.value[a].constructor.blockName();if(i===H.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(i!==G.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[a].valueBlock.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[a].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===y(this,e,t,r))return-1;var o=new Uint8Array(e,t,r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var u=e.slice(t+1,t+r);try{var s=Oe(u);-1!==s.offset&&s.offset===r-1&&(this.value=[s.result])}catch(e){}}this.valueHex=new ArrayBuffer(o.length-1);for(var c=new Uint8Array(this.valueHex),l=0;l<r-1;l++)c[l]=o[l+1];return this.blockLength=o.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return P.prototype.toBER.call(this,e);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);var t=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),n=new Uint8Array(r);n[0]=this.unusedBits;for(var a=0;a<this.valueHex.byteLength;a++)n[a+1]=t[a];return r}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=p(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),r}(x(P)),G=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,z)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){return 0===n?t:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,_get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n))}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}},{key:"toString",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return L.prototype.toString.call(this);var e,t=[],r=_createForOfIteratorHelper(new Uint8Array(this.valueBlock.valueHex));try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}return"".concat(this.constructor.blockName()," : ").concat(t.join(""))}}],[{key:"blockName",value:function(){return"BIT STRING"}}]),r}(O),q=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),e=t.call(this,n),"value"in n&&(e.valueDec=n.value),e}return _createClass(r,[{key:"valueHex",get:function(){return this._valueHex},set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=w.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=function(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var a=d(r-t,8,n);return new Uint8Array(a)[0]|=128,a}var i=d(t,8,n),o=new Uint8Array(i);if(128&o[0]){var u=i.slice(0),s=new Uint8Array(u);i=new ArrayBuffer(i.byteLength+1),o=new Uint8Array(i);for(var c=0;c<u.byteLength;c++)o[c+1]=s[c];o[0]=0}return i}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e)}},{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.fromBER(e,t,r);if(-1===a)return a;var i=new Uint8Array(this._valueHex);if(0===i[0]&&0!=(128&i[1])){var o=new ArrayBuffer(this._valueHex.byteLength-1),u=new Uint8Array(o);u.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=o.slice(0)}else if(0!==n&&this._valueHex.byteLength<n){n-this._valueHex.byteLength>1&&(n=this._valueHex.byteLength+1);var s=new ArrayBuffer(n),c=new Uint8Array(s);c.set(i,n-this._valueHex.byteLength),this._valueHex=s.slice(0)}return a}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),n=new Uint8Array(r);n[0]=0,n.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0==(128&t[1]):var a=new ArrayBuffer(this._valueHex.byteLength-1),i=new Uint8Array(a);i.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=a.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,n){var a=_get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n);return-1===a?a:(this.blockLength=n,t+n)}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}},{key:"toString",value:function(){function e(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),o=i.length-1,u=a.slice(0),s=u.length-1,c=0,l=0,h=s<o?o:s;h>=0;h--,l++){if(!0==l<u.length)c=i[o-l]+u[s-l]+r[0];else c=i[o-l]+r[0];if(r[0]=c/10,!0==l>=i.length)i=k(new Uint8Array([c%10]),i);else i[o-l]=c%10}return r[0]>0&&(i=k(r,i)),i.slice(0)}function t(e){if(e>=S.length)for(var t=S.length;t<=e;t++){for(var r=new Uint8Array([0]),n=S[t-1].slice(0),a=n.length-1;a>=0;a--){var i=new Uint8Array([(n[a]<<1)+r[0]]);r[0]=i[0]/10,n[a]=i[0]%10}r[0]>0&&(n=k(r,n)),S.push(n)}return S[e]}function r(e,t){for(var r,n=0,a=new Uint8Array(e),i=new Uint8Array(t),o=a.slice(0),u=o.length-1,s=i.slice(0),c=s.length-1,l=0,h=c;h>=0;h--,l++)if(!0==(r=o[u-l]-s[c-l]-n)<0)n=1,o[u-l]=r+10;else n=0,o[u-l]=r;if(n>0)for(var f=u-c+1;f>=0;f--,l++){if(!((r=o[u-l]-n)<0)){n=0,o[u-l]=r;break}n=1,o[u-l]=r+10}return o.slice()}for(var n,a=8*this._valueHex.byteLength-1,i=new Uint8Array(8*this._valueHex.byteLength/3),o=0,u=new Uint8Array(this._valueHex),s="",c=!1,l=this._valueHex.byteLength-1;l>=0;l--){n=u[l];for(var h=0;h<8;h++){if(1==(1&n))if(o===a)i=r(t(o),i),s="-";else i=e(i,t(o));o++,n>>=1}}for(var f=0;f<i.length;f++)i[f]&&(c=!0),c&&(s+=A.charAt(i[f]));return!1===c&&(s+=A.charAt(0)),s}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),r}(x(K)),W=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,q)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return _createClass(r,[{key:"isEqual",value:function(e){return e instanceof r?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?b(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&b(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,t=new r({valueHex:this.valueBlock.valueHex});return t.valueBlock.fromDER(t.valueBlock.valueHex,0,t.valueBlock.valueHex.byteLength,e),t}},{key:"toString",value:function(){C();var e=p(this.valueBlock.valueHex),t=BigInt("0x".concat(e));return"".concat(this.constructor.blockName()," : ").concat(t.toString())}}],[{key:"blockName",value:function(){return"INTEGER"}}]),r}(O),X=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return _createClass(r,null,[{key:"blockName",value:function(){return"ENUMERATED"}}]),r}(W),Z=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).valueDec=v(n,"valueDec",-1),e.isFirstSid=v(n,"isFirstSid",!1),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===y(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),s=0;s<this.blockLength;s++)u[s]=a[s];return this.valueHex=o.slice(0),a=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=g(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){C();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),n=0;n<r.length;n++)r[n]=parseInt(t.slice(7*n,7*n+7),2)+(n+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=d(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(i.byteLength),!1===r){var o=new Uint8Array(i);t=new Uint8Array(e);for(var u=0;u<i.byteLength-1;u++)t[u]=128|o[u];t[i.byteLength-1]=o[i.byteLength-1]}return e}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=p(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),r}(x(B)),$=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).fromString(v(n,"value","")),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new Z;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;0===this.value.length&&(a.isFirstSid=!0),this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=m(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",a=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1,a){var i=this.value[0],o=0;switch(i.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:return this.value=[],!1}var u=parseInt(n,10);if(isNaN(u))return!0;i.valueDec=u+o,a=!1}else{var s=new Z;if(n>Number.MAX_SAFE_INTEGER){C();var c=BigInt(n);s.valueBigInt=c}else if(s.valueDec=parseInt(n,10),isNaN(s.valueDec))return!0;0===this.value.length&&(s.isFirstSid=!0,a=!0),this.value.push(s)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),r}(K),Y=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,$)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return _createClass(r,[{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.toString())}}],[{key:"blockName",value:function(){return"OBJECT IDENTIFIER"}}]),r}(O),Q=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return _createClass(r,[{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),r}(x(B)),ee=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),e=t.call(this,n,Q),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push('Error during "decodeURIComponent": '.concat(e,", using raw string"))}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var n=new Uint8Array(this.valueBlock.valueHex),a=0;a<r;a++)n[a]=t.charCodeAt(a);this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"UTF8String"}}]),r}(O),te=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).valueDec=v(n,"valueDec",-1),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===y(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),s=0;s<this.blockLength;s++)u[s]=a[s];return this.valueHex=o.slice(0),a=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=g(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=d(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(i.byteLength),!1===r){var o=new Uint8Array(i);t=new Uint8Array(e);for(var u=0;u<i.byteLength-1;u++)t[u]=128|o[u];t[i.byteLength-1]=o[i.byteLength-1]}return e}},{key:"toString",value:function(){return!0===this.isHexOnly?p(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString()}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}}],[{key:"blockName",value:function(){return"relativeSidBlock"}}]),r}(x(B)),re=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).fromString(v(n,"value","")),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new te;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=m(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1;var a=new te;if(a.valueDec=parseInt(n,10),isNaN(a.valueDec))return!0;this.value.push(a)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"RelativeObjectIdentifierValueBlock"}}]),r}(K),ne=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,re)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return _createClass(r,null,[{key:"blockName",value:function(){return"RelativeObjectIdentifier"}}]),r}(O),ae=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return _createClass(r,[{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),r}(x(B)),ie=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),e=t.call(this,n,ae),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=2){var a=r[n];r[n]=r[n+1],r[n+1]=a}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=d(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>2))for(var o=2-i.length,u=i.length-1;u>=0;u--)r[2*n+u+o]=i[u]}this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"BMPString"}}]),r}(O),oe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return _createClass(r,[{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),r}(x(B)),ue=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),e=t.call(this,n,oe),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=d(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>4))for(var o=4-i.length,u=i.length-1;u>=0;u--)r[4*n+u+o]=i[u]}this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"UniversalString"}}]),r}(O),se=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).value="",e.isHexOnly=!0,e}return _createClass(r,[{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),r}(x(B)),ce=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),e=t.call(this,n,se),"value"in n&&e.fromString(n.value),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),r}(O),le=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return _createClass(r,null,[{key:"blockName",value:function(){return"NumericString"}}]),r}(ce),he=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return _createClass(r,null,[{key:"blockName",value:function(){return"PrintableString"}}]),r}(ce),fe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return _createClass(r,null,[{key:"blockName",value:function(){return"TeletexString"}}]),r}(ce),ve=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return _createClass(r,null,[{key:"blockName",value:function(){return"VideotexString"}}]),r}(ce),pe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return _createClass(r,null,[{key:"blockName",value:function(){return"IA5String"}}]),r}(ce),ye=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return _createClass(r,null,[{key:"blockName",value:function(){return"GraphicString"}}]),r}(ce),ge=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return _createClass(r,null,[{key:"blockName",value:function(){return"VisibleString"}}]),r}(ce),de=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return _createClass(r,null,[{key:"blockName",value:function(){return"GeneralString"}}]),r}(ce),me=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return _createClass(r,null,[{key:"blockName",value:function(){return"CharacterString"}}]),r}(ce),ke=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,"value"in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var a=new Uint8Array(e.valueBlock.valueHex),i=0;i<n.value.length;i++)a[i]=n.value.charCodeAt(i)}return"valueDate"in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for convertion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=_(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=_(this.month,2),e[2]=_(this.day,2),e[3]=_(this.hour,2),e[4]=_(this.minute,2),e[5]=_(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),r}(ge),we=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,e.millisecond=0,"value"in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var a=new Uint8Array(e.valueBlock.valueHex),i=0;i<n.value.length;i++)a[i]=n.value.charCodeAt(i)}return"valueDate"in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",a="",i=0,o=0,u=0;if("Z"===e[e.length-1])n=e.substr(0,e.length-1),r=!0;else{var s=new Number(e[e.length-1]);if(isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for convertion")}else{var c=1,l=n.indexOf("+"),h="";if(-1===l&&(l=n.indexOf("-"),c=-1),-1!==l){if(h=n.substr(l+1),n=n.substr(0,l),2!==h.length&&4!==h.length)throw new Error("Wrong input string for convertion");var f=new Number(h.substr(0,2));if(isNaN(f.valueOf()))throw new Error("Wrong input string for convertion");if(o=c*f,4===h.length){if(f=new Number(h.substr(2,2)),isNaN(f.valueOf()))throw new Error("Wrong input string for convertion");u=c*f}}}var v=n.indexOf(".");if(-1===v&&(v=n.indexOf(",")),-1!==v){var p=new Number("0".concat(n.substr(v)));if(isNaN(p.valueOf()))throw new Error("Wrong input string for convertion");i=p.valueOf(),a=n.substr(0,v)}else a=n;switch(!0){case 8===a.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==v)throw new Error("Wrong input string for convertion");break;case 10===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var y=60*i;this.minute=Math.floor(y),y=60*(y-this.minute),this.second=Math.floor(y),y=1e3*(y-this.second),this.millisecond=Math.floor(y)}break;case 12===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var g=60*i;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for convertion")}var m=t.exec(a);if(null===m)throw new Error("Wrong input string for convertion");for(var k=1;k<m.length;k++)switch(k){case 1:this.year=parseInt(m[k],10);break;case 2:this.month=parseInt(m[k],10);break;case 3:this.day=parseInt(m[k],10);break;case 4:this.hour=parseInt(m[k],10)+o;break;case 5:this.minute=parseInt(m[k],10)+u;break;case 6:this.second=parseInt(m[k],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push(_(this.year,4)),e.push(_(this.month,2)),e.push(_(this.day,2)),e.push(_(this.hour,2)),e.push(_(this.minute,2)),e.push(_(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(_(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),r}(ge),be=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return _createClass(r,null,[{key:"blockName",value:function(){return"DATE"}}]),r}(ee),_e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return _createClass(r,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),r}(ee),Ce=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return _createClass(r,null,[{key:"blockName",value:function(){return"DateTime"}}]),r}(ee),Se=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return _createClass(r,null,[{key:"blockName",value:function(){return"Duration"}}]),r}(ee),Ae=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return _createClass(r,null,[{key:"blockName",value:function(){return"TIME"}}]),r}(ee),Be=_createClass((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.value=v(t,"value",[]),this.optional=v(t,"optional",!1)})),xe=_createClass((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.name=v(t,"name",""),this.optional=v(t,"optional",!1)})),Ee=_createClass((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.name=v(t,"name",""),this.optional=v(t,"optional",!1),this.value=v(t,"value",new xe),this.local=v(t,"local",!1)})),Re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.data=v(t,"data",new ArrayBuffer(0))}return _createClass(e,[{key:"fromBER",value:function(e,t,r){return this.data=e.slice(t,r),t+r}},{key:"toBER",value:function(){return this.data}}]),e}();function Ke(e,t,r){var n=t;var a=new O({},Object),i=new B;if(!1===y(i,e,t,r))return a.error=i.error,{offset:-1,result:a};if(0===new Uint8Array(e,t,r).length)return a.error="Zero buffer length",{offset:-1,result:a};var o=a.idBlock.fromBER(e,t,r);if(a.warnings.concat(a.idBlock.warnings),-1===o)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=o,r-=a.idBlock.blockLength,o=a.lenBlock.fromBER(e,t,r),a.warnings.concat(a.lenBlock.warnings),-1===o)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=o,r-=a.lenBlock.blockLength,!1===a.idBlock.isConstructed&&!0===a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};var u=O;if(1===a.idBlock.tagClass){if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(!0===a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};u=H;break;case 1:u=D;break;case 2:u=W;break;case 3:u=G;break;case 4:u=V;break;case 5:u=J;break;case 6:u=Y;break;case 10:u=X;break;case 12:u=ee;break;case 13:u=ne;break;case 14:u=Ae;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:u=j;break;case 17:u=F;break;case 18:u=le;break;case 19:u=he;break;case 20:u=fe;break;case 21:u=ve;break;case 22:u=pe;break;case 23:u=ke;break;case 24:u=we;break;case 25:u=ye;break;case 26:u=ge;break;case 27:u=de;break;case 28:u=ue;break;case 29:u=me;break;case 30:u=ie;break;case 31:u=be;break;case 32:u=_e;break;case 33:u=Ce;break;case 34:u=Se;break;default:var s;(s=!0===a.idBlock.isConstructed?new L:new U).idBlock=a.idBlock,s.lenBlock=a.lenBlock,s.warnings=a.warnings,a=s}}else u=!0===a.idBlock.isConstructed?L:U;return a=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(a,u),o=a.fromBER(e,t,!0===a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecode=e.slice(n,n+a.blockLength),{offset:o,result:a}}function Oe(e){if(0===e.byteLength){var t=new O({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return Ke(e,0,e.byteLength)}function Ne(e,t,r){if(r instanceof Be){for(var n=0;n<r.value.length;n++){if(!0===Ne(e,t,r.value[n]).verified)return{verified:!0,result:e}}var a={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(a.name=r.name),a}if(r instanceof xe)return r.hasOwnProperty("name")&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if("isHexOnly"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var o=new Uint8Array(r.idBlock.valueHex),u=new Uint8Array(t.idBlock.valueHex);if(o.length!==u.length)return{verified:!1,result:e};for(var s=0;s<o.length;s++)if(o[s]!==u[1])return{verified:!1,result:e}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){var c=0,l={verified:!1},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof Ee&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,v=0;v<r.valueBlock.value.length;v++)f=f&&(r.valueBlock.value[v].optional||!1);return!0===f?{verified:!0,result:e}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var p=0;p<h;p++)if(p-c>=t.valueBlock.value.length){if(!1===r.valueBlock.value[p].optional){var y={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],y.name=r.name)),y}}else if(r.valueBlock.value[0]instanceof Ee){if(!1===(l=Ne(e,t.valueBlock.value[p],r.valueBlock.value[0].value)).verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;c++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var g={};void 0===(g="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(g[r.valueBlock.value[0].name]=[]),g[r.valueBlock.value[0].name].push(t.valueBlock.value[p])}}else if(!1===(l=Ne(e,t.valueBlock.value[p-c],r.valueBlock.value[p])).verified){if(!0!==r.valueBlock.value[p].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;c++}if(!1===l.verified){var d={verified:!1,result:e};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],d.name=r.name)),d}return{verified:!0,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){var m=Oe(t.valueBlock.valueHex);if(-1===m.offset){var k={verified:!1,result:m.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],k.name=r.name)),k}return Ne(e,m.result,r.primitiveSchema)}return{verified:!0,result:e}}var Ue,Pe,Le=Object.freeze({__proto__:null,HexBlock:x,ValueBlock:K,BaseBlock:O,Primitive:U,Constructed:L,EndOfContent:H,Boolean:D,Sequence:j,Set:F,Null:J,OctetString:V,BitString:G,Integer:W,Enumerated:X,ObjectIdentifier:Y,Utf8String:ee,RelativeObjectIdentifier:ne,BmpString:ie,UniversalString:ue,NumericString:le,PrintableString:he,TeletexString:fe,VideotexString:ve,IA5String:pe,GraphicString:ye,VisibleString:ge,GeneralString:de,CharacterString:me,UTCTime:ke,GeneralizedTime:we,DATE:be,TimeOfDay:_e,DateTime:Ce,Duration:Se,TIME:Ae,Choice:Be,Any:xe,Repeated:Ee,RawData:Re,fromBER:Oe,compareSchema:Ne,verifySchema:function(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};var r=Oe(e);return-1===r.offset?{verified:!1,result:r.result}:Ne(r.result,r.result,t)},fromJSON:function(e){}});!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(Ue||(Ue={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(Pe||(Pe={}));var Ie={fromASN:function(e){return e instanceof J?null:e.valueBeforeDecode},toASN:function(e){if(null===e)return new J;var t=Oe(e);if(t.result.error)throw new Error(t.result.error);return t.result}},He={fromASN:function(e){return e.valueBlock.valueHex.byteLength>4?e.valueBlock.toString():e.valueBlock.valueDec},toASN:function(e){return new W({value:e})}},Te={fromASN:function(e){return e.valueBlock.valueDec},toASN:function(e){return new X({value:e})}},De={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new G({valueHex:e})}},je={fromASN:function(e){return e.valueBlock.toString()},toASN:function(e){return new Y({value:e})}},Fe={fromASN:function(e){return e.valueBlock.value},toASN:function(e){return new D({value:e})}},Je={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new V({valueHex:e})}};function Me(e){return{fromASN:function(e){return e.valueBlock.value},toASN:function(t){return new e({value:t})}}}var Ve=Me(ee),ze=Me(ie),Ge=Me(ue),qe=Me(le),We=Me(he),Xe=Me(fe),Ze=Me(ve),$e=Me(pe),Ye=Me(ye),Qe=Me(ge),et=Me(de),tt=Me(me),rt={fromASN:function(e){return e.toDate()},toASN:function(e){return new ke({valueDate:e})}},nt={fromASN:function(e){return e.toDate()},toASN:function(e){return new we({valueDate:e})}},at={fromASN:function(e){return null},toASN:function(e){return new J}};function it(e){switch(e){case Pe.Any:return Ie;case Pe.BitString:return De;case Pe.BmpString:return ze;case Pe.Boolean:return Fe;case Pe.CharacterString:return tt;case Pe.Enumerated:return Te;case Pe.GeneralString:return et;case Pe.GeneralizedTime:return nt;case Pe.GraphicString:return Ye;case Pe.IA5String:return $e;case Pe.Integer:return He;case Pe.Null:return at;case Pe.NumericString:return qe;case Pe.ObjectIdentifier:return je;case Pe.OctetString:return Je;case Pe.PrintableString:return We;case Pe.TeletexString:return Xe;case Pe.UTCTime:return rt;case Pe.UniversalString:return Ge;case Pe.Utf8String:return Ve;case Pe.VideotexString:return Ze;case Pe.VisibleString:return Qe;default:return null}}var ot=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){var t=this.toUint8Array(e);return t.byteOffset||t.length?t.buffer.slice(t.byteOffset,t.byteOffset+t.length):t.buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return new t(e.buffer,e.byteOffset,e.byteLength);if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var n=e.toUint8Array(t),a=e.toUint8Array(r);if(n.length!==a.byteLength)return!1;for(var i=0;i<n.length;i++)if(n[i]!==a[i])return!1;return!0}}]),e}(),ut=function(){function e(t){_classCallCheck(this,e),"number"==typeof t?this.buffer=new ArrayBuffer(t):ot.isBufferSource(t)?this.buffer=ot.toArrayBuffer(t):Array.isArray(t)?this.buffer=new Uint8Array(t):this.buffer=new ArrayBuffer(0)}return _createClass(e,[{key:"byteLength",get:function(){return this.buffer.byteLength}},{key:"byteOffset",get:function(){return 0}},{key:"fromASN",value:function(e){if(!(e instanceof V))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}},{key:"toASN",value:function(){return new V({valueHex:this.buffer})}},{key:"toSchema",value:function(e){return new V({name:e})}}]),e}();function st(e){return e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||st(e.prototype):!!(e&&e.toASN&&e.fromASN)}function ct(e){var t;if(e){var r=Object.getPrototypeOf(e);return(null===(t=null==r?void 0:r.prototype)||void 0===t?void 0:t.constructor)===Array||ct(r)}return!1}function lt(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<e.byteLength;a++)if(r[a]!==n[a])return!1;return!0}var ht=new(function(){function e(){_classCallCheck(this,e),this.items=new WeakMap}return _createClass(e,[{key:"has",value:function(e){return this.items.has(e)}},{key:"get",value:function(e){var t,r,n,a=this.items.get(e);if(!a)throw new Error("Cannot get schema for '".concat(null!==(n=null===(r=null===(t=null==e?void 0:e.prototype)||void 0===t?void 0:t.constructor)||void 0===r?void 0:r.name)&&void 0!==n?n:e,"' target"));return a}},{key:"cache",value:function(e){var t=this.get(e);t.schema||(t.schema=this.create(e,!0))}},{key:"createDefault",value:function(e){var t={type:Ue.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}},{key:"create",value:function(e,t){var r=this.items.get(e)||this.createDefault(e),n=[];for(var a in r.items){var i=r.items[a],o=t?a:"",u=void 0;if("number"==typeof i.type){var s=Pe[i.type],c=Le[s];if(!c)throw new Error("Cannot get ASN1 class by name '".concat(s,"'"));u=new c({name:o})}else if(st(i.type)){u=(new i.type).toSchema(o)}else if(i.optional){this.get(i.type).type===Ue.Choice?u=new xe({name:o}):(u=this.create(i.type,!1)).name=o}else u=new xe({name:o});var l=!!i.optional||void 0!==i.defaultValue;if(i.repeated)u.name="",u=new("set"===i.repeated?F:j)({name:"",value:[new Ee({name:o,value:u})]});if(null!==i.context&&void 0!==i.context)if(i.implicit)if("number"==typeof i.type||st(i.type)){var h=i.repeated?L:U;n.push(new h({name:o,optional:l,idBlock:{tagClass:3,tagNumber:i.context}}))}else{this.cache(i.type);var f=!!i.repeated,v=f?u:this.get(i.type).schema;v=v.valueBlock?v.valueBlock.value:v.value,n.push(new L({name:f?"":o,optional:l,idBlock:{tagClass:3,tagNumber:i.context},value:v}))}else n.push(new L({optional:l,idBlock:{tagClass:3,tagNumber:i.context},value:[u]}));else u.optional=l,n.push(u)}switch(r.type){case Ue.Sequence:return new j({value:n,name:""});case Ue.Set:return new F({value:n,name:""});case Ue.Choice:return new Be({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}()),ft=function(e){return function(t){var r;ht.has(t)?r=ht.get(t):(r=ht.createDefault(t),ht.set(t,r)),Object.assign(r,e)}},vt=function(e){return function(t,r){var n;ht.has(t.constructor)?n=ht.get(t.constructor):(n=ht.createDefault(t.constructor),ht.set(t.constructor,n));var a=Object.assign({},e);if("number"==typeof a.type&&!a.converter){var i=it(e.type);if(!i)throw new Error("Cannot get default converter for property '".concat(r,"' of ").concat(t.constructor.name));a.converter=i}n.items[r]=a}},pt=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).schemas=[],e}return _createClass(r)}(),yt=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e,t){var r;if(e instanceof ArrayBuffer)r=e;else if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))r=new Uint8Array(e).buffer;else{if(!(ArrayBuffer.isView(e)||e.buffer instanceof ArrayBuffer))throw new TypeError("Wrong type of 'data' argument");r=e.buffer}var n=Oe(r);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}},{key:"fromASN",value:function(e,t){var r,n=this;try{if(st(t))return(new t).fromASN(e);var a=ht.get(t);ht.cache(t);var i=a.schema;if(e.constructor===L&&a.type!==Ue.Choice)for(var o in i=new L({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:a.schema.valueBlock.value}),a.items)delete e[o];var u=Ne(e,e,i);if(!u.verified)throw new pt("Data does not match to ".concat(t.name," ASN1 schema. ").concat(u.result.error));var s=new t;if(ct(t)){if("number"==typeof a.itemType){var c=it(a.itemType);if(!c)throw new Error("Cannot get default converter for array item of ".concat(t.name," ASN1 schema"));return t.from(e.valueBlock.value,(function(e){return c.fromASN(e)}))}return t.from(e.valueBlock.value,(function(e){return n.fromASN(e,a.itemType)}))}var l=function(t){if(!e[t])return"continue";var i=a.items[t];if("number"==typeof i.type||st(i.type)){var o=null!==(r=i.converter)&&void 0!==r?r:st(i.type)?new i.type:null;if(!o)throw new Error("Converter is empty");if(i.repeated)if(i.implicit){var u=new("sequence"===i.repeated?j:F);u.valueBlock=e[t].valueBlock;var c=Oe(u.toBER(!1)).result.valueBlock.value;s[t]=Array.from(c,(function(e){return o.fromASN(e)}))}else s[t]=Array.from(e[t],(function(e){return o.fromASN(e)}));else{var l=e[t];if(i.implicit){var h;if(st(i.type))h=(new i.type).toSchema("");else{var f=Pe[i.type],v=Le[f];if(!v)throw new Error("Cannot get '".concat(f,"' class from asn1js module"));h=new v}h.valueBlock=l.valueBlock,l=Oe(h.toBER(!1)).result}s[t]=o.fromASN(l)}}else i.repeated?s[t]=Array.from(e[t],(function(e){return n.fromASN(e,i.type)})):s[t]=n.fromASN(e[t],i.type)};for(var h in a.items)l(h);return s}catch(e){throw e instanceof pt&&e.schemas.push(t.name),e}}}]),e}(),gt=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){return e instanceof O?e.toBER(!1):this.toASN(e).toBER(!1)}},{key:"toASN",value:function(t){var r=this;if(t&&st(t.constructor))return t.toASN();var n=t.constructor,a=ht.get(n);ht.cache(n);var i,o=[];if(a.itemType)if("number"==typeof a.itemType){var u=it(a.itemType);if(!u)throw new Error("Cannot get default converter for array item of ".concat(n.name," ASN1 schema"));o=t.map((function(e){return u.toASN(e)}))}else o=t.map((function(e){return r.toAsnItem({type:a.itemType},"[]",n,e)}));else for(var s in a.items){var c=a.items[s],l=t[s];if(!(void 0===l||c.defaultValue===l||"object"===_typeof(c.defaultValue)&&"object"===_typeof(l)&&lt(this.serialize(c.defaultValue),this.serialize(l)))){var h=e.toAsnItem(c,s,n,l);if("number"==typeof c.context)if(c.implicit)if(c.repeated||"number"!=typeof c.type&&!st(c.type))o.push(new L({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context},value:h.valueBlock.value}));else{var f={};f.valueHex=h instanceof J?h.valueBeforeDecode:h.valueBlock.toBER(),o.push(new U(Object.assign({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context}},f)))}else o.push(new L({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context},value:[h]}));else c.repeated?o=o.concat(h):o.push(h)}}switch(a.type){case Ue.Sequence:i=new j({value:o});break;case Ue.Set:i=new F({value:o});break;case Ue.Choice:if(!o[0])throw new Error("Schema '".concat(n.name,"' has wrong data. Choice cannot be empty."));i=o[0]}return i}},{key:"toAsnItem",value:function(e,t,r,n){var a,i=this;if("number"==typeof e.type){var o=e.converter;if(!o)throw new Error("Property '".concat(t,"' doesn't have converter for type ").concat(Pe[e.type]," in schema '").concat(r.name,"'"));if(e.repeated){var u=Array.from(n,(function(e){return o.toASN(e)}));a=new("sequence"===e.repeated?j:F)({value:u})}else a=o.toASN(n)}else if(e.repeated){var s=Array.from(n,(function(e){return i.toASN(e)}));a=new("sequence"===e.repeated?j:F)({value:s})}else a=this.toASN(n);return a}}]),e}(),dt=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){return gt.serialize(e)}},{key:"parse",value:function(e,t){return yt.parse(e,t)}},{key:"toString",value:function(t){var r=Oe(ot.isBufferSource(t)?ot.toArrayBuffer(t):e.serialize(t));if(-1===r.offset)throw new Error("Cannot decode ASN.1 data. ".concat(r.result.error));return r.result.toString()}}]),e}();function mt(e,t,r,n){var a,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}function kt(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}s((n=n.apply(e,t||[])).next())}))}var wt,bt=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(e,n){var a;return _classCallCheck(this,r),(a=t.call(this,n?"".concat(e,". See the inner exception for more details."):e)).message=e,a.innerError=n,a}return _createClass(r)}(),_t=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a){return _classCallCheck(this,r),t.call(this,e,"JSON doesn't match to '".concat(e.target.name,"' schema. ").concat(n),a)}return _createClass(r)}(function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a){var i;return _classCallCheck(this,r),(i=t.call(this,n,a)).schema=e,i}return _createClass(r)}(bt)),Ct=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(bt),St=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a){var i;return _classCallCheck(this,r),(i=t.call(this,"Cannot serialize by '".concat(e,"' schema. ").concat(n),a)).schemaName=e,i}return _createClass(r)}(bt),At=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,r),(a=t.call(this,e,"Some keys doesn't match to schema")).keys=n,a.errors=i,a}return _createClass(r)}(_t);function Bt(e,t){if(!function(e,t){switch(t){case wt.Boolean:return"boolean"==typeof e;case wt.Number:return"number"==typeof e;case wt.String:return"string"==typeof e}return!0}(e,t))throw new TypeError("Value must be ".concat(wt[t]))}function xt(e){return e&&e.prototype?!(!e.prototype.toJSON||!e.prototype.fromJSON)||xt(e.prototype):!!(e&&e.toJSON&&e.fromJSON)}!function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.String=3]="String"}(wt||(wt={}));var Et=function(){function e(){_classCallCheck(this,e),this.items=new Map}return _createClass(e,[{key:"has",value:function(e){return this.items.has(e)||!!this.findParentSchema(e)}},{key:"get",value:function(e){var t=this.items.get(e)||this.findParentSchema(e);if(!t)throw new Error("Cannot get schema for current target");return t}},{key:"create",value:function(e){var t={names:{}},r=this.findParentSchema(e);if(r)for(var n in Object.assign(t,r),t.names={},r.names)t.names[n]=Object.assign({},r.names[n]);return t.target=e,t}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}(),Rt="default",Kt=new Et,Ot=function(){function e(t){_classCallCheck(this,e),this.pattern=new RegExp(t)}return _createClass(e,[{key:"validate",value:function(e){var t=new RegExp(this.pattern.source,this.pattern.flags);if("string"!=typeof e)throw new Ct("Incoming value must be string");if(!t.exec(e))throw new Ct("Value doesn't match to pattern '".concat(t.toString(),"'"))}}]),e}(),Nt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;_classCallCheck(this,e),this.min=t,this.max=r}return _createClass(e,[{key:"validate",value:function(e){if(Bt(e,wt.Number),!(this.min<=e&&e<=this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Ct("Value doesn't match to diapason [".concat(t,",").concat(r,"]"))}}}]),e}(),Ut=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;_classCallCheck(this,e),this.min=t,this.max=r}return _createClass(e,[{key:"validate",value:function(e){if(Bt(e,wt.Number),!(this.min<e&&e<this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Ct("Value doesn't match to diapason (".concat(t,",").concat(r,")"))}}}]),e}(),Pt=function(){function e(t,r,n){_classCallCheck(this,e),this.length=t,this.minLength=r,this.maxLength=n}return _createClass(e,[{key:"validate",value:function(e){if(void 0===this.length){if(void 0!==this.minLength&&e.length<this.minLength)throw new Ct("Value length must be more than ".concat(this.minLength,"."));if(void 0!==this.maxLength&&e.length>this.maxLength)throw new Ct("Value length must be less than ".concat(this.maxLength,"."))}else if(e.length!==this.length)throw new Ct("Value length must be exactly ".concat(this.length,"."))}}]),e}(),Lt=function(){function e(t){_classCallCheck(this,e),this.enumeration=t}return _createClass(e,[{key:"validate",value:function(e){if(Bt(e,wt.String),!this.enumeration.includes(e))throw new Ct("Value must be one of ".concat(this.enumeration.map((function(e){return"'".concat(e,"'")})).join(", ")))}}]),e}(),It=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"checkValues",value:function(e,t){var r,n=_createForOfIteratorHelper(Array.isArray(e)?e:[e]);try{for(n.s();!(r=n.n()).done;){var a,i=r.value,o=_createForOfIteratorHelper(t.validations);try{for(o.s();!(a=o.n()).done;){var u=a.value;u instanceof Pt&&t.repeated?u.validate(e):u.validate(i)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"checkTypes",value:function(e,t){if(t.repeated&&!Array.isArray(e))throw new TypeError("Value must be Array");if("number"==typeof t.type){var r,n=_createForOfIteratorHelper(Array.isArray(e)?e:[e]);try{for(n.s();!(r=n.n()).done;){Bt(r.value,t.type)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getSchemaByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rt;return _objectSpread(_objectSpread({},e.names.default),e.names[t])}}]),e}(),Ht=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,null,[{key:"serialize",value:function(e,t,r,n){var a=this.toJSON(e,t);return JSON.stringify(a,r,n)}},{key:"toJSON",value:function(e){var t,r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.targetSchema,i=n.schemaName||Rt;if(xt(e))return e.toJSON();if(Array.isArray(e)){t=[];var o,u=_createForOfIteratorHelper(e);try{for(u.s();!(o=u.n()).done;){var s=o.value;t.push(this.toJSON(s,n))}}catch(e){u.e(e)}finally{u.f()}}else if("object"===_typeof(e)){if(a&&!Kt.has(a))throw new bt("Cannot get schema for `targetSchema` param");if(a=a||e.constructor,Kt.has(a)){var c=Kt.get(a);t={};var l=this.getSchemaByName(c,i);for(var h in l)try{var f=function(){var n=l[h],o=e[h],u=void 0;if(n.optional&&void 0===o||void 0!==n.defaultValue&&o===n.defaultValue)return"continue";if(!n.optional&&void 0===o)throw new St(a.name,"Property '".concat(h,"' is required."));u="number"==typeof n.type?n.converter?n.repeated?o.map((function(t){return n.converter.toJSON(t,e)})):n.converter.toJSON(o,e):o:n.repeated?o.map((function(e){return r.toJSON(e,{schemaName:i})})):r.toJSON(o,{schemaName:i}),r.checkTypes(u,n),r.checkValues(u,n),t[n.name||h]=u}();if("continue"===f)continue}catch(e){throw e instanceof St?e:new St(c.target.name,"Property '".concat(h,"' is wrong. ").concat(e.message),e)}}else for(var v in t={},e)t[v]=this.toJSON(e[v],{schemaName:i})}else t=e;return t}}]),r}(It),Tt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,null,[{key:"parse",value:function(e,t){var r=JSON.parse(e);return this.fromJSON(r,t)}},{key:"fromJSON",value:function(e,t){var n=this,a=t.targetSchema,i=t.schemaName||Rt,o=new a;if(xt(o))return o.fromJSON(e);var u=Kt.get(a),s=this.getSchemaByName(u,i),c={};for(var l in t.strictProperty&&!Array.isArray(e)&&r.checkStrictProperty(e,s,u),s)try{if("continue"===function(){var r=s[l],a=r.name||l,c=e[a];if(void 0===c&&(r.optional||void 0!==r.defaultValue))return"continue";if(!r.optional&&void 0===c)throw new _t(u,"Property '".concat(a,"' is required."));if(n.checkTypes(c,r),n.checkValues(c,r),"number"==typeof r.type)r.converter?r.repeated?o[l]=c.map((function(e){return r.converter.fromJSON(e,o)})):o[l]=r.converter.fromJSON(c,o):o[l]=c;else{var h=_objectSpread(_objectSpread({},t),{},{targetSchema:r.type,schemaName:i});r.repeated?o[l]=c.map((function(e){return n.fromJSON(e,h)})):o[l]=n.fromJSON(c,h)}}())continue}catch(e){if(e instanceof _t||(e=new _t(u,"Property '".concat(l,"' is wrong. ").concat(e.message),e)),!t.strictAllKeys)throw e;c[l]=e}var h=Object.keys(c);if(h.length)throw new At(u,h,c);return o}},{key:"checkStrictProperty",value:function(e,t,r){for(var n=Object.keys(e),a=Object.keys(t),i=[],o=0,u=n;o<u.length;o++){var s=u[o];-1===a.indexOf(s)&&i.push(s)}if(i.length)throw new At(r,i)}}]),r}(It);function Dt(e){var t=[];return e.pattern&&t.push(new Ot(e.pattern)),e.type!==wt.Number&&e.type!==wt.Any||(void 0===e.minInclusive&&void 0===e.maxInclusive||t.push(new Nt(e.minInclusive,e.maxInclusive)),void 0===e.minExclusive&&void 0===e.maxExclusive||t.push(new Ut(e.minExclusive,e.maxExclusive)),void 0!==e.enumeration&&t.push(new Lt(e.enumeration))),(e.type===wt.String||e.repeated||e.type===wt.Any)&&(void 0===e.length&&void 0===e.minLength&&void 0===e.maxLength||t.push(new Pt(e.length,e.minLength,e.maxLength))),t}var jt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n,a="Cannot set type for ".concat(r," property of ").concat(t.constructor.name," schema");Kt.has(t.constructor)?(n=Kt.get(t.constructor)).target!==t.constructor&&(n=Kt.create(t.constructor),Kt.set(t.constructor,n)):(n=Kt.create(t.constructor),Kt.set(t.constructor,n));var i={type:wt.Any,validations:[]},o=Object.assign(i,e);if(o.validations=Dt(o),"number"!=typeof o.type&&!Kt.has(o.type)&&!xt(o.type))throw new Error("".concat(a,". Assigning type doesn't have schema."));var u,s=_createForOfIteratorHelper(Array.isArray(e.schema)?e.schema:[e.schema||Rt]);try{for(s.s();!(u=s.n()).done;){var c=u.value;n.names[c]||(n.names[c]={}),n.names[c][r]=o}}catch(e){s.e(e)}finally{s.f()}}},Ft=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(),Jt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ft),Mt=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,"Unsupported operation: ".concat(e?"".concat(e):""))}return _createClass(r)}(Ft),Vt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Ft),zt=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,"".concat(e,": Missing required property"))}return _createClass(r)}(Ft);function Gt(e){return"object"===_typeof(e)&&"kty"in e}var qt=function(){function e(){_classCallCheck(this,e)}var t,r,n,a,i,o,u,c,l,h,f,v,p,y,g,d,m,k;return _createClass(e,[{key:"digest",value:(k=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkDigest.apply(this,r),e.abrupt("return",this.onDigest.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"checkDigest",value:function(e,t){this.checkAlgorithmName(e)}},{key:"onDigest",value:(m=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("digest");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"generateKey",value:(d=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkGenerateKey.apply(this,r),e.abrupt("return",this.onGenerateKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"checkGenerateKey",value:function(e,t,r){if(this.checkAlgorithmName(e),this.checkGenerateKeyParams(e),!r||!r.length)throw new TypeError("Usages cannot be empty when creating a key.");var n;n=Array.isArray(this.usages)?this.usages:this.usages.privateKey.concat(this.usages.publicKey),this.checkKeyUsages(r,n)}},{key:"checkGenerateKeyParams",value:function(e){}},{key:"onGenerateKey",value:(g=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("generateKey");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return g.apply(this,arguments)})},{key:"sign",value:(y=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkSign.apply(this,r),e.abrupt("return",this.onSign.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"checkSign",value:function(e,t,r){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"sign")}},{key:"onSign",value:(p=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("sign");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return p.apply(this,arguments)})},{key:"verify",value:(v=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkVerify.apply(this,r),e.abrupt("return",this.onVerify.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"checkVerify",value:function(e,t,r,n){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"verify")}},{key:"onVerify",value:(f=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("verify");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return f.apply(this,arguments)})},{key:"encrypt",value:(h=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkEncrypt.apply(this,r),e.abrupt("return",this.onEncrypt.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"checkEncrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"encrypt":void 0)}},{key:"onEncrypt",value:(l=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("encrypt");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"decrypt",value:(c=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkDecrypt.apply(this,r),e.abrupt("return",this.onDecrypt.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"checkDecrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"decrypt":void 0)}},{key:"onDecrypt",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("decrypt");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"deriveBits",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkDeriveBits.apply(this,r),e.abrupt("return",this.onDeriveBits.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"checkDeriveBits",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"deriveBits":void 0),r%8!=0)throw new Vt("length: Is not multiple of 8")}},{key:"onDeriveBits",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("deriveBits");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"exportKey",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkExportKey.apply(this,r),e.abrupt("return",this.onExportKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"checkExportKey",value:function(e,t){if(this.checkKeyFormat(e),this.checkCryptoKey(t),!t.extractable)throw new Ft("key: Is not extractable")}},{key:"onExportKey",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("exportKey");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"importKey",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t),n=0;n<t;n++)r[n]=a[n];return this.checkImportKey.apply(this,r),e.abrupt("return",this.onImportKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"checkImportKey",value:function(e,t,r,n,a){this.checkKeyFormat(e),this.checkKeyData(e,t),this.checkAlgorithmName(r),this.checkImportParams(r),Array.isArray(this.usages)&&this.checkKeyUsages(a,this.usages)}},{key:"onImportKey",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n,a,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mt("importKey");case 1:case"end":return e.stop()}}),e)}))),function(e,r,n,a,i){return t.apply(this,arguments)})},{key:"checkAlgorithmName",value:function(e){if(e.name.toLowerCase()!==this.name.toLowerCase())throw new Jt("Unrecognized name")}},{key:"checkAlgorithmParams",value:function(e){}},{key:"checkDerivedKeyParams",value:function(e){}},{key:"checkKeyUsages",value:function(e,t){var r,n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(-1===t.indexOf(a))throw new TypeError("Cannot create a key using the specified key usages")}}catch(e){n.e(e)}finally{n.f()}}},{key:"checkCryptoKey",value:function(e,t){if(this.checkAlgorithmName(e.algorithm),t&&-1===e.usages.indexOf(t))throw new Ft("key does not match that of operation")}},{key:"checkRequiredProperty",value:function(e,t){if(!(t in e))throw new zt(t)}},{key:"checkHashAlgorithm",value:function(e,t){var r,n=_createForOfIteratorHelper(t);try{for(n.s();!(r=n.n()).done;){if(r.value.toLowerCase()===e.name.toLowerCase())return}}catch(e){n.e(e)}finally{n.f()}throw new Vt("hash: Must be one of ".concat(t.join(", ")))}},{key:"checkImportParams",value:function(e){}},{key:"checkKeyFormat",value:function(e){switch(e){case"raw":case"pkcs8":case"spki":case"jwk":break;default:throw new TypeError("format: Is invalid value. Must be 'jwk', 'raw', 'spki', or 'pkcs8'")}}},{key:"checkKeyData",value:function(e,t){if(!t)throw new TypeError("keyData: Cannot be empty on empty on key importing");if("jwk"===e){if(!Gt(t))throw new TypeError("keyData: Is not JsonWebToken")}else if(!s.isBufferSource(t))throw new TypeError("keyData: Is not ArrayBufferView or ArrayBuffer")}},{key:"prepareData",value:function(e){return s.toArrayBuffer(e)}}]),e}(),Wt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");switch(e.length){case 128:case 192:case 256:break;default:throw new TypeError("length: Must be 128, 192, or 256")}}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),r}(qt),Xt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-CBC",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.iv.byteLength)throw new TypeError("iv: Must have length 16 bytes")}}]),r}(Wt),Zt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-CTR",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"counter"),!(e.counter instanceof ArrayBuffer||ArrayBuffer.isView(e.counter)))throw new TypeError("counter: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.counter.byteLength)throw new TypeError("iv: Must have length 16 bytes");if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new Vt("length: Must be more than 0")}}]),r}(Wt),$t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-ECB",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r)}(Wt),Yt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-GCM",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength<1)throw new Vt("iv: Must have length more than 0 and less than 2^64 - 1");switch("tagLength"in e||(e.tagLength=128),e.tagLength){case 32:case 64:case 96:case 104:case 112:case 120:case 128:break;default:throw new Vt("tagLength: Must be one of 32, 64, 96, 104, 112, 120 or 128")}}}]),r}(Wt),Qt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-KW",e.usages=["wrapKey","unwrapKey"],e}return _createClass(r)}(Wt),er=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.ivSize){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength!==this.ivSize)throw new TypeError("iv: Must have length ".concat(this.ivSize," bytes"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");if(e.length!==this.keySizeBits)throw new Vt("algorithm.length: Must be ".concat(this.keySizeBits))}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),r}(qt),tr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return _createClass(r,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=h.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");if(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength%8||e.modulusLength<256||e.modulusLength>16384)throw new TypeError("The modulus length must be a multiple of 8 bits and >= 256 and <= 16384")}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(qt),rr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSASSA-PKCS1-v1_5",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return _createClass(r)}(tr),nr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSA-PSS",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"saltLength"),"number"!=typeof e.saltLength)throw new TypeError("saltLength: Is not a Number");if(e.saltLength<0)throw new RangeError("saltLength: Must be positive number")}}]),r}(tr),ar=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSA-OAEP",e.usages={privateKey:["decrypt","unwrapKey"],publicKey:["encrypt","wrapKey"]},e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(e.label&&!(e.label instanceof ArrayBuffer||ArrayBuffer.isView(e.label)))throw new TypeError("label: Is not of type '(ArrayBuffer or ArrayBufferView)'")}}]),r}(tr),ir=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"checkGenerateKeyParams",value:function(e){this.checkRequiredProperty(e,"namedCurve"),this.checkNamedCurve(e.namedCurve)}},{key:"checkNamedCurve",value:function(e){var t,r=_createForOfIteratorHelper(this.namedCurves);try{for(r.s();!(t=r.n()).done;){if(t.value.toLowerCase()===e.toLowerCase())return}}catch(e){r.e(e)}finally{r.f()}throw new Vt("namedCurve: Must be one of ".concat(this.namedCurves.join(", ")))}}]),r}(qt),or=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="ECDSA",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages={privateKey:["sign"],publicKey:["verify"]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(ir),ur=["secret","private","public"],sr=function(e){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"CryptoKey"}}],[{key:"create",value:function(e,t,r,n){var a=new this;return a.algorithm=e,a.type=t,a.extractable=r,a.usages=n,a}},{key:"isKeyType",value:function(e){return-1!==ur.indexOf(e)}}]),t}(),cr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="ECDH",e.usages={privateKey:["deriveBits","deriveKey"],publicKey:[]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"public"),!(e.public instanceof sr))throw new TypeError("public: Is not a CryptoKey");if("public"!==e.public.type)throw new Vt("public: Is not a public key");if(e.public.algorithm.name!==this.name)throw new Vt("public: Is not ".concat(this.name," key"))}}]),r}(ir),lr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="ECDH-ES",e.namedCurves=["X25519","X448"],e}return _createClass(r)}(cr),hr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="EdDSA",e.usages={privateKey:["sign"],publicKey:["verify"]},e.namedCurves=["Ed25519","Ed448"],e}return _createClass(r)}(ir),fr=_createClass((function e(t){_classCallCheck(this,e),t&&(this.value=t)}));mt([vt({type:Pe.ObjectIdentifier})],fr.prototype,"value",void 0),fr=mt([ft({type:Ue.Choice})],fr);var vr=_createClass((function e(t){_classCallCheck(this,e),Object.assign(this,t)}));mt([vt({type:Pe.ObjectIdentifier})],vr.prototype,"algorithm",void 0),mt([vt({type:Pe.Any,optional:!0})],vr.prototype,"parameters",void 0);var pr=_createClass((function e(){_classCallCheck(this,e),this.version=0,this.privateKeyAlgorithm=new vr,this.privateKey=new ArrayBuffer(0)}));mt([vt({type:Pe.Integer})],pr.prototype,"version",void 0),mt([vt({type:vr})],pr.prototype,"privateKeyAlgorithm",void 0),mt([vt({type:Pe.OctetString})],pr.prototype,"privateKey",void 0),mt([vt({type:Pe.Any,optional:!0})],pr.prototype,"attributes",void 0);var yr=_createClass((function e(){_classCallCheck(this,e),this.publicKeyAlgorithm=new vr,this.publicKey=new ArrayBuffer(0)}));mt([vt({type:vr})],yr.prototype,"publicKeyAlgorithm",void 0),mt([vt({type:Pe.BitString})],yr.prototype,"publicKey",void 0);var gr={fromJSON:function(e){return h.FromBase64Url(e)},toJSON:function(e){return h.ToBase64Url(new Uint8Array(e))}},dr={fromASN:function(e){var t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:function(e){var t=new Uint8Array(e)[0]>127?f(new Uint8Array([0]).buffer,e):e;return new W({valueHex:t})}},mr=_createClass((function e(){_classCallCheck(this,e),this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)}));mt([vt({type:Pe.Integer,converter:He})],mr.prototype,"version",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"n",converter:gr})],mr.prototype,"modulus",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"e",converter:gr})],mr.prototype,"publicExponent",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"d",converter:gr})],mr.prototype,"privateExponent",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"p",converter:gr})],mr.prototype,"prime1",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"q",converter:gr})],mr.prototype,"prime2",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"dp",converter:gr})],mr.prototype,"exponent1",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"dq",converter:gr})],mr.prototype,"exponent2",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"qi",converter:gr})],mr.prototype,"coefficient",void 0),mt([vt({type:Pe.Any,optional:!0})],mr.prototype,"otherPrimeInfos",void 0);var kr=_createClass((function e(){_classCallCheck(this,e),this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)}));mt([vt({type:Pe.Integer,converter:dr}),jt({name:"n",converter:gr})],kr.prototype,"modulus",void 0),mt([vt({type:Pe.Integer,converter:dr}),jt({name:"e",converter:gr})],kr.prototype,"publicExponent",void 0);var wr=function(){function e(t){_classCallCheck(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return _createClass(e,[{key:"toJSON",value:function(){var e=new Uint8Array(this.value);if(4!==e[0])throw new Ft("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");var t=(e=new Uint8Array(this.value.slice(1))).length/2;return{x:h.ToBase64Url(e.buffer.slice(0,0+t)),y:h.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");var t=h.FromBase64Url(e.x),r=h.FromBase64Url(e.y),n=f(new Uint8Array([4]).buffer,t,r);return this.value=new Uint8Array(n).buffer,this}}]),e}();mt([vt({type:Pe.OctetString})],wr.prototype,"value",void 0),wr=mt([ft({type:Ue.Choice})],wr);var br=function(){function e(){_classCallCheck(this,e),this.version=1,this.privateKey=new ArrayBuffer(0)}return _createClass(e,[{key:"fromJSON",value:function(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=h.FromBase64Url(e.d),"x"in e){var t=new wr;t.fromJSON(e),this.publicKey=gt.toASN(t).valueBlock.valueHex}return this}},{key:"toJSON",value:function(){var e={};return e.d=h.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new wr(this.publicKey).toJSON()),e}}]),e}();mt([vt({type:Pe.Integer,converter:He})],br.prototype,"version",void 0),mt([vt({type:Pe.OctetString})],br.prototype,"privateKey",void 0),mt([vt({context:0,type:Pe.Any,optional:!0})],br.prototype,"parameters",void 0),mt([vt({context:1,type:Pe.BitString,optional:!0})],br.prototype,"publicKey",void 0);var _r={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);return r.set(t,1),new W({valueHex:r.buffer})}return new W({valueHex:e})}},Cr=Object.freeze({__proto__:null,AsnIntegerWithoutPaddingConverter:_r}),Sr=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"decodePoint",value:function(e,t){var r=s.toUint8Array(e);if(0===r.length||4!==r[0])throw new Error("Only uncompressed point format supported");var n=(r.length-1)/2;if(n!==Math.ceil(t/8))throw new Error("Point does not match field size");return{x:r.slice(1,n+1),y:r.slice(n+1,n+1+n)}}},{key:"encodePoint",value:function(e,t){var r=Math.ceil(t/8);if(e.x.byteLength!==r||e.y.byteLength!==r)throw new Error("X,Y coordinates don't match point size criteria");var n=s.toUint8Array(e.x),a=s.toUint8Array(e.y),i=new Uint8Array(2*r+1);return i[0]=4,i.set(n,1),i.set(a,r+1),i}},{key:"getSize",value:function(e){return Math.ceil(e/8)}},{key:"encodeSignature",value:function(e,t){var r=this.getSize(t),n=s.toUint8Array(e.r),a=s.toUint8Array(e.s),i=new Uint8Array(2*r);return i.set(this.padStart(n,r)),i.set(this.padStart(a,r),r),i}},{key:"decodeSignature",value:function(e,t){var r=this.getSize(t),n=s.toUint8Array(e);if(n.length!==2*r)throw new Error("Incorrect size of the signature");var a=n.slice(0,r),i=n.slice(r);return{r:this.trimStart(a),s:this.trimStart(i)}}},{key:"trimStart",value:function(e){for(var t=0;t<e.length-1&&0===e[t];)t++;return 0===t?e:e.slice(t,e.length)}},{key:"padStart",value:function(e,t){if(t===e.length)return e;var r=new Uint8Array(t);return r.set(e,t-e.length),r}}]),e}(),Ar=function(){function e(){_classCallCheck(this,e),this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)}return _createClass(e,[{key:"toWebCryptoSignature",value:function(e){return null!=e||(e=8*Math.max(this.r.byteLength,this.s.byteLength)),Sr.encodeSignature(this,e).buffer}}],[{key:"fromWebCryptoSignature",value:function(t){var r=t.byteLength/2,n=Sr.decodeSignature(t,8*r),a=new e;return a.r=s.toArrayBuffer(n.r),a.s=s.toArrayBuffer(n.s),a}}]),e}();mt([vt({type:Pe.Integer,converter:_r})],Ar.prototype,"r",void 0),mt([vt({type:Pe.Integer,converter:_r})],Ar.prototype,"s",void 0);var Br=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(pr);mt([vt({context:1,implicit:!0,type:Pe.BitString,optional:!0})],Br.prototype,"publicKey",void 0);var xr=function(){function e(){_classCallCheck(this,e),this.value=new ArrayBuffer(0)}return _createClass(e,[{key:"fromJSON",value:function(e){if(!e.d)throw new Error("d: Missing required property");return this.value=h.FromBase64Url(e.d),this}},{key:"toJSON",value:function(){return{d:h.ToBase64Url(this.value)}}}]),e}();mt([vt({type:Pe.OctetString})],xr.prototype,"value",void 0),xr=mt([ft({type:Ue.Choice})],xr);var Er=function(){function e(t){_classCallCheck(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return _createClass(e,[{key:"toJSON",value:function(){return{x:h.ToBase64Url(this.value)}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");return this.value=h.FromBase64Url(e.x),this}}]),e}();mt([vt({type:Pe.BitString})],Er.prototype,"value",void 0),Er=mt([ft({type:Ue.Choice})],Er);var Rr=_createClass((function e(){_classCallCheck(this,e)}));mt([vt({type:Pe.OctetString}),jt({type:wt.String,converter:gr})],Rr.prototype,"d",void 0),Rr=mt([ft({type:Ue.Choice})],Rr);var Kr="1.2.840.10045.3.1.7",Or="1.3.132.0",Nr="".concat(Or,".34"),Ur="".concat(Or,".35"),Pr="".concat(Or,".10"),Lr="1.3.36.3.3.2.8.1.1",Ir="".concat(Lr,".1"),Hr="".concat(Lr,".2"),Tr="".concat(Lr,".3"),Dr="".concat(Lr,".4"),jr="".concat(Lr,".5"),Fr="".concat(Lr,".6"),Jr="".concat(Lr,".7"),Mr="".concat(Lr,".8"),Vr="".concat(Lr,".9"),zr="".concat(Lr,".10"),Gr="".concat(Lr,".11"),qr="".concat(Lr,".12"),Wr="".concat(Lr,".13"),Xr="".concat(Lr,".14"),Zr=Object.freeze({__proto__:null,converters:Cr,get ObjectIdentifier(){return fr},AlgorithmIdentifier:vr,PrivateKeyInfo:pr,PublicKeyInfo:yr,RsaPrivateKey:mr,RsaPublicKey:kr,EcPrivateKey:br,get EcPublicKey(){return wr},EcDsaSignature:Ar,OneAsymmetricKey:Br,get EdPrivateKey(){return xr},get EdPublicKey(){return Er},get CurvePrivateKey(){return Rr},idSecp256r1:Kr,idEllipticCurve:Or,idSecp384r1:Nr,idSecp521r1:Ur,idSecp256k1:Pr,idVersionOne:Lr,idBrainpoolP160r1:Ir,idBrainpoolP160t1:Hr,idBrainpoolP192r1:Tr,idBrainpoolP192t1:Dr,idBrainpoolP224r1:jr,idBrainpoolP224t1:Fr,idBrainpoolP256r1:Jr,idBrainpoolP256t1:Mr,idBrainpoolP320r1:Vr,idBrainpoolP320t1:zr,idBrainpoolP384r1:Gr,idBrainpoolP384t1:qr,idBrainpoolP512r1:Wr,idBrainpoolP512t1:Xr,idX25519:"1.3.101.110",idX448:"1.3.101.111",idEd25519:"1.3.101.112",idEd448:"1.3.101.113"}),$r=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"register",value:function(e){var t=new fr;t.value=e.id;var r=dt.serialize(t);this.items.push(_objectSpread(_objectSpread({},e),{},{raw:r})),this.names.push(e.name)}},{key:"find",value:function(e){e=e.toUpperCase();var t,r=_createForOfIteratorHelper(this.items);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.name.toUpperCase()===e||n.id.toUpperCase()===e)return n}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"get",value:function(e){var t=this.find(e);if(!t)throw new Error("Unsupported EC named curve '".concat(e,"'"));return t}}]),e}();$r.items=[],$r.names=[],$r.register({name:"P-256",id:Kr,size:256}),$r.register({name:"P-384",id:Nr,size:384}),$r.register({name:"P-521",id:Ur,size:521}),$r.register({name:"K-256",id:Pr,size:256}),$r.register({name:"brainpoolP160r1",id:Ir,size:160}),$r.register({name:"brainpoolP160t1",id:Hr,size:160}),$r.register({name:"brainpoolP192r1",id:Tr,size:192}),$r.register({name:"brainpoolP192t1",id:Dr,size:192}),$r.register({name:"brainpoolP224r1",id:jr,size:224}),$r.register({name:"brainpoolP224t1",id:Fr,size:224}),$r.register({name:"brainpoolP256r1",id:Jr,size:256}),$r.register({name:"brainpoolP256t1",id:Mr,size:256}),$r.register({name:"brainpoolP320r1",id:Vr,size:320}),$r.register({name:"brainpoolP320t1",id:zr,size:320}),$r.register({name:"brainpoolP384r1",id:Gr,size:384}),$r.register({name:"brainpoolP384t1",id:qr,size:384}),$r.register({name:"brainpoolP512r1",id:Wr,size:512}),$r.register({name:"brainpoolP512t1",id:Xr,size:512});var Yr,Qr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="HMAC",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["sign","verify"],e}return _createClass(r,[{key:"getDefaultLength",value:function(e){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":return 512;default:throw new Error("Unknown algorithm name '".concat(e,"'"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),"length"in e){if("number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new RangeError("length: Number is out of range")}}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(qt),en=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="PBKDF2",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["deriveBits","deriveKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!(e.salt instanceof ArrayBuffer||ArrayBuffer.isView(e.salt)))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"iterations"),"number"!=typeof e.iterations)throw new TypeError("iterations: Is not a Number");if(e.iterations<1)throw new TypeError("iterations: Is less than 1")}},{key:"checkImportKey",value:function(e,t,n,a,i){if(_get(_getPrototypeOf(r.prototype),"checkImportKey",this).call(this,e,t,n,a,i),a)throw new SyntaxError("extractable: Must be 'false'")}}]),r}(qt),tn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).usages=[],e.defaultLength=0,e}return _createClass(r,[{key:"digest",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[0]=_objectSpread({length:this.defaultLength},t[0]),_get(_getPrototypeOf(r.prototype),"digest",this).apply(this,t)}},{key:"checkDigest",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkDigest",this).call(this,e,t);var n=e.length||0;if("number"!=typeof n)throw new TypeError("length: Is not a Number");if(n<0)throw new TypeError("length: Is negative")}}]),r}(qt),rn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="shake128",e.defaultLength=16,e}return _createClass(r)}(tn),nn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="shake256",e.defaultLength=32,e}return _createClass(r)}(tn),an=function(e){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"Crypto"}},{key:"randomUUID",value:function(){var e=this.getRandomValues(new Uint8Array(16));e[6]=15&e[6]|64,e[8]=63&e[8]|128;var t=h.ToHex(e).toLowerCase();return"".concat(t.substring(0,8),"-").concat(t.substring(8,12),"-").concat(t.substring(12,16),"-").concat(t.substring(16))}}]),t}(),on=function(){function e(){_classCallCheck(this,e),this.items={}}return _createClass(e,[{key:"get",value:function(e){return this.items[e.toLowerCase()]||null}},{key:"set",value:function(e){this.items[e.name.toLowerCase()]=e}},{key:"removeAt",value:function(e){var t=this.get(e.toLowerCase());return t&&delete this.items[e],t}},{key:"has",value:function(e){return!!this.get(e)}},{key:"length",get:function(){return Object.keys(this.items).length}},{key:"algorithms",get:function(){var e=[];for(var t in this.items){var r=this.items[t];e.push(r.name)}return e.sort()}}]),e}(),un=function(e){function t(){_classCallCheck(this,t),this.providers=new on}var r,n,a,i,o,u,c,l,f,v,p,y;return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"SubtleCrypto"}},{key:"digest",value:(y=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,c,l,h,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,2,"digest"),a=r[0],i=r[1],o=r.slice(2),u=this.prepareAlgorithm(a),c=s.toArrayBuffer(i),l=this.getProvider(u.name),e.next=8,l.digest.apply(l,[u,c].concat(_toConsumableArray(o)));case 8:return h=e.sent,e.abrupt("return",h);case 10:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"generateKey",value:(p=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,s,c,l,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=h.length,r=new Array(t),n=0;n<t;n++)r[n]=h[n];return this.checkRequiredArguments(r,3,"generateKey"),a=r[0],i=r[1],o=r[2],u=r.slice(3),s=this.prepareAlgorithm(a),c=this.getProvider(s.name),e.next=7,c.generateKey.apply(c,[_objectSpread(_objectSpread({},s),{},{name:c.name}),i,o].concat(_toConsumableArray(u)));case 7:return l=e.sent,e.abrupt("return",l);case 9:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"sign",value:(v=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,c,l,h,f,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.length,r=new Array(t),n=0;n<t;n++)r[n]=v[n];return this.checkRequiredArguments(r,3,"sign"),a=r[0],i=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(i),c=this.prepareAlgorithm(a),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.sign.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),i,l].concat(_toConsumableArray(u)));case 9:return f=e.sent,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"verify",value:(f=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,c,l,h,f,v,p,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=y.length,r=new Array(t),n=0;n<t;n++)r[n]=y[n];return this.checkRequiredArguments(r,4,"verify"),a=r[0],i=r[1],o=r[2],u=r[3],c=r.slice(4),this.checkCryptoKey(i),l=this.prepareAlgorithm(a),h=s.toArrayBuffer(u),f=s.toArrayBuffer(o),v=this.getProvider(l.name),e.next=10,v.verify.apply(v,[_objectSpread(_objectSpread({},l),{},{name:v.name}),i,f,h].concat(_toConsumableArray(c)));case 10:return p=e.sent,e.abrupt("return",p);case 12:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"encrypt",value:(l=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,c,l,h,f,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.length,r=new Array(t),n=0;n<t;n++)r[n]=v[n];return this.checkRequiredArguments(r,3,"encrypt"),a=r[0],i=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(i),c=this.prepareAlgorithm(a),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.encrypt.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),i,l,{keyUsage:!0}].concat(_toConsumableArray(u)));case 9:return f=e.sent,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"decrypt",value:(c=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,c,l,h,f,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.length,r=new Array(t),n=0;n<t;n++)r[n]=v[n];return this.checkRequiredArguments(r,3,"decrypt"),a=r[0],i=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(i),c=this.prepareAlgorithm(a),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.decrypt.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),i,l,{keyUsage:!0}].concat(_toConsumableArray(u)));case 9:return f=e.sent,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"deriveBits",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,s,c,l,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=h.length,r=new Array(t),n=0;n<t;n++)r[n]=h[n];return this.checkRequiredArguments(r,3,"deriveBits"),a=r[0],i=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(i),s=this.prepareAlgorithm(a),c=this.getProvider(s.name),e.next=8,c.deriveBits.apply(c,[_objectSpread(_objectSpread({},s),{},{name:c.name}),i,o,{keyUsage:!0}].concat(_toConsumableArray(u)));case 8:return l=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"deriveKey",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,s,c,l,h,f,v,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];return this.checkRequiredArguments(r,5,"deriveKey"),a=r[0],i=r[1],o=r[2],u=r[3],s=r[4],c=r.slice(5),l=this.prepareAlgorithm(o),this.getProvider(l.name).checkDerivedKeyParams(l),h=this.prepareAlgorithm(a),(f=this.getProvider(h.name)).checkCryptoKey(i,"deriveKey"),e.next=11,f.deriveBits.apply(f,[_objectSpread(_objectSpread({},h),{},{name:f.name}),i,o.length||512,{keyUsage:!1}].concat(_toConsumableArray(c)));case 11:return v=e.sent,e.abrupt("return",this.importKey.apply(this,["raw",v,o,u,s].concat(_toConsumableArray(c))));case 13:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"exportKey",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,s,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=c.length,r=new Array(t),n=0;n<t;n++)r[n]=c[n];return this.checkRequiredArguments(r,2,"exportKey"),a=r[0],i=r[1],o=r.slice(2),this.checkCryptoKey(i),u=this.getProvider(i.algorithm.name),e.next=7,u.exportKey.apply(u,[a,i].concat(_toConsumableArray(o)));case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"importKey",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,c,l,h,f,v,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];if(this.checkRequiredArguments(r,5,"importKey"),a=r[0],i=r[1],o=r[2],u=r[3],c=r[4],l=r.slice(5),h=this.prepareAlgorithm(o),f=this.getProvider(h.name),-1===["pkcs8","spki","raw"].indexOf(a)){e.next=10;break}return v=s.toArrayBuffer(i),e.abrupt("return",f.importKey.apply(f,[a,v,_objectSpread(_objectSpread({},h),{},{name:f.name}),u,c].concat(_toConsumableArray(l))));case 10:if(i.kty){e.next=12;break}throw new TypeError("keyData: Is not JSON");case 12:return e.abrupt("return",f.importKey.apply(f,[a,i,_objectSpread(_objectSpread({},h),{},{name:f.name}),u,c].concat(_toConsumableArray(l))));case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"wrapKey",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n,a){var i,o,u,c,l,f,v,p,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=y.length,o=new Array(i>4?i-4:0),u=4;u<i;u++)o[u-4]=y[u];return e.next=3,this.exportKey.apply(this,[t,r].concat(o));case 3:return c=e.sent,"jwk"===t&&(l=JSON.stringify(c),c=h.FromUtf8String(l)),f=this.prepareAlgorithm(a),v=s.toArrayBuffer(c),p=this.getProvider(f.name),e.abrupt("return",p.encrypt.apply(p,[_objectSpread(_objectSpread({},f),{},{name:p.name}),n,v,{keyUsage:!1}].concat(o)));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"unwrapKey",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r,n,a,i,o,u){var c,l,f,v,p,y,g,d,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=this.prepareAlgorithm(a),l=s.toArrayBuffer(r),f=this.getProvider(c.name),v=m.length,p=new Array(v>7?v-7:0),y=7;y<v;y++)p[y-7]=m[y];return e.next=6,f.decrypt.apply(f,[_objectSpread(_objectSpread({},c),{},{name:f.name}),n,l,{keyUsage:!1}].concat(p));case 6:if(g=e.sent,"jwk"!==t){e.next=17;break}e.prev=8,g=JSON.parse(h.ToUtf8String(g)),e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(8),(d=new TypeError("wrappedKey: Is not a JSON")).internal=e.t0,d;case 17:return e.abrupt("return",this.importKey.apply(this,[t,g,i,o,u].concat(p)));case 18:case"end":return e.stop()}}),e,this,[[8,12]])}))),function(e,t,n,a,i,o,u){return r.apply(this,arguments)})},{key:"checkRequiredArguments",value:function(e,t,r){if(e.length<t)throw new TypeError("Failed to execute '".concat(r,"' on 'SubtleCrypto': ").concat(t," arguments required, but only ").concat(e.length," present"))}},{key:"prepareAlgorithm",value:function(e){if("string"==typeof e)return{name:e};if(t.isHashedAlgorithm(e)){var r=_objectSpread({},e);return r.hash=this.prepareAlgorithm(e.hash),r}return _objectSpread({},e)}},{key:"getProvider",value:function(e){var t=this.providers.get(e);if(!t)throw new Jt("Unrecognized name");return t}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof sr))throw new TypeError("Key is not of type 'CryptoKey'")}}],[{key:"isHashedAlgorithm",value:function(e){return!!(e&&"object"===_typeof(e)&&"name"in e&&"hash"in e)}}]),t}(),sn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"enabled",get:function(){return"undefined"!=typeof self&&self.PV_WEBCRYPTO_LINER_LOG}},{key:"log",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.log.apply(console,t)}}},{key:"error",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error.apply(console,t)}}},{key:"info",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.info.apply(console,t)}}},{key:"warn",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.warn.apply(console,t)}}},{key:"trace",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.trace.apply(console,t)}}}]),e}();function cn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),a=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[a+r]=e[r];a+=e.length})),n}!function(e){e.Unknown="Unknown",e.IE="Internet Explorer",e.Safari="Safari",e.Edge="Edge",e.Chrome="Chrome",e.Firefox="Firefox Mozilla",e.Mobile="Mobile"}(Yr||(Yr={}));var ln=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i){var o;return _classCallCheck(this,r),(o=t.call(this)).extractable=n,o.type=a,o.usages=i,o.algorithm=Object.assign({},e),o}return _createClass(r)}(sr);function hn(e,t){return e.name.toUpperCase()===t.toUpperCase()}var fn=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"secret",a)).raw=i,o}return _createClass(r,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:h.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"AES-CBC":return"A".concat(this.algorithm.length,"CBC");case"AES-CTR":return"A".concat(this.algorithm.length,"CTR");case"AES-GCM":return"A".concat(this.algorithm.length,"GCM");case"AES-ECB":return"A".concat(this.algorithm.length,"ECB");default:throw new Jt("Unsupported algorithm name")}}}]),r}(ln),vn=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof fn))throw new TypeError("key: Is not AesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),a.abrupt("return",new fn(t,r,n,i));case 2:case"end":return a.stop()}}),a)})))}},{key:"encrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,s.toUint8Array(r),!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,s.toUint8Array(r),!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"exportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="jwk"===r.t0?3:"raw"===r.t0?4:5;break;case 3:return r.abrupt("return",t.toJSON());case 4:return r.abrupt("return",t.raw.buffer);case 5:throw new Vt("format: Must be 'jwk' or 'raw'");case 6:case"end":return r.stop()}}),r)})))}},{key:"importKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Gt(t)?h.FromBase64Url(t.k):s.toArrayBuffer(t),e.t0=i.byteLength<<3,e.next=128===e.t0||192===e.t0||256===e.t0?4:5;break;case 4:return e.abrupt("break",6);case 5:throw new Vt("keyData: Is wrong key length");case 6:return o=new fn({name:r.name,length:i.byteLength<<3},n,a,new Uint8Array(i)),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))}},{key:"cipher",value:function(e,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function o(){var u,c,l,h,f,v;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(u=a?"encrypt":"decrypt",!hn(e,t.AesCBC)){o.next=6;break}l=s.toUint8Array(e.iv),c=i.AES_CBC[u](n,r.raw,void 0,l),o.next=18;break;case 6:if(!hn(e,t.AesGCM)){o.next=13;break}h=s.toUint8Array(e.iv),e.additionalData&&(f=s.toArrayBuffer(e.additionalData)),v=(e.tagLength||128)/8,c=i.AES_GCM[u](n,r.raw,h,f,v),o.next=18;break;case 13:if(!hn(e,t.AesECB)){o.next=17;break}c=i.AES_ECB[u](n,r.raw,!0),o.next=18;break;case 17:throw new Vt("algorithm: Is not recognized");case 18:return o.abrupt("return",s.toArrayBuffer(c));case 19:case"end":return o.stop()}}),o)})))}}]),t}();vn.AesCBC="AES-CBC",vn.AesECB="AES-ECB",vn.AesGCM="AES-GCM";var pn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",vn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",vn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),vn.checkCryptoKey(e)}}]),r}(Xt),yn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",vn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",vn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),vn.checkCryptoKey(e)}}]),r}($t),gn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",vn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",vn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),vn.checkCryptoKey(e)}}]),r}(Yt),dn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new i.AES_CTR(t.raw,s.toUint8Array(e.counter)).encrypt(s.toUint8Array(r)),n.abrupt("return",s.toArrayBuffer(a));case 2:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new i.AES_CTR(t.raw,s.toUint8Array(e.counter)).decrypt(s.toUint8Array(r)),n.abrupt("return",s.toArrayBuffer(a));case 2:case"end":return n.stop()}}),n)})))}},{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",vn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",vn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",vn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),vn.checkCryptoKey(e)}}]),r}(Zt),mn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),vn.checkCryptoKey(e)}}]),r}(Qt),kn=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i,o){var u;return _classCallCheck(this,r),(u=t.call(this,e,n,a,i)).data=o,u}return _createClass(r)}(ln),wn=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof kn))throw new TypeError("key: Is not RsaCryptoKey")}},{key:"generateKey",value:function(t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,o,u,s,c,l,h,f=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i={name:"RSA-PSS",hash:"SHA-256",publicExponent:t.publicExponent,modulusLength:t.modulusLength},a.next=3,e.nativeSubtle.generateKey(i,!0,["sign","verify"]);case 3:return o=a.sent,u=new Ki,a.next=7,u.subtle.exportKey("pkcs8",o.privateKey);case 7:return s=a.sent,a.next=10,u.subtle.importKey("pkcs8",s,t,r,n.filter((function(e){return f.privateUsages.includes(e)})));case 10:return c=a.sent,a.next=13,u.subtle.exportKey("spki",o.publicKey);case 13:return l=a.sent,a.next=16,u.subtle.importKey("spki",l,t,!0,n.filter((function(e){return f.publicUsages.includes(e)})));case 16:return h=a.sent,a.abrupt("return",{privateKey:c,publicKey:h});case 18:case"end":return a.stop()}}),a)})))}},{key:"exportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="pkcs8"===r.t0?3:"spki"===r.t0?4:"jwk"===r.t0?5:6;break;case 3:return r.abrupt("return",this.exportPkcs8Key(t));case 4:return r.abrupt("return",this.exportSpkiKey(t));case 5:return r.abrupt("return",this.exportJwkKey(t));case 6:throw new Vt("format: Must be 'jwk', 'pkcs8' or 'spki'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:i.t0=e,i.next="pkcs8"===i.t0?3:"spki"===i.t0?5:"jwk"===i.t0?7:9;break;case 3:return o=this.importPkcs8Key(t),i.abrupt("break",10);case 5:return o=this.importSpkiKey(t),i.abrupt("break",10);case 7:return o=this.importJwkKey(t),i.abrupt("break",10);case 9:throw new Vt("format: Must be 'jwk', 'pkcs8' or 'spki'");case 10:return u=new kn(Object.assign({publicExponent:1===o[1][1]?o[1].slice(1):o[1].slice(3),modulusLength:o[0].byteLength<<3},r),n,2===o.length?"public":"private",a,o),i.abrupt("return",u);case 12:case"end":return i.stop()}}),i,this)})))}},{key:"randomNonZeroValues",value:function(t){return(t=e.nativeCrypto.getRandomValues(t)).map((function(t){for(;!t;)t=e.nativeCrypto.getRandomValues(new Uint8Array(1))[0];return t}))}},{key:"exportPkcs8Key",value:function(e){var t=new Zr.PrivateKeyInfo;return t.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",t.privateKeyAlgorithm.parameters=null,t.privateKey=dt.serialize(this.exportAsmKey(e.data)),dt.serialize(t)}},{key:"importPkcs8Key",value:function(e){var t=dt.parse(e,Zr.PrivateKeyInfo),r=dt.parse(t.privateKey,Zr.RsaPrivateKey);return this.importAsmKey(r)}},{key:"importSpkiKey",value:function(e){var t=dt.parse(e,Zr.PublicKeyInfo),r=dt.parse(t.publicKey,Zr.RsaPublicKey);return this.importAsmKey(r)}},{key:"exportSpkiKey",value:function(e){var t=new Zr.RsaPublicKey;t.modulus=e.data[0].buffer,t.publicExponent=1===e.data[1][1]?e.data[1].buffer.slice(1):e.data[1].buffer.slice(3);var r=new Zr.PublicKeyInfo;return r.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",r.publicKeyAlgorithm.parameters=null,r.publicKey=dt.serialize(t),dt.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?Tt.fromJSON(e,{targetSchema:Zr.RsaPrivateKey}):Tt.fromJSON(e,{targetSchema:Zr.RsaPublicKey}),this.importAsmKey(t)}},{key:"exportJwkKey",value:function(e){var t=this.exportAsmKey(e.data),r=Ht.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.kty="RSA",r.alg=this.getJwkAlgorithm(e.algorithm),r}},{key:"getJwkAlgorithm",value:function(e){switch(e.name.toUpperCase()){case"RSA-OAEP":var t=/(\d+)$/.exec(e.hash.name)[1];return"RSA-OAEP".concat("1"!==t?"-".concat(t):"");case"RSASSA-PKCS1-V1_5":return"RS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSA-PSS":return"PS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSAES-PKCS1-V1_5":return"PS1";default:throw new Vt("algorithm: Is not recognized")}}},{key:"exportAsmKey",value:function(e){var t;if(e.length>2){var r=new Zr.RsaPrivateKey;r.privateExponent=e[2].buffer,r.prime1=e[3].buffer,r.prime2=e[4].buffer,r.exponent1=e[5].buffer,r.exponent2=e[6].buffer,r.coefficient=e[7].buffer,t=r}else t=new Zr.RsaPublicKey;return t.modulus=e[0].buffer,t.publicExponent=1===e[1][1]?e[1].buffer.slice(1):e[1].buffer.slice(3),t}},{key:"importAsmKey",value:function(e){var t=new Uint8Array(4-e.publicExponent.byteLength),r=[new Uint8Array(e.modulus),cn(t,new Uint8Array(e.publicExponent))];return e instanceof Zr.RsaPrivateKey&&(r.push(new Uint8Array(e.privateExponent)),r.push(new Uint8Array(e.prime1)),r.push(new Uint8Array(e.prime2)),r.push(new Uint8Array(e.exponent1)),r.push(new Uint8Array(e.exponent2)),r.push(new Uint8Array(e.coefficient))),r}}]),t}();wn.RsaSsa="RSASSA-PKCS1-v1_5",wn.RsaPss="RSA-PSS",wn.RsaOaep="RSA-OAEP",wn.privateUsages=["sign","decrypt","unwrapKey"],wn.publicUsages=["verify","encrypt","wrapKey"];var bn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getDigest",value:function(e){switch(e){case"SHA-1":return new i.Sha1;case"SHA-256":return new i.Sha256;case"SHA-512":return new i.Sha512;default:throw new Jt("keyAlgorithm.hash: Is not recognized")}}},{key:"digest",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=this.getDigest(e.name),a=n.process(s.toUint8Array(t)).finish().result,r.abrupt("return",s.toArrayBuffer(a));case 3:case"end":return r.stop()}}),r,this)})))}}]),e}(),_n=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",wn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",wn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),wn.checkCryptoKey(e)}},{key:"cipher",value:function(e,t,r){var n,a=bn.getDigest(t.algorithm.hash.name);e.label&&(n=s.toUint8Array(e.label));var o,u=new i.RSA_OAEP(t.data,a,n),c=s.toUint8Array(r);return o="public"===t.type?u.encrypt(c):u.decrypt(c),s.toArrayBuffer(o)}}]),r}(ar),Cn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",wn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",wn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"onSign",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new i.RSA_PSS(t.data,bn.getDigest(t.algorithm.hash.name),e.saltLength),o=a.sign(s.toUint8Array(r)),n.abrupt("return",s.toArrayBuffer(o));case 3:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=new i.RSA_PSS(t.data,bn.getDigest(t.algorithm.hash.name),e.saltLength),a.prev=1,o.verify(s.toUint8Array(r),s.toUint8Array(n)),a.next=8;break;case 5:return a.prev=5,a.t0=a.catch(1),a.abrupt("return",!1);case 8:return a.abrupt("return",!0);case 9:case"end":return a.stop()}}),a,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),wn.checkCryptoKey(e)}}]),r}(nr),Sn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",wn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",wn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"onSign",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i.RSA_PKCS1_v1_5(t.data,bn.getDigest(t.algorithm.hash.name)),a=n.sign(s.toUint8Array(r)),e.abrupt("return",s.toArrayBuffer(a));case 3:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new i.RSA_PKCS1_v1_5(t.data,bn.getDigest(t.algorithm.hash.name)),e.prev=1,a.verify(s.toUint8Array(r),s.toUint8Array(n)),e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),wn.checkCryptoKey(e)}}]),r}(rr),An=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSAES-PKCS1-v1_5",e.usages={publicKey:["encrypt","wrapKey"],privateKey:["decrypt","unwrapKey"]},e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=h.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new i.RSA(t.data).decrypt(new i.BigNumber(s.toUint8Array(r))).result,a=t.algorithm.modulusLength>>3,r.byteLength===a){e.next=4;break}throw new Ft("Decryption error. Encrypted message size doesn't match to key length");case 4:if(o=0,!n[o++]&&2===n[o++]){e.next=7;break}throw new Ft("Decryption error");case 7:if(0!==n[o++]){e.next=9;break}return e.abrupt("break",10);case 9:if(o<n.length){e.next=7;break}case 10:if(!(o<11)){e.next=12;break}throw new Ft("Decryption error. PS is less than 8 octets.");case 12:if(o!==n.length){e.next=14;break}throw new Ft("Decryption error. There is no octet with hexadecimal value 0x00 to separate PS from M");case 14:return e.abrupt("return",n.buffer.slice(o));case 15:case"end":return e.stop()}}),e)})))}},{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.algorithm.modulusLength>>3,!(r.byteLength>n-11)){e.next=3;break}throw new Ft("Message too long");case 3:return a=n-r.byteLength-3,o=wn.randomNonZeroValues(new Uint8Array(a)),(u=new Uint8Array(n))[0]=0,u[1]=2,u.set(o,2),u[2+a]=0,u.set(new Uint8Array(r),3+a),c=new i.RSA(t.data).encrypt(new i.BigNumber(u)).result,e.abrupt("return",s.toArrayBuffer(c));case 13:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",wn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,wn.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,a);case 2:return o=i.sent,i.abrupt("return",o);case 4:case"end":return i.stop()}}),i,this)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),wn.checkCryptoKey(e)}},{key:"prepareSignData",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Ki,r.abrupt("return",n.subtle.digest(e.hash,t));case 2:case"end":return r.stop()}}),r)})))}}]),r}(qt),Bn={"1.2.840.10045.3.1.7":"P-256","P-256":"1.2.840.10045.3.1.7","1.3.132.0.34":"P-384","P-384":"1.3.132.0.34","1.3.132.0.35":"P-521","P-521":"1.3.132.0.35","1.3.132.0.10":"K-256","K-256":"1.3.132.0.10","1.3.36.3.3.2.8.1.1.7":"brainpoolP256r1",brainpoolP256r1:"1.3.36.3.3.2.8.1.1.7","1.3.36.3.3.2.8.1.1.11":"brainpoolP384r1",brainpoolP384r1:"1.3.36.3.3.2.8.1.1.11","1.3.36.3.3.2.8.1.1.13":"brainpoolP512r1",brainpoolP512r1:"1.3.36.3.3.2.8.1.1.13"};function xn(e){var t=Bn[e];if(!t)throw new Vt("Cannot convert WebCrypto named curve '".concat(e,"' to OID"));return t}var En=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i,o){var u;return _classCallCheck(this,r),(u=t.call(this,e,n,a,i)).data=o,u}return _createClass(r)}(ln),Rn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"checkLib",value:function(){if(void 0===o)throw new Vt("Cannot implement EC mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/elliptic.js' script to your project")}},{key:"generateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,i,o,u,s=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkLib(),a=this.initEcKey(e.namedCurve),(i=a.genKeyPair()).getPublic(),o=new En(Object.assign({},e),t,"private",r.filter((function(e){return~s.privateUsages.indexOf(e)})),i),u=new En(Object.assign({},e),!0,"public",r.filter((function(e){return~s.publicUsages.indexOf(e)})),i),n.abrupt("return",{privateKey:o,publicKey:u});case 7:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof En))throw new TypeError("key: Is not EcCryptoKey")}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),a=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[a+r]=e[r];a+=e.length})),n}},{key:"exportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="pkcs8"===r.t0?4:"spki"===r.t0?5:"jwk"===r.t0?6:"raw"===r.t0?7:8;break;case 4:return r.abrupt("return",this.exportPkcs8Key(t));case 5:return r.abrupt("return",this.exportSpkiKey(t));case 6:return r.abrupt("return",this.exportJwkKey(t));case 7:return r.abrupt("return",new Uint8Array(t.data.getPublic("der")).buffer);case 8:throw new Vt("format: Must be 'jwk', 'raw, 'pkcs8' or 'spki'");case 9:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.checkLib(),i.t0=e,i.next="pkcs8"===i.t0?4:"spki"===i.t0?6:"raw"===i.t0?8:"jwk"===i.t0?10:12;break;case 4:return o=this.importPkcs8Key(t,r.namedCurve),i.abrupt("break",13);case 6:return o=this.importSpkiKey(t,r.namedCurve),i.abrupt("break",13);case 8:return o=this.importEcKey(new Zr.EcPublicKey(t),r.namedCurve),i.abrupt("break",13);case 10:return o=this.importJwkKey(t),i.abrupt("break",13);case 12:throw new Vt("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'");case 13:return u=new En(Object.assign({},r),n,o.priv?"private":"public",a,o),i.abrupt("return",u);case 15:case"end":return i.stop()}}),i,this)})))}},{key:"getNamedCurve",value:function(e){var t=e.toUpperCase(),r="";if(["P-256","P-384","P-521"].indexOf(t)>-1)r=t.replace("-","").toLowerCase();else if("K-256"===t)r="secp256k1";else{if(!["brainpoolP256r1","brainpoolP384r1","brainpoolP512r1"].includes(e))throw new Vt("Unsupported named curve '".concat(e,"'"));r=e}return r}},{key:"initEcKey",value:function(e){return o.ec(this.getNamedCurve(e))}},{key:"exportPkcs8Key",value:function(e){var t=new Zr.PrivateKeyInfo;return t.privateKeyAlgorithm.algorithm=this.ASN_ALGORITHM,t.privateKeyAlgorithm.parameters=dt.serialize(new Zr.ObjectIdentifier(xn(e.algorithm.namedCurve))),t.privateKey=dt.serialize(this.exportEcKey(e)),dt.serialize(t)}},{key:"importPkcs8Key",value:function(e,t){var r=dt.parse(e,Zr.PrivateKeyInfo),n=dt.parse(r.privateKey,Zr.EcPrivateKey);return this.importEcKey(n,t)}},{key:"importSpkiKey",value:function(e,t){var r=dt.parse(e,Zr.PublicKeyInfo),n=new Zr.EcPublicKey(r.publicKey);return this.importEcKey(n,t)}},{key:"exportSpkiKey",value:function(e){var t=new Zr.EcPublicKey(new Uint8Array(e.data.getPublic("der")).buffer),r=new Zr.PublicKeyInfo;return r.publicKeyAlgorithm.algorithm=this.ASN_ALGORITHM,r.publicKeyAlgorithm.parameters=dt.serialize(new Zr.ObjectIdentifier(xn(e.algorithm.namedCurve))),r.publicKey=t.value,dt.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?Tt.fromJSON(e,{targetSchema:Zr.EcPrivateKey}):Tt.fromJSON(e,{targetSchema:Zr.EcPublicKey}),this.importEcKey(t,e.crv)}},{key:"exportJwkKey",value:function(e){var t=this.exportEcKey(e),r=Ht.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.crv=e.algorithm.namedCurve,r.kty="EC",r}},{key:"exportEcKey",value:function(e){if("private"===e.type){var t=new Zr.EcPrivateKey,r=new Uint8Array(e.data.getPrivate("der").toArray()),n=new Uint8Array(this.getPointSize(e.algorithm.namedCurve)-r.length);return t.privateKey=cn(n,r),t.publicKey=new Uint8Array(e.data.getPublic("der")),t}if(e.data.pub)return new Zr.EcPublicKey(new Uint8Array(e.data.getPublic("der")).buffer);throw new Error("Cannot get private or public key")}},{key:"importEcKey",value:function(e,t){var r=this.initEcKey(t);return e instanceof Zr.EcPublicKey?r.keyFromPublic(new Uint8Array(e.value)):r.keyFromPrivate(new Uint8Array(e.privateKey))}},{key:"getPointSize",value:function(e){switch(e){case"P-256":case"K-256":return 32;case"P-384":return 48;case"P-521":return 66}throw new Error("namedCurve: Is not recognized")}}]),e}();Rn.privateUsages=["sign","deriveKey","deriveBits"],Rn.publicUsages=["verify"],Rn.ASN_ALGORITHM="1.2.840.10045.2.1";var Kn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).namedCurves=["P-256","P-384","P-521","K-256","brainpoolP256r1","brainpoolP384r1","brainpoolP512r1"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Rn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Rn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Rn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"onDeriveBits",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,i,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Rn.checkLib(),a=t.data.derive(e.public.data.getPublic()),i=new Uint8Array(a.toArray()),o=(o=i.length)>32?o>48?66:48:32,i.length<o&&(i=Rn.concat(new Uint8Array(o-i.length),i)),u=i.slice(0,r/8).buffer,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),Rn.checkCryptoKey(e)}}]),r}(cr);function On(e){for(var t=new Uint8Array(e),r=[],n=0;n<t.length;n++)r.push(t[n]);return r}var Nn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","SHA3-256","SHA3-384","SHA3-512"],e.namedCurves=["P-256","P-384","P-521","K-256","brainpoolP256r1","brainpoolP384r1","brainpoolP512r1"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Rn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Rn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Rn.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"onSign",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,i,o,u,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Rn.checkLib(),a=new Ki,n.next=4,a.subtle.digest(e.hash,r);case 4:return o=n.sent,i=On(o),n.next=8,t.data.sign(i);case 8:return u=n.sent,(s=new Zr.EcDsaSignature).r=new Uint8Array(u.r.toArray()).buffer,s.s=new Uint8Array(u.s.toArray()).buffer,n.abrupt("return",s.toWebCryptoSignature());case 13:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,o,u,s;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return Rn.checkLib(),i=new Ki,o={r:new Uint8Array(r.slice(0,r.byteLength/2)),s:new Uint8Array(r.slice(r.byteLength/2))},a.next=5,i.subtle.digest(e.hash,n);case 5:return u=a.sent,s=On(u),a.abrupt("return",t.data.verify(s,o));case 8:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),Rn.checkCryptoKey(e)}}]),r}(or),Un=(_defineProperty(n={},Zr.idEd448,"Ed448"),_defineProperty(n,"ed448",Zr.idEd448),_defineProperty(n,Zr.idX448,"X448"),_defineProperty(n,"x448",Zr.idX448),_defineProperty(n,Zr.idEd25519,"Ed25519"),_defineProperty(n,"ed25519",Zr.idEd25519),_defineProperty(n,Zr.idX25519,"X25519"),_defineProperty(n,"x25519",Zr.idX25519),n);function Pn(e){var t=Un[e.toLowerCase()];if(!t)throw new Vt("Cannot convert WebCrypto named curve '".concat(e,"' to OID"));return t}var Ln=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"private",a)).data=i,o}return _createClass(r,[{key:"toJSON",value:function(){var e={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(e,{d:h.ToBase64Url(h.FromHex(/^ed/i.test(e.crv)?this.data.getSecret("hex"):this.data.getPrivate("hex")))})}},{key:"fromJSON",value:function(e){if(!e.d)throw new Vt("Cannot get private data from JWK. Property 'd' is required");if(!e.crv)throw new Vt("Cannot get named curve from JWK. Property 'crv' is required");var t=h.ToHex(h.FromBase64Url(e.d)),r=new o.eddsa("ed25519");return this.data=r.keyFromSecret(t),this}}]),r}(ln),In=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"public",a)).data=i,o}return _createClass(r,[{key:"toJSON",value:function(){var e={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(e,{x:h.ToBase64Url(h.FromHex(this.data.getPublic("hex")))})}},{key:"fromJSON",value:function(e){if(!e.crv)throw new Vt("Cannot get named curve from JWK. Property 'crv' is required");if(!e.x)throw new Vt("Cannot get property from JWK. Property 'x' is required");var t=h.ToHex(h.FromBase64Url(e.x));if(/^ed/i.test(e.crv)){var r=new o.eddsa(e.crv.toLowerCase());this.data=r.keyFromPublic(t,"hex")}else{var n=o.ec(e.crv.replace(/^x/i,"curve"));this.data=n.keyFromPublic(t,"hex")}return this}}]),r}(ln),Hn=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkLib",value:function(){if(void 0===o)throw new Vt("Cannot implement EC mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/elliptic.js' script to your project")}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),a=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[a+r]=e[r];a+=e.length})),n}},{key:"generateKey",value:function(t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,u,s,c,l,h=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return this.checkLib(),"ed25519",u=e.nativeCrypto.getRandomValues(new Uint8Array(32)),s=new o.eddsa("ed25519"),i=s.keyFromSecret(u),c=new Ln(t,r,n.filter((function(e){return-1!==h.privateKeyUsages.indexOf(e)})),i),l=new In(t,!0,n.filter((function(e){return-1!==h.publicKeyUsages.indexOf(e)})),i),a.abrupt("return",{privateKey:c,publicKey:l});case 8:case"end":return a.stop()}}),a,this)})))}},{key:"sign",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkLib(),n=On(r),a=t.data.sign(n).toHex(),e.abrupt("return",h.FromHex(a));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"verify",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkLib(),a=On(n),i=t.data.verify(a,h.ToHex(r)),e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deriveBits",value:function(e,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,u,s,c,l,f,v,p,y;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return this.checkLib(),i=new Uint8Array(h.FromHex(r.data.getSecret("hex"))),u=new o.ec("curve25519"),s=u.keyFromPrivate(h.ToHex(i),"hex"),c=e.public.data.getPublic("hex"),new Uint8Array(h.FromHex(c)),l=e.public.data.getPublic(),f=s.derive(l),v=new Uint8Array(f.toArray()),p=(p=v.length)>32?p>48?66:48:32,v.length<p&&(v=t.concat(new Uint8Array(p-v.length),v)),y=v.slice(0,n/8).buffer,a.abrupt("return",y);case 14:case"end":return a.stop()}}),a,this)})))}},{key:"exportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a,i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e.toLowerCase(),r.next="jwk"===r.t0?4:"pkcs8"===r.t0?5:"spki"===r.t0?10:"raw"===r.t0?15:16;break;case 4:return r.abrupt("return",Ht.toJSON(t));case 5:return n=h.FromHex(t.data.getSecret("hex")),(a=new Zr.PrivateKeyInfo).privateKeyAlgorithm.algorithm=Pn(t.algorithm.namedCurve),a.privateKey=dt.serialize(new ut(n)),r.abrupt("return",dt.serialize(a));case 10:return i=h.FromHex(t.data.getPublic("hex")),(o=new Zr.PublicKeyInfo).publicKeyAlgorithm.algorithm=Pn(t.algorithm.namedCurve),o.publicKey=i,r.abrupt("return",dt.serialize(o));case 15:return r.abrupt("return",h.FromHex(t.data.getPublic("hex")));case 16:throw new Vt("format: Must be 'jwk', 'raw', pkcs8' or 'spki'");case 17:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o,u,s,c,l;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.checkLib(),i.t0=e.toLowerCase(),i.next="jwk"===i.t0?4:"raw"===i.t0?13:"spki"===i.t0?14:"pkcs8"===i.t0?16:19;break;case 4:if(!(o=t).d){i.next=10;break}return u=Tt.fromJSON(t,{targetSchema:Zr.CurvePrivateKey}),i.abrupt("return",this.importPrivateKey(u,r,n,a));case 10:if(o.x){i.next=12;break}throw new TypeError("keyData: Cannot get required 'x' field");case 12:return i.abrupt("return",this.importPublicKey(h.FromBase64Url(o.x),r,n,a));case 13:return i.abrupt("return",this.importPublicKey(t,r,n,a));case 14:return s=dt.parse(new Uint8Array(t),Zr.PublicKeyInfo),i.abrupt("return",this.importPublicKey(s.publicKey,r,n,a));case 16:return c=dt.parse(new Uint8Array(t),Zr.PrivateKeyInfo),l=dt.parse(c.privateKey,Zr.CurvePrivateKey),i.abrupt("return",this.importPrivateKey(l,r,n,a));case 19:throw new Vt("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'");case 20:case"end":return i.stop()}}),i,this)})))}},{key:"importPrivateKey",value:function(e,t,r,n){var a=new Ln(Object.assign({},t),r,n,null);return a.fromJSON({crv:t.namedCurve,d:h.ToBase64Url(e.d)}),a}},{key:"importPublicKey",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(i=new In(Object.assign({},t),r,n,null)).fromJSON({crv:t.namedCurve,x:h.ToBase64Url(e)}),a.abrupt("return",i);case 3:case"end":return a.stop()}}),a)})))}}]),t}();Hn.publicKeyUsages=["verify"],Hn.privateKeyUsages=["sign","deriveKey","deriveBits"];var Tn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).namedCurves=["Ed25519"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Hn.generateKey({name:this.name,namedCurve:e.namedCurve.replace(/^ed/i,"Ed")},t,r);case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"onSign",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Hn.sign(e,t,new Uint8Array(r)));case 1:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Hn.verify(e,t,new Uint8Array(r),new Uint8Array(n)));case 1:case"end":return a.stop()}}),a)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Hn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Hn.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,a);case 2:return o=i.sent,i.abrupt("return",o);case 4:case"end":return i.stop()}}),i,this)})))}}]),r}(hr),Dn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).namedCurves=["X25519"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Hn.generateKey({name:this.name,namedCurve:e.namedCurve.replace(/^x/i,"X")},t,r);case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"onDeriveBits",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Hn.deriveBits(Object.assign(Object.assign({},e),{public:e.public}),t,r);case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Hn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Hn.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,a);case 2:return o=i.sent,i.abrupt("return",o);case 4:case"end":return i.stop()}}),i,this)})))}}]),r}(lr),jn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA-1",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",bn.digest(e,t));case 1:case"end":return r.stop()}}),r)})))}}]),r}(qt),Fn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA-256",e}return _createClass(r)}(jn),Jn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA-512",e}return _createClass(r)}(jn),Mn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Vn={},zn={},Gn={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.mul=Math.imul||function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},e.add=function(e,t){return e+t|0},e.sub=function(e,t){return e-t|0},e.rotl=function(e,t){return e<<t|e>>>32-t},e.rotr=function(e,t){return e<<32-t|e>>>t},e.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},e.MAX_SAFE_INTEGER=9007199254740991,e.isSafeInteger=function(t){return e.isInteger(t)&&t>=-e.MAX_SAFE_INTEGER&&t<=e.MAX_SAFE_INTEGER}}(Gn),Object.defineProperty(zn,"__esModule",{value:!0});var qn=Gn;function Wn(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>8,t[r+1]=e>>>0,t}function Xn(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t}function Zn(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function $n(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Yn(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function Qn(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function ea(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>24,t[r+1]=e>>>16,t[r+2]=e>>>8,t[r+3]=e>>>0,t}function ta(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24,t}function ra(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),ea(e/4294967296>>>0,t,r),ea(e>>>0,t,r+4),t}function na(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),ta(e>>>0,t,r),ta(e/4294967296>>>0,t,r+4),t}zn.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},zn.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},zn.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},zn.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},zn.writeUint16BE=Wn,zn.writeInt16BE=Wn,zn.writeUint16LE=Xn,zn.writeInt16LE=Xn,zn.readInt32BE=Zn,zn.readUint32BE=$n,zn.readInt32LE=Yn,zn.readUint32LE=Qn,zn.writeUint32BE=ea,zn.writeInt32BE=ea,zn.writeUint32LE=ta,zn.writeInt32LE=ta,zn.readInt64BE=function(e,t){void 0===t&&(t=0);var r=Zn(e,t),n=Zn(e,t+4);return 4294967296*r+n-4294967296*(n>>31)},zn.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*$n(e,t)+$n(e,t+4)},zn.readInt64LE=function(e,t){void 0===t&&(t=0);var r=Yn(e,t);return 4294967296*Yn(e,t+4)+r-4294967296*(r>>31)},zn.readUint64LE=function(e,t){void 0===t&&(t=0);var r=Qn(e,t);return 4294967296*Qn(e,t+4)+r},zn.writeUint64BE=ra,zn.writeInt64BE=ra,zn.writeUint64LE=na,zn.writeInt64LE=na,zn.readUintBE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,a=1,i=e/8+r-1;i>=r;i--)n+=t[i]*a,a*=256;return n},zn.readUintLE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,a=1,i=r;i<r+e/8;i++)n+=t[i]*a,a*=256;return n},zn.writeUintBE=function(e,t,r,n){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===n&&(n=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!qn.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var a=1,i=e/8+n-1;i>=n;i--)r[i]=t/a&255,a*=256;return r},zn.writeUintLE=function(e,t,r,n){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===n&&(n=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!qn.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var a=1,i=n;i<n+e/8;i++)r[i]=t/a&255,a*=256;return r},zn.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},zn.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},zn.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},zn.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},zn.writeFloat32BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e),t},zn.writeFloat32LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e,!0),t},zn.writeFloat64BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e),t},zn.writeFloat64LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e,!0),t};var aa={};Object.defineProperty(aa,"__esModule",{value:!0}),aa.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e};var ia,oa=Mn&&Mn.__extends||(ia=function(e,t){return ia=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},ia(e,t)},function(e,t){function r(){this.constructor=e}ia(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(Vn,"__esModule",{value:!0});var ua=zn,sa=aa,ca=function(){function e(e){if(void 0===e&&(e=32),this.capacity=e,this._sh=new Int32Array(25),this._sl=new Int32Array(25),this._state=new Uint8Array(200),this._pos=0,this._finished=!1,this.clean=this.reset,e<=0||e>128)throw new Error("SHA3: incorrect capacity");this.blockSize=200-e}return e.prototype.reset=function(){return sa.wipe(this._sh),sa.wipe(this._sl),sa.wipe(this._state),this._pos=0,this._finished=!1,this},e.prototype.update=function(e){if(this._finished)throw new Error("SHA3: can't update because hash was finished");for(var t=0;t<e.length;t++)this._state[this._pos++]^=e[t],this._pos>=this.blockSize&&(Ba(this._sh,this._sl,this._state),this._pos=0);return this},e.prototype._padAndPermute=function(e){this._state[this._pos]^=e,this._state[this.blockSize-1]^=128,Ba(this._sh,this._sl,this._state),this._finished=!0,this._pos=0},e.prototype._squeeze=function(e){if(!this._finished)throw new Error("SHA3: squeezing before padAndPermute");for(var t=0;t<e.length;t++)this._pos===this.blockSize&&(Ba(this._sh,this._sl,this._state),this._pos=0),e[t]=this._state[this._pos++]},e}();Vn.Keccak=ca;var la=function(e){function t(t){void 0===t&&(t=32);var r=e.call(this,2*t)||this;return r.digestLength=t,r}return oa(t,e),t.prototype.finish=function(e){return this._finished?this._pos=0:this._padAndPermute(6),this._squeeze(e),this},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(this._finished)throw new Error("SHA3: cannot save finished state");return new Uint8Array(this._state.subarray(0,this._pos))},t.prototype.restoreState=function(e){return this._state.set(e),this._pos=e.length,this._finished=!1,this},t.prototype.cleanSavedState=function(e){sa.wipe(e)},t}(ca);Vn.SHA3=la;var ha=function(e){function t(){return e.call(this,28)||this}return oa(t,e),t}(la);Vn.SHA3224=ha;var fa=function(e){function t(){return e.call(this,32)||this}return oa(t,e),t}(la);Vn.SHA3256=fa;var va=function(e){function t(){return e.call(this,48)||this}return oa(t,e),t}(la);Vn.SHA3384=va;var pa=function(e){function t(){return e.call(this,64)||this}return oa(t,e),t}(la);function ya(e,t){var r=new la(e);r.update(t);var n=r.digest();return r.clean(),n}Vn.SHA3512=pa,Vn.hash=ya,Vn.hash224=function(e){return ya(28,e)};var ga=Vn.hash256=function(e){return ya(32,e)},da=Vn.hash384=function(e){return ya(48,e)},ma=Vn.hash512=function(e){return ya(64,e)},ka=function(e){function t(t){var r=e.call(this,t/8*2)||this;return r.bitSize=t,r}return oa(t,e),t.prototype.stream=function(e){this._finished||this._padAndPermute(31),this._squeeze(e)},t}(ca);Vn.SHAKE=ka;var wa=function(e){function t(){return e.call(this,128)||this}return oa(t,e),t}(ka),ba=Vn.SHAKE128=wa,_a=function(e){function t(){return e.call(this,256)||this}return oa(t,e),t}(ka),Ca=Vn.SHAKE256=_a,Sa=new Int32Array([0,0,2147483648,2147483648,0,0,2147483648,2147483648,0,0,0,0,0,2147483648,2147483648,2147483648,2147483648,2147483648,0,2147483648,2147483648,2147483648,0,2147483648]),Aa=new Int32Array([1,32898,32906,2147516416,32907,2147483649,2147516545,32777,138,136,2147516425,2147483658,2147516555,139,32905,32771,32770,128,32778,2147483658,2147516545,32896,2147483649,2147516424]);function Ba(e,t,r){for(var n,a,i,o,u,s,c,l,h,f,v,p,y=0;y<25;y++)t[y]=ua.readUint32LE(r,8*y),e[y]=ua.readUint32LE(r,8*y+4);for(var g=0;g<24;g++)n=e[0]^e[5]^e[10]^e[15]^e[20],a=e[1]^e[6]^e[11]^e[16]^e[21],i=e[2]^e[7]^e[12]^e[17]^e[22],o=e[3]^e[8]^e[13]^e[18]^e[23],u=e[4]^e[9]^e[14]^e[19]^e[24],s=t[0]^t[5]^t[10]^t[15]^t[20],c=t[1]^t[6]^t[11]^t[16]^t[21],l=t[2]^t[7]^t[12]^t[17]^t[22],h=t[3]^t[8]^t[13]^t[18]^t[23],v=u^(a<<1|c>>>31),p=(f=t[4]^t[9]^t[14]^t[19]^t[24])^(c<<1|a>>>31),e[0]^=v,e[5]^=v,e[10]^=v,e[15]^=v,e[20]^=v,t[0]^=p,t[5]^=p,t[10]^=p,t[15]^=p,t[20]^=p,v=n^(i<<1|l>>>31),p=s^(l<<1|i>>>31),e[1]^=v,e[6]^=v,e[11]^=v,e[16]^=v,e[21]^=v,t[1]^=p,t[6]^=p,t[11]^=p,t[16]^=p,t[21]^=p,v=a^(o<<1|h>>>31),p=c^(h<<1|o>>>31),e[2]^=v,e[7]^=v,e[12]^=v,e[17]^=v,e[22]^=v,t[2]^=p,t[7]^=p,t[12]^=p,t[17]^=p,t[22]^=p,v=i^(u<<1|f>>>31),p=l^(f<<1|u>>>31),e[3]^=v,t[3]^=p,e[8]^=v,t[8]^=p,e[13]^=v,t[13]^=p,e[18]^=v,t[18]^=p,e[23]^=v,t[23]^=p,v=o^(n<<1|s>>>31),p=h^(s<<1|n>>>31),e[4]^=v,e[9]^=v,e[14]^=v,e[19]^=v,e[24]^=v,t[4]^=p,t[9]^=p,t[14]^=p,t[19]^=p,t[24]^=p,v=e[1],p=t[1],n=e[10],s=t[10],e[10]=v<<1|p>>>31,t[10]=p<<1|v>>>31,v=n,p=s,n=e[7],s=t[7],e[7]=v<<3|p>>>29,t[7]=p<<3|v>>>29,v=n,p=s,n=e[11],s=t[11],e[11]=v<<6|p>>>26,t[11]=p<<6|v>>>26,v=n,p=s,n=e[17],s=t[17],e[17]=v<<10|p>>>22,t[17]=p<<10|v>>>22,v=n,p=s,n=e[18],s=t[18],e[18]=v<<15|p>>>17,t[18]=p<<15|v>>>17,v=n,p=s,n=e[3],s=t[3],e[3]=v<<21|p>>>11,t[3]=p<<21|v>>>11,v=n,p=s,n=e[5],s=t[5],e[5]=v<<28|p>>>4,t[5]=p<<28|v>>>4,v=n,p=s,n=e[16],s=t[16],e[16]=p<<4|v>>>28,t[16]=v<<4|p>>>28,v=n,p=s,n=e[8],s=t[8],e[8]=p<<13|v>>>19,t[8]=v<<13|p>>>19,v=n,p=s,n=e[21],s=t[21],e[21]=p<<23|v>>>9,t[21]=v<<23|p>>>9,v=n,p=s,n=e[24],s=t[24],e[24]=v<<2|p>>>30,t[24]=p<<2|v>>>30,v=n,p=s,n=e[4],s=t[4],e[4]=v<<14|p>>>18,t[4]=p<<14|v>>>18,v=n,p=s,n=e[15],s=t[15],e[15]=v<<27|p>>>5,t[15]=p<<27|v>>>5,v=n,p=s,n=e[23],s=t[23],e[23]=p<<9|v>>>23,t[23]=v<<9|p>>>23,v=n,p=s,n=e[19],s=t[19],e[19]=p<<24|v>>>8,t[19]=v<<24|p>>>8,v=n,p=s,n=e[13],s=t[13],e[13]=v<<8|p>>>24,t[13]=p<<8|v>>>24,v=n,p=s,n=e[12],s=t[12],e[12]=v<<25|p>>>7,t[12]=p<<25|v>>>7,v=n,p=s,n=e[2],s=t[2],e[2]=p<<11|v>>>21,t[2]=v<<11|p>>>21,v=n,p=s,n=e[20],s=t[20],e[20]=p<<30|v>>>2,t[20]=v<<30|p>>>2,v=n,p=s,n=e[14],s=t[14],e[14]=v<<18|p>>>14,t[14]=p<<18|v>>>14,v=n,p=s,n=e[22],s=t[22],e[22]=p<<7|v>>>25,t[22]=v<<7|p>>>25,v=n,p=s,n=e[9],s=t[9],e[9]=p<<29|v>>>3,t[9]=v<<29|p>>>3,v=n,p=s,n=e[6],s=t[6],e[6]=v<<20|p>>>12,t[6]=p<<20|v>>>12,v=n,p=s,n=e[1],s=t[1],e[1]=p<<12|v>>>20,t[1]=v<<12|p>>>20,v=n,p=s,n=e[0],a=e[1],i=e[2],o=e[3],u=e[4],e[0]^=~a&i,e[1]^=~i&o,e[2]^=~o&u,e[3]^=~u&n,e[4]^=~n&a,s=t[0],c=t[1],l=t[2],h=t[3],f=t[4],t[0]^=~c&l,t[1]^=~l&h,t[2]^=~h&f,t[3]^=~f&s,t[4]^=~s&c,n=e[5],a=e[6],i=e[7],o=e[8],u=e[9],e[5]^=~a&i,e[6]^=~i&o,e[7]^=~o&u,e[8]^=~u&n,e[9]^=~n&a,s=t[5],c=t[6],l=t[7],h=t[8],f=t[9],t[5]^=~c&l,t[6]^=~l&h,t[7]^=~h&f,t[8]^=~f&s,t[9]^=~s&c,n=e[10],a=e[11],i=e[12],o=e[13],u=e[14],e[10]^=~a&i,e[11]^=~i&o,e[12]^=~o&u,e[13]^=~u&n,e[14]^=~n&a,s=t[10],c=t[11],l=t[12],h=t[13],f=t[14],t[10]^=~c&l,t[11]^=~l&h,t[12]^=~h&f,t[13]^=~f&s,t[14]^=~s&c,n=e[15],a=e[16],i=e[17],o=e[18],u=e[19],e[15]^=~a&i,e[16]^=~i&o,e[17]^=~o&u,e[18]^=~u&n,e[19]^=~n&a,s=t[15],c=t[16],l=t[17],h=t[18],f=t[19],t[15]^=~c&l,t[16]^=~l&h,t[17]^=~h&f,t[18]^=~f&s,t[19]^=~s&c,n=e[20],a=e[21],i=e[22],o=e[23],u=e[24],e[20]^=~a&i,e[21]^=~i&o,e[22]^=~o&u,e[23]^=~u&n,e[24]^=~n&a,s=t[20],c=t[21],l=t[22],h=t[23],f=t[24],t[20]^=~c&l,t[21]^=~l&h,t[22]^=~h&f,t[23]^=~f&s,t[24]^=~s&c,e[0]^=Sa[g],t[0]^=Aa[g];for(y=0;y<25;y++)ua.writeUint32LE(t[y],r,8*y),ua.writeUint32LE(e[y],r,8*y+4)}var xa=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA3-256",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ga(new Uint8Array(t)).buffer);case 1:case"end":return e.stop()}}),e)})))}}]),r}(qt),Ea=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA3-384",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",da(new Uint8Array(t)).buffer);case 1:case"end":return e.stop()}}),e)})))}}]),r}(qt),Ra=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA3-512",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ma(new Uint8Array(t)).buffer);case 1:case"end":return e.stop()}}),e)})))}}]),r}(qt),Ka=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onDigest",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Uint8Array(e.length),(new ba).update(new Uint8Array(t)).stream(n),r.abrupt("return",n.buffer);case 3:case"end":return r.stop()}}),r)})))}}]),r}(rn),Oa=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onDigest",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Uint8Array(e.length),(new Ca).update(new Uint8Array(t)).stream(n),r.abrupt("return",n.buffer);case 3:case"end":return r.stop()}}),r)})))}}]),r}(nn),Na=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"secret",a)).raw=i,o}return _createClass(r)}(ln),Ua=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Na(r,n,a,s.toUint8Array(t)));case 1:case"end":return e.stop()}}),e)})))}},{key:"onDeriveBits",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=s.toUint8Array(e.salt),u=t.raw,n.t0=e.hash.name.toUpperCase(),n.next="SHA-1"===n.t0?5:"SHA-256"===n.t0?7:"SHA-512"===n.t0?9:11;break;case 5:return a=i.Pbkdf2HmacSha1(u,o,e.iterations,r>>3),n.abrupt("break",12);case 7:return a=i.Pbkdf2HmacSha256(u,o,e.iterations,r>>3),n.abrupt("break",12);case 9:return a=i.Pbkdf2HmacSha512(u,o,e.iterations,r>>3),n.abrupt("break",12);case 11:throw new Vt("algorithm.hash: '".concat(e.hash.name,"' hash algorithm is not supported"));case 12:return n.abrupt("return",s.toArrayBuffer(a));case 13:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){if(_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof Na))throw new TypeError("key: Is not PbkdfCryptoKey")}}]),r}(en),Pa={},La={readUInt32BE:function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},writeUInt32BE:function(e,t,r){e[0+r]=t>>>24,e[1+r]=t>>>16&255,e[2+r]=t>>>8&255,e[3+r]=255&t},ip:function(e,t,r,n){for(var a=0,i=0,o=6;o>=0;o-=2){for(var u=0;u<=24;u+=8)a<<=1,a|=t>>>u+o&1;for(u=0;u<=24;u+=8)a<<=1,a|=e>>>u+o&1}for(o=6;o>=0;o-=2){for(u=1;u<=25;u+=8)i<<=1,i|=t>>>u+o&1;for(u=1;u<=25;u+=8)i<<=1,i|=e>>>u+o&1}r[n+0]=a>>>0,r[n+1]=i>>>0},rip:function(e,t,r,n){for(var a=0,i=0,o=0;o<4;o++)for(var u=24;u>=0;u-=8)a<<=1,a|=t>>>u+o&1,a<<=1,a|=e>>>u+o&1;for(o=4;o<8;o++)for(u=24;u>=0;u-=8)i<<=1,i|=t>>>u+o&1,i<<=1,i|=e>>>u+o&1;r[n+0]=a>>>0,r[n+1]=i>>>0},pc1:function(e,t,r,n){for(var a=0,i=0,o=7;o>=5;o--){for(var u=0;u<=24;u+=8)a<<=1,a|=t>>u+o&1;for(u=0;u<=24;u+=8)a<<=1,a|=e>>u+o&1}for(u=0;u<=24;u+=8)a<<=1,a|=t>>u+o&1;for(o=1;o<=3;o++){for(u=0;u<=24;u+=8)i<<=1,i|=t>>u+o&1;for(u=0;u<=24;u+=8)i<<=1,i|=e>>u+o&1}for(u=0;u<=24;u+=8)i<<=1,i|=e>>u+o&1;r[n+0]=a>>>0,r[n+1]=i>>>0},r28shl:function(e,t){return e<<t&268435455|e>>>28-t}},Ia=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];La.pc2=function(e,t,r,n){for(var a=0,i=0,o=Ia.length>>>1,u=0;u<o;u++)a<<=1,a|=e>>>Ia[u]&1;for(u=o;u<Ia.length;u++)i<<=1,i|=t>>>Ia[u]&1;r[n+0]=a>>>0,r[n+1]=i>>>0},La.expand=function(e,t,r){var n=0,a=0;n=(1&e)<<5|e>>>27;for(var i=23;i>=15;i-=4)n<<=6,n|=e>>>i&63;for(i=11;i>=3;i-=4)a|=e>>>i&63,a<<=6;a|=(31&e)<<1|e>>>31,t[r+0]=n>>>0,t[r+1]=a>>>0};var Ha=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];La.substitute=function(e,t){for(var r=0,n=0;n<4;n++){r<<=4,r|=Ha[64*n+(e>>>18-6*n&63)]}for(n=0;n<4;n++){r<<=4,r|=Ha[256+64*n+(t>>>18-6*n&63)]}return r>>>0};var Ta=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];La.permute=function(e){for(var t=0,r=0;r<Ta.length;r++)t<<=1,t|=e>>>Ta[r]&1;return t>>>0},La.padSplit=function(e,t,r){for(var n=e.toString(2);n.length<t;)n="0"+n;for(var a=[],i=0;i<t;i+=r)a.push(n.slice(i,i+r));return a.join(" ")};var Da=ja;function ja(e,t){if(!e)throw new Error(t||"Assertion failed")}ja.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)};var Fa=Da;function Ja(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}var Ma=Ja;Ja.prototype._init=function(){},Ja.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},Ja.prototype._buffer=function(e,t){for(var r=Math.min(this.buffer.length-this.bufferOff,e.length-t),n=0;n<r;n++)this.buffer[this.bufferOff+n]=e[t+n];return this.bufferOff+=r,r},Ja.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},Ja.prototype._updateEncrypt=function(e){var t=0,r=0,n=(this.bufferOff+e.length)/this.blockSize|0,a=new Array(n*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(a,r)));for(var i=e.length-(e.length-t)%this.blockSize;t<i;t+=this.blockSize)this._update(e,t,a,r),r+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return a},Ja.prototype._updateDecrypt=function(e){for(var t=0,r=0,n=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,a=new Array(n*this.blockSize);n>0;n--)t+=this._buffer(e,t),r+=this._flushBuffer(a,r);return t+=this._buffer(e,t),a},Ja.prototype.final=function(e){var t,r;return e&&(t=this.update(e)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(r):r},Ja.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},Ja.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},Ja.prototype._unpad=function(e){return e},Ja.prototype._finalDecrypt=function(){Fa.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)};var Va={exports:{}},za={exports:{}};"function"==typeof Object.create?za.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:za.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}};try{var Ga=require("util");if("function"!=typeof Ga.inherits)throw"";Va.exports=Ga.inherits}catch(e){Va.exports=za.exports}var qa=Da,Wa=Va.exports,Xa=La,Za=Ma;function $a(){this.tmp=new Array(2),this.keys=null}function Ya(e){Za.call(this,e);var t=new $a;this._desState=t,this.deriveKeys(t,e.key)}Wa(Ya,Za);var Qa=Ya;Ya.create=function(e){return new Ya(e)};var ei=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];Ya.prototype.deriveKeys=function(e,t){e.keys=new Array(32),qa.equal(t.length,this.blockSize,"Invalid key length");var r=Xa.readUInt32BE(t,0),n=Xa.readUInt32BE(t,4);Xa.pc1(r,n,e.tmp,0),r=e.tmp[0],n=e.tmp[1];for(var a=0;a<e.keys.length;a+=2){var i=ei[a>>>1];r=Xa.r28shl(r,i),n=Xa.r28shl(n,i),Xa.pc2(r,n,e.keys,a)}},Ya.prototype._update=function(e,t,r,n){var a=this._desState,i=Xa.readUInt32BE(e,t),o=Xa.readUInt32BE(e,t+4);Xa.ip(i,o,a.tmp,0),i=a.tmp[0],o=a.tmp[1],"encrypt"===this.type?this._encrypt(a,i,o,a.tmp,0):this._decrypt(a,i,o,a.tmp,0),i=a.tmp[0],o=a.tmp[1],Xa.writeUInt32BE(r,i,n),Xa.writeUInt32BE(r,o,n+4)},Ya.prototype._pad=function(e,t){for(var r=e.length-t,n=t;n<e.length;n++)e[n]=r;return!0},Ya.prototype._unpad=function(e){for(var t=e[e.length-1],r=e.length-t;r<e.length;r++)qa.equal(e[r],t);return e.slice(0,e.length-t)},Ya.prototype._encrypt=function(e,t,r,n,a){for(var i=t,o=r,u=0;u<e.keys.length;u+=2){var s=e.keys[u],c=e.keys[u+1];Xa.expand(o,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=Xa.substitute(s,c),h=o;o=(i^Xa.permute(l))>>>0,i=h}Xa.rip(o,i,n,a)},Ya.prototype._decrypt=function(e,t,r,n,a){for(var i=r,o=t,u=e.keys.length-2;u>=0;u-=2){var s=e.keys[u],c=e.keys[u+1];Xa.expand(i,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=Xa.substitute(s,c),h=i;i=(o^Xa.permute(l))>>>0,o=h}Xa.rip(i,o,n,a)};var ti={},ri=Da,ni=Va.exports,ai={};function ii(e){ri.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}ti.instantiate=function(e){function t(t){e.call(this,t),this._cbcInit()}ni(t,e);for(var r=Object.keys(ai),n=0;n<r.length;n++){var a=r[n];t.prototype[a]=ai[a]}return t.create=function(e){return new t(e)},t},ai._cbcInit=function(){var e=new ii(this.options.iv);this._cbcState=e},ai._update=function(e,t,r,n){var a=this._cbcState,i=this.constructor.super_.prototype,o=a.iv;if("encrypt"===this.type){for(var u=0;u<this.blockSize;u++)o[u]^=e[t+u];i._update.call(this,o,0,r,n);for(u=0;u<this.blockSize;u++)o[u]=r[n+u]}else{i._update.call(this,e,t,r,n);for(u=0;u<this.blockSize;u++)r[n+u]^=o[u];for(u=0;u<this.blockSize;u++)o[u]=e[t+u]}};var oi=Da,ui=Va.exports,si=Ma,ci=Qa;function li(e,t){oi.equal(t.length,24,"Invalid key length");var r=t.slice(0,8),n=t.slice(8,16),a=t.slice(16,24);this.ciphers="encrypt"===e?[ci.create({type:"encrypt",key:r}),ci.create({type:"decrypt",key:n}),ci.create({type:"encrypt",key:a})]:[ci.create({type:"decrypt",key:a}),ci.create({type:"encrypt",key:n}),ci.create({type:"decrypt",key:r})]}function hi(e){si.call(this,e);var t=new li(this.type,this.options.key);this._edeState=t}ui(hi,si);var fi=hi;hi.create=function(e){return new hi(e)},hi.prototype._update=function(e,t,r,n){var a=this._edeState;a.ciphers[0]._update(e,t,r,n),a.ciphers[1]._update(r,n,r,n),a.ciphers[2]._update(r,n,r,n)},hi.prototype._pad=ci.prototype._pad,hi.prototype._unpad=ci.prototype._unpad;var vi,pi=Pa.utils=La,yi=Pa.Cipher=Ma,gi=Pa.DES=Qa,di=Pa.CBC=ti,mi=Pa.EDE=fi,ki=(vi={__proto__:null,default:Pa,utils:pi,Cipher:yi,DES:gi,CBC:di,EDE:mi},[Pa].forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(t){if("default"!==t&&!(t in vi)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(vi,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}))})),Object.freeze(vi)),wi=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"secret",a)).raw=i,o}return _createClass(r,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:h.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"DES-CBC":return"DES-CBC";case"DES-EDE3-CBC":return"3DES-CBC";default:throw new Jt("Unsupported algorithm name")}}}]),r}(ln),bi=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkLib",value:function(){if(void 0===ki)throw new Vt("Cannot implement DES mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/des.js' script to your project")}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof wi))throw new TypeError("key: Is not DesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return this.checkLib(),i=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),a.abrupt("return",new wi(t,r,n,i));case 3:case"end":return a.stop()}}),a,this)})))}},{key:"exportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="jwk"===r.t0?4:"raw"===r.t0?5:6;break;case 4:return r.abrupt("return",t.toJSON());case 5:return r.abrupt("return",t.raw.buffer);case 6:throw new Vt("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkLib(),i=Gt(t)?h.FromBase64Url(t.k):s.toArrayBuffer(t),!("DES-CBC"===r.name&&8!==i.byteLength||"DES-EDE3-CBC"===r.name&&24!==i.byteLength)){e.next=4;break}throw new Vt("keyData: Is wrong key length");case 4:return o=new wi({name:r.name,length:i.byteLength<<3},n,a,new Uint8Array(i)),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"cipher",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,o,u,c;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:this.checkLib(),i=n?"encrypt":"decrypt",u=s.toUint8Array(e.iv),a.t0=e.name.toUpperCase(),a.next="DES-CBC"===a.t0?6:"DES-EDE3-CBC"===a.t0?8:10;break;case 6:return o=di.instantiate(gi).create({key:t.raw,type:i,iv:u}),a.abrupt("break",11);case 8:return o=di.instantiate(mi).create({key:t.raw,type:i,iv:u}),a.abrupt("break",11);case 10:throw new Vt("algorithm: Is not recognized");case 11:return c=o.update(new Uint8Array(r)).concat(o.final()),a.abrupt("return",new Uint8Array(c).buffer);case 13:case"end":return a.stop()}}),a,this)})))}}]),t}(),_i=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).keySizeBits=64,e.ivSize=8,e.name="DES-CBC",e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",bi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",bi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",bi.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",bi.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",bi.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),bi.checkCryptoKey(e)}}]),r}(er),Ci=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).keySizeBits=192,e.ivSize=8,e.name="DES-EDE3-CBC",e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",bi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",bi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",bi.importKey(e,t,r,n,a));case 1:case"end":return i.stop()}}),i)})))}},{key:"onEncrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",bi.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",bi.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),bi.checkCryptoKey(e)}}]),r}(er),Si={fromJSON:function(e){return Buffer.from(h.FromBase64Url(e))},toJSON:function(e){return h.ToBase64Url(e)}},Ai=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"HMAC"},a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Uint8Array(0);return _classCallCheck(this,r),(e=t.call(this,n,a,"secret",i)).kty="oct",e.data=o,e}return _createClass(r,[{key:"alg",get:function(){var e=this.algorithm.hash.name.toUpperCase();return"HS".concat(e.replace("SHA-",""))},set:function(e){}}]),r}(ln);mt([jt({name:"ext",type:wt.Boolean,optional:!0})],Ai.prototype,"extractable",void 0),mt([jt({name:"key_ops",type:wt.String,repeated:!0,optional:!0})],Ai.prototype,"usages",void 0),mt([jt({name:"k",converter:Si})],Ai.prototype,"data",void 0),mt([jt({type:wt.String})],Ai.prototype,"kty",void 0),mt([jt({type:wt.String})],Ai.prototype,"alg",null);var Bi,xi=function(t){_inherits(n,t);var r=_createSuper(n);function n(){return _classCallCheck(this,n),r.apply(this,arguments)}return _createClass(n,[{key:"onGenerateKey",value:function(t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=t.length||this.getDefaultLength(t.hash.name),o=e.nativeCrypto.getRandomValues(new Uint8Array(i>>3)),u=new Ai(t,r,n,o),a.abrupt("return",u);case 4:case"end":return a.stop()}}),a,this)})))}},{key:"onSign",value:function(e,t,r){return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.algorithm.hash.name.toUpperCase(),e.next="SHA-1"===e.t0?3:"SHA-256"===e.t0?5:"SHA-512"===e.t0?7:9;break;case 3:return n=i.HmacSha1,e.abrupt("break",10);case 5:return n=i.HmacSha256,e.abrupt("break",10);case 7:return n=i.HmacSha512,e.abrupt("break",10);case 9:throw new Vt("key.algorithm.hash: Is not recognized");case 10:return a=new n(t.data).process(s.toUint8Array(r)).finish().result,e.abrupt("return",s.toArrayBuffer(a));case 12:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,t,r,n){return kt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.onSign(e,t,n);case 2:return i=a.sent,a.abrupt("return",h.ToHex(i)===h.ToHex(r));case 4:case"end":return a.stop()}}),a,this)})))}},{key:"onImportKey",value:function(e,t,r,n,a){return kt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:i.t0=e.toLowerCase(),i.next="jwk"===i.t0?3:"raw"===i.t0?5:9;break;case 3:return o=Tt.fromJSON(t,{targetSchema:Ai}),i.abrupt("break",10);case 5:if(s.isBufferSource(t)){i.next=7;break}throw new TypeError("keyData: Is not ArrayBuffer or ArrayBufferView");case 7:return o=new Ai(r,n,a,s.toUint8Array(t)),i.abrupt("break",10);case 9:throw new Vt("format: Must be 'jwk' or 'raw'");case 10:return o.algorithm={hash:{name:r.hash.name},name:this.name,length:o.data.length<<3},o.extractable=n,o.usages=a,i.abrupt("return",o);case 14:case"end":return i.stop()}}),i,this)})))}},{key:"onExportKey",value:function(e,t){return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e.toLowerCase(),r.next="jwk"===r.t0?3:"raw"===r.t0?5:6;break;case 3:return n=Ht.toJSON(t),r.abrupt("return",n);case 5:return r.abrupt("return",new Uint8Array(t.data).buffer);case 6:throw new Vt("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r)})))}},{key:"checkCryptoKey",value:function(e,t){if(_get(_getPrototypeOf(n.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof Ai))throw new TypeError("key: Is not HMAC CryptoKey")}}]),n}(Qr),Ei=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,i,o){var u;return _classCallCheck(this,r),u=t.call(this,e,n,a,i),Bi.set(_assertThisInitialized(u),void 0),function(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?a.call(e,r):a?a.value=r:t.set(e,r)}(_assertThisInitialized(u),Bi,o,"f"),u}return _createClass(r,[{key:"getNative",value:function(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Bi,"f")}}]),r}(ln);Bi=new WeakMap;var Ri=function(t){_inherits(n,t);var r=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=r.call(this)).browserInfo=function(){var e={name:Yr.Unknown,version:"0"};if("undefined"==typeof self)return e;var t,r=self.navigator.userAgent;return(t=/edge\/([\d\.]+)/i.exec(r))?(e.name=Yr.Edge,e.version=t[1]):/msie/i.test(r)?(e.name=Yr.IE,e.version=/msie ([\d\.]+)/i.exec(r)[1]):/Trident/i.test(r)?(e.name=Yr.IE,e.version=/rv:([\d\.]+)/i.exec(r)[1]):/chrome/i.test(r)?(e.name=Yr.Chrome,e.version=/chrome\/([\d\.]+)/i.exec(r)[1]):/firefox/i.test(r)?(e.name=Yr.Firefox,e.version=/firefox\/([\d\.]+)/i.exec(r)[1]):/mobile/i.test(r)?(e.name=Yr.Mobile,e.version=/mobile\/([\w]+)/i.exec(r)[1]):/safari/i.test(r)&&(e.name=Yr.Safari,e.version=/version\/([\d\.]+)/i.exec(r)[1]),e}(),e.providers.set(new pn),e.providers.set(new dn),e.providers.set(new yn),e.providers.set(new gn),e.providers.set(new mn),e.providers.set(new _i),e.providers.set(new Ci),e.providers.set(new Sn),e.providers.set(new Cn),e.providers.set(new _n),e.providers.set(new An),e.providers.set(new Nn),e.providers.set(new Kn),e.providers.set(new jn),e.providers.set(new Fn),e.providers.set(new Jn),e.providers.set(new Ua),e.providers.set(new xi),e.providers.set(new Tn),e.providers.set(new Dn),e.providers.set(new xa),e.providers.set(new Ea),e.providers.set(new Ra),e.providers.set(new Ka),e.providers.set(new Oa),e}return _createClass(n,[{key:"digest",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["digest"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"importKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.fixFirefoxEcImportPkcs8(t),e.abrupt("return",this.wrapNative.apply(this,["importKey"].concat(t)));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"exportKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fixFirefoxEcExportPkcs8(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return e.next=6,this.wrapNative.apply(this,["exportKey"].concat(t));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"generateKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["generateKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"sign",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["sign"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"verify",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["verify"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["encrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"decrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["decrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["wrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"unwrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["unwrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveBits",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveBits"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapNative",value:function(t){for(var r=this,a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var u=function(e){return _get(_getPrototypeOf(n.prototype),e,r)};return kt(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,o,s,c,l,f,v,p,y,g,d,m,k,w,b,_;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(~["generateKey","unwrapKey","deriveKey","importKey"].indexOf(t)&&this.fixAlgorithmName(i),r.prev=1,"digest"===t&&i.some((function(e){return e instanceof ln}))){r.next=9;break}return a=this.fixNativeArguments(t,i),sn.info("Call native '".concat(t,"' method"),a),r.next=7,e.nativeSubtle[t].apply(e.nativeSubtle,a);case 7:return o=r.sent,r.abrupt("return",this.fixNativeResult(t,i,o));case 9:r.next=14;break;case 11:r.prev=11,r.t0=r.catch(1),sn.warn("Error on native '".concat(t,"' calling. ").concat(r.t0.message),r.t0);case 14:if("wrapKey"!==t){r.next=30;break}return r.prev=15,sn.info("Trying to wrap key by using native functions",i),r.next=19,this.exportKey(i[0],i[1]);case 19:return s=r.sent,c="jwk"===i[0]?h.FromUtf8String(JSON.stringify(s)):s,r.next=23,this.encrypt(i[3],i[2],c);case 23:return l=r.sent,r.abrupt("return",l);case 27:r.prev=27,r.t1=r.catch(15),sn.warn("Cannot wrap key by native functions. ".concat(r.t1.message),r.t1);case 30:if("unwrapKey"!==t){r.next=46;break}return r.prev=31,sn.info("Trying to unwrap key by using native functions",i),r.next=35,this.decrypt(i[3],i[2],i[1]);case 35:return f=r.sent,v="jwk"===i[0]?JSON.parse(h.ToUtf8String(f)):f,r.next=39,this.importKey(i[0],v,i[4],i[5],i[6]);case 39:return p=r.sent,r.abrupt("return",p);case 43:r.prev=43,r.t2=r.catch(31),sn.warn("Cannot unwrap key by native functions. ".concat(r.t2.message),r.t2);case 46:if("deriveKey"!==t){r.next=61;break}return r.prev=47,sn.info("Trying to derive key by using native functions",i),r.next=51,this.deriveBits(i[0],i[1],i[2].length);case 51:return y=r.sent,r.next=54,this.importKey("raw",y,i[2],i[3],i[4]);case 54:return g=r.sent,r.abrupt("return",g);case 58:r.prev=58,r.t3=r.catch(47),sn.warn("Cannot derive key by native functions. ".concat(r.t3.message),r.t3);case 61:if("deriveBits"!==t&&"deriveKey"!==t){r.next=81;break}d=_createForOfIteratorHelper(i),r.prev=63,d.s();case 65:if((m=d.n()).done){r.next=73;break}if("object"!==_typeof(k=m.value)||!k.public||!n.isAnotherKey(k.public)){r.next=71;break}return r.next=70,this.castKey(k.public);case 70:k.public=r.sent;case 71:r.next=65;break;case 73:r.next=78;break;case 75:r.prev=75,r.t4=r.catch(63),d.e(r.t4);case 78:return r.prev=78,d.f(),r.finish(78);case 81:w=0;case 82:if(!(w<i.length)){r.next=91;break}if(b=i[w],!n.isAnotherKey(b)){r.next=88;break}return r.next=87,this.castKey(b);case 87:i[w]=r.sent;case 88:w++,r.next=82;break;case 91:if("function"!=typeof(_=u(t))){r.next=94;break}return r.abrupt("return",_.apply(this,i));case 94:throw new Error("Incorrect type of 'method'. Must be 'function'.");case 95:case"end":return r.stop()}}),r,this,[[1,11],[15,27],[31,43],[47,58],[63,75,78,81]])})))}},{key:"fixNativeArguments",value:function(e,t){var r,n,a,i,o,u,c,l,f=_toConsumableArray(t);if("importKey"===e&&(this.browserInfo.name!==Yr.IE||"jwk"!==(null===(n=null===(r=f[0])||void 0===r?void 0:r.toLowerCase)||void 0===n?void 0:n.call(r))||s.isBufferSource(f[1])||(f[1]=h.FromUtf8String(JSON.stringify(f[1])))),this.browserInfo.name===Yr.IE&&t[1]instanceof Ei)switch(e){case"sign":case"verify":case"encrypt":case"decrypt":f[0]=Object.assign(Object.assign({},this.prepareAlgorithm(f[0])),{hash:null===(o=null===(i=null===(a=f[1])||void 0===a?void 0:a.algorithm)||void 0===i?void 0:i.hash)||void 0===o?void 0:o.name});break;case"wrapKey":case"unwrapKey":f[4]=Object.assign(Object.assign({},this.prepareAlgorithm(f[4])),{hash:null===(l=null===(c=null===(u=f[3])||void 0===u?void 0:u.algorithm)||void 0===c?void 0:c.hash)||void 0===l?void 0:l.name})}for(var v=0;v<f.length;v++){var p=f[v];p instanceof Ei&&(f[v]=p.getNative())}return f}},{key:"fixNativeResult",value:function(e,t,r){var n,a;if(this.browserInfo.name===Yr.IE){if("exportKey"===e&&"jwk"===(null===(a=null===(n=t[0])||void 0===n?void 0:n.toLowerCase)||void 0===a?void 0:a.call(n))&&r instanceof ArrayBuffer)return JSON.parse(h.ToUtf8String(r));if("privateKey"in r){var i=["sign","decrypt","unwrapKey","deriveKey","deriveBits"],o=["verify","encrypt","wrapKey"];return{privateKey:this.wrapNativeKey(r.privateKey,t[0],t[1],t[2].filter((function(e){return i.includes(e)}))),publicKey:this.wrapNativeKey(r.publicKey,t[0],t[1],t[2].filter((function(e){return o.includes(e)})))}}if("extractable"in r){var u,s;switch(e){case"importKey":u=t[2],s=t[4];break;case"unwrapKey":u=t[4],s=t[6];break;case"generateKey":u=t[0],s=t[2];break;default:throw new Vt("Cannot wrap native key. Unsupported method in use")}return this.wrapNativeKey(r,u,r.extractable,s)}}return r}},{key:"wrapNativeKey",value:function(e,t,r,n){if(this.browserInfo.name===Yr.IE){var a=["RSASSA-PKCS1-v1_5","RSA-PSS","RSA-OAEP","AES-CBC","AES-CTR","AES-KW","HMAC"],i=a.map((function(e){return e.toLowerCase()})).indexOf(e.algorithm.name.toLowerCase());if(-1!==i){var o=this.prepareAlgorithm(t),u=Object.assign(Object.assign({},e.algorithm),{name:a[i]});return un.isHashedAlgorithm(o)&&(u.hash={name:o.hash.name.toUpperCase()}),sn.info("Wrapping ".concat(a[i]," crypto key to WrappedNativeCryptoKey")),new Ei(u,r,e.type,n,e)}}return e}},{key:"castKey",value:function(e){return kt(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(sn.info("Cast native CryptoKey to linter key.",e),e.extractable){t.next=3;break}throw new Error("Cannot cast unextractable crypto key");case 3:return r=this.getProvider(e.algorithm.name),t.next=6,this.exportKey("jwk",e);case 6:return n=t.sent,t.abrupt("return",r.importKey("jwk",n,e.algorithm,!0,e.usages));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"fixAlgorithmName",value:function(e){if(this.browserInfo.name===Yr.Edge)for(var t=0;t<e.length;t++){var r=e[0];if("string"==typeof r){var n,a=_createForOfIteratorHelper(this.providers.algorithms);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.toLowerCase()===r.toLowerCase()){e[t]=i;break}}}catch(e){a.e(e)}finally{a.f()}}else if("object"===_typeof(r)&&"string"==typeof r.name){var o,u=_createForOfIteratorHelper(this.providers.algorithms);try{for(u.s();!(o=u.n()).done;){var s=o.value;s.toLowerCase()===r.name.toLowerCase()&&(r.name=s),("string"==typeof r.hash&&s.toLowerCase()===r.hash.toLowerCase()||"object"===_typeof(r.hash)&&"string"==typeof r.hash.name&&s.toLowerCase()===r.hash.name.toLowerCase())&&(r.hash={name:s})}}catch(e){u.e(e)}finally{u.f()}}}}},{key:"fixFirefoxEcImportPkcs8",value:function(e){var t=this.prepareAlgorithm(e[2]),r=t.name.toUpperCase();if(this.browserInfo.name===Yr.Firefox&&"pkcs8"===e[0]&&~["ECDSA","ECDH"].indexOf(r)&&~["P-256","P-384","P-521"].indexOf(t.namedCurve)){if(!s.isBufferSource(e[1]))throw new TypeError("data: Is not ArrayBuffer or ArrayBufferView");var n=s.toArrayBuffer(e[1]),a=dt.parse(n,Zr.PrivateKeyInfo),i=dt.parse(a.privateKey,Zr.EcPrivateKey),o=Ht.toJSON(i);o.ext=!0,o.key_ops=e[4],o.crv=t.namedCurve,o.kty="EC",e[0]="jwk",e[1]=o}}},{key:"fixFirefoxEcExportPkcs8",value:function(e){return kt(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.browserInfo.name!==Yr.Firefox||"pkcs8"!==e[0]||!~["ECDSA","ECDH"].indexOf(e[1].algorithm.name)||!~["P-256","P-384","P-521"].indexOf(e[1].algorithm.namedCurve)){t.next=11;break}return t.next=4,this.exportKey("jwk",e[1]);case 4:return r=t.sent,n=Tt.fromJSON(r,{targetSchema:Zr.EcPrivateKey}),(a=new Zr.PrivateKeyInfo).privateKeyAlgorithm.algorithm=Rn.ASN_ALGORITHM,a.privateKeyAlgorithm.parameters=dt.serialize(new Zr.ObjectIdentifier(xn(e[1].algorithm.namedCurve))),a.privateKey=dt.serialize(n),t.abrupt("return",dt.serialize(a));case 11:t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(0),sn.error(t.t0),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t,this,[[0,13]])})))}}],[{key:"isAnotherKey",value:function(e){return"object"===_typeof(e)&&"string"==typeof e.type&&"boolean"==typeof e.extractable&&"object"===_typeof(e.algorithm)&&!(e instanceof ln)}}]),n}(un);Ri.methods=["digest","importKey","exportKey","sign","verify","generateKey","encrypt","decrypt","deriveBits","deriveKey","wrapKey","unwrapKey"];var Ki=function(t){_inherits(n,t);var r=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=r.apply(this,arguments)).subtle=new Ri,e}return _createClass(n,[{key:"nativeCrypto",get:function(){return e.nativeCrypto}},{key:"getRandomValues",value:function(t){return e.nativeCrypto.getRandomValues(t)}}]),n}(an);function Oi(e,t){var r=e[t];e[t]=function(){var n=arguments;return new Promise((function(a,i){var o=r.apply(e,n);o.oncomplete=function(e){a(e.target.result)},o.onerror=function(e){i("Error on running '".concat(t,"' function"))}}))}}"undefined"!=typeof self&&self.msCrypto&&(Oi(e.nativeSubtle,"generateKey"),Oi(e.nativeSubtle,"digest"),Oi(e.nativeSubtle,"sign"),Oi(e.nativeSubtle,"verify"),Oi(e.nativeSubtle,"encrypt"),Oi(e.nativeSubtle,"decrypt"),Oi(e.nativeSubtle,"importKey"),Oi(e.nativeSubtle,"exportKey"),Oi(e.nativeSubtle,"wrapKey"),Oi(e.nativeSubtle,"unwrapKey"),Oi(e.nativeSubtle,"deriveKey"),Oi(e.nativeSubtle,"deriveBits")),Math.imul||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0});var Ni=self;e.nativeCrypto&&Object.freeze(e.nativeCrypto.getRandomValues);try{delete self.crypto,Ni.crypto=new Ki,Object.freeze(Ni.crypto)}catch(e){sn.error(e)}var Ui=Ni.crypto;return e.Crypto=Ki,e.CryptoKey=ln,e.crypto=Ui,e.setCrypto=function(t){e.nativeCrypto=t,e.nativeSubtle=t.subtle},Object.defineProperty(e,"__esModule",{value:!0}),e}({},self.asmCrypto,self.elliptic);
